{"pageProps":{"post":{"title":"당신의 NextJs 프로젝트에 PayPal Checkout 통합하기","description":"","date":"2024-05-12 23:01","slug":"2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject","content":"\n\n## NEXT.JS 앱 라우터에 관한 기사\n\n![이미지](/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_0.png)\n\n참고: Next.Js 앱 라우터를 사용할 것입니다. 페이지 라우터가 아닙니다.\n\n간단한 전자상거래 스토어를 만드는 데 항상 고민했었습니다. 카트와 체크아웃이 제 머리를 얽히게 만들었는데, Stripe, PayPal 또는 심지어 Square를 웹사이트에 통합하려고 노력했기 때문입니다.\n\n\n\n하지만 전자 상거래 스토어에서의 고난이 그치지 않았습니다. 결제 통합 시에도 고난이 있었습니다. 그래서 웹사이트용 결제 포털을 만드는 일에 나는 압도되었습니다. \"이걸 어떻게 해야하지?\"라고 스스로 물었습니다.\n\nSquare는 웹사이트에 통합하기 가장 어려운 지불 프로세서입니다. 대면 거래에 더 적합합니다. 그럼에도 불구하고 Square로 설정을 해보았지만 전혀 실패했습니다.\n\n이어 Stripe로 넘어가 보겠습니다. 이것은 온라인 비즈니스에 좋은 옵션입니다. 그러나 고객 서비스와 관련된 다른 문제로 통합에 들어가기 전에 실패했습니다. 그래서 다른 것을 찾아봐야 했습니다.\n\n마지막으로 PayPal을 시도해 본 결과, 다른 온라인 비즈니스에서 성공을 들은 뒤, PayPal로 결제 포털을 만드는 데 성공했습니다. 이제 그 방법을 보여드릴 차례입니다. 그러니 함께 알아보겠습니다:\n\n\n\n# 시작하기\n\n![이미지](/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_1.png)\n\n알겠어요. 저는 뭔가 간단한 것을 이루고 싶었어요. 사용자가 지불할 금액을 선택하고 지불하도록 하고 싶었어요. 그건 충분히 간단한 목표죠.\n\n시작하려면 API 엔드포인트를 만드는 방법이 필요합니다. 우리는 App Router를 사용하기 때문에 API 엔드포인트에 대한 제 게시물을 확인해주세요.\n\n\n\n만약 당신이 이 글을 읽고 있고 Next.Js 프로젝트를 어떻게 생성하는지 모른다면 뭐하고 있는 거야!? 어쨌든, Next.Js 프로젝트를 만들려면 터미널에서 npx create-next-app@latest을 실행하면 됩니다.\n\n# 금액 구하는 중\n\n이어서, 지불 포털용 페이지를 생성하세요. 또한, 처음에 payment-form이라고 이름 지은 컴포넌트를 만드세요. 왜냐하면 금액 페이지를 체크아웃 페이지와 결합할 것이라고 생각했기 때문입니다. 그러나 결국 그렇게 하지 않았습니다.\n\n그리고 우리가 하는 동안, API 엔드포인트와 이를 위해 필요한 나머지 파일들도 만들어봅시다. 마지막에는 이렇게 된 것처럼 보일 거에요:\n\n\n\n```js\n프로젝트/\n│\n├──페이지/api/\n│   ├── get-token.ts\n|   ├── paypal-client-id.ts\n|   ├── paypal.ts\n└──src/app\n    ├──결제-포털/\n    │   ├── page.tsx\n    └── 결제-페이지/\n    │  ├── page.tsx\n    ├── 컴포넌트/\n    │   ├── payment-form.tsx\n    │   ├── paypal-buttons.tsx\n    ├── layout.tsx\n    ├── page.tsx\n```\n\n우리는 `payment-form.tsx` 파일 맨 위에 ‘use client’를 추가해서, 이 파일의 코드를 기본 서버 측이 아닌 클라이언트 측으로 만들 수 있습니다.\n\n또한, react에서 `useState` 훅과 axios, 그리고 next/navigation에서 `useRouter` 훅을 import 해보겠습니다:\n\n```js\n'use client';\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { useRouter } from 'next/navigation';\n```\n\n\n\n이제 PaymentFormProps 인터페이스를 사용하여 PaymentForm 컴포넌트의 예상 프롭을 정의해 봅시다.\n\n```js\ninterface PaymentFormProps {\n  onSuccess: (orderId: string) => void;\n}\n```\n\n우리는 onSuccess를 프롭으로 받는 함수형 컴포넌트를 정의해야 합니다. 이를 PaymentForm이라고 부르겠습니다.\n\n```js\nconst PaymentForm: React.FC<PaymentFormProps> = ({ onSuccess }) => {\n\n}\n```\n\n\n이제, handlePaymentSubmit이란 이름의 함수를 만들어서 결제 양식 제출을 처리하는 함수를 만들겠습니다. 이 함수는 POST 요청을 사용하여 api/paypal로 결제 양식을 제출하려 합니다. 성공하면 Payment-Page로 이동합니다. 실패하면 오류 메시지를 표시합니다:\n\n```js\n  const handlePaymentSubmit = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const response = await axios.post('/api/paypal', { amount });\n\n      setLoading(false);\n\n      if (response.data.success) {\n        onSuccess(response.data.orderId);\n        router.push(`/Payment-Page?amount=${amount}`);\n      } else {\n        setError(response.data.error);\n      }\n    } catch (error) {\n      console.error('결제 초기화 오류:', error);\n      setLoading(false);\n      setError('결제 초기화 중 오류가 발생했습니다. 나중에 다시 시도해주세요.');\n    }\n  };\n```\n\n마지막으로, 입력 필드와 제출 버튼을 추가하겠습니다:\n\n```js\n  return (\n    <div className=\"flex flex-col gap-4 items-center\">\n      <label>\n        금액 입력:\n      </label>\n      <input type=\"number\" name=\"amount\" value={amount} onChange={handleAmountChange} className='text-black text-xl font-semibold p-2 rounded'/>\n      <button onClick={handlePaymentSubmit} disabled={loading} className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2\">\n        {loading ? '처리 중...' : '결제 제출'}\n      </button>\n      {error && <p>오류: {error}</p>}\n    </div>\n  );\n```\n\n\n\n새로운 코드 아래에 `export default PaymentForm;`를 추가해주세요.\n\n최종 payment-form.tsx 코드는 다음과 같이 보여야 합니다:\n\n```js\n'use client';\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { useRouter } from 'next/navigation';\n\ninterface PaymentFormProps {\n  onSuccess: (orderId: string) => void;\n}\n\nconst PaymentForm: React.FC<PaymentFormProps> = ({ onSuccess }) => {\n  const router = useRouter();\n  const [amount, setAmount] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleAmountChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setAmount(Number(event.target.value));\n  };\n\n  const handlePaymentSubmit = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      const response = await axios.post('/api/paypal', { amount });\n\n      setLoading(false);\n\n      if (response.data.success) {\n        onSuccess(response.data.orderId);\n        router.push(`/Payment-Page?amount=${amount}`);\n      } else {\n        setError(response.data.error);\n      }\n    } catch (error) {\n      console.error('Error initiating payment:', error);\n      setLoading(false);\n      setError('An error occurred while initiating payment. Please try again later.');\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 items-center\">\n      <label>\n        Enter Amount: \n      </label>\n      <input type=\"number\" name=\"amount\" value={amount} onChange={handleAmountChange} className='text-black text-xl font-semibold p-2 rounded'/>\n      <button onClick={handlePaymentSubmit} disabled={loading} className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2\">\n        {loading ? 'Processing...' : 'Submit Payment'}\n      </button>\n      {error && <p>Error: {error}</p>}\n    </div>\n  );\n};\n\nexport default PaymentForm;\n```\n\n# 주문 생성하기\n\n\n\npaypal.ts 파일에 NextApiRequest와 NextApiResponse를 next에서, axios를 그리고 get-token.ts에서 getToken을 import해서 추가해봐요. getToken 코드는 나중에 보여줄게요.\n\n```js\nimport { NextApiRequest, NextApiResponse } from 'next';\nimport axios from 'axios';\nimport getToken from './get-token ';\n```\n\n이제 API 엔드포인트를 만들어봅시다. 먼저 HTTP 메소드가 POST인지 확인한 후, 요청 본문에서 amount를 추출해요. 우리는 getToken 함수를 호출해서 액세스 토큰을 받을 거에요. PayPal에서 생성된 액세스 토큰은 .env 파일에 있어야 해요. 코드는 그런 다음 PayPal API로 POST 요청을 보낼 거에요:\n\n```js\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method === 'POST') {\n    try {\n      const { amount } = req.body;\n      const accessToken = await getToken();\n\n      const paypalResponse = await axios.post(\n        'https://api.paypal.com/v2/checkout/orders',\n        {\n          intent: 'CAPTURE',\n          purchase_units: [\n            {\n              amount: {\n                currency_code: 'USD',\n                value: amount.toString(),\n              },\n            },\n          ],\n        },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${accessToken}`,\n          },\n        }\n      );\n\n      const { id: orderId } = paypalResponse.data;\n\n      res.status(200).json({ success: true, orderId });\n    } catch (error) {\n      console.error('PayPal API error:', error);\n      res.status(500).json({ success: false, error: 'Internal server error' });\n    }\n  } else {\n    res.status(405).json({ success: false, error: 'Method not allowed' });\n  }\n}\n```\n\n\n\n위의 코드를 한국어로 번역하면 다음과 같습니다:\n\n```js\nimport { NextApiRequest, NextApiResponse } from 'next';\nimport axios from 'axios';\nimport getToken from './get-token';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method === 'POST') {\n    try {\n      const { amount } = req.body;\n      const accessToken = await getToken();\n\n      const paypalResponse = await axios.post(\n        'https://api.paypal.com/v2/checkout/orders',\n        {\n          intent: 'CAPTURE',\n          purchase_units: [\n            {\n              amount: {\n                currency_code: 'USD',\n                value: amount.toString(),\n              },\n            },\n          ],\n        },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${accessToken}`,\n          },\n        }\n      );\n\n      const { id: orderId } = paypalResponse.data;\n\n      res.status(200).json({ success: true, orderId });\n    } catch (error) {\n      console.error('PayPal API 에러:', error);\n      res.status(500).json({ success: false, error: '내부 서버 오류' });\n    }\n  } else {\n    res.status(405).json({ success: false, error: '허용되지 않은 메소드' });\n  }\n}\n```\n\n# Access Token 가져오기\n\nget-token.ts 코드에 추가할 예정입니다.\n\n\n\naxios를 가져와봐요:\n\n```js\nimport axios from 'axios';\n```\n\n그리고 PAYPAL_CLIENT_ID 및 PAYPAL_CLIENT_SECRET를 환경 변수에서 가져와요:\n\n```js\nconst CLIENT_ID = process.env.PAYPAL_CLIENT_ID;\nconst CLIENT_SECRET = process.env.PAYPAL_CLIENT_SECRET;\n```\n\n\n\n그럼 우리는 PayPal API에서 액세스 토큰을 검색하는 getToken이라는 비동기 함수를 만들고 싶어요:\n\n```js\nconst getToken = async () => {\n  const credentials = Buffer.from(`${CLIENT_ID}:${CLIENT_SECRET}`).toString('base64');\n\n  const response = await axios.post(\n    'https://api.paypal.com/v1/oauth2/token',\n    'grant_type=client_credentials',\n    {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        Authorization: `Basic ${credentials}`,\n      },\n    }\n  );\n\n  return response.data.access_token;\n};\n\nexport default getToken;\n```\n\n전체 코드는 다음과 같습니다:\n\n```js\nimport axios from 'axios';\n\nconst CLIENT_ID = process.env.PAYPAL_CLIENT_ID;\nconst CLIENT_SECRET = process.env.PAYPAL_CLIENT_SECRET;\n\nconst getToken = async () => {\n  const credentials = Buffer.from(`${CLIENT_ID}:${CLIENT_SECRET}`).toString('base64');\n\n  const response = await axios.post(\n    'https://api.paypal.com/v1/oauth2/token',\n    'grant_type=client_credentials',\n    {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        Authorization: `Basic ${credentials}`,\n      },\n    }\n  );\n\n  return response.data.access_token;\n};\n\nexport default getToken;\n```\n\n\n\n# PayPal 버튼 만들기\n\nPayPal 버튼을 만들기 위해 paypal-buttons.tsx 파일을 서버 측이 아닌 클라이언트 측으로 변경해 보겠습니다. ‘use client’를 추가해 주세요. 그리고 여기서 react에서 useEffect 훅을 import해 주세요:\n\n```js\n'use client';\nimport React, { useEffect } from 'react';\n```\n\nTypeScript를 사용하기 때문에 전역 창에 속성을 추가하여 오류를 방지해 보겠습니다:\n\n\n\n```js\n전역을 선언합니다:\n   \n```typescript\ndeclare global {\n    interface Window {\n      paypal?: any;\n    }\n}\n```\n\n이제 네 개의 속성 유형을 지정하는 객체를 인수로 취하는 함수형 컴포넌트를 정의해야 합니다:\n\n```js\nconst PayPalPaymentButton = ({ amount, paypalClientId, onSuccess, onError }: { amount: number; paypalClientId: string | null; onSuccess: () => void; onError: (err: any) => void; }) => {\n\n}\n```\n\n함수형 컴포넌트인 PayPalPaymentButton 안에서 useEffect를 사용하여 컴포넌트가 마운트될 때 PayPal SDK 스크립트를 DOM에 추가하세요:\n\n\n\n```js\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = `https://www.paypal.com/sdk/js?client-id=${paypalClientId}`;\n    script.async = true;\n    script.onload = () => {\n      initializePayPalButton();\n    };\n    document.body.appendChild(script);\n\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, []);\n```\n\n이제 웹페이지에 PayPal 버튼을 렌더링하는 함수를 만들어봅시다:\n\n```js\n  const initializePayPalButton = () => {\n    window.paypal.Buttons({\n      createOrder: function(data: any, actions: any) {\n        return actions.order.create({\n          purchase_units: [{\n            amount: {\n              value: amount,\n              currency_code: 'USD', // 원하는 통화로 변경\n            },   \n            application_context: {\n              user_action: 'PAY_NOW',\n              shipping_preference: 'NO_SHIPPING',\n              payment_method: { payee_preferred: 'IMMEDIATE_PAYMENT_REQUIRED' },\n              return_url: 'https://YOUR_WEBSITE_URL',\n              cancel_url: 'https://YOUR_WEBSITE_URL',\n            },\n          }],\n        });\n      },\n      onApprove: function(data:any, actions:any) {\n        return actions.order.capture().then(function(details: any) {\n          onSuccess();\n        });\n      },\n      onError: function(err: any) {\n        onError(err);\n      },\n    }).render('#paypal-button-container');\n  };\n```\n\n이제 버튼을 표시하는 것만 남았습니다:\n```\n\n\n\n```js\nreturn <div id=\"paypal-button-container\" className='bg-gray-200'></div>;\n```\n\n최종 코드:\n\n```js\n'use client';\nimport React, { useEffect } from 'react';\n\ndeclare global {\n    interface Window {\n      paypal?: any;\n    }\n}\n\nconst PayPalPaymentButton = ({ amount, paypalClientId, onSuccess, onError }: { amount: number; paypalClientId: string | null; onSuccess: () => void; onError: (err: any) => void; }) => {\n  useEffect(() => {\n    const script = document.createElement('script');\n    script.src = `https://www.paypal.com/sdk/js?client-id=${paypalClientId}`;\n    script.async = true;\n    script.onload = () => {\n      initializePayPalButton();\n    };\n    document.body.appendChild(script);\n\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, []);\n\n  const initializePayPalButton = () => {\n    window.paypal.Buttons({\n      createOrder: function(data: any, actions: any) {\n        return actions.order.create({\n          purchase_units: [{\n            amount: {\n              value: amount,\n              currency_code: 'USD',\n            },   \n            application_context: {\n              user_action: 'PAY_NOW',\n              shipping_preference: 'NO_SHIPPING',\n              payment_method: { payee_preferred: 'IMMEDIATE_PAYMENT_REQUIRED' },\n              return_url: 'https://YOUR_WEBSITE_URL',\n              cancel_url: 'https://YOUR_WEBSITE_URL',\n            },\n          }],\n        });\n      },\n      onApprove: function(data:any, actions:any) {\n        return actions.order.capture().then(function(details: any) {\n          onSuccess();\n        });\n      },\n      onError: function(err: any) {\n        onError(err);\n      },\n    }).render('#paypal-button-container');\n  };\n\n  return <div id=\"paypal-button-container\" className='bg-gray-200'></div>;\n};\n\nexport default PayPalPaymentButton;\n```\n\n# PayPal 클라이언트 ID 가져오기\n\n\n\n나중에 필요할 것이므로 지금 처리해 봐요. 당신의 paypal-client-id는 환경 변수 중에 PAYPAL_CLIENT_ID가 있는지 확인하고 그것을 클라이언트 쪽으로 보내요:\n\n```js\nimport { NextApiRequest, NextApiResponse } from 'next';\n\nexport default function handler(req: NextApiRequest, res: NextApiResponse) {\n  const paypalClientId = process.env.PAYPAL_CLIENT_ID;\n\n  if (!paypalClientId) {\n    return res.status(500).json({ error: 'PayPal client ID not found.' });\n  }\n\n  return res.status(200).json({ paypalClientId });\n}\n``` \n\n# Payment-Portal Page.tsx에 코드 추가하기\n\n\n\n```js\nimport PaymentComponent from \"../components/payment-form\";\n```\n\n결제 성공에 대한 함수를 정의하세요:\n\n```js\n  const handlePaymentSuccess = (orderId: string) => {\n    console.log('결제 성공! 주문 ID:', orderId);\n  };\n```\n\nPaymentComponent를 반환하세요:\n\n\n\n```jsx\n  return (\n    <main>\n      <div>\n        <PaymentComponent onSuccess={handlePaymentSuccess} />\n      </div>\n    </main>\n  );\n```\n\n# Payment-Page 페이지에 코드 추가하기\n\n파일의 맨 위에 'use client';를 추가해야 합니다. 그 다음으로 useEffect 훅, useState 훅, 그리고 Suspense를 react에서 임포트해주세요. 또한 next/navigation에서 useRouter와 useSearchParams를 임포트해주세요. 마지막으로 paypal-buttons.tsx에서 PayPalPaymentButtons를 임포트해주세요:\n\n```jsx\n'use client';\nimport React, { useEffect, useState, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport PayPalPaymentButtons from '../ui/PayPalButtons';\n```\n\n\n\n이제 paymentPage라는 기능 구성 요소를 만들 수 있습니다. 내부에서 useRouter 훅을 사용하여 router 객체에 액세스하는 코드를 추가하고 URL에서 검색 매개 변수를 가져 오는 것을 시도해 보겠습니다. 또한 상태 변수를 선언해 봅시다:\n\n```js\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const amount = searchParams ? searchParams.get('amount') : null;\n  const [paypalClientId, setPaypalClientId] = useState<string | null>(null);\n```\n\nuseEffect 훅을 사용하여 API 엔드 포인트 paypal-client-id.ts에서 PayPal 클라이언트 ID를 가져 오는 것을 시도해 보겠습니다:\n\n```js\n  useEffect(() => {\n    fetch('/api/paypal-client-id')\n      .then((response) => response.json())\n      .then((data) => {\n        if (data.paypalClientId) {\n          setPaypalClientId(data.paypalClientId);\n        } else {\n          console.error('PayPal 클라이언트 ID를 찾을 수 없습니다.');\n        }\n      })\n      .catch((error) => {\n        console.error('PayPal 클라이언트 ID를 가져 오지 못했습니다:', error);\n      });\n  }, []);\n```\n\n\n\n페이팔 클라이언트 ID가 없는 경우 \"로딩 중...\"이 표시됩니다:\n\n```js\nif (!paypalClientId) {\n  return <div>로딩 중...</div>;\n}\n```\n\n성공 및 오류 처리를 다음과 같이 수행할 거에요:\n\n```js\nconst handleSuccess = () => {\n  router.push('/');\n};\n\nconst handleError = (error: any) => {\n  console.error('결제 오류:', error);\n};\n```\n\n\n\n그럼 모든 것을 표시할 거예요:\n\n```js\n  return (\n    <div className='bg-blue-900'>\n      <div className=\"w-full bg-blue-900 flex flex-col justify-center items-center\">\n      <h1 className=\"md:text-5xl text-3xl font-bold text-blue-500\">결제 페이지</h1>\n      <p>총액: ${amount}</p>\n      <div className=\"w-screen p-14\">\n      <PayPalPaymentButtons amount={parseFloat(amount as string)} paypalClientId={paypalClientId} onSuccess={handleSuccess} onError={handleError} />\n      </div>\n      </div>\n    </div>\n  );\n```\n\n실제 페이지는 Suspense 경계로 둘러싸여야 합니다:\n\n```js\nconst actualPage: React.FC = () => {\n  return <Suspense fallback={<div>Loading...</div>}><PaymentPage /></Suspense>;\n}\n\nexport default actualPage;\n```\n\n\n\n전체 코드:\n\n```js\n'use client';\nimport React, { useEffect, useState, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport PayPalPaymentButtons from '../ui/paypal-buttons';\n\nconst PaymentPage: React.FC = () => {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const amount = searchParams ? searchParams.get('amount') : null;\n\n  const [paypalClientId, setPaypalClientId] = useState<string | null>(null);\n\n  useEffect(() => {\n    fetch('/api/paypal-client-id')\n      .then((response) => response.json())\n      .then((data) => {\n        if (data.paypalClientId) {\n          setPaypalClientId(data.paypalClientId);\n        } else {\n          console.error('PayPal client ID not found.');\n        }\n      })\n      .catch((error) => {\n        console.error('Failed to fetch PayPal client ID:', error);\n      });\n  }, []);\n\n  if (!paypalClientId) {\n    return <div>Loading...</div>;\n  }\n\n  const handleSuccess = () => {\n    router.push('/');\n  };\n\n  const handleError = (error: any) => {\n    console.error('Payment error:', error);\n  };\n\n  return (\n    <div className='bg-blue-900'>\n      <div className=\"w-full bg-blue-900 flex flex-col justify-center items-center\">\n        <h1 className=\"md:text-5xl text-3xl font-bold text-blue-500\">Payment Page</h1>\n        <p>Total Amount: ${amount}</p>\n        <div className=\"w-screen p-14\">\n          <PayPalPaymentButtons amount={parseFloat(amount as string)} paypalClientId={paypalClientId} onSuccess={handleSuccess} onError={handleError} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst actualPage: React.FC = () => {\n  return <Suspense fallback={<div>Loading...</div>}><PaymentPage /></Suspense>;\n}\n\nexport default actualPage;\n```\n\n이렇게해요. 이 글은 Next.js 프로젝트에 PayPal 체크아웃을 통합하는 것에 대한 내용이었습니다. 파일 이름과 코드의 일부 이름으로 보았듯이, 모든 것이 가지고 있기 전에 약간 실험을 해봤습니다. 이 글이 결제 페이지를 만들 때 올바른 방향으로 안내가 되길 바랍니다. 이 튜토리얼을 좋아하셨다면 박수를 보내주시고, 팔로우를 눌러주세요. 질문이 있으시면 언제든지 답변해 드리겠습니다.\n\n즐거운 코딩되세요!\n```","ogImage":{"url":"/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_0.png"},"coverImage":"/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_0.png","tag":["Tech"],"readingTime":19},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>NEXT.JS 앱 라우터에 관한 기사</h2>\n<p><img src=\"/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_0.png\" alt=\"이미지\"></p>\n<p>참고: Next.Js 앱 라우터를 사용할 것입니다. 페이지 라우터가 아닙니다.</p>\n<p>간단한 전자상거래 스토어를 만드는 데 항상 고민했었습니다. 카트와 체크아웃이 제 머리를 얽히게 만들었는데, Stripe, PayPal 또는 심지어 Square를 웹사이트에 통합하려고 노력했기 때문입니다.</p>\n<p>하지만 전자 상거래 스토어에서의 고난이 그치지 않았습니다. 결제 통합 시에도 고난이 있었습니다. 그래서 웹사이트용 결제 포털을 만드는 일에 나는 압도되었습니다. \"이걸 어떻게 해야하지?\"라고 스스로 물었습니다.</p>\n<p>Square는 웹사이트에 통합하기 가장 어려운 지불 프로세서입니다. 대면 거래에 더 적합합니다. 그럼에도 불구하고 Square로 설정을 해보았지만 전혀 실패했습니다.</p>\n<p>이어 Stripe로 넘어가 보겠습니다. 이것은 온라인 비즈니스에 좋은 옵션입니다. 그러나 고객 서비스와 관련된 다른 문제로 통합에 들어가기 전에 실패했습니다. 그래서 다른 것을 찾아봐야 했습니다.</p>\n<p>마지막으로 PayPal을 시도해 본 결과, 다른 온라인 비즈니스에서 성공을 들은 뒤, PayPal로 결제 포털을 만드는 데 성공했습니다. 이제 그 방법을 보여드릴 차례입니다. 그러니 함께 알아보겠습니다:</p>\n<h1>시작하기</h1>\n<p><img src=\"/assets/img/2024-05-12-IntegratingPayPalCheckoutIntoYourNextJsProject_1.png\" alt=\"이미지\"></p>\n<p>알겠어요. 저는 뭔가 간단한 것을 이루고 싶었어요. 사용자가 지불할 금액을 선택하고 지불하도록 하고 싶었어요. 그건 충분히 간단한 목표죠.</p>\n<p>시작하려면 API 엔드포인트를 만드는 방법이 필요합니다. 우리는 App Router를 사용하기 때문에 API 엔드포인트에 대한 제 게시물을 확인해주세요.</p>\n<p>만약 당신이 이 글을 읽고 있고 Next.Js 프로젝트를 어떻게 생성하는지 모른다면 뭐하고 있는 거야!? 어쨌든, Next.Js 프로젝트를 만들려면 터미널에서 npx create-next-app@latest을 실행하면 됩니다.</p>\n<h1>금액 구하는 중</h1>\n<p>이어서, 지불 포털용 페이지를 생성하세요. 또한, 처음에 payment-form이라고 이름 지은 컴포넌트를 만드세요. 왜냐하면 금액 페이지를 체크아웃 페이지와 결합할 것이라고 생각했기 때문입니다. 그러나 결국 그렇게 하지 않았습니다.</p>\n<p>그리고 우리가 하는 동안, API 엔드포인트와 이를 위해 필요한 나머지 파일들도 만들어봅시다. 마지막에는 이렇게 된 것처럼 보일 거에요:</p>\n<pre><code class=\"hljs language-js\">프로젝트/\n│\n├──페이지/api/\n│   ├── get-token.<span class=\"hljs-property\">ts</span>\n|   ├── paypal-client-id.<span class=\"hljs-property\">ts</span>\n|   ├── paypal.<span class=\"hljs-property\">ts</span>\n└──src/app\n    ├──결제-포털/\n    │   ├── page.<span class=\"hljs-property\">tsx</span>\n    └── 결제-페이지/\n    │  ├── page.<span class=\"hljs-property\">tsx</span>\n    ├── 컴포넌트/\n    │   ├── payment-form.<span class=\"hljs-property\">tsx</span>\n    │   ├── paypal-buttons.<span class=\"hljs-property\">tsx</span>\n    ├── layout.<span class=\"hljs-property\">tsx</span>\n    ├── page.<span class=\"hljs-property\">tsx</span>\n</code></pre>\n<p>우리는 <code>payment-form.tsx</code> 파일 맨 위에 ‘use client’를 추가해서, 이 파일의 코드를 기본 서버 측이 아닌 클라이언트 측으로 만들 수 있습니다.</p>\n<p>또한, react에서 <code>useState</code> 훅과 axios, 그리고 next/navigation에서 <code>useRouter</code> 훅을 import 해보겠습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useState } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n<span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n<span class=\"hljs-keyword\">import</span> { useRouter } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next/navigation'</span>;\n</code></pre>\n<p>이제 PaymentFormProps 인터페이스를 사용하여 PaymentForm 컴포넌트의 예상 프롭을 정의해 봅시다.</p>\n<pre><code class=\"hljs language-js\">interface <span class=\"hljs-title class_\">PaymentFormProps</span> {\n  <span class=\"hljs-attr\">onSuccess</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">orderId: string</span>) =></span> <span class=\"hljs-keyword\">void</span>;\n}\n</code></pre>\n<p>우리는 onSuccess를 프롭으로 받는 함수형 컴포넌트를 정의해야 합니다. 이를 PaymentForm이라고 부르겠습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">PaymentForm</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span>&#x3C;<span class=\"hljs-title class_\">PaymentFormProps</span>> = <span class=\"hljs-function\">(<span class=\"hljs-params\">{ onSuccess }</span>) =></span> {\n\n}\n</code></pre>\n<p>이제, handlePaymentSubmit이란 이름의 함수를 만들어서 결제 양식 제출을 처리하는 함수를 만들겠습니다. 이 함수는 POST 요청을 사용하여 api/paypal로 결제 양식을 제출하려 합니다. 성공하면 Payment-Page로 이동합니다. 실패하면 오류 메시지를 표시합니다:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handlePaymentSubmit</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) => {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">true</span>);\n      <span class=\"hljs-title function_\">setError</span>(<span class=\"hljs-string\">''</span>);\n\n      <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">'/api/paypal'</span>, { amount });\n\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">false</span>);\n\n      <span class=\"hljs-keyword\">if</span> (response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">success</span>) {\n        <span class=\"hljs-title function_\">onSuccess</span>(response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">orderId</span>);\n        router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">`/Payment-Page?amount=<span class=\"hljs-subst\">${amount}</span>`</span>);\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-title function_\">setError</span>(response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">error</span>);\n      }\n    } <span class=\"hljs-keyword\">catch</span> (error) {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'결제 초기화 오류:'</span>, error);\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">false</span>);\n      <span class=\"hljs-title function_\">setError</span>(<span class=\"hljs-string\">'결제 초기화 중 오류가 발생했습니다. 나중에 다시 시도해주세요.'</span>);\n    }\n  };\n</code></pre>\n<p>마지막으로, 입력 필드와 제출 버튼을 추가하겠습니다:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"flex flex-col gap-4 items-center\"</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">label</span>></span>\n        금액 입력:\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">label</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"number\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"amount\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{amount}</span> <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{handleAmountChange}</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">'text-black text-xl font-semibold p-2 rounded'</span>/></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{handlePaymentSubmit}</span> <span class=\"hljs-attr\">disabled</span>=<span class=\"hljs-string\">{loading}</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2\"</span>></span>\n        {loading ? '처리 중...' : '결제 제출'}\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span>\n      {error &#x26;&#x26; <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">p</span>></span>오류: {error}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">p</span>></span>}\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n  );\n</code></pre>\n<p>새로운 코드 아래에 <code>export default PaymentForm;</code>를 추가해주세요.</p>\n<p>최종 payment-form.tsx 코드는 다음과 같이 보여야 합니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useState } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n<span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n<span class=\"hljs-keyword\">import</span> { useRouter } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next/navigation'</span>;\n\ninterface <span class=\"hljs-title class_\">PaymentFormProps</span> {\n  <span class=\"hljs-attr\">onSuccess</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">orderId: string</span>) =></span> <span class=\"hljs-keyword\">void</span>;\n}\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">PaymentForm</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span>&#x3C;<span class=\"hljs-title class_\">PaymentFormProps</span>> = <span class=\"hljs-function\">(<span class=\"hljs-params\">{ onSuccess }</span>) =></span> {\n  <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>();\n  <span class=\"hljs-keyword\">const</span> [amount, setAmount] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>);\n  <span class=\"hljs-keyword\">const</span> [loading, setLoading] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-literal\">false</span>);\n  <span class=\"hljs-keyword\">const</span> [error, setError] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-string\">''</span>);\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleAmountChange</span> = (<span class=\"hljs-params\">event: React.ChangeEvent&#x3C;HTMLInputElement></span>) => {\n    <span class=\"hljs-title function_\">setAmount</span>(<span class=\"hljs-title class_\">Number</span>(event.<span class=\"hljs-property\">target</span>.<span class=\"hljs-property\">value</span>));\n  };\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handlePaymentSubmit</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) => {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">true</span>);\n      <span class=\"hljs-title function_\">setError</span>(<span class=\"hljs-string\">''</span>);\n\n      <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">'/api/paypal'</span>, { amount });\n\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">false</span>);\n\n      <span class=\"hljs-keyword\">if</span> (response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">success</span>) {\n        <span class=\"hljs-title function_\">onSuccess</span>(response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">orderId</span>);\n        router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">`/Payment-Page?amount=<span class=\"hljs-subst\">${amount}</span>`</span>);\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-title function_\">setError</span>(response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">error</span>);\n      }\n    } <span class=\"hljs-keyword\">catch</span> (error) {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'Error initiating payment:'</span>, error);\n      <span class=\"hljs-title function_\">setLoading</span>(<span class=\"hljs-literal\">false</span>);\n      <span class=\"hljs-title function_\">setError</span>(<span class=\"hljs-string\">'An error occurred while initiating payment. Please try again later.'</span>);\n    }\n  };\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"flex flex-col gap-4 items-center\"</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">label</span>></span>\n        Enter Amount: \n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">label</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"number\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"amount\"</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{amount}</span> <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{handleAmountChange}</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">'text-black text-xl font-semibold p-2 rounded'</span>/></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{handlePaymentSubmit}</span> <span class=\"hljs-attr\">disabled</span>=<span class=\"hljs-string\">{loading}</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2\"</span>></span>\n        {loading ? 'Processing...' : 'Submit Payment'}\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span>\n      {error &#x26;&#x26; <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">p</span>></span>Error: {error}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">p</span>></span>}\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n  );\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">PaymentForm</span>;\n</code></pre>\n<h1>주문 생성하기</h1>\n<p>paypal.ts 파일에 NextApiRequest와 NextApiResponse를 next에서, axios를 그리고 get-token.ts에서 getToken을 import해서 추가해봐요. getToken 코드는 나중에 보여줄게요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">NextApiRequest</span>, <span class=\"hljs-title class_\">NextApiResponse</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next'</span>;\n<span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n<span class=\"hljs-keyword\">import</span> getToken <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./get-token '</span>;\n</code></pre>\n<p>이제 API 엔드포인트를 만들어봅시다. 먼저 HTTP 메소드가 POST인지 확인한 후, 요청 본문에서 amount를 추출해요. 우리는 getToken 함수를 호출해서 액세스 토큰을 받을 거에요. PayPal에서 생성된 액세스 토큰은 .env 파일에 있어야 해요. 코드는 그런 다음 PayPal API로 POST 요청을 보낼 거에요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">handler</span>(<span class=\"hljs-params\">req: NextApiRequest, res: NextApiResponse</span>) {\n  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">method</span> === <span class=\"hljs-string\">'POST'</span>) {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> { amount } = req.<span class=\"hljs-property\">body</span>;\n      <span class=\"hljs-keyword\">const</span> accessToken = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getToken</span>();\n\n      <span class=\"hljs-keyword\">const</span> paypalResponse = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(\n        <span class=\"hljs-string\">'https://api.paypal.com/v2/checkout/orders'</span>,\n        {\n          <span class=\"hljs-attr\">intent</span>: <span class=\"hljs-string\">'CAPTURE'</span>,\n          <span class=\"hljs-attr\">purchase_units</span>: [\n            {\n              <span class=\"hljs-attr\">amount</span>: {\n                <span class=\"hljs-attr\">currency_code</span>: <span class=\"hljs-string\">'USD'</span>,\n                <span class=\"hljs-attr\">value</span>: amount.<span class=\"hljs-title function_\">toString</span>(),\n              },\n            },\n          ],\n        },\n        {\n          <span class=\"hljs-attr\">headers</span>: {\n            <span class=\"hljs-string\">'Content-Type'</span>: <span class=\"hljs-string\">'application/json'</span>,\n            <span class=\"hljs-title class_\">Authorization</span>: <span class=\"hljs-string\">`Bearer <span class=\"hljs-subst\">${accessToken}</span>`</span>,\n          },\n        }\n      );\n\n      <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">id</span>: orderId } = paypalResponse.<span class=\"hljs-property\">data</span>;\n\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">true</span>, orderId });\n    } <span class=\"hljs-keyword\">catch</span> (error) {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'PayPal API error:'</span>, error);\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">500</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">'Internal server error'</span> });\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">405</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">'Method not allowed'</span> });\n  }\n}\n</code></pre>\n<p>위의 코드를 한국어로 번역하면 다음과 같습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">NextApiRequest</span>, <span class=\"hljs-title class_\">NextApiResponse</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next'</span>;\n<span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n<span class=\"hljs-keyword\">import</span> getToken <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./get-token'</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">handler</span>(<span class=\"hljs-params\">req: NextApiRequest, res: NextApiResponse</span>) {\n  <span class=\"hljs-keyword\">if</span> (req.<span class=\"hljs-property\">method</span> === <span class=\"hljs-string\">'POST'</span>) {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> { amount } = req.<span class=\"hljs-property\">body</span>;\n      <span class=\"hljs-keyword\">const</span> accessToken = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getToken</span>();\n\n      <span class=\"hljs-keyword\">const</span> paypalResponse = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(\n        <span class=\"hljs-string\">'https://api.paypal.com/v2/checkout/orders'</span>,\n        {\n          <span class=\"hljs-attr\">intent</span>: <span class=\"hljs-string\">'CAPTURE'</span>,\n          <span class=\"hljs-attr\">purchase_units</span>: [\n            {\n              <span class=\"hljs-attr\">amount</span>: {\n                <span class=\"hljs-attr\">currency_code</span>: <span class=\"hljs-string\">'USD'</span>,\n                <span class=\"hljs-attr\">value</span>: amount.<span class=\"hljs-title function_\">toString</span>(),\n              },\n            },\n          ],\n        },\n        {\n          <span class=\"hljs-attr\">headers</span>: {\n            <span class=\"hljs-string\">'Content-Type'</span>: <span class=\"hljs-string\">'application/json'</span>,\n            <span class=\"hljs-title class_\">Authorization</span>: <span class=\"hljs-string\">`Bearer <span class=\"hljs-subst\">${accessToken}</span>`</span>,\n          },\n        }\n      );\n\n      <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">id</span>: orderId } = paypalResponse.<span class=\"hljs-property\">data</span>;\n\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">true</span>, orderId });\n    } <span class=\"hljs-keyword\">catch</span> (error) {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'PayPal API 에러:'</span>, error);\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">500</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">'내부 서버 오류'</span> });\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">405</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">success</span>: <span class=\"hljs-literal\">false</span>, <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">'허용되지 않은 메소드'</span> });\n  }\n}\n</code></pre>\n<h1>Access Token 가져오기</h1>\n<p>get-token.ts 코드에 추가할 예정입니다.</p>\n<p>axios를 가져와봐요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n</code></pre>\n<p>그리고 PAYPAL_CLIENT_ID 및 PAYPAL_CLIENT_SECRET를 환경 변수에서 가져와요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">CLIENT_ID</span> = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PAYPAL_CLIENT_ID</span>;\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">CLIENT_SECRET</span> = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PAYPAL_CLIENT_SECRET</span>;\n</code></pre>\n<p>그럼 우리는 PayPal API에서 액세스 토큰을 검색하는 getToken이라는 비동기 함수를 만들고 싶어요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getToken</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">const</span> credentials = <span class=\"hljs-title class_\">Buffer</span>.<span class=\"hljs-title function_\">from</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${CLIENT_ID}</span>:<span class=\"hljs-subst\">${CLIENT_SECRET}</span>`</span>).<span class=\"hljs-title function_\">toString</span>(<span class=\"hljs-string\">'base64'</span>);\n\n  <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(\n    <span class=\"hljs-string\">'https://api.paypal.com/v1/oauth2/token'</span>,\n    <span class=\"hljs-string\">'grant_type=client_credentials'</span>,\n    {\n      <span class=\"hljs-attr\">headers</span>: {\n        <span class=\"hljs-string\">'Content-Type'</span>: <span class=\"hljs-string\">'application/x-www-form-urlencoded'</span>,\n        <span class=\"hljs-title class_\">Authorization</span>: <span class=\"hljs-string\">`Basic <span class=\"hljs-subst\">${credentials}</span>`</span>,\n      },\n    }\n  );\n\n  <span class=\"hljs-keyword\">return</span> response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">access_token</span>;\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getToken;\n</code></pre>\n<p>전체 코드는 다음과 같습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'axios'</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">CLIENT_ID</span> = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PAYPAL_CLIENT_ID</span>;\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">CLIENT_SECRET</span> = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PAYPAL_CLIENT_SECRET</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getToken</span> = <span class=\"hljs-keyword\">async</span> (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">const</span> credentials = <span class=\"hljs-title class_\">Buffer</span>.<span class=\"hljs-title function_\">from</span>(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${CLIENT_ID}</span>:<span class=\"hljs-subst\">${CLIENT_SECRET}</span>`</span>).<span class=\"hljs-title function_\">toString</span>(<span class=\"hljs-string\">'base64'</span>);\n\n  <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> axios.<span class=\"hljs-title function_\">post</span>(\n    <span class=\"hljs-string\">'https://api.paypal.com/v1/oauth2/token'</span>,\n    <span class=\"hljs-string\">'grant_type=client_credentials'</span>,\n    {\n      <span class=\"hljs-attr\">headers</span>: {\n        <span class=\"hljs-string\">'Content-Type'</span>: <span class=\"hljs-string\">'application/x-www-form-urlencoded'</span>,\n        <span class=\"hljs-title class_\">Authorization</span>: <span class=\"hljs-string\">`Basic <span class=\"hljs-subst\">${credentials}</span>`</span>,\n      },\n    }\n  );\n\n  <span class=\"hljs-keyword\">return</span> response.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">access_token</span>;\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> getToken;\n</code></pre>\n<h1>PayPal 버튼 만들기</h1>\n<p>PayPal 버튼을 만들기 위해 paypal-buttons.tsx 파일을 서버 측이 아닌 클라이언트 측으로 변경해 보겠습니다. ‘use client’를 추가해 주세요. 그리고 여기서 react에서 useEffect 훅을 import해 주세요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n</code></pre>\n<p>TypeScript를 사용하기 때문에 전역 창에 속성을 추가하여 오류를 방지해 보겠습니다:</p>\n<pre><code class=\"hljs language-js\">전역을 선언합니다:\n   \n<span class=\"hljs-string\">``</span><span class=\"hljs-string\">`typescript\ndeclare global {\n    interface Window {\n      paypal?: any;\n    }\n}\n</span></code></pre>\n<p>이제 네 개의 속성 유형을 지정하는 객체를 인수로 취하는 함수형 컴포넌트를 정의해야 합니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">PayPalPaymentButton</span> = (<span class=\"hljs-params\">{ amount, paypalClientId, onSuccess, onError }: { amount: number; paypalClientId: string | <span class=\"hljs-literal\">null</span>; onSuccess: () => <span class=\"hljs-keyword\">void</span>; onError: (err: any) => <span class=\"hljs-keyword\">void</span>; }</span>) => {\n\n}\n</code></pre>\n<p>함수형 컴포넌트인 PayPalPaymentButton 안에서 useEffect를 사용하여 컴포넌트가 마운트될 때 PayPal SDK 스크립트를 DOM에 추가하세요:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n    <span class=\"hljs-keyword\">const</span> script = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">'script'</span>);\n    script.<span class=\"hljs-property\">src</span> = <span class=\"hljs-string\">`https://www.paypal.com/sdk/js?client-id=<span class=\"hljs-subst\">${paypalClientId}</span>`</span>;\n    script.<span class=\"hljs-property\">async</span> = <span class=\"hljs-literal\">true</span>;\n    script.<span class=\"hljs-property\">onload</span> = <span class=\"hljs-function\">() =></span> {\n      <span class=\"hljs-title function_\">initializePayPalButton</span>();\n    };\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">appendChild</span>(script);\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =></span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeChild</span>(script);\n    };\n  }, []);\n</code></pre>\n<p>이제 웹페이지에 PayPal 버튼을 렌더링하는 함수를 만들어봅시다:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">initializePayPalButton</span> = (<span class=\"hljs-params\"></span>) => {\n    <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">paypal</span>.<span class=\"hljs-title class_\">Buttons</span>({\n      <span class=\"hljs-attr\">createOrder</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data: any, actions: any</span>) {\n        <span class=\"hljs-keyword\">return</span> actions.<span class=\"hljs-property\">order</span>.<span class=\"hljs-title function_\">create</span>({\n          <span class=\"hljs-attr\">purchase_units</span>: [{\n            <span class=\"hljs-attr\">amount</span>: {\n              <span class=\"hljs-attr\">value</span>: amount,\n              <span class=\"hljs-attr\">currency_code</span>: <span class=\"hljs-string\">'USD'</span>, <span class=\"hljs-comment\">// 원하는 통화로 변경</span>\n            },   \n            <span class=\"hljs-attr\">application_context</span>: {\n              <span class=\"hljs-attr\">user_action</span>: <span class=\"hljs-string\">'PAY_NOW'</span>,\n              <span class=\"hljs-attr\">shipping_preference</span>: <span class=\"hljs-string\">'NO_SHIPPING'</span>,\n              <span class=\"hljs-attr\">payment_method</span>: { <span class=\"hljs-attr\">payee_preferred</span>: <span class=\"hljs-string\">'IMMEDIATE_PAYMENT_REQUIRED'</span> },\n              <span class=\"hljs-attr\">return_url</span>: <span class=\"hljs-string\">'https://YOUR_WEBSITE_URL'</span>,\n              <span class=\"hljs-attr\">cancel_url</span>: <span class=\"hljs-string\">'https://YOUR_WEBSITE_URL'</span>,\n            },\n          }],\n        });\n      },\n      <span class=\"hljs-attr\">onApprove</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data:any, actions:any</span>) {\n        <span class=\"hljs-keyword\">return</span> actions.<span class=\"hljs-property\">order</span>.<span class=\"hljs-title function_\">capture</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">details: any</span>) {\n          <span class=\"hljs-title function_\">onSuccess</span>();\n        });\n      },\n      <span class=\"hljs-attr\">onError</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">err: any</span>) {\n        <span class=\"hljs-title function_\">onError</span>(err);\n      },\n    }).<span class=\"hljs-title function_\">render</span>(<span class=\"hljs-string\">'#paypal-button-container'</span>);\n  };\n</code></pre>\n<p>이제 버튼을 표시하는 것만 남았습니다:</p>\n<pre><code>\n\n\n```js\nreturn &#x3C;div id=\"paypal-button-container\" className='bg-gray-200'>&#x3C;/div>;\n</code></pre>\n<p>최종 코드:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n\ndeclare <span class=\"hljs-variable language_\">global</span> {\n    interface <span class=\"hljs-title class_\">Window</span> {\n      paypal?: any;\n    }\n}\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">PayPalPaymentButton</span> = (<span class=\"hljs-params\">{ amount, paypalClientId, onSuccess, onError }: { amount: number; paypalClientId: string | <span class=\"hljs-literal\">null</span>; onSuccess: () => <span class=\"hljs-keyword\">void</span>; onError: (err: any) => <span class=\"hljs-keyword\">void</span>; }</span>) => {\n  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n    <span class=\"hljs-keyword\">const</span> script = <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-title function_\">createElement</span>(<span class=\"hljs-string\">'script'</span>);\n    script.<span class=\"hljs-property\">src</span> = <span class=\"hljs-string\">`https://www.paypal.com/sdk/js?client-id=<span class=\"hljs-subst\">${paypalClientId}</span>`</span>;\n    script.<span class=\"hljs-property\">async</span> = <span class=\"hljs-literal\">true</span>;\n    script.<span class=\"hljs-property\">onload</span> = <span class=\"hljs-function\">() =></span> {\n      <span class=\"hljs-title function_\">initializePayPalButton</span>();\n    };\n    <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">appendChild</span>(script);\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =></span> {\n      <span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">body</span>.<span class=\"hljs-title function_\">removeChild</span>(script);\n    };\n  }, []);\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">initializePayPalButton</span> = (<span class=\"hljs-params\"></span>) => {\n    <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-property\">paypal</span>.<span class=\"hljs-title class_\">Buttons</span>({\n      <span class=\"hljs-attr\">createOrder</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data: any, actions: any</span>) {\n        <span class=\"hljs-keyword\">return</span> actions.<span class=\"hljs-property\">order</span>.<span class=\"hljs-title function_\">create</span>({\n          <span class=\"hljs-attr\">purchase_units</span>: [{\n            <span class=\"hljs-attr\">amount</span>: {\n              <span class=\"hljs-attr\">value</span>: amount,\n              <span class=\"hljs-attr\">currency_code</span>: <span class=\"hljs-string\">'USD'</span>,\n            },   \n            <span class=\"hljs-attr\">application_context</span>: {\n              <span class=\"hljs-attr\">user_action</span>: <span class=\"hljs-string\">'PAY_NOW'</span>,\n              <span class=\"hljs-attr\">shipping_preference</span>: <span class=\"hljs-string\">'NO_SHIPPING'</span>,\n              <span class=\"hljs-attr\">payment_method</span>: { <span class=\"hljs-attr\">payee_preferred</span>: <span class=\"hljs-string\">'IMMEDIATE_PAYMENT_REQUIRED'</span> },\n              <span class=\"hljs-attr\">return_url</span>: <span class=\"hljs-string\">'https://YOUR_WEBSITE_URL'</span>,\n              <span class=\"hljs-attr\">cancel_url</span>: <span class=\"hljs-string\">'https://YOUR_WEBSITE_URL'</span>,\n            },\n          }],\n        });\n      },\n      <span class=\"hljs-attr\">onApprove</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data:any, actions:any</span>) {\n        <span class=\"hljs-keyword\">return</span> actions.<span class=\"hljs-property\">order</span>.<span class=\"hljs-title function_\">capture</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">details: any</span>) {\n          <span class=\"hljs-title function_\">onSuccess</span>();\n        });\n      },\n      <span class=\"hljs-attr\">onError</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">err: any</span>) {\n        <span class=\"hljs-title function_\">onError</span>(err);\n      },\n    }).<span class=\"hljs-title function_\">render</span>(<span class=\"hljs-string\">'#paypal-button-container'</span>);\n  };\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"paypal-button-container\"</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">'bg-gray-200'</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>;\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">PayPalPaymentButton</span>;\n</code></pre>\n<h1>PayPal 클라이언트 ID 가져오기</h1>\n<p>나중에 필요할 것이므로 지금 처리해 봐요. 당신의 paypal-client-id는 환경 변수 중에 PAYPAL_CLIENT_ID가 있는지 확인하고 그것을 클라이언트 쪽으로 보내요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">NextApiRequest</span>, <span class=\"hljs-title class_\">NextApiResponse</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next'</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">handler</span>(<span class=\"hljs-params\">req: NextApiRequest, res: NextApiResponse</span>) {\n  <span class=\"hljs-keyword\">const</span> paypalClientId = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PAYPAL_CLIENT_ID</span>;\n\n  <span class=\"hljs-keyword\">if</span> (!paypalClientId) {\n    <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">500</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">error</span>: <span class=\"hljs-string\">'PayPal client ID not found.'</span> });\n  }\n\n  <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>({ paypalClientId });\n}\n</code></pre>\n<h1>Payment-Portal Page.tsx에 코드 추가하기</h1>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">PaymentComponent</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"../components/payment-form\"</span>;\n</code></pre>\n<p>결제 성공에 대한 함수를 정의하세요:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handlePaymentSuccess</span> = (<span class=\"hljs-params\">orderId: string</span>) => {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'결제 성공! 주문 ID:'</span>, orderId);\n  };\n</code></pre>\n<p>PaymentComponent를 반환하세요:</p>\n<pre><code class=\"hljs language-jsx\">  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">main</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">PaymentComponent</span> <span class=\"hljs-attr\">onSuccess</span>=<span class=\"hljs-string\">{handlePaymentSuccess}</span> /></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">main</span>></span></span>\n  );\n</code></pre>\n<h1>Payment-Page 페이지에 코드 추가하기</h1>\n<p>파일의 맨 위에 'use client';를 추가해야 합니다. 그 다음으로 useEffect 훅, useState 훅, 그리고 Suspense를 react에서 임포트해주세요. 또한 next/navigation에서 useRouter와 useSearchParams를 임포트해주세요. 마지막으로 paypal-buttons.tsx에서 PayPalPaymentButtons를 임포트해주세요:</p>\n<pre><code class=\"hljs language-jsx\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect, useState, <span class=\"hljs-title class_\">Suspense</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n<span class=\"hljs-keyword\">import</span> { useRouter, useSearchParams } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next/navigation'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">PayPalPaymentButtons</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../ui/PayPalButtons'</span>;\n</code></pre>\n<p>이제 paymentPage라는 기능 구성 요소를 만들 수 있습니다. 내부에서 useRouter 훅을 사용하여 router 객체에 액세스하는 코드를 추가하고 URL에서 검색 매개 변수를 가져 오는 것을 시도해 보겠습니다. 또한 상태 변수를 선언해 봅시다:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>();\n  <span class=\"hljs-keyword\">const</span> searchParams = <span class=\"hljs-title function_\">useSearchParams</span>();\n  <span class=\"hljs-keyword\">const</span> amount = searchParams ? searchParams.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'amount'</span>) : <span class=\"hljs-literal\">null</span>;\n  <span class=\"hljs-keyword\">const</span> [paypalClientId, setPaypalClientId] = useState&#x3C;string | <span class=\"hljs-literal\">null</span>>(<span class=\"hljs-literal\">null</span>);\n</code></pre>\n<p>useEffect 훅을 사용하여 API 엔드 포인트 paypal-client-id.ts에서 PayPal 클라이언트 ID를 가져 오는 것을 시도해 보겠습니다:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n    <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">'/api/paypal-client-id'</span>)\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =></span> response.<span class=\"hljs-title function_\">json</span>())\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =></span> {\n        <span class=\"hljs-keyword\">if</span> (data.<span class=\"hljs-property\">paypalClientId</span>) {\n          <span class=\"hljs-title function_\">setPaypalClientId</span>(data.<span class=\"hljs-property\">paypalClientId</span>);\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'PayPal 클라이언트 ID를 찾을 수 없습니다.'</span>);\n        }\n      })\n      .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> {\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'PayPal 클라이언트 ID를 가져 오지 못했습니다:'</span>, error);\n      });\n  }, []);\n</code></pre>\n<p>페이팔 클라이언트 ID가 없는 경우 \"로딩 중...\"이 표시됩니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">if</span> (!paypalClientId) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>로딩 중...<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>;\n}\n</code></pre>\n<p>성공 및 오류 처리를 다음과 같이 수행할 거에요:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSuccess</span> = (<span class=\"hljs-params\"></span>) => {\n  router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">'/'</span>);\n};\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleError</span> = (<span class=\"hljs-params\">error: any</span>) => {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'결제 오류:'</span>, error);\n};\n</code></pre>\n<p>그럼 모든 것을 표시할 거예요:</p>\n<pre><code class=\"hljs language-js\">  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">'bg-blue-900'</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"w-full bg-blue-900 flex flex-col justify-center items-center\"</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"md:text-5xl text-3xl font-bold text-blue-500\"</span>></span>결제 페이지<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">h1</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">p</span>></span>총액: ${amount}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">p</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"w-screen p-14\"</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">PayPalPaymentButtons</span> <span class=\"hljs-attr\">amount</span>=<span class=\"hljs-string\">{parseFloat(amount</span> <span class=\"hljs-attr\">as</span> <span class=\"hljs-attr\">string</span>)} <span class=\"hljs-attr\">paypalClientId</span>=<span class=\"hljs-string\">{paypalClientId}</span> <span class=\"hljs-attr\">onSuccess</span>=<span class=\"hljs-string\">{handleSuccess}</span> <span class=\"hljs-attr\">onError</span>=<span class=\"hljs-string\">{handleError}</span> /></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n  );\n</code></pre>\n<p>실제 페이지는 Suspense 경계로 둘러싸여야 합니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">actualPage</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span> = <span class=\"hljs-function\">() =></span> {\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Suspense</span> <span class=\"hljs-attr\">fallback</span>=<span class=\"hljs-string\">{</span>&#x3C;<span class=\"hljs-attr\">div</span>></span>Loading...<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>}><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">PaymentPage</span> /></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Suspense</span>></span></span>;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> actualPage;\n</code></pre>\n<p>전체 코드:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">'use client'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect, useState, <span class=\"hljs-title class_\">Suspense</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'react'</span>;\n<span class=\"hljs-keyword\">import</span> { useRouter, useSearchParams } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'next/navigation'</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">PayPalPaymentButtons</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../ui/paypal-buttons'</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">PaymentPage</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span> = <span class=\"hljs-function\">() =></span> {\n  <span class=\"hljs-keyword\">const</span> router = <span class=\"hljs-title function_\">useRouter</span>();\n  <span class=\"hljs-keyword\">const</span> searchParams = <span class=\"hljs-title function_\">useSearchParams</span>();\n  <span class=\"hljs-keyword\">const</span> amount = searchParams ? searchParams.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'amount'</span>) : <span class=\"hljs-literal\">null</span>;\n\n  <span class=\"hljs-keyword\">const</span> [paypalClientId, setPaypalClientId] = useState&#x3C;string | <span class=\"hljs-literal\">null</span>>(<span class=\"hljs-literal\">null</span>);\n\n  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n    <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">'/api/paypal-client-id'</span>)\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =></span> response.<span class=\"hljs-title function_\">json</span>())\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =></span> {\n        <span class=\"hljs-keyword\">if</span> (data.<span class=\"hljs-property\">paypalClientId</span>) {\n          <span class=\"hljs-title function_\">setPaypalClientId</span>(data.<span class=\"hljs-property\">paypalClientId</span>);\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'PayPal client ID not found.'</span>);\n        }\n      })\n      .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> {\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'Failed to fetch PayPal client ID:'</span>, error);\n      });\n  }, []);\n\n  <span class=\"hljs-keyword\">if</span> (!paypalClientId) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>Loading...<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>;\n  }\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleSuccess</span> = (<span class=\"hljs-params\"></span>) => {\n    router.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-string\">'/'</span>);\n  };\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">handleError</span> = (<span class=\"hljs-params\">error: any</span>) => {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(<span class=\"hljs-string\">'Payment error:'</span>, error);\n  };\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">'bg-blue-900'</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"w-full bg-blue-900 flex flex-col justify-center items-center\"</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">h1</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"md:text-5xl text-3xl font-bold text-blue-500\"</span>></span>Payment Page<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">h1</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">p</span>></span>Total Amount: ${amount}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">p</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">\"w-screen p-14\"</span>></span>\n          <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">PayPalPaymentButtons</span> <span class=\"hljs-attr\">amount</span>=<span class=\"hljs-string\">{parseFloat(amount</span> <span class=\"hljs-attr\">as</span> <span class=\"hljs-attr\">string</span>)} <span class=\"hljs-attr\">paypalClientId</span>=<span class=\"hljs-string\">{paypalClientId}</span> <span class=\"hljs-attr\">onSuccess</span>=<span class=\"hljs-string\">{handleSuccess}</span> <span class=\"hljs-attr\">onError</span>=<span class=\"hljs-string\">{handleError}</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n  );\n};\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">actualPage</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span> = <span class=\"hljs-function\">() =></span> {\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Suspense</span> <span class=\"hljs-attr\">fallback</span>=<span class=\"hljs-string\">{</span>&#x3C;<span class=\"hljs-attr\">div</span>></span>Loading...<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>}><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">PaymentPage</span> /></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Suspense</span>></span></span>;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> actualPage;\n</code></pre>\n<p>이렇게해요. 이 글은 Next.js 프로젝트에 PayPal 체크아웃을 통합하는 것에 대한 내용이었습니다. 파일 이름과 코드의 일부 이름으로 보았듯이, 모든 것이 가지고 있기 전에 약간 실험을 해봤습니다. 이 글이 결제 페이지를 만들 때 올바른 방향으로 안내가 되길 바랍니다. 이 튜토리얼을 좋아하셨다면 박수를 보내주시고, 팔로우를 눌러주세요. 질문이 있으시면 언제든지 답변해 드리겠습니다.</p>\n<p>즐거운 코딩되세요!</p>\n<pre><code></code></pre>\n</body>\n</html>\n"},"__N_SSG":true}