{"pageProps":{"post":{"title":"iFrameê°€ ë¦¬ìŠ¤ë„ˆë¥¼ ì œê±°í•˜ê³  ReactëŠ” ì•Œì§€ ëª»í•œë‹¤ ","description":"","date":"2024-05-12 18:44","slug":"2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit","content":"\n\n# ê°œìš”\n\nì´ ê¸°ì‚¬ì—ì„œëŠ” ë¶€ëª¨ ì°½ê³¼ ìì‹ iFrame ê°„ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ê³  ì‹¶ì–´ìš”. ì´ ê³¼ì •ì—ì„œ iFrameì´ ë¦¬ìŠ¤ë„ˆë¥¼ ì–´ë–»ê²Œ ì§€ìš°ëŠ”ì§€ì— ëŒ€í•´ í¥ë¯¸ë¡œìš´ ì ì„ ë°œê²¬í–ˆì–´ìš”. ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”, ë‚˜ì•„ê°€ë©´ì„œ ìŠ¤í¬ë¦°ìƒ·ì„ ê²Œì‹œí•  ê±°ì—ìš”. [GitHub ë§í¬](https://github.com)\n\nì¦ê²ê²Œ ê³µë¶€í•˜ì„¸ìš”!\n\n# iFrameì´ë€ ë¬´ì—‡ì¸ê°€ìš”?\n\n\n\niFrame ë˜ëŠ” ì¸ë¼ì¸ í”„ë ˆì„ì€ ë¶€ëª¨ ì›¹í˜ì´ì§€ ë‚´ì— ë‹¤ë¥¸ ë¬¸ì„œë¥¼ ë¡œë“œí•˜ëŠ” HTML ìš”ì†Œì…ë‹ˆë‹¤.\n\n# iFrameì„ ì‚¬ìš©í•˜ëŠ” ê³³ì€ ì–´ë””ì¸ê°€ìš”?\n\niFrameì€ ì´ë¯¸ ìˆëŠ” HTML ì•ˆì— HTMLì„ í¬í•¨ì‹œí‚¤ê³  ì‹¶ì„ ë•Œë‚˜ ì‹ ë¢°í•  ìˆ˜ ì—†ê±°ë‚˜ ì œ3ì ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¦‰, ê´‘ê³  ì„¹ì…˜ì„ ì›¹ì‚¬ì´íŠ¸ì— í‘œì‹œí•˜ê±°ë‚˜ YouTube ë¹„ë””ì˜¤ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ iFrameì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ iFrameì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” ì œ3ì ì‚¬ì´íŠ¸/ì½˜í…ì¸ ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\n# iFrame ìƒì„±í•˜ê¸°\n\n\n\nì œê°€ ë§Œë“  í”„ë¡œì íŠ¸ëŠ” ê°„ë‹¨í•œ React ì•±(v18.2.0)ì…ë‹ˆë‹¤. ë¶€ëª¨ ìœ„ì ¯(App.tsx)ì€ iFrame ì»´í¬ë„ŒíŠ¸(IFrame.tsx)ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ëª¨ë‘ ë©”ì‹œì§€ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ í•´ì œë  ë•Œ ì œê±°ë©ë‹ˆë‹¤. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ postMessage í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ iFrameì— ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.\n\nApp.tsx\n\n```js\nimport React, { useEffect, useRef } from \"react\";\nimport IFrame from \"./iFrame\";\n\nconst App: React.FC = () => {\n const refs = useRef<HTMLIFrameElement>(null);\n\n useEffect(() => {\n   window.addEventListener(\"message\", processMessage, false);\n   return () => window.removeEventListener(\"message\", processMessage);\n }, []);\n\n\n const processMessage = (event: MessageEvent) => {\n   if (event.origin !== \"http://localhost:8080\") {\n     return;\n   }\n   console.log(\"parent Event Listener\", event);\n };\n\n\n const buttonClick = (event: React.MouseEvent) => {\n   event.stopPropagation();\n   if (refs.current === null) {\n     return;\n   }\n\n   refs?.current?.contentWindow?.postMessage(\"ë¶€ëª¨ì—ì„œ ë³´ë‚¸ ë©”ì‹œì§€\", \"*\");\n };\n return (\n   <div>\n     <button\n       style={ margin: \"10px\", marginLeft: \"0px\" }\n       onClick={buttonClick}\n     >\n       ìì‹ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°\n     </button>\n     <IFrame ref={refs} />\n   </div>\n );\n};\n\nexport default App;\n```\n\nIFrame.tsx\n\n\n\n```js\nimport React, { useEffect, useState, forwardRef, ForwardedRef } from \"react\";\n\n\ninterface IFrameProps {\n ref: ForwardedRef<HTMLIFrameElement>;\n}\n\nconst IFrame = forwardRef<HTMLIFrameElement, IFrameProps>((prop, ref) => {\n const [message, setMessage] = useState('');\n const iframeRef = ref as React.MutableRefObject<HTMLIFrameElement>;\n useEffect(() => {\n   console.log(\"mounted\");\n   iframeRef?.current?.contentWindow?.addEventListener(\n     \"message\",\n     processMessage,\n     false\n   );\n   return () => {\n     console.log(\"unmounted\");\n     iframeRef?.current?.contentWindow?.removeEventListener(\n       \"message\",\n       processMessage,\n       false\n     );\n   };\n }, [iframeRef?.current]);\n\n\n const processMessage = (event: MessageEvent) => {\n   console.log(\"iFrame Event Listener\");\n   if (event.origin !== \"http://localhost:8080\") {\n     return;\n   }\n\n\n  const newMessage = message.concat(event?.data)\n  setMessage(newMessage);\n\n\n };\n\n\n return (\n   <div>\n     <iframe id=\"1\" {...prop} ref={ref} srcDoc={message}></iframe>\n   </div>\n );\n});\n\n\nexport default IFrame;\r\n```\n\në¦¬ìŠ¤ë„ˆê°€ ì˜¬ë°”ë¥´ê²Œ ë§ˆìš´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ iFrameì—ì„œ getEventListeners(window)ì„ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤. iFrameì—ì„œ 'message' ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  ëŒ€ê¸°í•˜ëŠ” ë¦¬ìŠ¤ë„ˆë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë³´ì•ˆ ëŒ€ì±…ìœ¼ë¡œ ì•…ì˜ì ì¸ ì‚¬ìš©ìë¡œë¶€í„°ì˜ ë©”ì‹œì§€ë¥¼ ë¬´ì‹œí•˜ë„ë¡ originì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.\n\n<img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_0.png\" />\n\n# í™”ë©´ì—ì„œ ë³´ì´ëŠ” ëª¨ìŠµ\n```\n\n\n\n<img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_1.png\" />\n\në²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë©”ì‹œì§€ê°€ iFrame ì•ˆì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.\n\n<img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_2.png\" />\n\nì´ ëª¨ë“  ê²ƒì´ ì •ë§ ê¸°ë»¤ì–´ìš”. ê·¸ëŸ¬ë‚˜ ì´ê³³ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë©”ì‹œì§€ë¥¼ iFrameìœ¼ë¡œ ë³´ë‚´ë ¤ê³  ì‹œë„í–ˆì„ ë•Œ iFrame UIê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. iFrame ì•ˆì—ì„œ \"ë¶€ëª¨ë¡œë¶€í„° ì˜¨ ë©”ì‹œì§€\"ë¥¼ ì—¬ëŸ¬ ë²ˆ ë³´ê¸°ë¥¼ ê¸°ëŒ€í–ˆëŠ”ë° ê·¸ëŸ° ì¼ì€ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë²„íŠ¼ í´ë¦­ ì‹œ UIê°€ ë§¤ë²ˆ ì—…ë°ì´íŠ¸ë˜ì§€ ëª»í–ˆë‹¤ëŠ” ê²ƒ ê°™ì•˜ì–´ìš”.\n\n\n\n<img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_3.png\" />\n\në‚´ ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë‹ˆ, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì–¸ë§ˆìš´íŠ¸í•œ í›„ì— ì¶œë ¥í•˜ëŠ” `unmounted`ê°€ ì•„ë¬´ëŸ° ë°œìƒí•˜ì§€ ì•Šì•˜ì–´. ì´ê²ƒì€ Reactê°€ ë²„íŠ¼ í´ë¦­ í›„ iFrameì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì œëŒ€ë¡œ ì–¸ë§ˆìš´íŠ¸í•˜ì§€ ì•Šì•˜ìŒì„ í™•ì¸í–ˆì–´. (ì¬í‘œí˜„)\n\nuseEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì„ ê±´ë“œë¦¬ë©´ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•´ ë³´ì•˜ì§€ë§Œ, ëª¨ë“  ì‹œë„ê°€ ì‹¤íŒ¨í–ˆì–´. ìì‹ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì—¬ëŸ¬ ë²ˆ ë³´ë‚´ë„, ìì‹ì€ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë§Œ ë“£ë”ë¼ê³ .\n\n# ê·¸ë˜ì„œ ì–´ë–»ê²Œ í•˜ë©´ ì œëŒ€ë¡œ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?\n\n\n\në” ê¶ê¸ˆí•´ì ¸ì„œ, ì²˜ìŒ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— ë‹¤ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í™•ì¸í•´ ë´¤ì–´ìš”. ì—¬ê¸°ì„œ ë¬¸ì œë¥¼ ë°œê²¬í–ˆì–´ìš”.\n\n![ì´ë¯¸ì§€](/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_4.png)\n\nì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— iFrameì—ëŠ” ì–´ë– í•œ ë¦¬ìŠ¤ë„ˆë„ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šì•˜ì–´ìš”. ë§ˆì¹˜ ì–´ë–»ê²Œë“  ì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— ë¦¬ìŠ¤ë„ˆë“¤ì´ ì œê±°ëœ ê²ƒì²˜ëŸ¼ ë³´ì˜€ì–´ìš”.\n\nì¡°ê¸ˆ ë” ì‹¤í—˜í•´ ë³¸ ê²°ê³¼, srcDoc ìš”ì†Œì— ë¬¸ì œê°€ ìˆëŠ” ê²ƒì„ ë°œê²¬í–ˆì–´ìš”. ë”°ë¼ì„œ, ìƒíƒœê°€ ë³€ê²½ë  ë•Œ srcDoc ìš”ì†Œê°€ iFrameì˜ ìƒˆ ë©”ì‹œì§€ë¥¼ ê°€ë¦¬í‚¤ê²Œ ë˜ì—ˆì–´ìš”. ì´ ë³€ê²½ìœ¼ë¡œ ì¸í•´ iFrameì€ iFrameê³¼ ê´€ë ¨ëœ ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ëª¨ë‘ ì œê±°í•˜ê³  ë¦¬ì•¡íŠ¸ëŠ” ì•„ë¬´ê²ƒë„ ëª¨ë¥´ê²Œ ë˜ì—ˆì–´ìš” ğŸ«¢.\n\n\n\nê·¸ë˜ì„œ ReactëŠ” iFrameì´ ê·¸ê²ƒì„ í•˜ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤. ì™œëƒí•˜ë©´ Reactì—ê²ŒëŠ” iFrameì— ëŒ€í•œ ì°¸ì¡°ê°€ ì¶”ê°€/ì œê±°ë˜ì–´ì•¼ í•˜ëŠ”ë°, ì°¸ì¡°ê°€ ì ˆëŒ€ ë³€ê²½ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ReactëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë§ˆìš´íŠ¸í•˜ê±°ë‚˜ ì–¸ë§ˆìš´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ iFrameì— ì •ì  HTMLì„ ì¶”ê°€í–ˆìœ¼ë©°, ë©”ì‹œì§€ê°€ ë„ì°©í•  ë•Œë§ˆë‹¤ ê¸°ì¡´ HTMLì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´ëŠ” srcDocê°€ ìƒˆ HTMLì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— iFrameì— ì²¨ë¶€ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì§€ìš°ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n```js\nimport React, { useEffect, forwardRef, ForwardedRef } from \"react\";\n\n\ninterface IFrameProps {\n  ref: ForwardedRef<HTMLIFrameElement>;\n}\n\n\nconst html = `<html>\n<body>\n<div id=\"changeText\" value=\"changeText\">Hello Div</div>\n<button value=\"replyButton\" id=\"replyButton\">Reply to parent</button>\n<script>\n// Get the button element\nvar button = document.getElementById(\"replyButton\");\n\n\n// click event listener\nbutton.addEventListener(\"click\", function() {\n  console.log('sending message to parent');\n  window.parent.postMessage('Message from Child. Listen to me!');\n});\n</script>\n</body>\n</html>`;\n\n\nconst IFrame = forwardRef<HTMLIFrameElement, IFrameProps>((prop, ref) => {\n  const iframeRef = ref as React.MutableRefObject<HTMLIFrameElement>;\n  useEffect(() => {\n    console.log(\"mounted\");\n    iframeRef?.current?.contentWindow?.addEventListener(\n      \"message\",\n      processMessage,\n      false\n    );\n    return () => {\n      console.log(\"unmounted\");\n      iframeRef?.current?.contentWindow?.removeEventListener(\n        \"message\",\n        processMessage,\n        false\n      );\n    };\n  }, [iframeRef?.current]);\n\n\n  const processMessage = (event: MessageEvent) => {\n    console.log(\"iFrame Event Listener\");\n    if (event.origin !== \"http://localhost:8080\") {\n      return;\n    }\n\n\n    const node = document.createElement(\"div\");\n    const textNode = document.createTextNode(event?.data);\n    node.appendChild(textNode);\n    iframeRef?.current?.contentWindow?.document.body.appendChild(textNode);\n  };\n\n\n  return (\n    <div>\n      <iframe id=\"1\" {...prop} ref={ref} srcDoc={html}></iframe>\n    </div>\n  );\n});\n\n\nexport default IFrame;\r\n```\n\n# ìš”ì•½\n\n\n\n- ë¶€ëª¨ì™€ ìì‹ ê°„ì˜ ê°„ë‹¨í•œ ë©”ì‹œì§€ í†µì‹ ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ì´ìœ ì— ëŒ€í•´ ê³µìœ í–ˆì–´ìš”. iFrameì—ì„œ srcDoc ìš”ì†Œë¥¼ ë³€ê²½í•  ê²½ìš° ì‘ë™í•˜ì§€ ì•Šì•„ìš”.\n- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ iFrameì— HTMLì„ ì‚½ì…í•˜ê³  ì§€ì†ì ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ iFrameì´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì§€ì›Œ ë²„ë¦¬ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆì–´ìš”.","ogImage":{"url":"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_0.png"},"coverImage":"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_0.png","tag":["Tech"],"readingTime":7},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h1>ê°œìš”</h1>\n<p>ì´ ê¸°ì‚¬ì—ì„œëŠ” ë¶€ëª¨ ì°½ê³¼ ìì‹ iFrame ê°„ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ê³  ì‹¶ì–´ìš”. ì´ ê³¼ì •ì—ì„œ iFrameì´ ë¦¬ìŠ¤ë„ˆë¥¼ ì–´ë–»ê²Œ ì§€ìš°ëŠ”ì§€ì— ëŒ€í•´ í¥ë¯¸ë¡œìš´ ì ì„ ë°œê²¬í–ˆì–´ìš”. ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”, ë‚˜ì•„ê°€ë©´ì„œ ìŠ¤í¬ë¦°ìƒ·ì„ ê²Œì‹œí•  ê±°ì—ìš”. <a href=\"https://github.com\" rel=\"nofollow\" target=\"_blank\">GitHub ë§í¬</a></p>\n<p>ì¦ê²ê²Œ ê³µë¶€í•˜ì„¸ìš”!</p>\n<h1>iFrameì´ë€ ë¬´ì—‡ì¸ê°€ìš”?</h1>\n<p>iFrame ë˜ëŠ” ì¸ë¼ì¸ í”„ë ˆì„ì€ ë¶€ëª¨ ì›¹í˜ì´ì§€ ë‚´ì— ë‹¤ë¥¸ ë¬¸ì„œë¥¼ ë¡œë“œí•˜ëŠ” HTML ìš”ì†Œì…ë‹ˆë‹¤.</p>\n<h1>iFrameì„ ì‚¬ìš©í•˜ëŠ” ê³³ì€ ì–´ë””ì¸ê°€ìš”?</h1>\n<p>iFrameì€ ì´ë¯¸ ìˆëŠ” HTML ì•ˆì— HTMLì„ í¬í•¨ì‹œí‚¤ê³  ì‹¶ì„ ë•Œë‚˜ ì‹ ë¢°í•  ìˆ˜ ì—†ê±°ë‚˜ ì œ3ì ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¦‰, ê´‘ê³  ì„¹ì…˜ì„ ì›¹ì‚¬ì´íŠ¸ì— í‘œì‹œí•˜ê±°ë‚˜ YouTube ë¹„ë””ì˜¤ë¥¼ ë„£ê³  ì‹¶ì„ ë•Œ iFrameì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ iFrameì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” ì œ3ì ì‚¬ì´íŠ¸/ì½˜í…ì¸ ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>\n<h1>iFrame ìƒì„±í•˜ê¸°</h1>\n<p>ì œê°€ ë§Œë“  í”„ë¡œì íŠ¸ëŠ” ê°„ë‹¨í•œ React ì•±(v18.2.0)ì…ë‹ˆë‹¤. ë¶€ëª¨ ìœ„ì ¯(App.tsx)ì€ iFrame ì»´í¬ë„ŒíŠ¸(IFrame.tsx)ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ëª¨ë‘ ë©”ì‹œì§€ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ í•´ì œë  ë•Œ ì œê±°ë©ë‹ˆë‹¤. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ postMessage í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ iFrameì— ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.</p>\n<p>App.tsx</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect, useRef } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"react\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">IFrame</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"./iFrame\"</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">App</span>: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">FC</span> = <span class=\"hljs-function\">() =></span> {\n <span class=\"hljs-keyword\">const</span> refs = useRef&#x3C;<span class=\"hljs-title class_\">HTMLIFrameElement</span>>(<span class=\"hljs-literal\">null</span>);\n\n <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n   <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"message\"</span>, processMessage, <span class=\"hljs-literal\">false</span>);\n   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =></span> <span class=\"hljs-variable language_\">window</span>.<span class=\"hljs-title function_\">removeEventListener</span>(<span class=\"hljs-string\">\"message\"</span>, processMessage);\n }, []);\n\n\n <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">processMessage</span> = (<span class=\"hljs-params\">event: MessageEvent</span>) => {\n   <span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">origin</span> !== <span class=\"hljs-string\">\"http://localhost:8080\"</span>) {\n     <span class=\"hljs-keyword\">return</span>;\n   }\n   <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"parent Event Listener\"</span>, event);\n };\n\n\n <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">buttonClick</span> = (<span class=\"hljs-params\">event: React.MouseEvent</span>) => {\n   event.<span class=\"hljs-title function_\">stopPropagation</span>();\n   <span class=\"hljs-keyword\">if</span> (refs.<span class=\"hljs-property\">current</span> === <span class=\"hljs-literal\">null</span>) {\n     <span class=\"hljs-keyword\">return</span>;\n   }\n\n   refs?.<span class=\"hljs-property\">current</span>?.<span class=\"hljs-property\">contentWindow</span>?.<span class=\"hljs-title function_\">postMessage</span>(<span class=\"hljs-string\">\"ë¶€ëª¨ì—ì„œ ë³´ë‚¸ ë©”ì‹œì§€\"</span>, <span class=\"hljs-string\">\"*\"</span>);\n };\n <span class=\"hljs-keyword\">return</span> (\n   <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>\n     <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span>\n       <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{</span> <span class=\"hljs-attr\">margin:</span> \"<span class=\"hljs-attr\">10px</span>\", <span class=\"hljs-attr\">marginLeft:</span> \"<span class=\"hljs-attr\">0px</span>\" }\n       <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{buttonClick}</span>\n     ></span>\n       ìì‹ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°\n     <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span>\n     <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">IFrame</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">{refs}</span> /></span>\n   <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n );\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">App</span>;\n</code></pre>\n<p>IFrame.tsx</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">React</span>, { useEffect, useState, forwardRef, <span class=\"hljs-title class_\">ForwardedRef</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"react\"</span>;\n\n\ninterface <span class=\"hljs-title class_\">IFrameProps</span> {\n <span class=\"hljs-attr\">ref</span>: <span class=\"hljs-title class_\">ForwardedRef</span>&#x3C;<span class=\"hljs-title class_\">HTMLIFrameElement</span>>;\n}\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">IFrame</span> = forwardRef&#x3C;<span class=\"hljs-title class_\">HTMLIFrameElement</span>, <span class=\"hljs-title class_\">IFrameProps</span>>(<span class=\"hljs-function\">(<span class=\"hljs-params\">prop, ref</span>) =></span> {\n <span class=\"hljs-keyword\">const</span> [message, setMessage] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-string\">''</span>);\n <span class=\"hljs-keyword\">const</span> iframeRef = ref <span class=\"hljs-keyword\">as</span> <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">MutableRefObject</span>&#x3C;<span class=\"hljs-title class_\">HTMLIFrameElement</span>>;\n <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =></span> {\n   <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"mounted\"</span>);\n   iframeRef?.<span class=\"hljs-property\">current</span>?.<span class=\"hljs-property\">contentWindow</span>?.<span class=\"hljs-title function_\">addEventListener</span>(\n     <span class=\"hljs-string\">\"message\"</span>,\n     processMessage,\n     <span class=\"hljs-literal\">false</span>\n   );\n   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =></span> {\n     <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"unmounted\"</span>);\n     iframeRef?.<span class=\"hljs-property\">current</span>?.<span class=\"hljs-property\">contentWindow</span>?.<span class=\"hljs-title function_\">removeEventListener</span>(\n       <span class=\"hljs-string\">\"message\"</span>,\n       processMessage,\n       <span class=\"hljs-literal\">false</span>\n     );\n   };\n }, [iframeRef?.<span class=\"hljs-property\">current</span>]);\n\n\n <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">processMessage</span> = (<span class=\"hljs-params\">event: MessageEvent</span>) => {\n   <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"iFrame Event Listener\"</span>);\n   <span class=\"hljs-keyword\">if</span> (event.<span class=\"hljs-property\">origin</span> !== <span class=\"hljs-string\">\"http://localhost:8080\"</span>) {\n     <span class=\"hljs-keyword\">return</span>;\n   }\n\n\n  <span class=\"hljs-keyword\">const</span> newMessage = message.<span class=\"hljs-title function_\">concat</span>(event?.<span class=\"hljs-property\">data</span>)\n  <span class=\"hljs-title function_\">setMessage</span>(newMessage);\n\n\n };\n\n\n <span class=\"hljs-keyword\">return</span> (\n   <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>\n     <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"1\"</span> {<span class=\"hljs-attr\">...prop</span>} <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">{ref}</span> <span class=\"hljs-attr\">srcDoc</span>=<span class=\"hljs-string\">{message}</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">iframe</span>></span>\n   <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span></span>\n );\n});\n\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">IFrame</span>;\n</code></pre>\n<p>ë¦¬ìŠ¤ë„ˆê°€ ì˜¬ë°”ë¥´ê²Œ ë§ˆìš´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ iFrameì—ì„œ getEventListeners(window)ì„ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤. iFrameì—ì„œ 'message' ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  ëŒ€ê¸°í•˜ëŠ” ë¦¬ìŠ¤ë„ˆë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë³´ì•ˆ ëŒ€ì±…ìœ¼ë¡œ ì•…ì˜ì ì¸ ì‚¬ìš©ìë¡œë¶€í„°ì˜ ë©”ì‹œì§€ë¥¼ ë¬´ì‹œí•˜ë„ë¡ originì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<h1>í™”ë©´ì—ì„œ ë³´ì´ëŠ” ëª¨ìŠµ</h1>\n<pre><code>\n\n\n&#x3C;img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_1.png\" />\n\në²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë©”ì‹œì§€ê°€ iFrame ì•ˆì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.\n\n&#x3C;img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_2.png\" />\n\nì´ ëª¨ë“  ê²ƒì´ ì •ë§ ê¸°ë»¤ì–´ìš”. ê·¸ëŸ¬ë‚˜ ì´ê³³ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë©”ì‹œì§€ë¥¼ iFrameìœ¼ë¡œ ë³´ë‚´ë ¤ê³  ì‹œë„í–ˆì„ ë•Œ iFrame UIê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. iFrame ì•ˆì—ì„œ \"ë¶€ëª¨ë¡œë¶€í„° ì˜¨ ë©”ì‹œì§€\"ë¥¼ ì—¬ëŸ¬ ë²ˆ ë³´ê¸°ë¥¼ ê¸°ëŒ€í–ˆëŠ”ë° ê·¸ëŸ° ì¼ì€ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë²„íŠ¼ í´ë¦­ ì‹œ UIê°€ ë§¤ë²ˆ ì—…ë°ì´íŠ¸ë˜ì§€ ëª»í–ˆë‹¤ëŠ” ê²ƒ ê°™ì•˜ì–´ìš”.\n\n\n\n&#x3C;img src=\"/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_3.png\" />\n\në‚´ ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë‹ˆ, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì–¸ë§ˆìš´íŠ¸í•œ í›„ì— ì¶œë ¥í•˜ëŠ” `unmounted`ê°€ ì•„ë¬´ëŸ° ë°œìƒí•˜ì§€ ì•Šì•˜ì–´. ì´ê²ƒì€ Reactê°€ ë²„íŠ¼ í´ë¦­ í›„ iFrameì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì œëŒ€ë¡œ ì–¸ë§ˆìš´íŠ¸í•˜ì§€ ì•Šì•˜ìŒì„ í™•ì¸í–ˆì–´. (ì¬í‘œí˜„)\n\nuseEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì„ ê±´ë“œë¦¬ë©´ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•´ ë³´ì•˜ì§€ë§Œ, ëª¨ë“  ì‹œë„ê°€ ì‹¤íŒ¨í–ˆì–´. ìì‹ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì—¬ëŸ¬ ë²ˆ ë³´ë‚´ë„, ìì‹ì€ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë§Œ ë“£ë”ë¼ê³ .\n\n# ê·¸ë˜ì„œ ì–´ë–»ê²Œ í•˜ë©´ ì œëŒ€ë¡œ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?\n\n\n\në” ê¶ê¸ˆí•´ì ¸ì„œ, ì²˜ìŒ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— ë‹¤ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í™•ì¸í•´ ë´¤ì–´ìš”. ì—¬ê¸°ì„œ ë¬¸ì œë¥¼ ë°œê²¬í–ˆì–´ìš”.\n\n![ì´ë¯¸ì§€](/assets/img/2024-05-12-iFramewipesoutlistenersandReactdoesnotknowaboutit_4.png)\n\nì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— iFrameì—ëŠ” ì–´ë– í•œ ë¦¬ìŠ¤ë„ˆë„ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šì•˜ì–´ìš”. ë§ˆì¹˜ ì–´ë–»ê²Œë“  ì²« ë²ˆì§¸ ë©”ì‹œì§€ê°€ ë„ì°©í•œ í›„ì— ë¦¬ìŠ¤ë„ˆë“¤ì´ ì œê±°ëœ ê²ƒì²˜ëŸ¼ ë³´ì˜€ì–´ìš”.\n\nì¡°ê¸ˆ ë” ì‹¤í—˜í•´ ë³¸ ê²°ê³¼, srcDoc ìš”ì†Œì— ë¬¸ì œê°€ ìˆëŠ” ê²ƒì„ ë°œê²¬í–ˆì–´ìš”. ë”°ë¼ì„œ, ìƒíƒœê°€ ë³€ê²½ë  ë•Œ srcDoc ìš”ì†Œê°€ iFrameì˜ ìƒˆ ë©”ì‹œì§€ë¥¼ ê°€ë¦¬í‚¤ê²Œ ë˜ì—ˆì–´ìš”. ì´ ë³€ê²½ìœ¼ë¡œ ì¸í•´ iFrameì€ iFrameê³¼ ê´€ë ¨ëœ ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ëª¨ë‘ ì œê±°í•˜ê³  ë¦¬ì•¡íŠ¸ëŠ” ì•„ë¬´ê²ƒë„ ëª¨ë¥´ê²Œ ë˜ì—ˆì–´ìš” ğŸ«¢.\n\n\n\nê·¸ë˜ì„œ ReactëŠ” iFrameì´ ê·¸ê²ƒì„ í•˜ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤. ì™œëƒí•˜ë©´ Reactì—ê²ŒëŠ” iFrameì— ëŒ€í•œ ì°¸ì¡°ê°€ ì¶”ê°€/ì œê±°ë˜ì–´ì•¼ í•˜ëŠ”ë°, ì°¸ì¡°ê°€ ì ˆëŒ€ ë³€ê²½ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ReactëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë§ˆìš´íŠ¸í•˜ê±°ë‚˜ ì–¸ë§ˆìš´íŠ¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ iFrameì— ì •ì  HTMLì„ ì¶”ê°€í–ˆìœ¼ë©°, ë©”ì‹œì§€ê°€ ë„ì°©í•  ë•Œë§ˆë‹¤ ê¸°ì¡´ HTMLì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´ëŠ” srcDocê°€ ìƒˆ HTMLì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— iFrameì— ì²¨ë¶€ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì§€ìš°ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n```js\nimport React, { useEffect, forwardRef, ForwardedRef } from \"react\";\n\n\ninterface IFrameProps {\n  ref: ForwardedRef&#x3C;HTMLIFrameElement>;\n}\n\n\nconst html = `&#x3C;html>\n&#x3C;body>\n&#x3C;div id=\"changeText\" value=\"changeText\">Hello Div&#x3C;/div>\n&#x3C;button value=\"replyButton\" id=\"replyButton\">Reply to parent&#x3C;/button>\n&#x3C;script>\n// Get the button element\nvar button = document.getElementById(\"replyButton\");\n\n\n// click event listener\nbutton.addEventListener(\"click\", function() {\n  console.log('sending message to parent');\n  window.parent.postMessage('Message from Child. Listen to me!');\n});\n&#x3C;/script>\n&#x3C;/body>\n&#x3C;/html>`;\n\n\nconst IFrame = forwardRef&#x3C;HTMLIFrameElement, IFrameProps>((prop, ref) => {\n  const iframeRef = ref as React.MutableRefObject&#x3C;HTMLIFrameElement>;\n  useEffect(() => {\n    console.log(\"mounted\");\n    iframeRef?.current?.contentWindow?.addEventListener(\n      \"message\",\n      processMessage,\n      false\n    );\n    return () => {\n      console.log(\"unmounted\");\n      iframeRef?.current?.contentWindow?.removeEventListener(\n        \"message\",\n        processMessage,\n        false\n      );\n    };\n  }, [iframeRef?.current]);\n\n\n  const processMessage = (event: MessageEvent) => {\n    console.log(\"iFrame Event Listener\");\n    if (event.origin !== \"http://localhost:8080\") {\n      return;\n    }\n\n\n    const node = document.createElement(\"div\");\n    const textNode = document.createTextNode(event?.data);\n    node.appendChild(textNode);\n    iframeRef?.current?.contentWindow?.document.body.appendChild(textNode);\n  };\n\n\n  return (\n    &#x3C;div>\n      &#x3C;iframe id=\"1\" {...prop} ref={ref} srcDoc={html}>&#x3C;/iframe>\n    &#x3C;/div>\n  );\n});\n\n\nexport default IFrame;\n</code></pre>\n<h1>ìš”ì•½</h1>\n<ul>\n<li>ë¶€ëª¨ì™€ ìì‹ ê°„ì˜ ê°„ë‹¨í•œ ë©”ì‹œì§€ í†µì‹ ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ì´ìœ ì— ëŒ€í•´ ê³µìœ í–ˆì–´ìš”. iFrameì—ì„œ srcDoc ìš”ì†Œë¥¼ ë³€ê²½í•  ê²½ìš° ì‘ë™í•˜ì§€ ì•Šì•„ìš”.</li>\n<li>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ iFrameì— HTMLì„ ì‚½ì…í•˜ê³  ì§€ì†ì ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ iFrameì´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì§€ì›Œ ë²„ë¦¬ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆì–´ìš”.</li>\n</ul>\n</body>\n</html>\n"},"__N_SSG":true}