{"pageProps":{"post":{"title":"ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²•","description":"","date":"2024-05-27 18:48","slug":"2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers","content":"\n\nì•ˆë…•í•˜ì„¸ìš”, ì œ ì´ë¦„ì€ Taylor Hughesì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. ì €ëŠ” í˜ì´ìŠ¤ë¶, êµ¬ê¸€, í´ëŸ½í•˜ìš°ìŠ¤ ë° ì¤‘ê°„ì˜ ì—¬ëŸ¬ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ì•±ì„ ì¶œì‹œí•˜ê³  íŒ€ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.\n\nì‚¬ìš©ìê°€ S3 ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¬¸ì œëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜¬ë°”ë¥¸ JavaScript êµ¬ì„± ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ëª¨ë“  ê²ƒì„ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤.\n\nAWS ë¬¸ì„œì— ë”°ë¥´ë©´ ì¶”ê°€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì „ì²´ AWS JS SDKë¥¼ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ê°€ì ¸ì™€ì•¼í•˜ì§€ë§Œ ì‹¤ì œë¡œ ê·¸ëŸ´ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤!\n\nëŒ€ì‹  ì‚¬ì „ ì„œëª…ëœ URL ë° í˜„ëŒ€ì ì¸ ì›¹ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì†ì‰½ê²Œ S3ë¡œ ì§ì ‘ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ëª‡ ì¤„ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì‚¬ìš©ì ë¸Œë¼ìš°ì €ì˜ ê´€ì ì—ì„œ ì „ì²´ ì†”ë£¨ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n- ì‚¬ìš©ìê°€ \"íŒŒì¼ ì—…ë¡œë“œ\"ë¥¼ í´ë¦­í•˜ê³  íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.\n- í•´ë‹¹ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ ì¸¡ APIì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ S3 PutObject URLì„ ìš”ì²­í•©ë‹ˆë‹¤.\n- ë¯¸ë¦¬ ì„œëª…ëœ S3 URLì„ ì œê³µë°›ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ PUTí•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n- ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ìƒˆ í‚¤ë¥¼ ë‹¤ì‹œ APIë¡œ ë°˜í™˜í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ëŒ€í•´ APIê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\n- ì´ìœ¤ ì°½ì¶œ!\n\në§Œì•½ ì™„ì„±ëœ ì½”ë“œë¡œ ë°”ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤ë©´, TypeScript í”„ë¡ íŠ¸ì—”ë“œ ë° Python API í•¸ë“¤ëŸ¬ ì˜ˆì‹œê°€ í¬í•¨ëœ gistë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.\n\nì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n## AWS êµ¬ì„±\n\në¨¼ì €, ê³µê°œ ì•¡ì„¸ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•¡ì„¸ìŠ¤ ì •ì±…ì´ ì—†ëŠ” ìƒˆ ë²„í‚· yourproject-uploadì„ ë§Œë“­ë‹ˆë‹¤. (ë˜í•œ ì´ ë²„í‚·ì— ëŒ€í•´ ëª¨ë“  ê²ƒì„ 24ì‹œê°„ í›„ì— ë§Œë£Œë˜ë„ë¡ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤ â€” ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬ ê³µê°œì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)\n\në‘˜ì§¸, web-upload-onlyë¼ëŠ” ìƒˆ IAM ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒˆ ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ì„ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ë°±ì—”ë“œ ì›¹ ì„œë²„ì— ì¶”ê°€í•˜ì„¸ìš”. (ì´ ìê²© ì¦ëª…ì€ ì£¼ AWS ìê²© ì¦ëª…ê³¼ ë³„ë„ì—¬ì•¼ í•©ë‹ˆë‹¤.)\n\nì…‹ì§¸, web-upload-onlyì—ê²Œ ìƒˆ ë²„í‚· yourproject-upload/*ì˜ ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ s3:PutObject ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìš°ë¦¬ëŠ” ì‚¬ì „ ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•  ë•Œ ì“°ê¸° í‚¤ë¥¼ ì œí•œí•  ê²ƒì…ë‹ˆë‹¤.)\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png\" />\n\në§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ AWS ì—­í•  ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ yourproject-upload/* ë²„í‚·ì— s3:GetObject ì•¡ì„¸ìŠ¤ë„ ë¶€ì—¬í•˜ì„¸ìš”. ì—…ë¡œë“œ ë²„í‚·ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ main/public ì„œë¹™ ë²„í‚·ìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n## ì›¹ ì„œë²„: \"ì—…ë¡œë“œ ìƒì„±\" API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€\n\nìƒˆ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ì„ ì–»ì—ˆë‹¤ë©´ ì´ì œ S3ì— íŠ¹ì • í‚¤ë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ì‚¬ì „ ì„œëª…ëœ URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n- content_type â€” ë¸Œë¼ìš°ì €ì˜ PUT ìš”ì²­ì˜ ì»¨í…ì¸  ìœ í˜•ìœ¼ë¡œ ì„¤ì •ë  íŒŒì¼ì˜ MIME ìœ í˜•ì´ë©°, ì„œëª…ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\n- filename â€” íŒŒì¼ì˜ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ, ì—¬ê¸°ì„œ í™•ì¥ìë¥¼ ê°€ì ¸ì™€ì„œ S3 í‚¤ì— ì¢‹ì€ í™•ì¥ìë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì´ëŸ¬í•œ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AWS S3 í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„œëª…ëœ PutObject URLì„ ìƒì„±í•˜ì„¸ìš”. Pythonì—ì„œ boto3ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:\n\n```python\ndef upload_s3_client() -> S3Client:\n    return boto3.client(\n        \"s3\",\n        aws_access_key_id=settings.UPLOAD_AWS_ACCESS_KEY_ID,\n        aws_secret_access_key=settings.UPLOAD_AWS_SECRET_ACCESS_KEY,\n        region_name=AWS_REGION,\n    )\n\n@api_view(\"/upload/create\")\ndef create_upload(request: Request) -> Response:\n    ext = request.validated_data[\"original_filename\"].split(\".\")[-1].lower()\n    # ìƒì„±ëœ S3 ê²½ë¡œì— ì‚¬ìš©ì IDì™€ ë‚ ì§œ í¬í•¨í•˜ê¸°:\n    date = datetime.now().strftime(\"%Y%m%d\")\n    key = f\"uploads/{request.user.id}/{date}-{uuid.uuid4()}.{ext}\"\n    # ì„œëª…ëœ URL ìƒì„±:\n    presigned_upload_url = upload_s3_client().generate_presigned_url(\n        \"put_object\",\n        Params={\n            \"Bucket\": \"yourproject-upload\",\n            \"Key\": key,\n            \"ContentType\": request.validated_data[\"content_type\"],\n        },\n        ExpiresIn=60 * 60,\n    )\n    # í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‚¤ ë° ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•©ë‹ˆë‹¤:\n    return success_response(\n        {\"key\": key, \"presigned_upload_url\": presigned_upload_url}\n    )\n```\n\n<div class=\"content-ad\"></div>\n\n## í´ë¼ì´ì–¸íŠ¸ ì¸¡: ëª¨ë‘ ì—°ê²°í•˜ê¸°\n\nì´ì œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” íŒŒì¼ ì…ë ¥ë€ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì•¼í•©ë‹ˆë‹¤. í•œ ë²ˆ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë©´ ìƒˆ API ë°±ì—”ë“œì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ URLì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API ìš”ì²­ì„ ë³´í†µ ì–´ë–»ê²Œ ë§Œë“¤ë“ ì§€ ìƒê´€ì—†ìŠµë‹ˆë‹¤:\n\n```js\nfunction getPresignedUrl(file: File) {\n  return makeAPIRequest(\n    \"POST\",\n    \"upload/create\",\n    {\n      original_filename: file.name,\n      content_type: file.type,\n    },\n    (response) => response as {\n      key: string;\n      presigned_upload_url: string;\n    },\n  );\n}\n```\n\nê·¸ëŸ° ë‹¤ìŒ, XmlHttpRequestë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ì§ì ‘ S3ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\nfunction uploadFile(\n  file: File,\n  presignedUploadUrl: string,\n  onProgress: (pct: number) => void,\n): Promise<void> {\n  return new Promise<void>((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    xhr.upload.addEventListener(\"progress\", (e) => {\n      if (e.lengthComputable) {\n        const pct = e.loaded / e.total;\n        onProgress(pct * 100);\n      }\n    });\n    xhr.upload.addEventListener(\"error\", (e) => {\n      reject(new Error(\"Upload failed: \" + e.toString()));\n    });\n    xhr.upload.addEventListener(\"abort\", (e) => {\n      reject(new Error(\"Upload aborted: \" + e.toString()));\n    });\n    xhr.addEventListener(\"load\", (e) => {\n      if (xhr.status === 200) {\n        resolve();\n      } else {\n        reject(new Error(\"Upload failed \" + xhr.status));\n      }\n    });\n    xhr.open(\"PUT\", presignedUploadUrl, true);\n    try {\n      xhr.send(file);\n    } catch (e) {\n      reject(new Error(\"Upload failed: \" + e.toString()));\n    }\n  });\n}\n```\n\nReact Hooksë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nexport function useUpload() {\n  const [uploadState, setUploadState] = useState<\n    \"idle\" | \"starting\" | \"uploading\" | \"finishing\" | \"done\" | \"error\"\n  >(\"idle\");\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [uploadError, setUploadError] = useState<Error | null>(null);\n\n  return {\n    uploadState,\n    uploadProgress,\n    uploadError,\n    upload: async (\n      file: File,\n      onSuccess: (uploadKey: string) => Promise<void>,\n    ) => {\n      setUploadState(\"starting\");\n\n      try {\n        // ë°±ì—”ë“œ APIì—ì„œ ì‚¬ì „ ì„œëª…ëœ URL ê°€ì ¸ì˜¤ê¸°:\n        const { key, presigned_upload_url } = await getPresignedUrl(\n          file,\n        );\n        setUploadState(\"uploading\");\n        // XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì—…ë¡œë“œ:\n        await uploadFile(file, presigned_upload_url, (pct) => {\n          setUploadProgress(pct);\n        });\n        setUploadState(\"finishing\");\n        // ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ ìœ ìš©í•˜ê²Œ í™œìš©í•˜ê¸°; ì•„ë§ˆë„ ì´ í‚¤ë¥¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤!\n        await onSuccess(key);\n        setUploadState(\"done\");\n      } catch (e) {\n        setUploadState(\"error\");\n        setUploadError(e);\n      }\n    },\n  };\n}\n```\n\n## ë§ˆì§€ë§‰ìœ¼ë¡œ: ìƒˆë¡œ ì—…ë¡œë“œëœ íŒŒì¼ ì‚¬ìš©í•˜ê¸°\n\n\n<div class=\"content-ad\"></div>\n\nì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì—…ë¡œë“œí•œ S3 í‚¤ë¥¼ APIë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•˜ê±°ë‚˜ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì† ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì—…ë¡œë“œ ì „ìš© S3 ë²„í‚· ë‚´ì˜ ê²½ë¡œì¸ ì—…ë¡œë“œ í‚¤ë¥¼ ë°›ëŠ” ë˜ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ë¥¸ ë²„í‚·ìœ¼ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n(ì €ëŠ” ì—…ë¡œë“œ í‚¤ì— ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ë„£ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ ë‚´ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¡œë¶€í„° ì—…ë¡œë“œëœ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)\n\në‹¤ìŒì€ Pythonì—ì„œ ë²„í‚·ì„ ê³µê°œ ì„œë¹™ ë²„í‚·ì— ë³µì‚¬í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\nupload_key = request.validated_data[\"upload_key\"]\next = upload_key.split(\".\")[-1]\nslug = slugify(request.validated_data[\"filename\"])\ndate = datetime.now().strftime(r\"%Y%m%d_%H%M%S\")\npublic_key = f\"media/{request.user.id}/{date}-{slug}.{ext}\"\n\ntry:\n  public_content_s3_client().copy(\n    CopySource={\n      \"Bucket\": \"yourproject-upload\",\n      \"Key\": upload_key,\n    },\n    Bucket=\"yourproject-public\",\n    Key=public_key,\n  )\nexcept Exception:\n  logging.exception(f\"Failed to copy file for user={request.user.id}\")\n```\n\nìš”ë ‡ê²Œ í•´ìš”. ëˆ„êµ°ê°€ì—ê² ë„ì›€ì´ ë˜ê¸¸ ë°”ë˜ìš”! í˜¹ì‹œ ë‹¤ì‹œ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ê¸° ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë‹´ê¸´ gist ë§í¬ë„ ë“œë¦´ê²Œìš”. ğŸ¥°\n\nì˜ê²¬ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì•Œë ¤ì£¼ì„¸ìš”! @taylorhughes\n","ogImage":{"url":"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png"},"coverImage":"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png","tag":["Tech"],"readingTime":7},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>ì•ˆë…•í•˜ì„¸ìš”, ì œ ì´ë¦„ì€ Taylor Hughesì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. ì €ëŠ” í˜ì´ìŠ¤ë¶, êµ¬ê¸€, í´ëŸ½í•˜ìš°ìŠ¤ ë° ì¤‘ê°„ì˜ ì—¬ëŸ¬ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ì•±ì„ ì¶œì‹œí•˜ê³  íŒ€ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ì‚¬ìš©ìê°€ S3 ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¬¸ì œëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜¬ë°”ë¥¸ JavaScript êµ¬ì„± ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ëª¨ë“  ê²ƒì„ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤.</p>\n<p>AWS ë¬¸ì„œì— ë”°ë¥´ë©´ ì¶”ê°€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì „ì²´ AWS JS SDKë¥¼ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ê°€ì ¸ì™€ì•¼í•˜ì§€ë§Œ ì‹¤ì œë¡œ ê·¸ëŸ´ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤!</p>\n<p>ëŒ€ì‹  ì‚¬ì „ ì„œëª…ëœ URL ë° í˜„ëŒ€ì ì¸ ì›¹ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì†ì‰½ê²Œ S3ë¡œ ì§ì ‘ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ëª‡ ì¤„ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p>\n<p>ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì˜ ê´€ì ì—ì„œ ì „ì²´ ì†”ë£¨ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>\n<ul>\n<li>ì‚¬ìš©ìê°€ \"íŒŒì¼ ì—…ë¡œë“œ\"ë¥¼ í´ë¦­í•˜ê³  íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.</li>\n<li>í•´ë‹¹ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ ì¸¡ APIì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ S3 PutObject URLì„ ìš”ì²­í•©ë‹ˆë‹¤.</li>\n<li>ë¯¸ë¦¬ ì„œëª…ëœ S3 URLì„ ì œê³µë°›ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ PUTí•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ìƒˆ í‚¤ë¥¼ ë‹¤ì‹œ APIë¡œ ë°˜í™˜í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ëŒ€í•´ APIê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li>\n<li>ì´ìœ¤ ì°½ì¶œ!</li>\n</ul>\n<p>ë§Œì•½ ì™„ì„±ëœ ì½”ë“œë¡œ ë°”ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤ë©´, TypeScript í”„ë¡ íŠ¸ì—”ë“œ ë° Python API í•¸ë“¤ëŸ¬ ì˜ˆì‹œê°€ í¬í•¨ëœ gistë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>\n<p>ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<h2>AWS êµ¬ì„±</h2>\n<p>ë¨¼ì €, ê³µê°œ ì•¡ì„¸ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•¡ì„¸ìŠ¤ ì •ì±…ì´ ì—†ëŠ” ìƒˆ ë²„í‚· yourproject-uploadì„ ë§Œë“­ë‹ˆë‹¤. (ë˜í•œ ì´ ë²„í‚·ì— ëŒ€í•´ ëª¨ë“  ê²ƒì„ 24ì‹œê°„ í›„ì— ë§Œë£Œë˜ë„ë¡ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤ â€” ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬ ê³µê°œì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)</p>\n<p>ë‘˜ì§¸, web-upload-onlyë¼ëŠ” ìƒˆ IAM ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒˆ ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ì„ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ë°±ì—”ë“œ ì›¹ ì„œë²„ì— ì¶”ê°€í•˜ì„¸ìš”. (ì´ ìê²© ì¦ëª…ì€ ì£¼ AWS ìê²© ì¦ëª…ê³¼ ë³„ë„ì—¬ì•¼ í•©ë‹ˆë‹¤.)</p>\n<p>ì…‹ì§¸, web-upload-onlyì—ê²Œ ìƒˆ ë²„í‚· yourproject-upload/*ì˜ ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ s3:PutObject ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìš°ë¦¬ëŠ” ì‚¬ì „ ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•  ë•Œ ì“°ê¸° í‚¤ë¥¼ ì œí•œí•  ê²ƒì…ë‹ˆë‹¤.)</p>\n<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ AWS ì—­í•  ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ yourproject-upload/* ë²„í‚·ì— s3:GetObject ì•¡ì„¸ìŠ¤ë„ ë¶€ì—¬í•˜ì„¸ìš”. ì—…ë¡œë“œ ë²„í‚·ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ main/public ì„œë¹™ ë²„í‚·ìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>\n<h2>ì›¹ ì„œë²„: \"ì—…ë¡œë“œ ìƒì„±\" API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€</h2>\n<p>ìƒˆ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ì„ ì–»ì—ˆë‹¤ë©´ ì´ì œ S3ì— íŠ¹ì • í‚¤ë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ì‚¬ì „ ì„œëª…ëœ URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>\n<ul>\n<li>content_type â€” ë¸Œë¼ìš°ì €ì˜ PUT ìš”ì²­ì˜ ì»¨í…ì¸  ìœ í˜•ìœ¼ë¡œ ì„¤ì •ë  íŒŒì¼ì˜ MIME ìœ í˜•ì´ë©°, ì„œëª…ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>\n<li>filename â€” íŒŒì¼ì˜ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ, ì—¬ê¸°ì„œ í™•ì¥ìë¥¼ ê°€ì ¸ì™€ì„œ S3 í‚¤ì— ì¢‹ì€ í™•ì¥ìë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n</ul>\n<p>ì´ëŸ¬í•œ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AWS S3 í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„œëª…ëœ PutObject URLì„ ìƒì„±í•˜ì„¸ìš”. Pythonì—ì„œ boto3ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">upload_s3_client</span>() -> S3Client:\n    <span class=\"hljs-keyword\">return</span> boto3.client(\n        <span class=\"hljs-string\">\"s3\"</span>,\n        aws_access_key_id=settings.UPLOAD_AWS_ACCESS_KEY_ID,\n        aws_secret_access_key=settings.UPLOAD_AWS_SECRET_ACCESS_KEY,\n        region_name=AWS_REGION,\n    )\n\n<span class=\"hljs-meta\">@api_view(<span class=\"hljs-params\"><span class=\"hljs-string\">\"/upload/create\"</span></span>)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">create_upload</span>(<span class=\"hljs-params\">request: Request</span>) -> Response:\n    ext = request.validated_data[<span class=\"hljs-string\">\"original_filename\"</span>].split(<span class=\"hljs-string\">\".\"</span>)[-<span class=\"hljs-number\">1</span>].lower()\n    <span class=\"hljs-comment\"># ìƒì„±ëœ S3 ê²½ë¡œì— ì‚¬ìš©ì IDì™€ ë‚ ì§œ í¬í•¨í•˜ê¸°:</span>\n    date = datetime.now().strftime(<span class=\"hljs-string\">\"%Y%m%d\"</span>)\n    key = <span class=\"hljs-string\">f\"uploads/<span class=\"hljs-subst\">{request.user.<span class=\"hljs-built_in\">id</span>}</span>/<span class=\"hljs-subst\">{date}</span>-<span class=\"hljs-subst\">{uuid.uuid4()}</span>.<span class=\"hljs-subst\">{ext}</span>\"</span>\n    <span class=\"hljs-comment\"># ì„œëª…ëœ URL ìƒì„±:</span>\n    presigned_upload_url = upload_s3_client().generate_presigned_url(\n        <span class=\"hljs-string\">\"put_object\"</span>,\n        Params={\n            <span class=\"hljs-string\">\"Bucket\"</span>: <span class=\"hljs-string\">\"yourproject-upload\"</span>,\n            <span class=\"hljs-string\">\"Key\"</span>: key,\n            <span class=\"hljs-string\">\"ContentType\"</span>: request.validated_data[<span class=\"hljs-string\">\"content_type\"</span>],\n        },\n        ExpiresIn=<span class=\"hljs-number\">60</span> * <span class=\"hljs-number\">60</span>,\n    )\n    <span class=\"hljs-comment\"># í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‚¤ ë° ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•©ë‹ˆë‹¤:</span>\n    <span class=\"hljs-keyword\">return</span> success_response(\n        {<span class=\"hljs-string\">\"key\"</span>: key, <span class=\"hljs-string\">\"presigned_upload_url\"</span>: presigned_upload_url}\n    )\n</code></pre>\n<h2>í´ë¼ì´ì–¸íŠ¸ ì¸¡: ëª¨ë‘ ì—°ê²°í•˜ê¸°</h2>\n<p>ì´ì œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” íŒŒì¼ ì…ë ¥ë€ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì•¼í•©ë‹ˆë‹¤. í•œ ë²ˆ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë©´ ìƒˆ API ë°±ì—”ë“œì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ URLì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API ìš”ì²­ì„ ë³´í†µ ì–´ë–»ê²Œ ë§Œë“¤ë“ ì§€ ìƒê´€ì—†ìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getPresignedUrl</span>(<span class=\"hljs-params\">file: File</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">makeAPIRequest</span>(\n    <span class=\"hljs-string\">\"POST\"</span>,\n    <span class=\"hljs-string\">\"upload/create\"</span>,\n    {\n      <span class=\"hljs-attr\">original_filename</span>: file.<span class=\"hljs-property\">name</span>,\n      <span class=\"hljs-attr\">content_type</span>: file.<span class=\"hljs-property\">type</span>,\n    },\n    <span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =></span> response <span class=\"hljs-keyword\">as</span> {\n      <span class=\"hljs-attr\">key</span>: string;\n      <span class=\"hljs-attr\">presigned_upload_url</span>: string;\n    },\n  );\n}\n</code></pre>\n<p>ê·¸ëŸ° ë‹¤ìŒ, XmlHttpRequestë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ì§ì ‘ S3ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">uploadFile</span>(<span class=\"hljs-params\">\n  file: File,\n  presignedUploadUrl: string,\n  onProgress: (pct: number) => <span class=\"hljs-keyword\">void</span>,\n</span>): <span class=\"hljs-title class_\">Promise</span>&#x3C;<span class=\"hljs-keyword\">void</span>> {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>&#x3C;<span class=\"hljs-keyword\">void</span>>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n    <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>();\n    xhr.<span class=\"hljs-property\">upload</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"progress\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =></span> {\n      <span class=\"hljs-keyword\">if</span> (e.<span class=\"hljs-property\">lengthComputable</span>) {\n        <span class=\"hljs-keyword\">const</span> pct = e.<span class=\"hljs-property\">loaded</span> / e.<span class=\"hljs-property\">total</span>;\n        <span class=\"hljs-title function_\">onProgress</span>(pct * <span class=\"hljs-number\">100</span>);\n      }\n    });\n    xhr.<span class=\"hljs-property\">upload</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"error\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =></span> {\n      <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">\"Upload failed: \"</span> + e.<span class=\"hljs-title function_\">toString</span>()));\n    });\n    xhr.<span class=\"hljs-property\">upload</span>.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"abort\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =></span> {\n      <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">\"Upload aborted: \"</span> + e.<span class=\"hljs-title function_\">toString</span>()));\n    });\n    xhr.<span class=\"hljs-title function_\">addEventListener</span>(<span class=\"hljs-string\">\"load\"</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =></span> {\n      <span class=\"hljs-keyword\">if</span> (xhr.<span class=\"hljs-property\">status</span> === <span class=\"hljs-number\">200</span>) {\n        <span class=\"hljs-title function_\">resolve</span>();\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">\"Upload failed \"</span> + xhr.<span class=\"hljs-property\">status</span>));\n      }\n    });\n    xhr.<span class=\"hljs-title function_\">open</span>(<span class=\"hljs-string\">\"PUT\"</span>, presignedUploadUrl, <span class=\"hljs-literal\">true</span>);\n    <span class=\"hljs-keyword\">try</span> {\n      xhr.<span class=\"hljs-title function_\">send</span>(file);\n    } <span class=\"hljs-keyword\">catch</span> (e) {\n      <span class=\"hljs-title function_\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">\"Upload failed: \"</span> + e.<span class=\"hljs-title function_\">toString</span>()));\n    }\n  });\n}\n</code></pre>\n<p>React Hooksë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">useUpload</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> [uploadState, setUploadState] = useState&#x3C;\n    <span class=\"hljs-string\">\"idle\"</span> | <span class=\"hljs-string\">\"starting\"</span> | <span class=\"hljs-string\">\"uploading\"</span> | <span class=\"hljs-string\">\"finishing\"</span> | <span class=\"hljs-string\">\"done\"</span> | <span class=\"hljs-string\">\"error\"</span>\n  >(<span class=\"hljs-string\">\"idle\"</span>);\n  <span class=\"hljs-keyword\">const</span> [uploadProgress, setUploadProgress] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-number\">0</span>);\n  <span class=\"hljs-keyword\">const</span> [uploadError, setUploadError] = useState&#x3C;<span class=\"hljs-title class_\">Error</span> | <span class=\"hljs-literal\">null</span>>(<span class=\"hljs-literal\">null</span>);\n\n  <span class=\"hljs-keyword\">return</span> {\n    uploadState,\n    uploadProgress,\n    uploadError,\n    <span class=\"hljs-attr\">upload</span>: <span class=\"hljs-keyword\">async</span> (\n      <span class=\"hljs-attr\">file</span>: <span class=\"hljs-title class_\">File</span>,\n      <span class=\"hljs-attr\">onSuccess</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">uploadKey: string</span>) =></span> <span class=\"hljs-title class_\">Promise</span>&#x3C;<span class=\"hljs-keyword\">void</span>>,\n    ) => {\n      <span class=\"hljs-title function_\">setUploadState</span>(<span class=\"hljs-string\">\"starting\"</span>);\n\n      <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-comment\">// ë°±ì—”ë“œ APIì—ì„œ ì‚¬ì „ ì„œëª…ëœ URL ê°€ì ¸ì˜¤ê¸°:</span>\n        <span class=\"hljs-keyword\">const</span> { key, presigned_upload_url } = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getPresignedUrl</span>(\n          file,\n        );\n        <span class=\"hljs-title function_\">setUploadState</span>(<span class=\"hljs-string\">\"uploading\"</span>);\n        <span class=\"hljs-comment\">// XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì—…ë¡œë“œ:</span>\n        <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">uploadFile</span>(file, presigned_upload_url, <span class=\"hljs-function\">(<span class=\"hljs-params\">pct</span>) =></span> {\n          <span class=\"hljs-title function_\">setUploadProgress</span>(pct);\n        });\n        <span class=\"hljs-title function_\">setUploadState</span>(<span class=\"hljs-string\">\"finishing\"</span>);\n        <span class=\"hljs-comment\">// ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ ìœ ìš©í•˜ê²Œ í™œìš©í•˜ê¸°; ì•„ë§ˆë„ ì´ í‚¤ë¥¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤!</span>\n        <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">onSuccess</span>(key);\n        <span class=\"hljs-title function_\">setUploadState</span>(<span class=\"hljs-string\">\"done\"</span>);\n      } <span class=\"hljs-keyword\">catch</span> (e) {\n        <span class=\"hljs-title function_\">setUploadState</span>(<span class=\"hljs-string\">\"error\"</span>);\n        <span class=\"hljs-title function_\">setUploadError</span>(e);\n      }\n    },\n  };\n}\n</code></pre>\n<h2>ë§ˆì§€ë§‰ìœ¼ë¡œ: ìƒˆë¡œ ì—…ë¡œë“œëœ íŒŒì¼ ì‚¬ìš©í•˜ê¸°</h2>\n<p>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì—…ë¡œë“œí•œ S3 í‚¤ë¥¼ APIë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•˜ê±°ë‚˜ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì† ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì—…ë¡œë“œ ì „ìš© S3 ë²„í‚· ë‚´ì˜ ê²½ë¡œì¸ ì—…ë¡œë“œ í‚¤ë¥¼ ë°›ëŠ” ë˜ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ë¥¸ ë²„í‚·ìœ¼ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>(ì €ëŠ” ì—…ë¡œë“œ í‚¤ì— ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ë„£ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ ë‚´ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¡œë¶€í„° ì—…ë¡œë“œëœ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>\n<p>ë‹¤ìŒì€ Pythonì—ì„œ ë²„í‚·ì„ ê³µê°œ ì„œë¹™ ë²„í‚·ì— ë³µì‚¬í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">upload_key = request.<span class=\"hljs-property\">validated_data</span>[<span class=\"hljs-string\">\"upload_key\"</span>]\next = upload_key.<span class=\"hljs-title function_\">split</span>(<span class=\"hljs-string\">\".\"</span>)[-<span class=\"hljs-number\">1</span>]\nslug = <span class=\"hljs-title function_\">slugify</span>(request.<span class=\"hljs-property\">validated_data</span>[<span class=\"hljs-string\">\"filename\"</span>])\ndate = datetime.<span class=\"hljs-title function_\">now</span>().<span class=\"hljs-title function_\">strftime</span>(r<span class=\"hljs-string\">\"%Y%m%d_%H%M%S\"</span>)\npublic_key = f<span class=\"hljs-string\">\"media/{request.user.id}/{date}-{slug}.{ext}\"</span>\n\n<span class=\"hljs-attr\">try</span>:\n  <span class=\"hljs-title function_\">public_content_s3_client</span>().<span class=\"hljs-title function_\">copy</span>(\n    <span class=\"hljs-title class_\">CopySource</span>={\n      <span class=\"hljs-string\">\"Bucket\"</span>: <span class=\"hljs-string\">\"yourproject-upload\"</span>,\n      <span class=\"hljs-string\">\"Key\"</span>: upload_key,\n    },\n    <span class=\"hljs-title class_\">Bucket</span>=<span class=\"hljs-string\">\"yourproject-public\"</span>,\n    <span class=\"hljs-title class_\">Key</span>=public_key,\n  )\nexcept <span class=\"hljs-title class_\">Exception</span>:\n  logging.<span class=\"hljs-title function_\">exception</span>(f<span class=\"hljs-string\">\"Failed to copy file for user={request.user.id}\"</span>)\n</code></pre>\n<p>ìš”ë ‡ê²Œ í•´ìš”. ëˆ„êµ°ê°€ì—ê² ë„ì›€ì´ ë˜ê¸¸ ë°”ë˜ìš”! í˜¹ì‹œ ë‹¤ì‹œ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ê¸° ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë‹´ê¸´ gist ë§í¬ë„ ë“œë¦´ê²Œìš”. ğŸ¥°</p>\n<p>ì˜ê²¬ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì•Œë ¤ì£¼ì„¸ìš”! @taylorhughes</p>\n</body>\n</html>\n"},"__N_SSG":true}