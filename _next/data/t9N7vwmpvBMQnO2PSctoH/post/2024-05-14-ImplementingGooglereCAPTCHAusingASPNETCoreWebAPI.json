{"pageProps":{"post":{"title":"ASPNET Core Web API를 사용하여 Google reCAPTCHA 구현하기","description":"","date":"2024-05-14 14:34","slug":"2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI","content":"\n\n\n![Implementing reCAPTCHA using ASP.NET Core Web API](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_0.png)\n\n폼을 디자인했지만 웹 사이트가 봇 공격이나 다른 자동화된 공격을 받고 백엔드로 무관한 데이터를 제출할까 걱정되나요? Google reCaptcha가 이 문제에 대한 해결책을 제공합니다.\n\nGoogle reCaptcha는 사기를 탐지하고 합법적인 사용자만 시스템에 입력하고 로그인 페이지를 사용하거나 양식을 제출하거나 결제를 하거나 페이지를 보거나 가짜 사용자를 차단하는 등의 작업을 허용하는 시스템입니다.\n\n이제 프로젝트에 reCaptcha를 구현하는 방법에 대해 이야기해보겠습니다. 프론트엔드로 HTML, CSS 및 Javascript을 사용하고 백엔드로는 ASP.NET Core Web API를 사용할 것입니다.\n\n\n\n\n구현 부분은 상당히 쉽습니다. Google은 reCaptcha 생성을 위한 API를 제공하며, 해당 API의 JavaScript 파일 링크를 HTML 코드에 포함해야 합니다.\n\n우리는 HTML과 CSS를 사용하여 간단한 로그인 폼을 만드는 것부터 시작할 것입니다.\n\n나는 이 로그인 폼을 만들었는데, 여기에 Google reCaptcha를 추가할 것입니다.\n\n![Login Form](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_1.png)\n\n\n\nGoogle reCaptcha를 추가하려면 나중에 코드에서 사용할 키를 먼저 생성해야 합니다.\n\n새 키를 생성하려면 다음 URL을 방문하십시오:\n\n[https://www.google.com/recaptcha/admin/create](https://www.google.com/recaptcha/admin/create)\n\nGoogle 계정으로 이미 로그인되어 있으면 등록 대시보드가 표시됩니다. 그렇지 않으면 Google 계정으로 먼저 로그인해야 합니다.\n\n\n\n이것은 등록 키 대시보드입니다. 여기에는 레이블, reCaptcha 유형 및 도메인과 같은 기본 정보를 입력해야 합니다.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_2.png)\n\n- 레이블은 키에 할당하려는 아무 이름이 될 수 있습니다.\n- Google이 제공하는 두 가지 유형의 reCaptcha가 있습니다. v3와 v2입니다. 저희는 v2 \"나는 로봇이 아닙니다\" 확인란을 사용할 것입니다.\n- 도메인 필드에는 Google reCaptcha를 사용할 도메인을 지정해야 합니다. 예를 들어, 웹 사이트 이름이 다음과 같다면:\nhttps://your-website.com/index.html — 여기서는 도메인으로 your-website.com만 입력하면 됩니다.\n저는 데모 목적으로 reCaptcha를 구현하고 있으므로 애플리케이션을 로컬 환경에서 실행할 것입니다. 따라서 도메인으로 127.0.0.1을 사용했습니다.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_3.png)\n\n\n\n모든 세부 정보를 입력한 후 제출 버튼을 클릭해주세요. 그럼 두 개의 키가 생성됩니다. 클라이언트 측에서 사용되는 사이트 키와 서버 측에서 사용되는 시크릿 키가 있습니다.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_4.png)\n\n코딩 부분으로 돌아가면, reCaptcha를 삽입할 위치에 다음 코드 라인을 추가해야 합니다. 로그인 버튼 앞에 추가하겠습니다.\n\n```js\n<div class=\"g-recaptcha\" data-sitekey=여기에_사이트_키_입력></div>\n```\n\n\n\n원하는 위치에 이 div 클래스를 추가한 후, Google reCaptcha API를 호출하는 JavaScript 파일을 추가하십시오.\n\n```js\n<script type=\"text/javascript\" src=\"https://www.google.com/recaptcha/api.js\"></script>\n```\n\nreCaptcha를 추가한 후 로그인 페이지가 이렇게 보입니다.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_5.png)\n\n\n\n아래에 HTML(index.html) 및 CSS(style.css) 파일의 코드를 찾을 수 있어요:\n\n```js\n<!DOCTYPE html>\n<head>\n    <title>로그인 페이지</title>\n    <link rel=\"stylesheet\" href=\"style.css\">    \n    <script type=\"text/javascript\" src=\"https://www.google.com/recaptcha/api.js\"></script>\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js\"></script>\n    <script type=\"text/javascript\" src=\"script.js\"></script>\n</head>\n<body>\n    <div class=\"login-page\">\n        <div class=\"form\">      \n          <div class=\"login-form\">\n            <input type=\"text\" placeholder=\"사용자 이름\"/>\n            <input type=\"password\" placeholder=\"비밀번호\"/>\n            <div class=\"g-recaptcha\" data-sitekey=\"6LfU_xMpAAAAADmXvZq0VqCVLIyJz3x6V8dUQeZ8\"></div><br>\n            <button onclick=\"LoginButton()\">로그인</button>            \n          </div>\n        </div>\n    </div>\n</body>\n</html>\n```\n\n```js\n@import url(https://fonts.googleapis.com/css?family=Roboto:300);\n\n.login-page {\n  width: 360px;\n  padding: 8% 0 0;\n  margin: auto;\n}\n.form {\n  position: relative;\n  z-index: 1;\n  background: rgb(116, 223, 187);\n  max-width: 360px;\n  margin: 0 auto 100px;\n  padding: 30px;\n  text-align: center;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);\n}\n.form input {\n  font-family: \"Roboto\", sans-serif;\n  outline: 0;\n  background: #f2f2f2;\n  width: 100%;\n  border: 0;\n  margin: 0 0 15px;\n  padding: 15px;\n  box-sizing: border-box;\n  font-size: 14px;\n}\n.form button {\n  font-family: \"Roboto\", sans-serif;\n  text-transform: uppercase;\n  outline: 0;\n  background: rgb(8, 103, 116);\n  width: 100%;\n  border: 0;\n  padding: 15px;\n  color: #FFFFFF;\n  font-size: 14px;\n  -webkit-transition: all 0.3 ease;\n  transition: all 0.3 ease;\n  cursor: pointer;\n}\n.form button:hover,.form button:active,.form button:focus {\n  background: #073b44;\n}\n\n.container {\n  position: relative;\n  z-index: 1;\n  max-width: 300px;\n  margin: 0 auto;\n}\n```\n\n프론트엔드 부분이 이제 완료되었어요. 그 다음에는 자바스크립트를 사용하여 reCaptcha로부터 응답을 가져와서 시크릿 키를 사용하여 백엔드에서 응답을 확인할 거에요.\n\n\n\n로그인 버튼에 onclick 함수를 추가했어요. 이 함수는 reCaptcha로부터 응답을 가져오고 API에 ajax 호출을 만들 거예요. 필요에 따라 세 개의 필드가 모두 채워질 때까지 로그인 버튼을 비활성화하는 기능 같은 다른 기능도 추가할 수 있어요. 여기서는 간단하게 reCaptcha의 유효성을 성공 또는 실패했을 때 경고 메시지를 표시해 줄 거에요.\n\nAPI 쪽에서는 ASP.NET Core와 Visual Studio 2022를 사용하고 있어요. 제 블로그의 첫 번째 부분(단계 1)을 참조해서 Visual Studio 2022를 사용해 API 프로젝트를 만드는 방법을 알아볼 수 있어요.\n\n- appsettings.json으로 이동해서 비밀 키를 추가하세요.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_6.png)\n\n\n\n```js\n\"reCaptcha\": {\n    \"SecretKey\": Your_Secret_Key, \n  },\n```\n\n2. 새 컨트롤러를 만듭니다. 다음 단계를 따라주세요:\nControllers 폴더에서 우클릭 -` 추가 -` 컨트롤러 -` 빈 API 컨트롤러 선택 -` 컨트롤러에 이름 지정 (저는 UserController라고 이름짓겠습니다).\n\n컨트롤러를 만들면 다음과 같은 모습이 될 것입니다:\n\n<img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_7.png\" />\n\n\n\n3. 컨트롤러에 reCaptcha를 검증하는 로직을 추가하세요.\n\n![이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_8.png)\n\n- 여기서 우리는 Configuration을 주입하여 appsettings.json에서 Secret Key를 가져오고 HttpClient를 사용하여 결과를 Google API 엔드포인트에 전송합니다.\n- 'GetreCaptchaResponse'라는 메서드를 생성했는데, 이 메서드는 프론트 엔드에서 전송된 reCaptcha 응답을 받습니다. 그다음으로, 응답 및 시크릿 키를 저장할 'content' 변수를 생성합니다.\n- Google은 응답과 시크릿 키가 전달되어야 하는 API 엔드포인트(https://www.google.com/recaptcha/api/siteverify)를 제공하고, json 형식의 결과를 제공합니다. 자세한 정보는 해당 페이지에서 확인할 수 있습니다.\n우리는 이 내용을 해당 API로 전달하고 결과를 'response' 변수에 저장합니다.\n- 이 응답이 성공하면 'Success' 및 'Error' 코드를 읽어 'result' 변수에 저장합니다.\n\n아래에서 전체 코드를 찾을 수 있습니다.\n\n\n\n```csharp\nusing Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\n\nnamespace reCaptchaAPI.Controllers\n{\n    [Route(\"api/[controller]\")]\n    [ApiController]\n    public class UserController : ControllerBase\n    {\n        private readonly IConfiguration _configuration;\n        private readonly HttpClient _httpClient;\n        public UserController(IConfiguration configuration, HttpClient httpClient)\n        {\n            _configuration = configuration;\n            _httpClient = httpClient;\n        }\n        [HttpGet(\"Captcha\")]\n        public async Task<bool> GetreCaptchaResponse(string userResponse)\n        {\n            var reCaptchaSecretKey = _configuration[\"reCaptcha:SecretKey\"];\n\n            if(reCaptchaSecretKey != null && userResponse != null)\n            {\n                var content = new FormUrlEncodedContent(new Dictionary<string, string>\n                {\n                    {\"secret\", reCaptchaSecretKey },\n                    {\"response\", userResponse }\n                });\n                var response = await _httpClient.PostAsync(\"https://www.google.com/recaptcha/api/siteverify\", content);\n                if(response.IsSuccessStatusCode)\n                {\n                    var result = await response.Content.ReadFromJsonAsync<reCaptchaResponse>();\n                    return result.Success;\n                }\n            }\n            return false;\n        }\n\n        public class reCaptchaResponse\n        {\n            public bool Success { get; set; }\n            public string[] ErrorCodes { get; set; }\n        }\n    }\n}\n```\n\n다음 단계는 HttpClient 미들웨어를 program.cs에 등록하고 이 API를 프론트엔드에서 호출할 것이므로 CORS (Cross Origin Resource Sharing)를 지정해야합니다. 이는 프론트엔드 코드에서 API에 액세스할 수 있도록 도와줍니다.\n\n<img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_9.png\" />\n\nCORS를 지정하려면:\n\n\n\n\n```js\nbuilder.Services.AddCors(options =>\n{\n    options.AddDefaultPolicy(\n        policy =>\n        {\n            policy.AllowAnyOrigin()\n                .AllowAnyHeader()\n                .AllowAnyMethod();\n        });\n});\n\napp.UseCors();\n```\n\nTo register HttpClient Middleware:\n\n```js\nbuilder.Services.AddHttpClient();\n```\n\nYour API Project is now completed. You can run and test it once using swagger.\n\n\n\n이제 남은 것은 API를 구현하기 위해 ajax 호출을 작성하는 것입니다. 로그인 버튼에 onclick 함수를 추가하고 함수 내에서 ajax 호출을 정의할 것입니다.\n\n<img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_10.png\" />\n\n여기서 reCaptcha 응답을 받아 이를 API의 매개변수로 보내고 있습니다. API 프로젝트를 실행하고 Swagger 페이지가 열리면 로컬호스트 URL을 복사하여 여기에 사용할 수 있습니다. 엔드포인트 이름을 정확히 지정했는지 확인해주세요!\n\n이러한 변경 사항을 적용하고 애플리케이션을 실행한 후, 다음과 같은 경고를 받게 될 것입니다:\n\n\n\n\n[이미지](/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_11.png)\n\n자바스크립트 (script.js) 코드는 다음과 같습니다:\n\n```js\nfunction LoginButton(){\n    const reCaptchaResponse = grecaptcha.getResponse();\n    if(reCaptchaResponse){\n        $.ajax({\n            type: \"GET\",\n            url: \"https://localhost:44317/api/User/Captcha\",\n            data: {userResponse : reCaptchaResponse},            \n            success: function(data){\n                if(data){\n                    //API returned true\n                    alert(\"Captcha Verified\");\n                }else{\n                    //API returned false\n                    alert(\"Please verify captcha again\");\n                }               \n            },\n            error: function(error){\n                alert(\"Please try again\");\n            }\n        });\n    }\n    else{\n        alert(\"Something went wrong with reCaptcha. Please try again!\");\n    }\n}\n```\n\n이 응용 프로그램의 소스 코드를 참조해주세요:\n","ogImage":{"url":"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_0.png"},"coverImage":"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_0.png","tag":["Tech"],"readingTime":10},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_0.png\" alt=\"Implementing reCAPTCHA using ASP.NET Core Web API\"></p>\n<p>폼을 디자인했지만 웹 사이트가 봇 공격이나 다른 자동화된 공격을 받고 백엔드로 무관한 데이터를 제출할까 걱정되나요? Google reCaptcha가 이 문제에 대한 해결책을 제공합니다.</p>\n<p>Google reCaptcha는 사기를 탐지하고 합법적인 사용자만 시스템에 입력하고 로그인 페이지를 사용하거나 양식을 제출하거나 결제를 하거나 페이지를 보거나 가짜 사용자를 차단하는 등의 작업을 허용하는 시스템입니다.</p>\n<p>이제 프로젝트에 reCaptcha를 구현하는 방법에 대해 이야기해보겠습니다. 프론트엔드로 HTML, CSS 및 Javascript을 사용하고 백엔드로는 ASP.NET Core Web API를 사용할 것입니다.</p>\n<p>구현 부분은 상당히 쉽습니다. Google은 reCaptcha 생성을 위한 API를 제공하며, 해당 API의 JavaScript 파일 링크를 HTML 코드에 포함해야 합니다.</p>\n<p>우리는 HTML과 CSS를 사용하여 간단한 로그인 폼을 만드는 것부터 시작할 것입니다.</p>\n<p>나는 이 로그인 폼을 만들었는데, 여기에 Google reCaptcha를 추가할 것입니다.</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_1.png\" alt=\"Login Form\"></p>\n<p>Google reCaptcha를 추가하려면 나중에 코드에서 사용할 키를 먼저 생성해야 합니다.</p>\n<p>새 키를 생성하려면 다음 URL을 방문하십시오:</p>\n<p><a href=\"https://www.google.com/recaptcha/admin/create\" rel=\"nofollow\" target=\"_blank\">https://www.google.com/recaptcha/admin/create</a></p>\n<p>Google 계정으로 이미 로그인되어 있으면 등록 대시보드가 표시됩니다. 그렇지 않으면 Google 계정으로 먼저 로그인해야 합니다.</p>\n<p>이것은 등록 키 대시보드입니다. 여기에는 레이블, reCaptcha 유형 및 도메인과 같은 기본 정보를 입력해야 합니다.</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_2.png\" alt=\"이미지\"></p>\n<ul>\n<li>레이블은 키에 할당하려는 아무 이름이 될 수 있습니다.</li>\n<li>Google이 제공하는 두 가지 유형의 reCaptcha가 있습니다. v3와 v2입니다. 저희는 v2 \"나는 로봇이 아닙니다\" 확인란을 사용할 것입니다.</li>\n<li>도메인 필드에는 Google reCaptcha를 사용할 도메인을 지정해야 합니다. 예를 들어, 웹 사이트 이름이 다음과 같다면:\n<a href=\"https://your-website.com/index.html\" rel=\"nofollow\" target=\"_blank\">https://your-website.com/index.html</a> — 여기서는 도메인으로 your-website.com만 입력하면 됩니다.\n저는 데모 목적으로 reCaptcha를 구현하고 있으므로 애플리케이션을 로컬 환경에서 실행할 것입니다. 따라서 도메인으로 127.0.0.1을 사용했습니다.</li>\n</ul>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_3.png\" alt=\"이미지\"></p>\n<p>모든 세부 정보를 입력한 후 제출 버튼을 클릭해주세요. 그럼 두 개의 키가 생성됩니다. 클라이언트 측에서 사용되는 사이트 키와 서버 측에서 사용되는 시크릿 키가 있습니다.</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_4.png\" alt=\"이미지\"></p>\n<p>코딩 부분으로 돌아가면, reCaptcha를 삽입할 위치에 다음 코드 라인을 추가해야 합니다. 로그인 버튼 앞에 추가하겠습니다.</p>\n<pre><code class=\"hljs language-js\">&#x3C;div <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"g-recaptcha\"</span> data-sitekey=여기에_사이트_키_입력>&#x3C;/div>\n</code></pre>\n<p>원하는 위치에 이 div 클래스를 추가한 후, Google reCaptcha API를 호출하는 JavaScript 파일을 추가하십시오.</p>\n<pre><code class=\"hljs language-js\">&#x3C;script type=<span class=\"hljs-string\">\"text/javascript\"</span> src=<span class=\"hljs-string\">\"https://www.google.com/recaptcha/api.js\"</span>>&#x3C;/script>\n</code></pre>\n<p>reCaptcha를 추가한 후 로그인 페이지가 이렇게 보입니다.</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_5.png\" alt=\"이미지\"></p>\n<p>아래에 HTML(index.html) 및 CSS(style.css) 파일의 코드를 찾을 수 있어요:</p>\n<pre><code class=\"hljs language-js\">&#x3C;!<span class=\"hljs-variable constant_\">DOCTYPE</span> html>\n<span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">head</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">title</span>></span>로그인 페이지<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">title</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"style.css\"</span>></span>    \n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://www.google.com/recaptcha/api.js\"</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">script</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js\"</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">script</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"script.js\"</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">script</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">head</span>></span>\n<span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">body</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"login-page\"</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"form\"</span>></span>      \n          <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"login-form\"</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text\"</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">\"사용자 이름\"</span>/></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"password\"</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">\"비밀번호\"</span>/></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"g-recaptcha\"</span> <span class=\"hljs-attr\">data-sitekey</span>=<span class=\"hljs-string\">\"6LfU_xMpAAAAADmXvZq0VqCVLIyJz3x6V8dUQeZ8\"</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">br</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onclick</span>=<span class=\"hljs-string\">\"LoginButton()\"</span>></span>로그인<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span>            \n          <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n        <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">body</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">html</span>></span>\n</span></code></pre>\n<pre><code class=\"hljs language-js\">@<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title function_\">url</span>(<span class=\"hljs-attr\">https</span>:<span class=\"hljs-comment\">//fonts.googleapis.com/css?family=Roboto:300);</span>\n\n.<span class=\"hljs-property\">login</span>-page {\n  <span class=\"hljs-attr\">width</span>: 360px;\n  <span class=\"hljs-attr\">padding</span>: <span class=\"hljs-number\">8</span>% <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attr\">margin</span>: auto;\n}\n.<span class=\"hljs-property\">form</span> {\n  <span class=\"hljs-attr\">position</span>: relative;\n  z-<span class=\"hljs-attr\">index</span>: <span class=\"hljs-number\">1</span>;\n  <span class=\"hljs-attr\">background</span>: <span class=\"hljs-title function_\">rgb</span>(<span class=\"hljs-number\">116</span>, <span class=\"hljs-number\">223</span>, <span class=\"hljs-number\">187</span>);\n  max-<span class=\"hljs-attr\">width</span>: 360px;\n  <span class=\"hljs-attr\">margin</span>: <span class=\"hljs-number\">0</span> auto 100px;\n  <span class=\"hljs-attr\">padding</span>: 30px;\n  text-<span class=\"hljs-attr\">align</span>: center;\n  box-<span class=\"hljs-attr\">shadow</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span> 20px <span class=\"hljs-number\">0</span> <span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.2</span>), <span class=\"hljs-number\">0</span> 5px 5px <span class=\"hljs-number\">0</span> <span class=\"hljs-title function_\">rgba</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0.24</span>);\n}\n.<span class=\"hljs-property\">form</span> input {\n  font-<span class=\"hljs-attr\">family</span>: <span class=\"hljs-string\">\"Roboto\"</span>, sans-serif;\n  <span class=\"hljs-attr\">outline</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attr\">background</span>: #f2f2f2;\n  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-number\">100</span>%;\n  <span class=\"hljs-attr\">border</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attr\">margin</span>: <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">0</span> 15px;\n  <span class=\"hljs-attr\">padding</span>: 15px;\n  box-<span class=\"hljs-attr\">sizing</span>: border-box;\n  font-<span class=\"hljs-attr\">size</span>: 14px;\n}\n.<span class=\"hljs-property\">form</span> button {\n  font-<span class=\"hljs-attr\">family</span>: <span class=\"hljs-string\">\"Roboto\"</span>, sans-serif;\n  text-<span class=\"hljs-attr\">transform</span>: uppercase;\n  <span class=\"hljs-attr\">outline</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attr\">background</span>: <span class=\"hljs-title function_\">rgb</span>(<span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">103</span>, <span class=\"hljs-number\">116</span>);\n  <span class=\"hljs-attr\">width</span>: <span class=\"hljs-number\">100</span>%;\n  <span class=\"hljs-attr\">border</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attr\">padding</span>: 15px;\n  <span class=\"hljs-attr\">color</span>: #<span class=\"hljs-variable constant_\">FFFFFF</span>;\n  font-<span class=\"hljs-attr\">size</span>: 14px;\n  -webkit-<span class=\"hljs-attr\">transition</span>: all <span class=\"hljs-number\">0.3</span> ease;\n  <span class=\"hljs-attr\">transition</span>: all <span class=\"hljs-number\">0.3</span> ease;\n  <span class=\"hljs-attr\">cursor</span>: pointer;\n}\n.<span class=\"hljs-property\">form</span> <span class=\"hljs-attr\">button</span>:hover,.<span class=\"hljs-property\">form</span> <span class=\"hljs-attr\">button</span>:active,.<span class=\"hljs-property\">form</span> <span class=\"hljs-attr\">button</span>:focus {\n  <span class=\"hljs-attr\">background</span>: #073b44;\n}\n\n.<span class=\"hljs-property\">container</span> {\n  <span class=\"hljs-attr\">position</span>: relative;\n  z-<span class=\"hljs-attr\">index</span>: <span class=\"hljs-number\">1</span>;\n  max-<span class=\"hljs-attr\">width</span>: 300px;\n  <span class=\"hljs-attr\">margin</span>: <span class=\"hljs-number\">0</span> auto;\n}\n</code></pre>\n<p>프론트엔드 부분이 이제 완료되었어요. 그 다음에는 자바스크립트를 사용하여 reCaptcha로부터 응답을 가져와서 시크릿 키를 사용하여 백엔드에서 응답을 확인할 거에요.</p>\n<p>로그인 버튼에 onclick 함수를 추가했어요. 이 함수는 reCaptcha로부터 응답을 가져오고 API에 ajax 호출을 만들 거예요. 필요에 따라 세 개의 필드가 모두 채워질 때까지 로그인 버튼을 비활성화하는 기능 같은 다른 기능도 추가할 수 있어요. 여기서는 간단하게 reCaptcha의 유효성을 성공 또는 실패했을 때 경고 메시지를 표시해 줄 거에요.</p>\n<p>API 쪽에서는 ASP.NET Core와 Visual Studio 2022를 사용하고 있어요. 제 블로그의 첫 번째 부분(단계 1)을 참조해서 Visual Studio 2022를 사용해 API 프로젝트를 만드는 방법을 알아볼 수 있어요.</p>\n<ul>\n<li>appsettings.json으로 이동해서 비밀 키를 추가하세요.</li>\n</ul>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_6.png\" alt=\"이미지\"></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">\"reCaptcha\"</span>: {\n    <span class=\"hljs-string\">\"SecretKey\"</span>: <span class=\"hljs-title class_\">Your</span>_Secret_Key, \n  },\n</code></pre>\n<ol start=\"2\">\n<li>새 컨트롤러를 만듭니다. 다음 단계를 따라주세요:\nControllers 폴더에서 우클릭 -<code> 추가 -</code> 컨트롤러 -<code> 빈 API 컨트롤러 선택 -</code> 컨트롤러에 이름 지정 (저는 UserController라고 이름짓겠습니다).</li>\n</ol>\n<p>컨트롤러를 만들면 다음과 같은 모습이 될 것입니다:</p>\n<ol start=\"3\">\n<li>컨트롤러에 reCaptcha를 검증하는 로직을 추가하세요.</li>\n</ol>\n<p><img src=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_8.png\" alt=\"이미지\"></p>\n<ul>\n<li>여기서 우리는 Configuration을 주입하여 appsettings.json에서 Secret Key를 가져오고 HttpClient를 사용하여 결과를 Google API 엔드포인트에 전송합니다.</li>\n<li>'GetreCaptchaResponse'라는 메서드를 생성했는데, 이 메서드는 프론트 엔드에서 전송된 reCaptcha 응답을 받습니다. 그다음으로, 응답 및 시크릿 키를 저장할 'content' 변수를 생성합니다.</li>\n<li>Google은 응답과 시크릿 키가 전달되어야 하는 API 엔드포인트(<a href=\"https://www.google.com/recaptcha/api/siteverify)%EB%A5%BC\" rel=\"nofollow\" target=\"_blank\">https://www.google.com/recaptcha/api/siteverify)를</a> 제공하고, json 형식의 결과를 제공합니다. 자세한 정보는 해당 페이지에서 확인할 수 있습니다.\n우리는 이 내용을 해당 API로 전달하고 결과를 'response' 변수에 저장합니다.</li>\n<li>이 응답이 성공하면 'Success' 및 'Error' 코드를 읽어 'result' 변수에 저장합니다.</li>\n</ul>\n<p>아래에서 전체 코드를 찾을 수 있습니다.</p>\n<pre><code class=\"hljs language-csharp\"><span class=\"hljs-keyword\">using</span> Microsoft.AspNetCore.Authorization;\n<span class=\"hljs-keyword\">using</span> Microsoft.AspNetCore.Http;\n<span class=\"hljs-keyword\">using</span> Microsoft.AspNetCore.Mvc;\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">reCaptchaAPI.Controllers</span>\n{\n    [<span class=\"hljs-meta\">Route(<span class=\"hljs-string\">\"api/[controller]\"</span>)</span>]\n    [<span class=\"hljs-meta\">ApiController</span>]\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserController</span> : <span class=\"hljs-title\">ControllerBase</span>\n    {\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> IConfiguration _configuration;\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">readonly</span> HttpClient _httpClient;\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">UserController</span>(<span class=\"hljs-params\">IConfiguration configuration, HttpClient httpClient</span>)</span>\n        {\n            _configuration = configuration;\n            _httpClient = httpClient;\n        }\n        [<span class=\"hljs-meta\">HttpGet(<span class=\"hljs-string\">\"Captcha\"</span>)</span>]\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">async</span> Task&#x3C;<span class=\"hljs-built_in\">bool</span>> <span class=\"hljs-title\">GetreCaptchaResponse</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">string</span> userResponse</span>)</span>\n        {\n            <span class=\"hljs-keyword\">var</span> reCaptchaSecretKey = _configuration[<span class=\"hljs-string\">\"reCaptcha:SecretKey\"</span>];\n\n            <span class=\"hljs-keyword\">if</span>(reCaptchaSecretKey != <span class=\"hljs-literal\">null</span> &#x26;&#x26; userResponse != <span class=\"hljs-literal\">null</span>)\n            {\n                <span class=\"hljs-keyword\">var</span> content = <span class=\"hljs-keyword\">new</span> FormUrlEncodedContent(<span class=\"hljs-keyword\">new</span> Dictionary&#x3C;<span class=\"hljs-built_in\">string</span>, <span class=\"hljs-built_in\">string</span>>\n                {\n                    {<span class=\"hljs-string\">\"secret\"</span>, reCaptchaSecretKey },\n                    {<span class=\"hljs-string\">\"response\"</span>, userResponse }\n                });\n                <span class=\"hljs-keyword\">var</span> response = <span class=\"hljs-keyword\">await</span> _httpClient.PostAsync(<span class=\"hljs-string\">\"https://www.google.com/recaptcha/api/siteverify\"</span>, content);\n                <span class=\"hljs-keyword\">if</span>(response.IsSuccessStatusCode)\n                {\n                    <span class=\"hljs-keyword\">var</span> result = <span class=\"hljs-keyword\">await</span> response.Content.ReadFromJsonAsync&#x3C;reCaptchaResponse>();\n                    <span class=\"hljs-keyword\">return</span> result.Success;\n                }\n            }\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n        }\n\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">reCaptchaResponse</span>\n        {\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">bool</span> Success { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">string</span>[] ErrorCodes { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n        }\n    }\n}\n</code></pre>\n<p>다음 단계는 HttpClient 미들웨어를 program.cs에 등록하고 이 API를 프론트엔드에서 호출할 것이므로 CORS (Cross Origin Resource Sharing)를 지정해야합니다. 이는 프론트엔드 코드에서 API에 액세스할 수 있도록 도와줍니다.</p>\n<p>CORS를 지정하려면:</p>\n<pre><code class=\"hljs language-js\">builder.<span class=\"hljs-property\">Services</span>.<span class=\"hljs-title class_\">AddCors</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">options</span> =></span>\n{\n    options.<span class=\"hljs-title class_\">AddDefaultPolicy</span>(\n        <span class=\"hljs-function\"><span class=\"hljs-params\">policy</span> =></span>\n        {\n            policy.<span class=\"hljs-title class_\">AllowAnyOrigin</span>()\n                .<span class=\"hljs-title class_\">AllowAnyHeader</span>()\n                .<span class=\"hljs-title class_\">AllowAnyMethod</span>();\n        });\n});\n\napp.<span class=\"hljs-title class_\">UseCors</span>();\n</code></pre>\n<p>To register HttpClient Middleware:</p>\n<pre><code class=\"hljs language-js\">builder.<span class=\"hljs-property\">Services</span>.<span class=\"hljs-title class_\">AddHttpClient</span>();\n</code></pre>\n<p>Your API Project is now completed. You can run and test it once using swagger.</p>\n<p>이제 남은 것은 API를 구현하기 위해 ajax 호출을 작성하는 것입니다. 로그인 버튼에 onclick 함수를 추가하고 함수 내에서 ajax 호출을 정의할 것입니다.</p>\n<p>여기서 reCaptcha 응답을 받아 이를 API의 매개변수로 보내고 있습니다. API 프로젝트를 실행하고 Swagger 페이지가 열리면 로컬호스트 URL을 복사하여 여기에 사용할 수 있습니다. 엔드포인트 이름을 정확히 지정했는지 확인해주세요!</p>\n<p>이러한 변경 사항을 적용하고 애플리케이션을 실행한 후, 다음과 같은 경고를 받게 될 것입니다:</p>\n<p><a href=\"/assets/img/2024-05-14-ImplementingGooglereCAPTCHAusingASPNETCoreWebAPI_11.png\">이미지</a></p>\n<p>자바스크립트 (script.js) 코드는 다음과 같습니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">LoginButton</span>(<span class=\"hljs-params\"></span>){\n    <span class=\"hljs-keyword\">const</span> reCaptchaResponse = grecaptcha.<span class=\"hljs-title function_\">getResponse</span>();\n    <span class=\"hljs-keyword\">if</span>(reCaptchaResponse){\n        $.<span class=\"hljs-title function_\">ajax</span>({\n            <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"GET\"</span>,\n            <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">\"https://localhost:44317/api/User/Captcha\"</span>,\n            <span class=\"hljs-attr\">data</span>: {userResponse : reCaptchaResponse},            \n            <span class=\"hljs-attr\">success</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">data</span>){\n                <span class=\"hljs-keyword\">if</span>(data){\n                    <span class=\"hljs-comment\">//API returned true</span>\n                    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">\"Captcha Verified\"</span>);\n                }<span class=\"hljs-keyword\">else</span>{\n                    <span class=\"hljs-comment\">//API returned false</span>\n                    <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">\"Please verify captcha again\"</span>);\n                }               \n            },\n            <span class=\"hljs-attr\">error</span>: <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">error</span>){\n                <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">\"Please try again\"</span>);\n            }\n        });\n    }\n    <span class=\"hljs-keyword\">else</span>{\n        <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">\"Something went wrong with reCaptcha. Please try again!\"</span>);\n    }\n}\n</code></pre>\n<p>이 응용 프로그램의 소스 코드를 참조해주세요:</p>\n</body>\n</html>\n"},"__N_SSG":true}