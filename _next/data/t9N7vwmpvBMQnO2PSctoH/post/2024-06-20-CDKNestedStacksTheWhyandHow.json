{"pageProps":{"post":{"title":"CDK ì¤‘ì²© ìŠ¤íƒ - ì™œì™€ ì–´ë–»ê²Œ","description":"","date":"2024-06-20 02:39","slug":"2024-06-20-CDKNestedStacksTheWhyandHow","content":"\n\n\n![CDK Nested Stacks](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_0.png)\n\n## ì‹œì‘ë§\n\nâœ”ï¸ ìš°ë¦¬ëŠ” ì¤‘ì²© ìŠ¤íƒì˜ í•„ìš”ì„±ì— ëŒ€í•´ ì´ì•¼ê¸°í•©ë‹ˆë‹¤.\nâœ”ï¸ AWS CDKë¡œ ì–´ë–»ê²Œ ì´ê²ƒì´ ì‹¤í˜„ë  ìˆ˜ ìˆëŠ”ì§€ ë…¼ì˜í•©ë‹ˆë‹¤.\n\n# ì†Œê°œ ğŸ‘‹ğŸ½\n\n\n<div class=\"content-ad\"></div>\n\nì´ ë¹ ë¥¸ ê¸°ì‚¬ì—ì„œëŠ” AWS CDK ì¤‘ì²© ìŠ¤íƒì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê³ , ì–¸ì œ ìš°ë¦¬ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€, ê·¸ë¦¬ê³  ì´ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì‚´í´ë³¼ ê²ƒì…ë‹ˆë‹¤. ì˜ˆì œ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ í†µí•´ ê±¸ì–´ ë³´ê¸° ìœ„í•´ 'Gilmore Cuisine'ë¼ëŠ” ê°€ìƒ íšŒì‚¬ë¥¼ ë‹¤ë£° ê²ƒì…ë‹ˆë‹¤:\n\n![image](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_1.png)\n\nê¸°ì‚¬ì˜ ì½”ë“œëŠ” GitHubì—ì„œ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\në” ìì„¸í•œ ê¸°ì‚¬ì™€ ì˜ˆì œëŠ” Serverless Advocate íŒ¨í„´ ë° ì†”ë£¨ì…˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ììœ ë¡­ê²Œ ì´ìš©í•´ ì£¼ì„¸ìš”:\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_2.png\" />\n\n# ì–´ë–»ê²Œ ì‘ë™í• ê¹Œìš”? ğŸ’¡\n\nì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•  ë•Œ í´ë¼ìš°ë“œí¬ë©”ì´ì…˜ì—ì„œ ìŠ¤íƒ ë‹¹ 500ê°œì˜ ë¦¬ì†ŒìŠ¤ ì œí•œì— ë„ë‹¬í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ìˆìŠµë‹ˆë‹¤.\n\nì´ê²ƒì€ ìš°ë¦¬ê°€ ì•„ë§ˆë„ ë‚´ë¶€ì ìœ¼ë¡œ ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” ìš°ë¦¬ë§Œì˜ L3 êµ¬ì„±ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì•ŒëŒ, ì ì§„ì  ë°°í¬, ëŒ€ì‹œë³´ë“œ ë“±ì„ í¬í•¨í•˜ëŠ” ëŒë‹¤ êµ¬ì„±ì´ ìˆëŠ” ê²½ìš°ì´ë©°, ìš°ë¦¬ëŠ” ì´ êµ¬ì„±ì„ ìŠ¤íƒì—ì„œ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©í•˜ì—¬ ì œí•œì„ ì´ˆê³¼í•˜ê²Œ ë©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nAWS CDKì˜ NestedStack êµ¬ì¡°ëŠ” ë¶€ëª¨ ìŠ¤íƒ ë‚´ì—ì„œ í•˜ë‚˜ì˜ ìì›ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ìŠ¤íƒ ë‹¹ AWS CloudFormation 500ê°œ ìì› ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ëŠ” ì¤‘ì²© ìŠ¤íƒì´ ë‹¤ë¥¸ ì¤‘ì²© ìŠ¤íƒì„ í¬í•¨í•˜ì—¬ ìµœëŒ€ 500ê°œì˜ ìì›ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¤‘ì²© ìŠ¤íƒì€ êµ¬ì¡°í™”ëœ ìŠ¤íƒì˜ ê³„ì¸µì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n![CDK Nested Stacks hierarchy](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_3.png)\n\nì¤‘ì²© ìŠ¤íƒì˜ ë²”ìœ„(ë³¸ì§ˆì ìœ¼ë¡œ ë¶€ëª¨)ëŠ” AWS CDKì˜ Stack ë˜ëŠ” NestedStack êµ¬ì¡°ì—¬ì•¼ í•©ë‹ˆë‹¤. ê¸°ì¡´ì˜ ìŠ¤íƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¤‘ì²© ìŠ¤íƒì—ì„œì˜ êµ¬ì¡° ì •ì˜ëŠ” ë™ì¼í•©ë‹ˆë‹¤.\n\ní•©ì„± ê³¼ì •ì—ì„œ ì¤‘ì²© ìŠ¤íƒì€ ìì²´ AWS CloudFormation í…œí”Œë¦¿ìœ¼ë¡œ ë³€í™˜ë˜ì–´ AWS CDK ìŠ¤í…Œì´ì§• ë²„í‚·ì— ì—…ë¡œë“œë©ë‹ˆë‹¤. ì¤‘ì²© ìŠ¤íƒì€ ë¶€ëª¨ ìŠ¤íƒì— ë°”ì¸ë”©ë˜ì–´ ë…ë¦½ì ì¸ ë°°í¬ ìì‚°ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\në¶€ëª¨ ìŠ¤íƒê³¼ ì¤‘ì²© ìŠ¤íƒ ê°„ì˜ ë¦¬ì†ŒìŠ¤ ì†ì„±ì˜ ìƒí˜¸ ì°¸ì¡°ëŠ” AWS CDKë¥¼ ì‚¬ìš©í•  ë•Œ ìë™ìœ¼ë¡œ ìŠ¤íƒ ë§¤ê°œë³€ìˆ˜ì™€ ì¶œë ¥ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.\n\në‹¤ìŒ ì„¹ì…˜ì˜ ì½”ë“œë¥¼ ì‚´í´ë´…ì‹œë‹¤.\n\nğŸ‘‡ ë” ë‚˜ì•„ê°€ê¸° ì „ì— â€” ì•ìœ¼ë¡œì˜ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ê³¼ ì„œë²„ë¦¬ìŠ¤ ë‰´ìŠ¤ë¥¼ ë°›ìœ¼ì‹œë ¤ë©´ LinkedInì—ì„œ ì €ì™€ ì—°ê²°í•´ì£¼ì„¸ìš” https://www.linkedin.com/in/lee-james-gilmore/\n\n![CDK Nested Stacks](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_4.png)\n\n<div class=\"content-ad\"></div>\n\n# ì½”ë“œë¥¼ í†µí•´ ì´ì•¼ê¸°í•˜ê¸°ğŸ‘¨â€ğŸ’»\n\në‚´ ì‘ì—…ì„ ë”°ë¥´ëŠ” ì‚¬ëŒë“¤ì€ ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ 'ìƒíƒœ ì—†ìŒ'ê³¼ 'ìƒíƒœ ìˆëŠ”' ë¦¬ì†ŒìŠ¤ë¡œ ë¶„í• í•˜ëŠ” ê²ƒì„ ì•Œê³  ìˆì„ ê²ƒì…ë‹ˆë‹¤. ë˜í•œ ê¹”ë”í•œ ì½”ë“œ ë° ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ë‚´ ì˜ê²¬ì´ ìˆìŠµë‹ˆë‹¤.\n\nì´ ê²½ë¡œë¥¼ ê³„ì† ë”°ë¼ê°€ì„œ ì¤‘ì²© ìŠ¤íƒì„ ì‚¬ìš©í•˜ë ¤ë©´ í´ë” êµ¬ì¡° ê´€ì ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤:\n\n![Folder Structure](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_5.png)\n\n<div class=\"content-ad\"></div>\n\nì´ì œ ì´ì œëŠ” 'stateful' ë° 'stateless'ì˜ ìƒìœ„ ìŠ¤íƒ ì•„ë˜ í•˜ë‚˜ ì´ìƒì˜ ì¤‘ì²©ëœ ìŠ¤íƒì„ ê°€ì§€ê³  ìˆìŒì„ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ìŠ¤íƒì´ ê°œë…ì  ìˆ˜ì¤€ì—ì„œ ë¬´ì—‡ì„ í¬í•¨í•˜ëŠ”ì§€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(API ë¦¬ì†ŒìŠ¤, ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì†ŒìŠ¤, ì´ë²¤íŠ¸ ë²„ìŠ¤ ë¦¬ì†ŒìŠ¤ ë° ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤).\n\nì´ì œ í´ë” êµ¬ì¡°ë¥¼ í™•ì¥í•´ ë³´ë©´:\n\n![image](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_6.png)\n\nì¤‘ì²©ëœ ìŠ¤íƒì—ëŠ” íŒŒì¼ì— 'nested'ê°€ ì¶”ê°€ëœ ë‹¨ì–´ë„ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìƒì„±ëœ íŒŒì¼ê³¼ ì½˜ì†”ì— í‘œì‹œë˜ì–´ ì´í•´í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nìš°ë¦¬ì˜ ìƒíƒœ ìœ ì§€ ìŠ¤íƒ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nimport * as cdk from 'aws-cdk-lib';\n\nimport { Construct } from 'constructs';\nimport { DatabaseResources } from './nested/database/database-nested';\nimport { EventBusResources } from './nested/event-bus/event-bus-nested';\n\nexport interface GilmoreCuisineStatefulStackProps extends cdk.StackProps {\n  stage: string;\n}\n\nexport class GilmoreCuisineStatefulStack extends cdk.Stack {\n  public databaseResources: DatabaseResources;\n  public eventBusResources: EventBusResources;\n\n  constructor(\n    scope: Construct,\n    id: string,\n    props: GilmoreCuisineStatefulStackProps\n  ) {\n    super(scope, id, props);\n\n    // ë‘ ìƒíƒœ ìœ ì§€ ì¤‘ì²© ìŠ¤íƒì„ ê°€ì ¸ì™€ì„œ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤.\n    this.databaseResources = new DatabaseResources(this, 'DatabaseResources', {\n      stage: props.stage,\n    });\n\n    this.eventBusResources = new EventBusResources(this, 'EventBusResources', {\n      stage: props.stage,\n    });\n  }\n}\n```\n\nìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ìš°ë¦¬ì˜ ìƒìœ„ ìŠ¤íƒì€ ë‘ ì¤‘ì²©ëœ ìŠ¤íƒì„ ê°€ì ¸ì™€ì„œ ê·¸ê²ƒë“¤ì„ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤.\n\nê·¸ëŸ° ë‹¤ìŒ DatabaseResources ì¤‘ì²© ìŠ¤íƒì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\nimport * as cdk from 'aws-cdk-lib';\nimport * as dynamodb from 'aws-cdk-lib/aws-dynamodb';\n\nimport { Construct } from 'constructs';\n\ninterface DatabaseResourcesProps extends cdk.NestedStackProps {\n  stage: string;\n}\n\nexport class DatabaseResources extends cdk.NestedStack {\n  public table: dynamodb.Table;\n\n  constructor(scope: Construct, id: string, props: DatabaseResourcesProps) {\n    super(scope, id, props);\n\n    // our database is a static resource\n    this.table = new dynamodb.Table(this, 'Table', {\n      tableName: `gilmore-cuisine-table-${props.stage}`,\n      billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,\n      partitionKey: {\n        name: 'id',\n        type: dynamodb.AttributeType.STRING,\n      },\n      removalPolicy: cdk.RemovalPolicy.DESTROY,\n    });\n  }\n}\n```\n\níŠ¹íˆ ì´ ìŠ¤íƒì´ cdk.Stackì´ ì•„ë‹Œ ë¶€ëª¨ì™€ ê°™ì´ cdk.NestedStackì„ í™•ì¥í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì´ì œ ìƒíƒœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ComputeResources ì¤‘ì²© ìŠ¤íƒìœ¼ë¡œ ì´ë™í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤:\n\n```js\nimport * as apigw from 'aws-cdk-lib/aws-apigateway';\nimport * as cdk from 'aws-cdk-lib';\nimport * as dynamodb from 'aws-cdk-lib/aws-dynamodb';\nimport * as events from 'aws-cdk-lib/aws-events';\nimport * as lambda from 'aws-cdk-lib/aws-lambda';\nimport * as nodeLambda from 'aws-cdk-lib/aws-lambda-nodejs';\nimport * as path from 'path';\n\nimport { Construct } from 'constructs';\n\ninterface ComputeResourcesProps extends cdk.NestedStackProps {\n  stage: string;\n  api: apigw.RestApi;\n}\n\nexport class ComputeResources extends cdk.NestedStack {\n  private api: apigw.RestApi;\n  private table: dynamodb.Table;\n  private bus: events.EventBus;\n\n  constructor(scope: Construct, id: string, props: ComputeResourcesProps) {\n    super(scope, id, props);\n\n    this.api = props.api;\n\n    // ìƒíƒœ ë¦¬ì†ŒìŠ¤ì—ì„œ í…Œì´ë¸”ì˜ ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°\n    this.table = dynamodb.Table.fromTableName(\n      this,\n      'Table',\n      `gilmore-cuisine-table-${props.stage}`\n    ) as dynamodb.Table;\n\n    // ìƒíƒœ ë¦¬ì†ŒìŠ¤ì—ì„œ busì˜ ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°\n    this.bus = events.EventBus.fromEventBusName(\n      this,\n      'EventBus',\n      `gilmore-cuisine-event-bus-${props.stage}`\n    ) as events.EventBus;\n\n    // ëŒë‹¤ íŒŒìš°ì–´íˆ´ì¦ˆ ì„¤ì • ìƒì„±\n    const lambdaPowerToolsConfig = {\n      LOG_LEVEL: 'DEBUG',\n      POWERTOOLS_LOGGER_LOG_EVENT: 'true',\n      POWERTOOLS_LOGGER_SAMPLE_RATE: '1',\n      POWERTOOLS_TRACE_ENABLED: 'enabled',\n      POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS: 'captureHTTPsRequests',\n      POWERTOOLS_SERVICE_NAME: 'gilmore-cuisine-service',\n      POWERTOOLS_TRACER_CAPTURE_RESPONSE: 'captureResult',\n      POWERTOOLS_METRICS_NAMESPACE: 'gilmore-cuisine',\n    };\n\n    // ëŒë‹¤ í•¨ìˆ˜ ìƒì„±\n    const listBookingsLambda: nodeLambda.NodejsFunction =\n      new nodeLambda.NodejsFunction(this, 'ListBookingsLambda', {\n        functionName: `${props.stage}-gilmore-cuisine-list-bookings`,\n        runtime: lambda.Runtime.NODEJS_20_X,\n        entry: path.join(\n          __dirname,\n          '../../src/adapters/primary/list-bookings/list-bookings.adapter.ts'\n        ),\n        memorySize: 1024,\n        handler: 'handler',\n        tracing: lambda.Tracing.ACTIVE,\n        bundling: {\n          minify: true,\n          sourceMap: true,\n        },\n        environment: {\n          NODE_OPTIONS: '--enable-source-maps',\n          ...lambdaPowerToolsConfig,\n          TABLE_NAME: this.table.tableName,\n          BUS: this.bus.eventBusName,\n        },\n      });\n\n    const createBookingLambda: nodeLambda.NodejsFunction =\n      new nodeLambda.NodejsFunction(this, 'CreateBookingLambda', {\n        functionName: `${props.stage}-gilmore-cuisine-create-booking`,\n        runtime: lambda.Runtime.NODEJS_20_X,\n        entry: path.join(\n          __dirname,\n          '../../src/adapters/primary/create-booking/create-booking.adapter.ts'\n        ),\n        memorySize: 1024,\n        handler: 'handler',\n        tracing: lambda.Tracing.ACTIVE,\n        bundling: {\n          minify: true,\n          sourceMap: true,\n        },\n        environment: {\n          NODE_OPTIONS: '--enable-source-maps',\n          ...lambdaPowerToolsConfig,\n          TABLE_NAME: this.table.tableName,\n          BUS: this.bus.eventBusName,\n        },\n      });\n\n    // í•¨ìˆ˜ì— ëŒ€í•œ í…Œì´ë¸” ê¶Œí•œ ë¶€ì—¬\n    this.table.grantReadData(listBookingsLambda);\n    this.table.grantWriteData(createBookingLambda);\n\n    // í•¨ìˆ˜ê°€ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ë„ë¡ í—ˆìš©\n    this.bus.grantPutEventsTo(createBookingLambda);\n\n    // ì˜¬ë°”ë¥¸ API ë¦¬ì†ŒìŠ¤ì— ëŒë‹¤ í•¨ìˆ˜ ì¶”ê°€\n    const orders = this.api.root\n      .getResource('v1')\n      ?.getResource('bookings') as apigw.Resource;\n\n    orders.addMethod(\n      'GET',\n      new apigw.LambdaIntegration(listBookingsLambda, {\n        proxy: true,\n      })\n    );\n\n    orders.addMethod(\n      'POST',\n      new apigw.LambdaIntegration(createBookingLambda, {\n        proxy: true,\n      })\n    );\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\nìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ DynamoDB í…Œì´ë¸” ë° EventBridge ì´ë²¤íŠ¸ ë²„ìŠ¤ì˜ ìƒíƒœë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‹¤ìŒ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë“¤ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ê³  ìˆìŠµë‹ˆë‹¤.\n\n```js\n...\n// ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì—ì„œ í…Œì´ë¸”ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜´\nthis.table = dynamodb.Table.fromTableName(\n  this,\n  'Table',\n  `gilmore-cuisine-table-${props.stage}`\n) as dynamodb.Table;\n\n// ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì—ì„œ ì´ë²¤íŠ¸ ë²„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜´\nthis.bus = events.EventBus.fromEventBusName(\n  this,\n  'EventBus',\n  `gilmore-cuisine-event-bus-${props.stage}`\n) as events.EventBus;\n...\n```\n\nê·¸ëŸ¬ë‚˜ ì´ëŠ” ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì´ ìƒíƒœê°€ ì—†ëŠ” ìŠ¤íƒë³´ë‹¤ ë¨¼ì € ë°°í¬ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” ì˜ì¡´ì„±ì— ê´€í•œ ë‹¤ìŒê³¼ ê°™ì´ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ì—ì„œ í™•ì‹¤í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\n#!/usr/bin/env node\n\nimport 'source-map-support/register';\n\nimport * as cdk from 'aws-cdk-lib';\n\nimport { GilmoreCuisineStatefulStack } from '../stateful/stateful';\nimport { GilmoreCuisineStatelessStack } from '../stateless/stateless';\n\nconst stage = 'prod';\n\nconst app = new cdk.App();\n\nconst stateful = new GilmoreCuisineStatefulStack(\n  app,\n  'GilmoreCuisineStatefulStack',\n  {\n    stage,\n  }\n);\n\nconst stateless = new GilmoreCuisineStatelessStack(\n  app,\n  'GilmoreCuisineStatelessStack',\n  {\n    stage,\n  }\n);\n\n// statelessê°€ statefulë³´ë‹¤ ë¨¼ì € ë°°í¬ë˜ë„ë¡ í•¨\nstateless.addDependency(stateful);\n```\n\n<div class=\"content-ad\"></div>\n\në‹¤ìŒ ì„¹ì…˜ì—ì„œ í•´ê²°ì±…ì„ ë°°í¬í•˜ê³  í…ŒìŠ¤íŠ¸í•´ ë´…ì‹œë‹¤.\n\n## ë°°í¬ ë° í…ŒìŠ¤íŠ¸ ğŸ§‘ğŸ¾â€ğŸ’»\n\nê·¸ëŸ¼ ì´ì œ 'gilmore-cuisine' í´ë”ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ìŠ¤íƒì„ ë°°í¬í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n\nnpm run deploy\n\n\n<div class=\"content-ad\"></div>\n\në™ì¼í•œ í´ë”ì—ì„œ cdk ëª©ë¡ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì•ì„œ ì„¤ëª…í•œëŒ€ë¡œ ë‘ ê°œì˜ ìƒìœ„ ìŠ¤íƒë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n![CDK Nested Stacks](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_7.png)\n\ní•©ì„±ëœ CloudFormation í…œí”Œë¦¿ ë° ì—ì…‹ì´ í¬í•¨ëœ cdk.out í´ë”ë¥¼ ë¡œì»¬ë¡œ í™•ì¸í•˜ë©´ ë‹¤ìŒ íŒŒì¼ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤:\n\në‘ ê°œì˜ ìƒìœ„ í…œí”Œë¦¿, GilmoreCuisineStatefulStack.template.json ë° GilmoreCuisineStatelessStack.template.json,ì´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë“¤ì€ ì•„ë˜ì™€ ìœ ì‚¬í•œ ë‚´ìš©ì„ ê°€ì§€ê³  ìˆìœ¼ë©° ì¤‘ì²© ìŠ¤íƒì„ ê°€ë¦¬í‚µë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\n...\n\"UpdateReplacePolicy\": \"Delete\",\n\"DeletionPolicy\": \"Delete\",\n\"Metadata\": {\n  \"aws:cdk:path\": \"GilmoreCuisineStatefulStack/EventBusResources.NestedStack/EventBusResources.NestedStackResource\",\n  \"aws:asset:path\": \"GilmoreCuisineStatefulStackEventBusResourcesAC59B19D.nested.template.json\",\n  \"aws:asset:property\": \"TemplateURL\"\n}\n...\n```\n\në°°í¬ê°€ ì™„ë£Œë˜ë©´ ì½˜ì†”ë¡œ ì „í™˜í•˜ì—¬ ì½˜ì†”ì— ì¤‘ì²© ìŠ¤íƒì´ í‘œì‹œë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤:\n\nì´ì œ ì½˜ì†”ì—ì„œ ë‘ ìŠ¤íƒì˜ í•˜ìœ„ ì¤‘ì²© ìŠ¤íƒì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:\n\nì´ì œ ê° ìŠ¤íƒì˜ ë‚´ìš©ì„ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n## âœ”ï¸ Stateful Stack\n\nìƒíƒœ ìœ ì§€ ìŠ¤íƒ ì•ˆì—ëŠ” DatabaseResourcesì™€ EventBusResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\në³´ë‹¤ ìì„¸í•œ ë‚´ìš©ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\nDatabaseResources\nìš°ë¦¬ì˜ DynamoDB í…Œì´ë¸”ì´ í¬í•¨ëœ DatabaseResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nEventBusResources\nì´ë²¤íŠ¸ ë²„ìŠ¤, CloudWatch ë¡œê·¸ ê·¸ë£¹ ë° ì´ë²¤íŠ¸ ê·œì¹™ ëŒ€ìƒì„ í¬í•¨í•˜ëŠ” EventBusResourcesì˜ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\nì´ì œ ë¬´ìƒíƒœ ìŠ¤íƒê³¼ ê´€ë ¨ëœ ë‚´ìš©ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n## âœ”ï¸ ë¬´ìƒíƒœ ìŠ¤íƒ\n\në¬´ìƒíƒœ ìŠ¤íƒì—ëŠ” ApiResources ë° ComputeResourcesì˜ ë‘ ê°œì˜ ì¤‘ì²© ìŠ¤íƒì´ í‘œì‹œë©ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nApiResources\nì•„ë˜ì—ì„œ ApiResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, API Gateway REST API, ìŠ¤í…Œì´ì§€, ë°°í¬ ë“±ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n\nComputeResources\nì•„ë˜ì—ì„œ ComputeResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ë‘ ê°œì˜ ëŒë‹¤ í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:\n\n## í…ŒìŠ¤íŒ… ğŸ§ª\n\n<img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_8.png\" />\n\n<div class=\"content-ad\"></div>\n\në§Œì•½ Postman íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ /bookings/ì˜ POST ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìš”ì²­í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_9.png)\n\nê·¸ë¦¬ê³  CloudWatch ë¡œê·¸ì˜ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ìºì¹˜í•˜ëŠ” ëŒ€ìƒì„ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì´ë²¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤:\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_10.png)\n\n<div class=\"content-ad\"></div>\n\nì•„ë˜ëŠ” ëª©ë¡ ì˜ˆì•½ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆì–´ìš”. \n\nì´ê²ƒì„ ë³´ì—¬ ì£¼ê² ì£ : \n\n![List Bookings EndPoint](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_12.png)\n\n# ê²°ë¡   \n\n<div class=\"content-ad\"></div>\n\nì´ ê¸€ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ë£¬ ë‚´ìš©ì„ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n- ì¤‘ì²© ìŠ¤íƒì´ í•„ìš”í•œ ì´ìœ ì— ëŒ€í•´ ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤.\n- AWS CDKë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤.\n\n# ë§ˆë¬´ë¦¬ ì¸ì‚¬ ğŸ‘‹ğŸ½\n\nì´ ì§§ì€ ê¸€ì„ ì¦ê²ê²Œ ì½ì–´ì£¼ì…¨ê¸°ë¥¼ ë°”ë¼ë©°, ë§ˆìŒì— ë“œì…¨ë‹¤ë©´ ê³µìœ í•´ ì£¼ì‹œê³  í”¼ë“œë°±ì„ ì£¼ì„¸ìš”!\n\n<div class=\"content-ad\"></div>\n\në¹„ìŠ·í•œ ì½˜í…ì¸ ë¥¼ ë” ë³´ê³  ì‹¶ë‹¤ë©´ ì œ YouTube ì±„ë„ì„ ë°©ë¬¸í•´ì£¼ì„¸ìš”!\n\n![YouTube](/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_13.png)\n\nê·¸ë¦¬ê³  ë‹¤ìŒ ë§í¬ë¥¼ í†µí•´ ì—°ë½í•  ìˆ˜ë„ ìˆì–´ìš”:\n\n[LinkedIn í”„ë¡œí•„](https://www.linkedin.com/in/lee-james-gilmore/)\n[Twitter í”„ë¡œí•„](https://twitter.com/LeeJamesGilmore)\n\n<div class=\"content-ad\"></div>\n\në§Œì•½ ì´ ê²Œì‹œë¬¼ì„ ì¦ê²¼ë‹¤ë©´, ì¶”ê°€ í¬ìŠ¤íŠ¸/ì‹œë¦¬ì¦ˆë¥¼ í™•ì¸í•˜ë ¤ë©´ ì œ í”„ë¡œí•„ Lee James Gilmoreë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì„¸ìš”. ë˜í•œ 'clap' ê¸°ëŠ¥ì„ ì´ìš©í•´ ì£¼ì„¸ìš”. ê²Œì‹œë¬¼ í•˜ë‹¨ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ì´ìƒìœ¼ë¡œë„ í´ë©ì„ í•  ìˆ˜ ìˆì–´ìš”! \n\n# ë‚˜ì— ëŒ€í•´\n\n\"ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” ì˜êµ­ì— ê±°ì£¼í•˜ê³  ìˆëŠ” AWS ì»¤ë®¤ë‹ˆí‹° ë¹Œë”, ë¸”ë¡œê±°, AWS ì¸ì¦ í´ë¼ìš°ë“œ ì•„í‚¤í…íŠ¸ì´ì ê¸°ìˆ  ë° ì•„í‚¤í…ì²˜ ê¸€ë¡œë²Œ ì´ê´„ì¸ Leeì…ë‹ˆë‹¤. í˜„ì¬ City Electrical Factors (UK) ë° City Electric Supply (US)ì—ì„œ ê·¼ë¬´ ì¤‘ì´ë©°, ì§€ë‚œ 6ë…„ê°„ ì£¼ë¡œ AWSì—ì„œ í’€ìŠ¤íƒ JavaScriptë¥¼ ì‚¬ìš©í•´ ì™”ìŠµë‹ˆë‹¤.\"\n\n<div class=\"content-ad\"></div>\n\nì €ëŠ” ëª¨ë“  ê²ƒì„ AWS, í˜ì‹ , ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜, ê·¸ë¦¬ê³  ê¸°ìˆ ì— ëŒ€í•œ ì‚¬ë‘ìœ¼ë¡œ ì„œë²„ë¦¬ìŠ¤ë¥¼ ì˜¹í˜¸í•˜ëŠ” ì‚¬ëŒì´ë¼ê³  ìƒê°í•´ìš”.\n\n*** ì œê³µëœ ì •ë³´ëŠ” ì œ ê°œì¸ì ì¸ ê²¬í•´ì´ë©°, ê·¸ì— ë”°ë¥¸ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ***\n\nì•„ë˜ ë‚´ìš©ë„ ê´€ì‹¬ì´ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤:","ogImage":{"url":"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_0.png"},"coverImage":"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_0.png","tag":["Tech"],"readingTime":13},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_0.png\" alt=\"CDK Nested Stacks\"></p>\n<h2>ì‹œì‘ë§</h2>\n<p>âœ”ï¸ ìš°ë¦¬ëŠ” ì¤‘ì²© ìŠ¤íƒì˜ í•„ìš”ì„±ì— ëŒ€í•´ ì´ì•¼ê¸°í•©ë‹ˆë‹¤.\nâœ”ï¸ AWS CDKë¡œ ì–´ë–»ê²Œ ì´ê²ƒì´ ì‹¤í˜„ë  ìˆ˜ ìˆëŠ”ì§€ ë…¼ì˜í•©ë‹ˆë‹¤.</p>\n<h1>ì†Œê°œ ğŸ‘‹ğŸ½</h1>\n<p>ì´ ë¹ ë¥¸ ê¸°ì‚¬ì—ì„œëŠ” AWS CDK ì¤‘ì²© ìŠ¤íƒì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê³ , ì–¸ì œ ìš°ë¦¬ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€, ê·¸ë¦¬ê³  ì´ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì‚´í´ë³¼ ê²ƒì…ë‹ˆë‹¤. ì˜ˆì œ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ í†µí•´ ê±¸ì–´ ë³´ê¸° ìœ„í•´ 'Gilmore Cuisine'ë¼ëŠ” ê°€ìƒ íšŒì‚¬ë¥¼ ë‹¤ë£° ê²ƒì…ë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_1.png\" alt=\"image\"></p>\n<p>ê¸°ì‚¬ì˜ ì½”ë“œëŠ” GitHubì—ì„œ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p>ë” ìì„¸í•œ ê¸°ì‚¬ì™€ ì˜ˆì œëŠ” Serverless Advocate íŒ¨í„´ ë° ì†”ë£¨ì…˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ììœ ë¡­ê²Œ ì´ìš©í•´ ì£¼ì„¸ìš”:</p>\n<h1>ì–´ë–»ê²Œ ì‘ë™í• ê¹Œìš”? ğŸ’¡</h1>\n<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•  ë•Œ í´ë¼ìš°ë“œí¬ë©”ì´ì…˜ì—ì„œ ìŠ¤íƒ ë‹¹ 500ê°œì˜ ë¦¬ì†ŒìŠ¤ ì œí•œì— ë„ë‹¬í•˜ëŠ” ê²½ìš°ê°€ ì¢…ì¢… ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ê²ƒì€ ìš°ë¦¬ê°€ ì•„ë§ˆë„ ë‚´ë¶€ì ìœ¼ë¡œ ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” ìš°ë¦¬ë§Œì˜ L3 êµ¬ì„±ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì•ŒëŒ, ì ì§„ì  ë°°í¬, ëŒ€ì‹œë³´ë“œ ë“±ì„ í¬í•¨í•˜ëŠ” ëŒë‹¤ êµ¬ì„±ì´ ìˆëŠ” ê²½ìš°ì´ë©°, ìš°ë¦¬ëŠ” ì´ êµ¬ì„±ì„ ìŠ¤íƒì—ì„œ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©í•˜ì—¬ ì œí•œì„ ì´ˆê³¼í•˜ê²Œ ë©ë‹ˆë‹¤.</p>\n<p>AWS CDKì˜ NestedStack êµ¬ì¡°ëŠ” ë¶€ëª¨ ìŠ¤íƒ ë‚´ì—ì„œ í•˜ë‚˜ì˜ ìì›ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ìŠ¤íƒ ë‹¹ AWS CloudFormation 500ê°œ ìì› ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ëŠ” ì¤‘ì²© ìŠ¤íƒì´ ë‹¤ë¥¸ ì¤‘ì²© ìŠ¤íƒì„ í¬í•¨í•˜ì—¬ ìµœëŒ€ 500ê°œì˜ ìì›ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¤‘ì²© ìŠ¤íƒì€ êµ¬ì¡°í™”ëœ ìŠ¤íƒì˜ ê³„ì¸µì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_3.png\" alt=\"CDK Nested Stacks hierarchy\"></p>\n<p>ì¤‘ì²© ìŠ¤íƒì˜ ë²”ìœ„(ë³¸ì§ˆì ìœ¼ë¡œ ë¶€ëª¨)ëŠ” AWS CDKì˜ Stack ë˜ëŠ” NestedStack êµ¬ì¡°ì—¬ì•¼ í•©ë‹ˆë‹¤. ê¸°ì¡´ì˜ ìŠ¤íƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¤‘ì²© ìŠ¤íƒì—ì„œì˜ êµ¬ì¡° ì •ì˜ëŠ” ë™ì¼í•©ë‹ˆë‹¤.</p>\n<p>í•©ì„± ê³¼ì •ì—ì„œ ì¤‘ì²© ìŠ¤íƒì€ ìì²´ AWS CloudFormation í…œí”Œë¦¿ìœ¼ë¡œ ë³€í™˜ë˜ì–´ AWS CDK ìŠ¤í…Œì´ì§• ë²„í‚·ì— ì—…ë¡œë“œë©ë‹ˆë‹¤. ì¤‘ì²© ìŠ¤íƒì€ ë¶€ëª¨ ìŠ¤íƒì— ë°”ì¸ë”©ë˜ì–´ ë…ë¦½ì ì¸ ë°°í¬ ìì‚°ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p>ë¶€ëª¨ ìŠ¤íƒê³¼ ì¤‘ì²© ìŠ¤íƒ ê°„ì˜ ë¦¬ì†ŒìŠ¤ ì†ì„±ì˜ ìƒí˜¸ ì°¸ì¡°ëŠ” AWS CDKë¥¼ ì‚¬ìš©í•  ë•Œ ìë™ìœ¼ë¡œ ìŠ¤íƒ ë§¤ê°œë³€ìˆ˜ì™€ ì¶œë ¥ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</p>\n<p>ë‹¤ìŒ ì„¹ì…˜ì˜ ì½”ë“œë¥¼ ì‚´í´ë´…ì‹œë‹¤.</p>\n<p>ğŸ‘‡ ë” ë‚˜ì•„ê°€ê¸° ì „ì— â€” ì•ìœ¼ë¡œì˜ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ê³¼ ì„œë²„ë¦¬ìŠ¤ ë‰´ìŠ¤ë¥¼ ë°›ìœ¼ì‹œë ¤ë©´ LinkedInì—ì„œ ì €ì™€ ì—°ê²°í•´ì£¼ì„¸ìš” <a href=\"https://www.linkedin.com/in/lee-james-gilmore/\" rel=\"nofollow\" target=\"_blank\">https://www.linkedin.com/in/lee-james-gilmore/</a></p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_4.png\" alt=\"CDK Nested Stacks\"></p>\n<h1>ì½”ë“œë¥¼ í†µí•´ ì´ì•¼ê¸°í•˜ê¸°ğŸ‘¨â€ğŸ’»</h1>\n<p>ë‚´ ì‘ì—…ì„ ë”°ë¥´ëŠ” ì‚¬ëŒë“¤ì€ ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ 'ìƒíƒœ ì—†ìŒ'ê³¼ 'ìƒíƒœ ìˆëŠ”' ë¦¬ì†ŒìŠ¤ë¡œ ë¶„í• í•˜ëŠ” ê²ƒì„ ì•Œê³  ìˆì„ ê²ƒì…ë‹ˆë‹¤. ë˜í•œ ê¹”ë”í•œ ì½”ë“œ ë° ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ë‚´ ì˜ê²¬ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ ê²½ë¡œë¥¼ ê³„ì† ë”°ë¼ê°€ì„œ ì¤‘ì²© ìŠ¤íƒì„ ì‚¬ìš©í•˜ë ¤ë©´ í´ë” êµ¬ì¡° ê´€ì ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_5.png\" alt=\"Folder Structure\"></p>\n<p>ì´ì œ ì´ì œëŠ” 'stateful' ë° 'stateless'ì˜ ìƒìœ„ ìŠ¤íƒ ì•„ë˜ í•˜ë‚˜ ì´ìƒì˜ ì¤‘ì²©ëœ ìŠ¤íƒì„ ê°€ì§€ê³  ìˆìŒì„ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ìŠ¤íƒì´ ê°œë…ì  ìˆ˜ì¤€ì—ì„œ ë¬´ì—‡ì„ í¬í•¨í•˜ëŠ”ì§€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(API ë¦¬ì†ŒìŠ¤, ë°ì´í„°ë² ì´ìŠ¤ ë¦¬ì†ŒìŠ¤, ì´ë²¤íŠ¸ ë²„ìŠ¤ ë¦¬ì†ŒìŠ¤ ë° ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤).</p>\n<p>ì´ì œ í´ë” êµ¬ì¡°ë¥¼ í™•ì¥í•´ ë³´ë©´:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_6.png\" alt=\"image\"></p>\n<p>ì¤‘ì²©ëœ ìŠ¤íƒì—ëŠ” íŒŒì¼ì— 'nested'ê°€ ì¶”ê°€ëœ ë‹¨ì–´ë„ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìƒì„±ëœ íŒŒì¼ê³¼ ì½˜ì†”ì— í‘œì‹œë˜ì–´ ì´í•´í•˜ê¸° ì‰½ê²Œ ë§Œë“­ë‹ˆë‹¤.</p>\n<p>ìš°ë¦¬ì˜ ìƒíƒœ ìœ ì§€ ìŠ¤íƒ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> cdk <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Construct</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'constructs'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">DatabaseResources</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./nested/database/database-nested'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">EventBusResources</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./nested/event-bus/event-bus-nested'</span>;\n\n<span class=\"hljs-keyword\">export</span> interface <span class=\"hljs-title class_\">GilmoreCuisineStatefulStackProps</span> <span class=\"hljs-keyword\">extends</span> cdk.<span class=\"hljs-property\">StackProps</span> {\n  <span class=\"hljs-attr\">stage</span>: string;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GilmoreCuisineStatefulStack</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">cdk.Stack</span> {\n  public <span class=\"hljs-attr\">databaseResources</span>: <span class=\"hljs-title class_\">DatabaseResources</span>;\n  public <span class=\"hljs-attr\">eventBusResources</span>: <span class=\"hljs-title class_\">EventBusResources</span>;\n\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">\n    scope: Construct,\n    id: string,\n    props: GilmoreCuisineStatefulStackProps\n  </span>) {\n    <span class=\"hljs-variable language_\">super</span>(scope, id, props);\n\n    <span class=\"hljs-comment\">// ë‘ ìƒíƒœ ìœ ì§€ ì¤‘ì²© ìŠ¤íƒì„ ê°€ì ¸ì™€ì„œ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤.</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">databaseResources</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DatabaseResources</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">'DatabaseResources'</span>, {\n      <span class=\"hljs-attr\">stage</span>: props.<span class=\"hljs-property\">stage</span>,\n    });\n\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">eventBusResources</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">EventBusResources</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">'EventBusResources'</span>, {\n      <span class=\"hljs-attr\">stage</span>: props.<span class=\"hljs-property\">stage</span>,\n    });\n  }\n}\n</code></pre>\n<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ìš°ë¦¬ì˜ ìƒìœ„ ìŠ¤íƒì€ ë‘ ì¤‘ì²©ëœ ìŠ¤íƒì„ ê°€ì ¸ì™€ì„œ ê·¸ê²ƒë“¤ì„ ì¸ìŠ¤í„´ìŠ¤í™”í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ëŸ° ë‹¤ìŒ DatabaseResources ì¤‘ì²© ìŠ¤íƒì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> cdk <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> dynamodb <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-dynamodb'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Construct</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'constructs'</span>;\n\ninterface <span class=\"hljs-title class_\">DatabaseResourcesProps</span> <span class=\"hljs-keyword\">extends</span> cdk.<span class=\"hljs-property\">NestedStackProps</span> {\n  <span class=\"hljs-attr\">stage</span>: string;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DatabaseResources</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">cdk.NestedStack</span> {\n  public <span class=\"hljs-attr\">table</span>: dynamodb.<span class=\"hljs-property\">Table</span>;\n\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">scope: Construct, id: string, props: DatabaseResourcesProps</span>) {\n    <span class=\"hljs-variable language_\">super</span>(scope, id, props);\n\n    <span class=\"hljs-comment\">// our database is a static resource</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span> = <span class=\"hljs-keyword\">new</span> dynamodb.<span class=\"hljs-title class_\">Table</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">'Table'</span>, {\n      <span class=\"hljs-attr\">tableName</span>: <span class=\"hljs-string\">`gilmore-cuisine-table-<span class=\"hljs-subst\">${props.stage}</span>`</span>,\n      <span class=\"hljs-attr\">billingMode</span>: dynamodb.<span class=\"hljs-property\">BillingMode</span>.<span class=\"hljs-property\">PAY_PER_REQUEST</span>,\n      <span class=\"hljs-attr\">partitionKey</span>: {\n        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'id'</span>,\n        <span class=\"hljs-attr\">type</span>: dynamodb.<span class=\"hljs-property\">AttributeType</span>.<span class=\"hljs-property\">STRING</span>,\n      },\n      <span class=\"hljs-attr\">removalPolicy</span>: cdk.<span class=\"hljs-property\">RemovalPolicy</span>.<span class=\"hljs-property\">DESTROY</span>,\n    });\n  }\n}\n</code></pre>\n<p>íŠ¹íˆ ì´ ìŠ¤íƒì´ cdk.Stackì´ ì•„ë‹Œ ë¶€ëª¨ì™€ ê°™ì´ cdk.NestedStackì„ í™•ì¥í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ì œ ìƒíƒœ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ComputeResources ì¤‘ì²© ìŠ¤íƒìœ¼ë¡œ ì´ë™í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> apigw <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-apigateway'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> cdk <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> dynamodb <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-dynamodb'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> events <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-events'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> lambda <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-lambda'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> nodeLambda <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib/aws-lambda-nodejs'</span>;\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> path <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'path'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Construct</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'constructs'</span>;\n\ninterface <span class=\"hljs-title class_\">ComputeResourcesProps</span> <span class=\"hljs-keyword\">extends</span> cdk.<span class=\"hljs-property\">NestedStackProps</span> {\n  <span class=\"hljs-attr\">stage</span>: string;\n  <span class=\"hljs-attr\">api</span>: apigw.<span class=\"hljs-property\">RestApi</span>;\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ComputeResources</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_ inherited__\">cdk.NestedStack</span> {\n  private <span class=\"hljs-attr\">api</span>: apigw.<span class=\"hljs-property\">RestApi</span>;\n  private <span class=\"hljs-attr\">table</span>: dynamodb.<span class=\"hljs-property\">Table</span>;\n  private <span class=\"hljs-attr\">bus</span>: events.<span class=\"hljs-property\">EventBus</span>;\n\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">scope: Construct, id: string, props: ComputeResourcesProps</span>) {\n    <span class=\"hljs-variable language_\">super</span>(scope, id, props);\n\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">api</span> = props.<span class=\"hljs-property\">api</span>;\n\n    <span class=\"hljs-comment\">// ìƒíƒœ ë¦¬ì†ŒìŠ¤ì—ì„œ í…Œì´ë¸”ì˜ ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span> = dynamodb.<span class=\"hljs-property\">Table</span>.<span class=\"hljs-title function_\">fromTableName</span>(\n      <span class=\"hljs-variable language_\">this</span>,\n      <span class=\"hljs-string\">'Table'</span>,\n      <span class=\"hljs-string\">`gilmore-cuisine-table-<span class=\"hljs-subst\">${props.stage}</span>`</span>\n    ) <span class=\"hljs-keyword\">as</span> dynamodb.<span class=\"hljs-property\">Table</span>;\n\n    <span class=\"hljs-comment\">// ìƒíƒœ ë¦¬ì†ŒìŠ¤ì—ì„œ busì˜ ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">bus</span> = events.<span class=\"hljs-property\">EventBus</span>.<span class=\"hljs-title function_\">fromEventBusName</span>(\n      <span class=\"hljs-variable language_\">this</span>,\n      <span class=\"hljs-string\">'EventBus'</span>,\n      <span class=\"hljs-string\">`gilmore-cuisine-event-bus-<span class=\"hljs-subst\">${props.stage}</span>`</span>\n    ) <span class=\"hljs-keyword\">as</span> events.<span class=\"hljs-property\">EventBus</span>;\n\n    <span class=\"hljs-comment\">// ëŒë‹¤ íŒŒìš°ì–´íˆ´ì¦ˆ ì„¤ì • ìƒì„±</span>\n    <span class=\"hljs-keyword\">const</span> lambdaPowerToolsConfig = {\n      <span class=\"hljs-attr\">LOG_LEVEL</span>: <span class=\"hljs-string\">'DEBUG'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_LOGGER_LOG_EVENT</span>: <span class=\"hljs-string\">'true'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_LOGGER_SAMPLE_RATE</span>: <span class=\"hljs-string\">'1'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_TRACE_ENABLED</span>: <span class=\"hljs-string\">'enabled'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS</span>: <span class=\"hljs-string\">'captureHTTPsRequests'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_SERVICE_NAME</span>: <span class=\"hljs-string\">'gilmore-cuisine-service'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_TRACER_CAPTURE_RESPONSE</span>: <span class=\"hljs-string\">'captureResult'</span>,\n      <span class=\"hljs-attr\">POWERTOOLS_METRICS_NAMESPACE</span>: <span class=\"hljs-string\">'gilmore-cuisine'</span>,\n    };\n\n    <span class=\"hljs-comment\">// ëŒë‹¤ í•¨ìˆ˜ ìƒì„±</span>\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">listBookingsLambda</span>: nodeLambda.<span class=\"hljs-property\">NodejsFunction</span> =\n      <span class=\"hljs-keyword\">new</span> nodeLambda.<span class=\"hljs-title class_\">NodejsFunction</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">'ListBookingsLambda'</span>, {\n        <span class=\"hljs-attr\">functionName</span>: <span class=\"hljs-string\">`<span class=\"hljs-subst\">${props.stage}</span>-gilmore-cuisine-list-bookings`</span>,\n        <span class=\"hljs-attr\">runtime</span>: lambda.<span class=\"hljs-property\">Runtime</span>.<span class=\"hljs-property\">NODEJS_20_X</span>,\n        <span class=\"hljs-attr\">entry</span>: path.<span class=\"hljs-title function_\">join</span>(\n          __dirname,\n          <span class=\"hljs-string\">'../../src/adapters/primary/list-bookings/list-bookings.adapter.ts'</span>\n        ),\n        <span class=\"hljs-attr\">memorySize</span>: <span class=\"hljs-number\">1024</span>,\n        <span class=\"hljs-attr\">handler</span>: <span class=\"hljs-string\">'handler'</span>,\n        <span class=\"hljs-attr\">tracing</span>: lambda.<span class=\"hljs-property\">Tracing</span>.<span class=\"hljs-property\">ACTIVE</span>,\n        <span class=\"hljs-attr\">bundling</span>: {\n          <span class=\"hljs-attr\">minify</span>: <span class=\"hljs-literal\">true</span>,\n          <span class=\"hljs-attr\">sourceMap</span>: <span class=\"hljs-literal\">true</span>,\n        },\n        <span class=\"hljs-attr\">environment</span>: {\n          <span class=\"hljs-attr\">NODE_OPTIONS</span>: <span class=\"hljs-string\">'--enable-source-maps'</span>,\n          ...lambdaPowerToolsConfig,\n          <span class=\"hljs-attr\">TABLE_NAME</span>: <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span>.<span class=\"hljs-property\">tableName</span>,\n          <span class=\"hljs-attr\">BUS</span>: <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">bus</span>.<span class=\"hljs-property\">eventBusName</span>,\n        },\n      });\n\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">createBookingLambda</span>: nodeLambda.<span class=\"hljs-property\">NodejsFunction</span> =\n      <span class=\"hljs-keyword\">new</span> nodeLambda.<span class=\"hljs-title class_\">NodejsFunction</span>(<span class=\"hljs-variable language_\">this</span>, <span class=\"hljs-string\">'CreateBookingLambda'</span>, {\n        <span class=\"hljs-attr\">functionName</span>: <span class=\"hljs-string\">`<span class=\"hljs-subst\">${props.stage}</span>-gilmore-cuisine-create-booking`</span>,\n        <span class=\"hljs-attr\">runtime</span>: lambda.<span class=\"hljs-property\">Runtime</span>.<span class=\"hljs-property\">NODEJS_20_X</span>,\n        <span class=\"hljs-attr\">entry</span>: path.<span class=\"hljs-title function_\">join</span>(\n          __dirname,\n          <span class=\"hljs-string\">'../../src/adapters/primary/create-booking/create-booking.adapter.ts'</span>\n        ),\n        <span class=\"hljs-attr\">memorySize</span>: <span class=\"hljs-number\">1024</span>,\n        <span class=\"hljs-attr\">handler</span>: <span class=\"hljs-string\">'handler'</span>,\n        <span class=\"hljs-attr\">tracing</span>: lambda.<span class=\"hljs-property\">Tracing</span>.<span class=\"hljs-property\">ACTIVE</span>,\n        <span class=\"hljs-attr\">bundling</span>: {\n          <span class=\"hljs-attr\">minify</span>: <span class=\"hljs-literal\">true</span>,\n          <span class=\"hljs-attr\">sourceMap</span>: <span class=\"hljs-literal\">true</span>,\n        },\n        <span class=\"hljs-attr\">environment</span>: {\n          <span class=\"hljs-attr\">NODE_OPTIONS</span>: <span class=\"hljs-string\">'--enable-source-maps'</span>,\n          ...lambdaPowerToolsConfig,\n          <span class=\"hljs-attr\">TABLE_NAME</span>: <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span>.<span class=\"hljs-property\">tableName</span>,\n          <span class=\"hljs-attr\">BUS</span>: <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">bus</span>.<span class=\"hljs-property\">eventBusName</span>,\n        },\n      });\n\n    <span class=\"hljs-comment\">// í•¨ìˆ˜ì— ëŒ€í•œ í…Œì´ë¸” ê¶Œí•œ ë¶€ì—¬</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span>.<span class=\"hljs-title function_\">grantReadData</span>(listBookingsLambda);\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span>.<span class=\"hljs-title function_\">grantWriteData</span>(createBookingLambda);\n\n    <span class=\"hljs-comment\">// í•¨ìˆ˜ê°€ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ë„ë¡ í—ˆìš©</span>\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">bus</span>.<span class=\"hljs-title function_\">grantPutEventsTo</span>(createBookingLambda);\n\n    <span class=\"hljs-comment\">// ì˜¬ë°”ë¥¸ API ë¦¬ì†ŒìŠ¤ì— ëŒë‹¤ í•¨ìˆ˜ ì¶”ê°€</span>\n    <span class=\"hljs-keyword\">const</span> orders = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">api</span>.<span class=\"hljs-property\">root</span>\n      .<span class=\"hljs-title function_\">getResource</span>(<span class=\"hljs-string\">'v1'</span>)\n      ?.<span class=\"hljs-title function_\">getResource</span>(<span class=\"hljs-string\">'bookings'</span>) <span class=\"hljs-keyword\">as</span> apigw.<span class=\"hljs-property\">Resource</span>;\n\n    orders.<span class=\"hljs-title function_\">addMethod</span>(\n      <span class=\"hljs-string\">'GET'</span>,\n      <span class=\"hljs-keyword\">new</span> apigw.<span class=\"hljs-title class_\">LambdaIntegration</span>(listBookingsLambda, {\n        <span class=\"hljs-attr\">proxy</span>: <span class=\"hljs-literal\">true</span>,\n      })\n    );\n\n    orders.<span class=\"hljs-title function_\">addMethod</span>(\n      <span class=\"hljs-string\">'POST'</span>,\n      <span class=\"hljs-keyword\">new</span> apigw.<span class=\"hljs-title class_\">LambdaIntegration</span>(createBookingLambda, {\n        <span class=\"hljs-attr\">proxy</span>: <span class=\"hljs-literal\">true</span>,\n      })\n    );\n  }\n}\n</code></pre>\n<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ DynamoDB í…Œì´ë¸” ë° EventBridge ì´ë²¤íŠ¸ ë²„ìŠ¤ì˜ ìƒíƒœë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‹¤ìŒ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë“¤ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ì–»ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\">...\n<span class=\"hljs-comment\">// ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì—ì„œ í…Œì´ë¸”ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜´</span>\n<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">table</span> = dynamodb.<span class=\"hljs-property\">Table</span>.<span class=\"hljs-title function_\">fromTableName</span>(\n  <span class=\"hljs-variable language_\">this</span>,\n  <span class=\"hljs-string\">'Table'</span>,\n  <span class=\"hljs-string\">`gilmore-cuisine-table-<span class=\"hljs-subst\">${props.stage}</span>`</span>\n) <span class=\"hljs-keyword\">as</span> dynamodb.<span class=\"hljs-property\">Table</span>;\n\n<span class=\"hljs-comment\">// ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì—ì„œ ì´ë²¤íŠ¸ ë²„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜´</span>\n<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">bus</span> = events.<span class=\"hljs-property\">EventBus</span>.<span class=\"hljs-title function_\">fromEventBusName</span>(\n  <span class=\"hljs-variable language_\">this</span>,\n  <span class=\"hljs-string\">'EventBus'</span>,\n  <span class=\"hljs-string\">`gilmore-cuisine-event-bus-<span class=\"hljs-subst\">${props.stage}</span>`</span>\n) <span class=\"hljs-keyword\">as</span> events.<span class=\"hljs-property\">EventBus</span>;\n...\n</code></pre>\n<p>ê·¸ëŸ¬ë‚˜ ì´ëŠ” ìƒíƒœë¥¼ ê°€ì§„ ìŠ¤íƒì´ ìƒíƒœê°€ ì—†ëŠ” ìŠ¤íƒë³´ë‹¤ ë¨¼ì € ë°°í¬ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” ì˜ì¡´ì„±ì— ê´€í•œ ë‹¤ìŒê³¼ ê°™ì´ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼ì—ì„œ í™•ì‹¤í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-meta\">#!/usr/bin/env node</span>\n\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'source-map-support/register'</span>;\n\n<span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> cdk <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'aws-cdk-lib'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">GilmoreCuisineStatefulStack</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../stateful/stateful'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">GilmoreCuisineStatelessStack</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../stateless/stateless'</span>;\n\n<span class=\"hljs-keyword\">const</span> stage = <span class=\"hljs-string\">'prod'</span>;\n\n<span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-keyword\">new</span> cdk.<span class=\"hljs-title class_\">App</span>();\n\n<span class=\"hljs-keyword\">const</span> stateful = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GilmoreCuisineStatefulStack</span>(\n  app,\n  <span class=\"hljs-string\">'GilmoreCuisineStatefulStack'</span>,\n  {\n    stage,\n  }\n);\n\n<span class=\"hljs-keyword\">const</span> stateless = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GilmoreCuisineStatelessStack</span>(\n  app,\n  <span class=\"hljs-string\">'GilmoreCuisineStatelessStack'</span>,\n  {\n    stage,\n  }\n);\n\n<span class=\"hljs-comment\">// statelessê°€ statefulë³´ë‹¤ ë¨¼ì € ë°°í¬ë˜ë„ë¡ í•¨</span>\nstateless.<span class=\"hljs-title function_\">addDependency</span>(stateful);\n</code></pre>\n<p>ë‹¤ìŒ ì„¹ì…˜ì—ì„œ í•´ê²°ì±…ì„ ë°°í¬í•˜ê³  í…ŒìŠ¤íŠ¸í•´ ë´…ì‹œë‹¤.</p>\n<h2>ë°°í¬ ë° í…ŒìŠ¤íŠ¸ ğŸ§‘ğŸ¾â€ğŸ’»</h2>\n<p>ê·¸ëŸ¼ ì´ì œ 'gilmore-cuisine' í´ë”ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ìŠ¤íƒì„ ë°°í¬í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<p>npm run deploy</p>\n<p>ë™ì¼í•œ í´ë”ì—ì„œ cdk ëª©ë¡ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì•ì„œ ì„¤ëª…í•œëŒ€ë¡œ ë‘ ê°œì˜ ìƒìœ„ ìŠ¤íƒë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_7.png\" alt=\"CDK Nested Stacks\"></p>\n<p>í•©ì„±ëœ CloudFormation í…œí”Œë¦¿ ë° ì—ì…‹ì´ í¬í•¨ëœ cdk.out í´ë”ë¥¼ ë¡œì»¬ë¡œ í™•ì¸í•˜ë©´ ë‹¤ìŒ íŒŒì¼ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤:</p>\n<p>ë‘ ê°œì˜ ìƒìœ„ í…œí”Œë¦¿, GilmoreCuisineStatefulStack.template.json ë° GilmoreCuisineStatelessStack.template.json,ì´ ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë“¤ì€ ì•„ë˜ì™€ ìœ ì‚¬í•œ ë‚´ìš©ì„ ê°€ì§€ê³  ìˆìœ¼ë©° ì¤‘ì²© ìŠ¤íƒì„ ê°€ë¦¬í‚µë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">...\n<span class=\"hljs-string\">\"UpdateReplacePolicy\"</span>: <span class=\"hljs-string\">\"Delete\"</span>,\n<span class=\"hljs-string\">\"DeletionPolicy\"</span>: <span class=\"hljs-string\">\"Delete\"</span>,\n<span class=\"hljs-string\">\"Metadata\"</span>: {\n  <span class=\"hljs-string\">\"aws:cdk:path\"</span>: <span class=\"hljs-string\">\"GilmoreCuisineStatefulStack/EventBusResources.NestedStack/EventBusResources.NestedStackResource\"</span>,\n  <span class=\"hljs-string\">\"aws:asset:path\"</span>: <span class=\"hljs-string\">\"GilmoreCuisineStatefulStackEventBusResourcesAC59B19D.nested.template.json\"</span>,\n  <span class=\"hljs-string\">\"aws:asset:property\"</span>: <span class=\"hljs-string\">\"TemplateURL\"</span>\n}\n...\n</code></pre>\n<p>ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ì½˜ì†”ë¡œ ì „í™˜í•˜ì—¬ ì½˜ì†”ì— ì¤‘ì²© ìŠ¤íƒì´ í‘œì‹œë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í‘œì‹œë©ë‹ˆë‹¤:</p>\n<p>ì´ì œ ì½˜ì†”ì—ì„œ ë‘ ìŠ¤íƒì˜ í•˜ìœ„ ì¤‘ì²© ìŠ¤íƒì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<p>ì´ì œ ê° ìŠ¤íƒì˜ ë‚´ìš©ì„ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<h2>âœ”ï¸ Stateful Stack</h2>\n<p>ìƒíƒœ ìœ ì§€ ìŠ¤íƒ ì•ˆì—ëŠ” DatabaseResourcesì™€ EventBusResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p>ë³´ë‹¤ ìì„¸í•œ ë‚´ìš©ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>\n<p>DatabaseResources\nìš°ë¦¬ì˜ DynamoDB í…Œì´ë¸”ì´ í¬í•¨ëœ DatabaseResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>EventBusResources\nì´ë²¤íŠ¸ ë²„ìŠ¤, CloudWatch ë¡œê·¸ ê·¸ë£¹ ë° ì´ë²¤íŠ¸ ê·œì¹™ ëŒ€ìƒì„ í¬í•¨í•˜ëŠ” EventBusResourcesì˜ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p>ì´ì œ ë¬´ìƒíƒœ ìŠ¤íƒê³¼ ê´€ë ¨ëœ ë‚´ìš©ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<h2>âœ”ï¸ ë¬´ìƒíƒœ ìŠ¤íƒ</h2>\n<p>ë¬´ìƒíƒœ ìŠ¤íƒì—ëŠ” ApiResources ë° ComputeResourcesì˜ ë‘ ê°œì˜ ì¤‘ì²© ìŠ¤íƒì´ í‘œì‹œë©ë‹ˆë‹¤.</p>\n<p>ApiResources\nì•„ë˜ì—ì„œ ApiResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, API Gateway REST API, ìŠ¤í…Œì´ì§€, ë°°í¬ ë“±ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>\n<p>ComputeResources\nì•„ë˜ì—ì„œ ComputeResourcesì— ëŒ€í•œ ì¤‘ì²© ìŠ¤íƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ë‘ ê°œì˜ ëŒë‹¤ í•¨ìˆ˜ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:</p>\n<h2>í…ŒìŠ¤íŒ… ğŸ§ª</h2>\n<p>ë§Œì•½ Postman íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ /bookings/ì˜ POST ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìš”ì²­í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_9.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>ê·¸ë¦¬ê³  CloudWatch ë¡œê·¸ì˜ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ìºì¹˜í•˜ëŠ” ëŒ€ìƒì„ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì´ë²¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤:</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_10.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>ì•„ë˜ëŠ” ëª©ë¡ ì˜ˆì•½ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆì–´ìš”.</p>\n<p>ì´ê²ƒì„ ë³´ì—¬ ì£¼ê² ì£ :</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_12.png\" alt=\"List Bookings EndPoint\"></p>\n<h1>ê²°ë¡ </h1>\n<p>ì´ ê¸€ì„ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ë£¬ ë‚´ìš©ì„ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>\n<ul>\n<li>ì¤‘ì²© ìŠ¤íƒì´ í•„ìš”í•œ ì´ìœ ì— ëŒ€í•´ ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤.</li>\n<li>AWS CDKë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•´ ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤.</li>\n</ul>\n<h1>ë§ˆë¬´ë¦¬ ì¸ì‚¬ ğŸ‘‹ğŸ½</h1>\n<p>ì´ ì§§ì€ ê¸€ì„ ì¦ê²ê²Œ ì½ì–´ì£¼ì…¨ê¸°ë¥¼ ë°”ë¼ë©°, ë§ˆìŒì— ë“œì…¨ë‹¤ë©´ ê³µìœ í•´ ì£¼ì‹œê³  í”¼ë“œë°±ì„ ì£¼ì„¸ìš”!</p>\n<p>ë¹„ìŠ·í•œ ì½˜í…ì¸ ë¥¼ ë” ë³´ê³  ì‹¶ë‹¤ë©´ ì œ YouTube ì±„ë„ì„ ë°©ë¬¸í•´ì£¼ì„¸ìš”!</p>\n<p><img src=\"/assets/img/2024-06-20-CDKNestedStacksTheWhyandHow_13.png\" alt=\"YouTube\"></p>\n<p>ê·¸ë¦¬ê³  ë‹¤ìŒ ë§í¬ë¥¼ í†µí•´ ì—°ë½í•  ìˆ˜ë„ ìˆì–´ìš”:</p>\n<p><a href=\"https://www.linkedin.com/in/lee-james-gilmore/\" rel=\"nofollow\" target=\"_blank\">LinkedIn í”„ë¡œí•„</a>\n<a href=\"https://twitter.com/LeeJamesGilmore\" rel=\"nofollow\" target=\"_blank\">Twitter í”„ë¡œí•„</a></p>\n<p>ë§Œì•½ ì´ ê²Œì‹œë¬¼ì„ ì¦ê²¼ë‹¤ë©´, ì¶”ê°€ í¬ìŠ¤íŠ¸/ì‹œë¦¬ì¦ˆë¥¼ í™•ì¸í•˜ë ¤ë©´ ì œ í”„ë¡œí•„ Lee James Gilmoreë¥¼ íŒ”ë¡œìš°í•´ ì£¼ì„¸ìš”. ë˜í•œ 'clap' ê¸°ëŠ¥ì„ ì´ìš©í•´ ì£¼ì„¸ìš”. ê²Œì‹œë¬¼ í•˜ë‹¨ì— ìœ„ì¹˜í•´ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ì´ìƒìœ¼ë¡œë„ í´ë©ì„ í•  ìˆ˜ ìˆì–´ìš”!</p>\n<h1>ë‚˜ì— ëŒ€í•´</h1>\n<p>\"ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” ì˜êµ­ì— ê±°ì£¼í•˜ê³  ìˆëŠ” AWS ì»¤ë®¤ë‹ˆí‹° ë¹Œë”, ë¸”ë¡œê±°, AWS ì¸ì¦ í´ë¼ìš°ë“œ ì•„í‚¤í…íŠ¸ì´ì ê¸°ìˆ  ë° ì•„í‚¤í…ì²˜ ê¸€ë¡œë²Œ ì´ê´„ì¸ Leeì…ë‹ˆë‹¤. í˜„ì¬ City Electrical Factors (UK) ë° City Electric Supply (US)ì—ì„œ ê·¼ë¬´ ì¤‘ì´ë©°, ì§€ë‚œ 6ë…„ê°„ ì£¼ë¡œ AWSì—ì„œ í’€ìŠ¤íƒ JavaScriptë¥¼ ì‚¬ìš©í•´ ì™”ìŠµë‹ˆë‹¤.\"</p>\n<p>ì €ëŠ” ëª¨ë“  ê²ƒì„ AWS, í˜ì‹ , ì†Œí”„íŠ¸ì›¨ì–´ ì•„í‚¤í…ì²˜, ê·¸ë¦¬ê³  ê¸°ìˆ ì— ëŒ€í•œ ì‚¬ë‘ìœ¼ë¡œ ì„œë²„ë¦¬ìŠ¤ë¥¼ ì˜¹í˜¸í•˜ëŠ” ì‚¬ëŒì´ë¼ê³  ìƒê°í•´ìš”.</p>\n<p>*** ì œê³µëœ ì •ë³´ëŠ” ì œ ê°œì¸ì ì¸ ê²¬í•´ì´ë©°, ê·¸ì— ë”°ë¥¸ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ***</p>\n<p>ì•„ë˜ ë‚´ìš©ë„ ê´€ì‹¬ì´ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤:</p>\n</body>\n</html>\n"},"__N_SSG":true}