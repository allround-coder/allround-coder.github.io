{"pageProps":{"post":{"title":"Jetpack Compose로 인터랙티브 HTML 콘텐츠 만드는 방법","description":"","date":"2024-06-22 03:58","slug":"2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose","content":"\n\nHTML 내용을 Android Compose에서 표시하는 것은 특히 클릭 가능한 링크와 함께 일부 쉽게 보이지 않을 수 있습니다. 그러나 Kotlin과 Jetpack Compose를 사용하면 관리할 수 있고 즐거울 수도 있습니다. 이 안내서에서는 클릭 가능한 링크가 포함된 HTML 문자열을 구문 분석하고 표시하는 사용자 정의 구성 가능한 함수인 HtmlText를 만드는 방법을 안내하겠습니다.\n\n# 의존성 추가\n\n시작하기 전에 build.gradle 파일에 필요한 종속성이 있는지 확인하세요:\n\n```js\ndependencies {\n    implementation \"androidx.compose.ui:ui:1.0.0\"\n    implementation \"androidx.compose.material:material:1.0.0\"\n    implementation \"androidx.compose.ui:ui-tooling-preview:1.0.0\"\n    implementation \"androidx.compose.runtime:runtime-livedata:1.0.0\"\n    implementation 'androidx.core:core-ktx:1.6.0'\n    implementation 'androidx.appcompat:appcompat:1.3.1'\n    implementation 'androidx.compose.foundation:foundation:1.0.0'\n}\n```\n\n<div class=\"content-ad\"></div>\n\n# HtmlText 컴포저블 함수 구축하기\n\nHtmlText 컴포저블 함수를 만드는 과정을 단계별로 살펴보겠습니다.\n\n![image](/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_0.png)\n\n함수 내부에서 현재 컨텍스트를 가져와 HTML 콘텐츠에서 주석이 달린 문자열을 만듭니다. HtmlCompat.fromHtml 메서드는 HTML 문자열을 Spanned 객체로 변환합니다.\n\n<div class=\"content-ad\"></div>\n\n```kotlin\nval context = LocalContext.current\nval annotatedText = remember(html) {\n    val spanned = HtmlCompat.fromHtml(html, HtmlCompat.FROM_HTML_MODE_LEGACY)\n    val text = spanned.toString()\n    buildAnnotatedString {\n        append(text)\n        // 여기에 추가 코드가 추가될 예정입니다\n    }\n}\n```\n\n## 링크 구문 분석\n\nSpanned 객체에서 URL 스팬을 추출하고 buildAnnotatedString 블록 내에서 해당 링크에 주석을 달아서 스타일을 적용하고 클릭 가능하게 만듭니다.\n\n```kotlin\nval urlSpans = spanned.getSpans(0, spanned.length, android.text.style.URLSpan::class.java)\nurlSpans.forEach { urlSpan ->\n    val start = spanned.getSpanStart(urlSpan)\n    val end = spanned.getSpanEnd(urlSpan)\n    val url = urlSpan.url\n    addStyle(\n        style = SpanStyle(\n            color = linkColor,\n            fontSize = fontSize,\n            fontWeight = FontWeight.SemiBold,\n            textDecoration = TextDecoration.Underline\n        ), start = start, end = end\n    )\n    addStringAnnotation(\n        tag = \"URL\",\n        annotation = url,\n        start = start,\n        end = end\n    )\n}\n```\n\n<div class=\"content-ad\"></div>\n\n# 클릭 처리\n\nClickableText를 사용하여 주석이 달린 문자열을 렌더링하고 링크 클릭을 처리하세요. 링크를 클릭하면 장치의 브라우저에서 열립니다.\n\n```js\nClickableText(\n    text = annotatedText,\n    onClick = { offset ->\n        annotatedText.getStringAnnotations(tag = \"URL\", start = offset, end = offset)\n            .firstOrNull()?.let { annotation ->\n                val intent = Intent(Intent.ACTION_VIEW, Uri.parse(annotation.item))\n                context.startActivity(intent)\n            }\n    },\n    style = TextStyle(\n        color = textColor,\n        fontSize = fontSize,\n        fontWeight = fontWeight\n    )\n)\r\n```\n\n# Complete HtmlText 함수\n\n<div class=\"content-ad\"></div>\n\n다음은 HtmlText 함수의 완전한 코드입니다:\n\n```js\nimport android.content.Intent\nimport android.net.Uri\nimport androidx.compose.foundation.text.ClickableText\nimport androidx.compose.runtime.Composable\nimport androidx.compose.runtime.remember\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.platform.LocalContext\nimport androidx.compose.ui.text.SpanStyle\nimport androidx.compose.ui.text.buildAnnotatedString\nimport androidx.compose.ui.text.font.FontWeight\nimport androidx.compose.ui.text.style.TextDecoration\nimport androidx.compose.ui.text.style.TextStyle\nimport androidx.compose.ui.unit.TextUnit\nimport androidx.compose.ui.unit.sp\nimport androidx.core.text.HtmlCompat\n\n@Composable\nfun HtmlText(\n    html: String,\n    linkColor: Color = Color(0xFF6200EE), // 기본 링크 색상\n    textColor: Color = Color.DarkGray,\n    fontSize: TextUnit = 11.sp,\n    fontWeight: FontWeight = FontWeight.Normal\n) {\n    val context = LocalContext.current\n    val annotatedText = remember(html) {\n        val spanned = HtmlCompat.fromHtml(html, HtmlCompat.FROM_HTML_MODE_LEGACY)\n        val text = spanned.toString()\n        buildAnnotatedString {\n            append(text)\n            val urlSpans = spanned.getSpans(0, spanned.length, android.text.style.URLSpan::class.java)\n            urlSpans.forEach { urlSpan ->\n                val start = spanned.getSpanStart(urlSpan)\n                val end = spanned.getSpanEnd(urlSpan)\n                val url = urlSpan.url\n                addStyle(\n                    style = SpanStyle(\n                        color = linkColor,\n                        fontSize = fontSize,\n                        fontWeight = FontWeight.SemiBold,\n                        textDecoration = TextDecoration.Underline\n                    ), start = start, end = end\n                )\n                addStringAnnotation(\n                    tag = \"URL\",\n                    annotation = url,\n                    start = start,\n                    end = end\n                )\n            }\n        }\n    }\n\n    ClickableText(\n        text = annotatedText,\n        onClick = { offset ->\n            annotatedText.getStringAnnotations(tag = \"URL\", start = offset, end = offset)\n                .firstOrNull()?.let { annotation ->\n                    val intent = Intent(Intent.ACTION_VIEW, Uri.parse(annotation.item))\n                    context.startActivity(intent)\n                }\n        },\n        style = TextStyle(\n            color = textColor,\n            fontSize = fontSize,\n            fontWeight = fontWeight\n        )\n    )\n}\n```\n\n# HtmlText 컴포저 사용하기\n\nCompose UI에서 HtmlText 컴포저를 사용하려면 HTML 콘텐츠와 함께 호출하면 됩니다.\n\n<div class=\"content-ad\"></div>\n\n```kotlin\n@Composable\nfun HelloWorldScreen() {\n    val htmlContent = \"\"\"\n        <p>This is a <a href=\"https://medium.com/\">link</a> in HTML.</p>\n    \"\"\".trimIndent()\n\n    HtmlText(\n        html = htmlContent,\n        linkColor = Color.Blue,\n        textColor = Color.Black,\n        fontSize = 16.sp,\n        fontWeight = FontWeight.Bold\n    )\n}\n```\n\n![Image](/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_1.png)\n\n# 결론\n\n위 단계를 따라서 Jetpack Compose에서 사용자 정의 HtmlText composable 함수를 만들어 클릭 가능한 링크가 있는 HTML 콘텐츠를 구문 분석하고 표시할 수 있었습니다. 이 함수는 Android의 HtmlCompat을 활용하여 HTML 문자열을 spanned 텍스트로 변환하고 Compose의 ClickableText를 사용하여 링크 상호 작용을 처리하여, Compose 애플리케이션에서 풍부한 텍스트 콘텐츠를 표시하는 강력한 도구가 되었습니다. 또한 사용자 정의 클릭 리스너를 추가하여 이 composable을 확장하고 HTML 콘텐츠와 더 복잡한 상호 작용을 가능하게 할 수 있습니다.\n","ogImage":{"url":"/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_0.png"},"coverImage":"/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_0.png","tag":["Tech"],"readingTime":7},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>HTML 내용을 Android Compose에서 표시하는 것은 특히 클릭 가능한 링크와 함께 일부 쉽게 보이지 않을 수 있습니다. 그러나 Kotlin과 Jetpack Compose를 사용하면 관리할 수 있고 즐거울 수도 있습니다. 이 안내서에서는 클릭 가능한 링크가 포함된 HTML 문자열을 구문 분석하고 표시하는 사용자 정의 구성 가능한 함수인 HtmlText를 만드는 방법을 안내하겠습니다.</p>\n<h1>의존성 추가</h1>\n<p>시작하기 전에 build.gradle 파일에 필요한 종속성이 있는지 확인하세요:</p>\n<pre><code class=\"hljs language-js\">dependencies {\n    implementation <span class=\"hljs-string\">\"androidx.compose.ui:ui:1.0.0\"</span>\n    implementation <span class=\"hljs-string\">\"androidx.compose.material:material:1.0.0\"</span>\n    implementation <span class=\"hljs-string\">\"androidx.compose.ui:ui-tooling-preview:1.0.0\"</span>\n    implementation <span class=\"hljs-string\">\"androidx.compose.runtime:runtime-livedata:1.0.0\"</span>\n    implementation <span class=\"hljs-string\">'androidx.core:core-ktx:1.6.0'</span>\n    implementation <span class=\"hljs-string\">'androidx.appcompat:appcompat:1.3.1'</span>\n    implementation <span class=\"hljs-string\">'androidx.compose.foundation:foundation:1.0.0'</span>\n}\n</code></pre>\n<h1>HtmlText 컴포저블 함수 구축하기</h1>\n<p>HtmlText 컴포저블 함수를 만드는 과정을 단계별로 살펴보겠습니다.</p>\n<p><img src=\"/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_0.png\" alt=\"image\"></p>\n<p>함수 내부에서 현재 컨텍스트를 가져와 HTML 콘텐츠에서 주석이 달린 문자열을 만듭니다. HtmlCompat.fromHtml 메서드는 HTML 문자열을 Spanned 객체로 변환합니다.</p>\n<pre><code class=\"hljs language-kotlin\"><span class=\"hljs-keyword\">val</span> context = LocalContext.current\n<span class=\"hljs-keyword\">val</span> annotatedText = remember(html) {\n    <span class=\"hljs-keyword\">val</span> spanned = HtmlCompat.fromHtml(html, HtmlCompat.FROM_HTML_MODE_LEGACY)\n    <span class=\"hljs-keyword\">val</span> text = spanned.toString()\n    buildAnnotatedString {\n        append(text)\n        <span class=\"hljs-comment\">// 여기에 추가 코드가 추가될 예정입니다</span>\n    }\n}\n</code></pre>\n<h2>링크 구문 분석</h2>\n<p>Spanned 객체에서 URL 스팬을 추출하고 buildAnnotatedString 블록 내에서 해당 링크에 주석을 달아서 스타일을 적용하고 클릭 가능하게 만듭니다.</p>\n<pre><code class=\"hljs language-kotlin\"><span class=\"hljs-keyword\">val</span> urlSpans = spanned.getSpans(<span class=\"hljs-number\">0</span>, spanned.length, android.text.style.URLSpan::<span class=\"hljs-keyword\">class</span>.java)\nurlSpans.forEach { urlSpan ->\n    <span class=\"hljs-keyword\">val</span> start = spanned.getSpanStart(urlSpan)\n    <span class=\"hljs-keyword\">val</span> end = spanned.getSpanEnd(urlSpan)\n    <span class=\"hljs-keyword\">val</span> url = urlSpan.url\n    addStyle(\n        style = SpanStyle(\n            color = linkColor,\n            fontSize = fontSize,\n            fontWeight = FontWeight.SemiBold,\n            textDecoration = TextDecoration.Underline\n        ), start = start, end = end\n    )\n    addStringAnnotation(\n        tag = <span class=\"hljs-string\">\"URL\"</span>,\n        <span class=\"hljs-keyword\">annotation</span> = url,\n        start = start,\n        end = end\n    )\n}\n</code></pre>\n<h1>클릭 처리</h1>\n<p>ClickableText를 사용하여 주석이 달린 문자열을 렌더링하고 링크 클릭을 처리하세요. 링크를 클릭하면 장치의 브라우저에서 열립니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title class_\">ClickableText</span>(\n    text = annotatedText,\n    onClick = { offset ->\n        annotatedText.<span class=\"hljs-title function_\">getStringAnnotations</span>(tag = <span class=\"hljs-string\">\"URL\"</span>, start = offset, end = offset)\n            .<span class=\"hljs-title function_\">firstOrNull</span>()?.<span class=\"hljs-property\">let</span> { annotation ->\n                val intent = <span class=\"hljs-title class_\">Intent</span>(<span class=\"hljs-title class_\">Intent</span>.<span class=\"hljs-property\">ACTION_VIEW</span>, <span class=\"hljs-title class_\">Uri</span>.<span class=\"hljs-title function_\">parse</span>(annotation.<span class=\"hljs-property\">item</span>))\n                context.<span class=\"hljs-title function_\">startActivity</span>(intent)\n            }\n    },\n    style = <span class=\"hljs-title class_\">TextStyle</span>(\n        color = textColor,\n        fontSize = fontSize,\n        fontWeight = fontWeight\n    )\n)\n</code></pre>\n<h1>Complete HtmlText 함수</h1>\n<p>다음은 HtmlText 함수의 완전한 코드입니다:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> android.<span class=\"hljs-property\">content</span>.<span class=\"hljs-property\">Intent</span>\n<span class=\"hljs-keyword\">import</span> android.<span class=\"hljs-property\">net</span>.<span class=\"hljs-property\">Uri</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">foundation</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">ClickableText</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">runtime</span>.<span class=\"hljs-property\">Composable</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">runtime</span>.<span class=\"hljs-property\">remember</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">graphics</span>.<span class=\"hljs-property\">Color</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">platform</span>.<span class=\"hljs-property\">LocalContext</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">SpanStyle</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">buildAnnotatedString</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">font</span>.<span class=\"hljs-property\">FontWeight</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-property\">TextDecoration</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-property\">TextStyle</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">unit</span>.<span class=\"hljs-property\">TextUnit</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">compose</span>.<span class=\"hljs-property\">ui</span>.<span class=\"hljs-property\">unit</span>.<span class=\"hljs-property\">sp</span>\n<span class=\"hljs-keyword\">import</span> androidx.<span class=\"hljs-property\">core</span>.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">HtmlCompat</span>\n\n@<span class=\"hljs-title class_\">Composable</span>\nfun <span class=\"hljs-title class_\">HtmlText</span>(\n    <span class=\"hljs-attr\">html</span>: <span class=\"hljs-title class_\">String</span>,\n    <span class=\"hljs-attr\">linkColor</span>: <span class=\"hljs-title class_\">Color</span> = <span class=\"hljs-title class_\">Color</span>(<span class=\"hljs-number\">0xFF6200EE</span>), <span class=\"hljs-comment\">// 기본 링크 색상</span>\n    <span class=\"hljs-attr\">textColor</span>: <span class=\"hljs-title class_\">Color</span> = <span class=\"hljs-title class_\">Color</span>.<span class=\"hljs-property\">DarkGray</span>,\n    <span class=\"hljs-attr\">fontSize</span>: <span class=\"hljs-title class_\">TextUnit</span> = <span class=\"hljs-number\">11.</span>sp,\n    <span class=\"hljs-attr\">fontWeight</span>: <span class=\"hljs-title class_\">FontWeight</span> = <span class=\"hljs-title class_\">FontWeight</span>.<span class=\"hljs-property\">Normal</span>\n) {\n    val context = <span class=\"hljs-title class_\">LocalContext</span>.<span class=\"hljs-property\">current</span>\n    val annotatedText = <span class=\"hljs-title function_\">remember</span>(<span class=\"hljs-params\">html</span>) {\n        val spanned = <span class=\"hljs-title class_\">HtmlCompat</span>.<span class=\"hljs-title function_\">fromHtml</span>(html, <span class=\"hljs-title class_\">HtmlCompat</span>.<span class=\"hljs-property\">FROM_HTML_MODE_LEGACY</span>)\n        val text = spanned.<span class=\"hljs-title function_\">toString</span>()\n        buildAnnotatedString {\n            <span class=\"hljs-title function_\">append</span>(text)\n            val urlSpans = spanned.<span class=\"hljs-title function_\">getSpans</span>(<span class=\"hljs-number\">0</span>, spanned.<span class=\"hljs-property\">length</span>, android.<span class=\"hljs-property\">text</span>.<span class=\"hljs-property\">style</span>.<span class=\"hljs-property\">URLSpan</span>::<span class=\"hljs-keyword\">class</span>.<span class=\"hljs-property\">java</span>)\n            urlSpans.<span class=\"hljs-property\">forEach</span> { urlSpan ->\n                val start = spanned.<span class=\"hljs-title function_\">getSpanStart</span>(urlSpan)\n                val end = spanned.<span class=\"hljs-title function_\">getSpanEnd</span>(urlSpan)\n                val url = urlSpan.<span class=\"hljs-property\">url</span>\n                <span class=\"hljs-title function_\">addStyle</span>(\n                    style = <span class=\"hljs-title class_\">SpanStyle</span>(\n                        color = linkColor,\n                        fontSize = fontSize,\n                        fontWeight = <span class=\"hljs-title class_\">FontWeight</span>.<span class=\"hljs-property\">SemiBold</span>,\n                        textDecoration = <span class=\"hljs-title class_\">TextDecoration</span>.<span class=\"hljs-property\">Underline</span>\n                    ), start = start, end = end\n                )\n                <span class=\"hljs-title function_\">addStringAnnotation</span>(\n                    tag = <span class=\"hljs-string\">\"URL\"</span>,\n                    annotation = url,\n                    start = start,\n                    end = end\n                )\n            }\n        }\n    }\n\n    <span class=\"hljs-title class_\">ClickableText</span>(\n        text = annotatedText,\n        onClick = { offset ->\n            annotatedText.<span class=\"hljs-title function_\">getStringAnnotations</span>(tag = <span class=\"hljs-string\">\"URL\"</span>, start = offset, end = offset)\n                .<span class=\"hljs-title function_\">firstOrNull</span>()?.<span class=\"hljs-property\">let</span> { annotation ->\n                    val intent = <span class=\"hljs-title class_\">Intent</span>(<span class=\"hljs-title class_\">Intent</span>.<span class=\"hljs-property\">ACTION_VIEW</span>, <span class=\"hljs-title class_\">Uri</span>.<span class=\"hljs-title function_\">parse</span>(annotation.<span class=\"hljs-property\">item</span>))\n                    context.<span class=\"hljs-title function_\">startActivity</span>(intent)\n                }\n        },\n        style = <span class=\"hljs-title class_\">TextStyle</span>(\n            color = textColor,\n            fontSize = fontSize,\n            fontWeight = fontWeight\n        )\n    )\n}\n</code></pre>\n<h1>HtmlText 컴포저 사용하기</h1>\n<p>Compose UI에서 HtmlText 컴포저를 사용하려면 HTML 콘텐츠와 함께 호출하면 됩니다.</p>\n<pre><code class=\"hljs language-kotlin\"><span class=\"hljs-meta\">@Composable</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">HelloWorldScreen</span><span class=\"hljs-params\">()</span></span> {\n    <span class=\"hljs-keyword\">val</span> htmlContent = <span class=\"hljs-string\">\"\"\"\n        &#x3C;p>This is a &#x3C;a href=\"https://medium.com/\">link&#x3C;/a> in HTML.&#x3C;/p>\n    \"\"\"</span>.trimIndent()\n\n    HtmlText(\n        html = htmlContent,\n        linkColor = Color.Blue,\n        textColor = Color.Black,\n        fontSize = <span class=\"hljs-number\">16.</span>sp,\n        fontWeight = FontWeight.Bold\n    )\n}\n</code></pre>\n<p><img src=\"/assets/img/2024-06-22-CreatingInteractiveHTMLContentinJetpackCompose_1.png\" alt=\"Image\"></p>\n<h1>결론</h1>\n<p>위 단계를 따라서 Jetpack Compose에서 사용자 정의 HtmlText composable 함수를 만들어 클릭 가능한 링크가 있는 HTML 콘텐츠를 구문 분석하고 표시할 수 있었습니다. 이 함수는 Android의 HtmlCompat을 활용하여 HTML 문자열을 spanned 텍스트로 변환하고 Compose의 ClickableText를 사용하여 링크 상호 작용을 처리하여, Compose 애플리케이션에서 풍부한 텍스트 콘텐츠를 표시하는 강력한 도구가 되었습니다. 또한 사용자 정의 클릭 리스너를 추가하여 이 composable을 확장하고 HTML 콘텐츠와 더 복잡한 상호 작용을 가능하게 할 수 있습니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}