{"pageProps":{"post":{"title":"잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스","description":"","date":"2024-06-20 04:43","slug":"2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase","content":"\n\n- 대부분의 기술적거래지표(TTI)는 과거 주식 데이터에서 유래되며 미래 가격 흐름 반전을 예측하고 거래 결정을 내리는 데 거래자들에 의해 사용됩니다.\n- 금융 시장 예측은 시간에 따라 변하는 시장 소음 수준이 뒤틀리는 기본 트렌드와 계절적 주기의 이미지를 왜곡하기 때문에 매우 어려운 작업임이 널리 인정되고 있습니다.\n- 알고트레이딩에서 기술적 분석은 항상 패턴 및 신호를 식별하는 데 의존하지만 때로는 신뢰성 없는 것이 있을 수 있습니다. (신호/소음)`1.\n- 실제로, 가짜 가격 변동 및 오작동이 잘못된 TTI 신호를 초래하여 리스크-수익 최적화를 감소시키고 좋지 않은 거래 전략을 야기할 수 있습니다.\n- 본 게시물에서는 불확실하고 정확하지 않은 시계열 데이터에 기초한 숨겨진 변수의 소음이 적절한 확률 추정을 제공하는 칼만 필터(KF)를 사용하여 TTI의 상기한 단점을 다룰 것입니다.\n- KF는 선형 가우시안 상태 공간 모델에서 이론적으로 최적인 것으로 알려져 있으며, 추정된 오차 공분산을 최소화함으로써 베이지안 예측 및 수정의 최적의 재귀적 구현이라고 할 수 있습니다. \n- 여기서, 우리의 목적은 짧은 윈도우 칼만 필터 이동 평균(KMA)를 도입하여 SMA 크로스오버 거래 전략의 극심한 소음 민감성을 줄이는 것입니다.\n- 사례 예시로, BAC 주식의 예상 수익율을 비교하여 KMA, SMA 크로스오버 및 매수 & 보유 알고트레이딩 전략의 백테스트 분석을 수행할 것입니다.\n- 비즈니스적인 측면에서, 제안된 연구는 계속되는 알고트레이딩 SaaS R&D 노력을 촉진하여 BAC에 대한 거래 봇 및 백테스팅 결과를 업데이트합니다. 이러한 노력은 은행이 대량의 핀테크 데이터를 분석하고 신속하게 거래를 실행하여 이윤을 극대화하고 인적 오류를 최소화합니다.\n\n우리의 접근 방식을 구체적으로 살펴보겠습니다.\n\n## 기본 Imports 및 설정\n\n<div class=\"content-ad\"></div>\n\n- 현재 작업 디렉토리를 YOURPATH로 설정하기\n\n```python\nimport os\nos.chdir('YOURPATH')    # 작업 디렉토리 설정\nos.getcwd()\n```\n\n- Python 라이브러리 가져오고 설치하기\n\n```python\n!pip install yfinance, pykalman\n\nimport pandas as pd \nimport matplotlib.pyplot as plt \nimport requests\nimport math\nfrom termcolor import colored as cl \nimport numpy as np\nimport yfinance as yf\nimport matplotlib.pyplot as plt\nfrom pykalman import KalmanFilter\n\nplt.style.use('fivethirtyeight')\nplt.rcParams['figure.figsize'] = (12, 6)\n```\n\n<div class=\"content-ad\"></div>\n\n## 주식 데이터 입력 읽기\n\n- 야후 파이낸스에서 BAC의 과거 데이터 가져오기\n\n```js\ndata = yf.download('BAC', start='2023-01-01', end='2024-06-01')\n\ndf=data.drop(columns=['Open', 'High','Low','Adj Close','Volume'])\ndf.tail()\n\n           Close\nDate \n2024-05-24 39.700001\n2024-05-28 39.320000\n2024-05-29 38.720001\n2024-05-30 38.630001\n2024-05-31 39.990002\n```\n\n## KMA vs SMA40\n\n<div class=\"content-ad\"></div>\n\n- 파이칼만(pykalman)을 사용한 KF 구현 및 SMA40 계산하기\n\n```python\nkf = KalmanFilter(\n    transition_matrices=[1],\n    observation_matrices=[1],\n    initial_state_mean=0,\n    initial_state_covariance=1,\n    observation_covariance=1,\n    transition_covariance=0.01\n)\n\nstate_means, _ = kf.filter(df['Close'].values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\ndf['kma'] = state_means\ndf['sma'] = df['Close'].rolling(window=40).mean()\n\ndf.tail()\n\n           Close     kma       sma\nDate   \n2024-05-24 39.700001 38.568957 37.64750\n2024-05-28 39.320000 38.640400 37.69250\n2024-05-29 38.720001 38.647972 37.72800\n2024-05-30 38.630001 38.646262 37.75775\n2024-05-31 39.990002 38.774086 37.83450\n```\n\n- 여기에서 KF에 대해 더 알아보기.\n- KMA vs SMA40 그래프 그리기\n\n```python\nplt.figure(figsize=(12,6))\nplt.plot(df['Close'], label='BAC', linewidth=5, alpha=0.3)\nplt.plot(df['kma'], label='KMA')\nplt.plot(df['sma'], label='SMA40')\nplt.title('BAC KMA/SMA')\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.legend(loc='upper left')\nplt.show()\n```\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_1.png\" />\n\n## KMA vs SMA20\n\n- KMA와 20일 이동평균(SMA)을 비교\n\n```js\nmean30 = df['Close'].rolling(window=20).mean()\n\n#plt.figure(figsize=(12,6))\nplt.plot(state_means)\nplt.plot(df['Close'])\nplt.plot(mean30)\nplt.title('Kalman filter estimate of average', fontsize=20)\nplt.legend(['Kalman', 'Price', '20-day MA'], fontsize=20)\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\n```\n\n<div class=\"content-ad\"></div>\n\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_2.png)\n\n## KMA-SMA40 Trading Strategy\n\n- `implement_sma_strategy` 함수를 사용하여 KMA-SMA40 트레이딩 전략 구현하기\n\n```python\ndef implement_sma_strategy(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = 0\n    \n    for i in range(len(data)):\n        if sma1.iloc[i] > sma2.iloc[i]:\n            if signal != 1:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = 1\n                sma_signal.append(signal)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        elif sma2.iloc[i] > sma1.iloc[i]:\n            if signal != -1:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -1\n                sma_signal.append(-1)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        else:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(0)\n            \n    return buy_price, sell_price, sma_signal\n\nsma_20 = df['kma']\nsma_50 = df['sma']\n\nbuy_price, sell_price, signal = implement_sma_strategy(df['Close'], sma_20, sma_50)\n```\n\n\n<div class=\"content-ad\"></div>\n\n- 우리 Position 생성하기\n\n```js\nposition = []\nfor i in range(len(signal)):\n    if signal[i] > 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.concat(frames, join = 'inner', axis = 1)\nstrategy = strategy.reset_index().drop('Date', axis = 1)\n\ndf_ret = pd.DataFrame(np.diff(df['Close'])).rename(columns = {0:'returns'})\nsma_strategy_ret = []\n\nfor i in range(len(df_ret)):\n    try:\n        returns = df_ret['returns'][i]*strategy['sma_position'][i]\n        sma_strategy_ret.append(returns)\n    except:\n        pass\n    \nsma_strategy_ret_df = pd.DataFrame(sma_strategy_ret).rename(columns = {0:'sma_returns'})\n```\n\n- BAC KMA/SMA 트레이딩 신호 플로팅\n\n```js\nplt.plot(df['Close'], alpha = 0.3, label = 'BAC')\nplt.plot(sma_20, alpha = 0.6, label = 'KMA')\nplt.plot(sma_50, alpha = 0.6, label = 'SMA40')\nplt.scatter(df.index, buy_price, marker = '^', s = 200, color = 'darkblue', label = '매수 신호')\nplt.scatter(df.index, sell_price, marker = 'v', s = 200, color = 'crimson', label = '매도 신호')\nplt.legend(loc = 'lower right')\nplt.xlabel('날짜')\nplt.ylabel('종가 USD')\nplt.title('BAC KMA/SMA 트레이딩 신호')\nplt.show()\n```\n\n<div class=\"content-ad\"></div>\n\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_3.png)\n\n- 저희 전략의 백테스팅을 수행 중입니다.\n\n```python\nimport math\nfrom termcolor import colored as cl\n투자금 = 100000\n주식수 = math.floor(투자금 / df['Close'].iloc[1])\nsma_투자_수익 = []\n\nfor i in range(len(sma_strategy_ret_df['sma_returns'])):\n    수익 = 주식수 * sma_strategy_ret_df['sma_returns'].iloc[i]\n    sma_투자_수익.append(수익)\n\nsma_투자_수익_df = pd.DataFrame(sma_투자_수익).rename(columns = {0:'투자_수익'})\n총_투자_수익 = round(sum(sma_투자_수익_df['투자_수익']), 2)\nprint(cl('BAC에 10만 달러를 투자하여 전략으로 얻은 이익: ${}'.format(총_투자_수익), attrs = ['bold']))\n\nBAC에 10만 달러를 투자하여 전략으로 얻은 이익: $29026.39\n```\n\n## SMA 20–50 트레이딩 전략\n\n\n<div class=\"content-ad\"></div>\n\n- 표준 SMA 20-50 거래 전략 구현\n\n```python\ndef sma(data, n):\n    sma = data.rolling(window=n).mean()\n    return pd.DataFrame(sma)\n\nn = [20, 50]\nfor i in n:\n    df[f'sma_{i}'] = sma(df['Close'], i)\n\nClose       sma_20    sma_50         sma_40\nDate    \n2024-05-24 39.700001 38.3415 37.4868 37.64750\n2024-05-28 39.320000 38.4300 37.5650 37.69250\n2024-05-29 38.720001 38.5155 37.6192 37.72800\n2024-05-30 38.630001 38.5995 37.6712 37.75775\n2024-05-31 39.990002 38.7550 37.7360 37.83450\n```\n\n- SMA 20-50 플로팅\n\n```python\nplt.plot(df['Close'], label='BAC', linewidth=5, alpha=0.3)\nplt.plot(df['sma_20'], label='SMA 20')\nplt.plot(df['sma_50'], label='SMA 50')\nplt.title('BAC Simple Moving Averages (20, 50)')\nplt.legend(loc='upper left')\n\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.show()\n```\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_4.png\" />\n\n- implement_sma_strategy 함수를 사용하여 BAC SMA (20,50) 거래 신호를 생성합니다.\n\n```js\ndef implement_sma_strategy(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = 0\n    \n    for i in range(len(data)):\n        if sma1.iloc[i] > sma2.iloc[i]:\n            if signal != 1:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = 1\n                sma_signal.append(signal)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        elif sma2.iloc[i] > sma1.iloc[i]:\n            if signal != -1:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -1\n                sma_signal.append(-1)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        else:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(0)\n            \n    return buy_price, sell_price, sma_signal\n\nsma_20 = df['sma_20']\nsma_50 = df['sma_50']\n\nbuy_price, sell_price, signal = implement_sma_strategy(df['Close'], sma_20, sma_50)\n```\n\n- BAC SMA (20,50) 거래 신호를 플로팅합니다.\n\n<div class=\"content-ad\"></div>\n\n```js\r\nplt.plot(df['Close'], alpha = 0.3, label = 'BAC')\nplt.plot(sma_20, alpha = 0.6, label = 'SMA 20')\nplt.plot(sma_50, alpha = 0.6, label = 'SMA 50')\nplt.scatter(df.index, buy_price, marker = '^', s = 200, color = 'darkblue', label = 'BUY SIGNAL')\nplt.scatter(df.index, sell_price, marker = 'v', s = 200, color = 'crimson', label = 'SELL SIGNAL')\nplt.legend(loc = 'upper left')\nplt.title('BAC SMA CROSSOVER TRADING SIGNALS')\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.show()\r\n```\n\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_5.png\" />\n\n- 포지션 생성\n\n```js\r\nposition = []\nfor i in range(len(signal)):\n    if signal[i] > 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.concat(frames, join = 'inner', axis = 1)\nstrategy = strategy.reset_index().drop('Date', axis = 1)\r\n```\n\n<div class=\"content-ad\"></div>\n\n- 우리 전략의 백테스팅을 수행중입니다\n\n```js\nmsft_ret = pd.DataFrame(np.diff(df['Close'])).rename(columns = {0:'returns'})\nsma_strategy_ret = []\n\nfor i in range(len(msft_ret)):\n    try:\n        returns = msft_ret['returns'].iloc[i]*strategy['sma_position'].iloc[i]\n        sma_strategy_ret.append(returns)\n    except:\n        pass\n\nsma_strategy_ret_df = pd.DataFrame(sma_strategy_ret).rename(columns = {0:'sma_returns'})\n\ninvestment_value = 100000\nnumber_of_stocks = math.floor(investment_value/df['Close'].iloc[1])\nsma_investment_ret = []\n\nfor i in range(len(sma_strategy_ret_df['sma_returns'])):\n    returns = number_of_stocks*sma_strategy_ret_df['sma_returns'].iloc[i]\n    sma_investment_ret.append(returns)\n\nsma_investment_ret_df = pd.DataFrame(sma_investment_ret).rename(columns = {0:'investment_returns'})\ntotal_investment_ret = round(sum(sma_investment_ret_df['investment_returns']), 2)\nprint(cl('장기 배당 수익 전략에 $100K 투자로 얻은 이익: ${}'.format(total_investment_ret), attrs = ['bold']))\n\n장기 배당 수익 전략에 $100K 투자로 얻은 이익: $13473.41\n```\n\n## 수동 매수 & 보유 전략\n\n- 일일 수익에 기반한 누적 수익률 계산 중\n\n<div class=\"content-ad\"></div>\n\n```js\ndf['daily_return'] = df['Close'].pct_change()\n# 누적 수익률 계산\ndf['cum_return'] = np.exp(np.log1p(df['daily_return']).cumsum())\n\n투자금 = 100000\n수익률=(df['cum_return'].iloc[-1]-1)*투자금\nprint(round(수익률,2))\n19337.52\n\n수익=round(수익률,2)\nprint(cl('BAC에 10만 달러를 투자하여 Buy & Hold 전략에서 얻은 수익: ${} '.format(수익), attrs = ['bold']))\n\nBAC에 10만 달러를 투자하여 Buy & Hold 전략에서 얻은 수익: $19337.52 \n```\n\n- 결과 그래프 그리기\n\n```js\ndf['cum_return'].plot()\nplt.title('BAC Buy-Hold 누적 수익률')\n```\n\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_6.png\" />\n\n\n<div class=\"content-ad\"></div>\n\n## 결론\n\n- 2023년 1월 3일부터 2024년 5월 31일까지의 백테스트 결과를 기반으로, KMA 알고 트레이딩 전략은 SMA 크로스오버 및 Buy & Hold 전략에 비해 매우 유망한 성과를 보여주었습니다.\n\n```js\nBAC에 10만 달러를 투자하여 KMA 전략으로 얻은 이익 : $29026.39\n\nBAC에 10만 달러를 투자하여 Buy & Hold 전략으로 얻은 이익 : $19337.52\n\nBAC에 10만 달러를 투자하여 SMA 크로스오버 전략으로 얻은 이익 : $13473.41\n```\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_7.png)\n\n<div class=\"content-ad\"></div>\n\n- 우리는 KF가 TTI의 제한을 극복하고 algo-trading 전략의 성능을 향상시킬 수 있다는 것을 보여줬어요.\n- 비선형 시스템, 이상치 및 잡음을 효율적이고 견고하게 처리하면서 동시에 최적 부드량화와 자동 매개변수 추정이 가능한 KF 프레임워크는 모든 KF 수정사항과 이점을 함께 포함할 수 있게 해 줄 거에요.\n\n## 전체 Python 코드 및 입출력\n\n```js\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport yfinance as yf\nfrom pandas_datareader import data as web\nfrom sklearn.decomposition import PCA\nimport seaborn as sns\nfrom datetime import datetime as dt, timedelta as td\nfrom pykalman import KalmanFilter\nsns.set()\n\ndata = yf.download('BAC', start='2023-01-01', end='2024-06-01')\n\ndf=data.drop(columns=['Open', 'High','Low','Adj Close','Volume'])\ndf.tail()\n\nClose\nDate \n2024-05-24 39.700001\n2024-05-28 39.320000\n2024-05-29 38.720001\n2024-05-30 38.630001\n2024-05-31 39.990002\n\nimport matplotlib.pyplot as plt \nimport requests\nimport math\nfrom termcolor import colored as cl \n\nfrom pykalman import KalmanFilter\n\nplt.style.use('fivethirtyeight')\nplt.rcParams['figure.figsize'] = (15, 8)\n\nkf = KalmanFilter(\n    transition_matrices = [1],\n    observation_matrices = [1],\n    initial_state_mean = 0,\n    initial_state_covariance = 1,\n    observation_covariance=1,\n    transition_covariance=0.01\n)\nstate_means, _ = kf.filter(df.values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\n\n...\n\nprint(signal)\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, ...\n\nposition = []\nfor i in range(len(signal)):\n    if signal[i] > 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\n...\n\nprint(cl('100K달러를 BAC에 투자하여 전략으로 얻은 이익 : ${}'.format(total_investment_ret), attrs = ['bold']))\n\n100K달러를 BAC에 투자하여 전략으로 얻은 이익 : $13473.41\r\n```\n\n## 더 알아보기\n\n<div class=\"content-ad\"></div>\n\n- 신호/잡음 비율이 낮은 칼만 필터 기반 객체 추적\n- 칼만 필터를 사용한 대상 궤적 추적 성능 QC 분석\n- 견고한 1차원 칼만 필터의 해부학\n- 칼만 필터를 사용한 주식 시장 변동성 예측\n\n## 참고 자료\n\n- 파이썬에서 SMA를 이용한 알고리즘 트레이딩\n- 금융 분야에서의 칼만 필터 (KF)\n- 칼만 필터를 기반으로 한 트레이딩 전략 구현\n- 파이썬에서 칼만 필터, 칼만 스무서, EM 알고리즘 구현\n- 칼만 필터를 활용한 주식 거래 마스터하기: 포괄적인 가이드\n- 파이썬에서 주식 가격 예측을 위한 칼만 필터 사용\n- 주식 거래에서의 칼만 필터\n- 시장 탁계를 탐색하는 주식 분석에서의 칼만 필터\n\n## 연락처\n\n<div class=\"content-ad\"></div>\n\n- 웹사이트\n- GitHub\n- X/트위터\n- 핀터레스트\n- 마스토돈\n- 텀블러","ogImage":{"url":"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png"},"coverImage":"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png","tag":["Tech"],"readingTime":17},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<ul>\n<li>대부분의 기술적거래지표(TTI)는 과거 주식 데이터에서 유래되며 미래 가격 흐름 반전을 예측하고 거래 결정을 내리는 데 거래자들에 의해 사용됩니다.</li>\n<li>금융 시장 예측은 시간에 따라 변하는 시장 소음 수준이 뒤틀리는 기본 트렌드와 계절적 주기의 이미지를 왜곡하기 때문에 매우 어려운 작업임이 널리 인정되고 있습니다.</li>\n<li>알고트레이딩에서 기술적 분석은 항상 패턴 및 신호를 식별하는 데 의존하지만 때로는 신뢰성 없는 것이 있을 수 있습니다. (신호/소음)`1.</li>\n<li>실제로, 가짜 가격 변동 및 오작동이 잘못된 TTI 신호를 초래하여 리스크-수익 최적화를 감소시키고 좋지 않은 거래 전략을 야기할 수 있습니다.</li>\n<li>본 게시물에서는 불확실하고 정확하지 않은 시계열 데이터에 기초한 숨겨진 변수의 소음이 적절한 확률 추정을 제공하는 칼만 필터(KF)를 사용하여 TTI의 상기한 단점을 다룰 것입니다.</li>\n<li>KF는 선형 가우시안 상태 공간 모델에서 이론적으로 최적인 것으로 알려져 있으며, 추정된 오차 공분산을 최소화함으로써 베이지안 예측 및 수정의 최적의 재귀적 구현이라고 할 수 있습니다.</li>\n<li>여기서, 우리의 목적은 짧은 윈도우 칼만 필터 이동 평균(KMA)를 도입하여 SMA 크로스오버 거래 전략의 극심한 소음 민감성을 줄이는 것입니다.</li>\n<li>사례 예시로, BAC 주식의 예상 수익율을 비교하여 KMA, SMA 크로스오버 및 매수 &#x26; 보유 알고트레이딩 전략의 백테스트 분석을 수행할 것입니다.</li>\n<li>비즈니스적인 측면에서, 제안된 연구는 계속되는 알고트레이딩 SaaS R&#x26;D 노력을 촉진하여 BAC에 대한 거래 봇 및 백테스팅 결과를 업데이트합니다. 이러한 노력은 은행이 대량의 핀테크 데이터를 분석하고 신속하게 거래를 실행하여 이윤을 극대화하고 인적 오류를 최소화합니다.</li>\n</ul>\n<p>우리의 접근 방식을 구체적으로 살펴보겠습니다.</p>\n<h2>기본 Imports 및 설정</h2>\n<div class=\"content-ad\"></div>\n<ul>\n<li>현재 작업 디렉토리를 YOURPATH로 설정하기</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> os\nos.chdir(<span class=\"hljs-string\">'YOURPATH'</span>)    <span class=\"hljs-comment\"># 작업 디렉토리 설정</span>\nos.getcwd()\n</code></pre>\n<ul>\n<li>Python 라이브러리 가져오고 설치하기</li>\n</ul>\n<pre><code class=\"hljs language-python\">!pip install yfinance, pykalman\n\n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd \n<span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt \n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> math\n<span class=\"hljs-keyword\">from</span> termcolor <span class=\"hljs-keyword\">import</span> colored <span class=\"hljs-keyword\">as</span> cl \n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n<span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">from</span> pykalman <span class=\"hljs-keyword\">import</span> KalmanFilter\n\nplt.style.use(<span class=\"hljs-string\">'fivethirtyeight'</span>)\nplt.rcParams[<span class=\"hljs-string\">'figure.figsize'</span>] = (<span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">6</span>)\n</code></pre>\n<div class=\"content-ad\"></div>\n<h2>주식 데이터 입력 읽기</h2>\n<ul>\n<li>야후 파이낸스에서 BAC의 과거 데이터 가져오기</li>\n</ul>\n<pre><code class=\"hljs language-js\">data = yf.<span class=\"hljs-title function_\">download</span>(<span class=\"hljs-string\">'BAC'</span>, start=<span class=\"hljs-string\">'2023-01-01'</span>, end=<span class=\"hljs-string\">'2024-06-01'</span>)\n\ndf=data.<span class=\"hljs-title function_\">drop</span>(columns=[<span class=\"hljs-string\">'Open'</span>, <span class=\"hljs-string\">'High'</span>,<span class=\"hljs-string\">'Low'</span>,<span class=\"hljs-string\">'Adj Close'</span>,<span class=\"hljs-string\">'Volume'</span>])\ndf.<span class=\"hljs-title function_\">tail</span>()\n\n           <span class=\"hljs-title class_\">Close</span>\n<span class=\"hljs-title class_\">Date</span> \n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">39.700001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">39.320000</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">38.720001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">30</span> <span class=\"hljs-number\">38.630001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">39.990002</span>\n</code></pre>\n<h2>KMA vs SMA40</h2>\n<div class=\"content-ad\"></div>\n<ul>\n<li>파이칼만(pykalman)을 사용한 KF 구현 및 SMA40 계산하기</li>\n</ul>\n<pre><code class=\"hljs language-python\">kf = KalmanFilter(\n    transition_matrices=[<span class=\"hljs-number\">1</span>],\n    observation_matrices=[<span class=\"hljs-number\">1</span>],\n    initial_state_mean=<span class=\"hljs-number\">0</span>,\n    initial_state_covariance=<span class=\"hljs-number\">1</span>,\n    observation_covariance=<span class=\"hljs-number\">1</span>,\n    transition_covariance=<span class=\"hljs-number\">0.01</span>\n)\n\nstate_means, _ = kf.<span class=\"hljs-built_in\">filter</span>(df[<span class=\"hljs-string\">'Close'</span>].values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\ndf[<span class=\"hljs-string\">'kma'</span>] = state_means\ndf[<span class=\"hljs-string\">'sma'</span>] = df[<span class=\"hljs-string\">'Close'</span>].rolling(window=<span class=\"hljs-number\">40</span>).mean()\n\ndf.tail()\n\n           Close     kma       sma\nDate   \n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">39.700001</span> <span class=\"hljs-number\">38.568957</span> <span class=\"hljs-number\">37.64750</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">39.320000</span> <span class=\"hljs-number\">38.640400</span> <span class=\"hljs-number\">37.69250</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">38.720001</span> <span class=\"hljs-number\">38.647972</span> <span class=\"hljs-number\">37.72800</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">30</span> <span class=\"hljs-number\">38.630001</span> <span class=\"hljs-number\">38.646262</span> <span class=\"hljs-number\">37.75775</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">39.990002</span> <span class=\"hljs-number\">38.774086</span> <span class=\"hljs-number\">37.83450</span>\n</code></pre>\n<ul>\n<li>여기에서 KF에 대해 더 알아보기.</li>\n<li>KMA vs SMA40 그래프 그리기</li>\n</ul>\n<pre><code class=\"hljs language-python\">plt.figure(figsize=(<span class=\"hljs-number\">12</span>,<span class=\"hljs-number\">6</span>))\nplt.plot(df[<span class=\"hljs-string\">'Close'</span>], label=<span class=\"hljs-string\">'BAC'</span>, linewidth=<span class=\"hljs-number\">5</span>, alpha=<span class=\"hljs-number\">0.3</span>)\nplt.plot(df[<span class=\"hljs-string\">'kma'</span>], label=<span class=\"hljs-string\">'KMA'</span>)\nplt.plot(df[<span class=\"hljs-string\">'sma'</span>], label=<span class=\"hljs-string\">'SMA40'</span>)\nplt.title(<span class=\"hljs-string\">'BAC KMA/SMA'</span>)\nplt.xlabel(<span class=\"hljs-string\">'Date'</span>)\nplt.ylabel(<span class=\"hljs-string\">'Close Price USD'</span>)\nplt.legend(loc=<span class=\"hljs-string\">'upper left'</span>)\nplt.show()\n</code></pre>\n<div class=\"content-ad\"></div>\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_1.png\">\n<h2>KMA vs SMA20</h2>\n<ul>\n<li>KMA와 20일 이동평균(SMA)을 비교</li>\n</ul>\n<pre><code class=\"hljs language-js\">mean30 = df[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-title function_\">rolling</span>(<span class=\"hljs-variable language_\">window</span>=<span class=\"hljs-number\">20</span>).<span class=\"hljs-title function_\">mean</span>()\n\n#plt.<span class=\"hljs-title function_\">figure</span>(figsize=(<span class=\"hljs-number\">12</span>,<span class=\"hljs-number\">6</span>))\nplt.<span class=\"hljs-title function_\">plot</span>(state_means)\nplt.<span class=\"hljs-title function_\">plot</span>(df[<span class=\"hljs-string\">'Close'</span>])\nplt.<span class=\"hljs-title function_\">plot</span>(mean30)\nplt.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">'Kalman filter estimate of average'</span>, fontsize=<span class=\"hljs-number\">20</span>)\nplt.<span class=\"hljs-title function_\">legend</span>([<span class=\"hljs-string\">'Kalman'</span>, <span class=\"hljs-string\">'Price'</span>, <span class=\"hljs-string\">'20-day MA'</span>], fontsize=<span class=\"hljs-number\">20</span>)\nplt.<span class=\"hljs-title function_\">xlabel</span>(<span class=\"hljs-string\">'Date'</span>)\nplt.<span class=\"hljs-title function_\">ylabel</span>(<span class=\"hljs-string\">'Close Price USD'</span>)\n</code></pre>\n<div class=\"content-ad\"></div>\n<p><img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_2.png\" alt=\"이미지\"></p>\n<h2>KMA-SMA40 Trading Strategy</h2>\n<ul>\n<li><code>implement_sma_strategy</code> 함수를 사용하여 KMA-SMA40 트레이딩 전략 구현하기</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">implement_sma_strategy</span>(<span class=\"hljs-params\">data, short_window, long_window</span>):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = <span class=\"hljs-number\">0</span>\n    \n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(data)):\n        <span class=\"hljs-keyword\">if</span> sma1.iloc[i] > sma2.iloc[i]:\n            <span class=\"hljs-keyword\">if</span> signal != <span class=\"hljs-number\">1</span>:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = <span class=\"hljs-number\">1</span>\n                sma_signal.append(signal)\n            <span class=\"hljs-keyword\">else</span>:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(<span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-keyword\">elif</span> sma2.iloc[i] > sma1.iloc[i]:\n            <span class=\"hljs-keyword\">if</span> signal != -<span class=\"hljs-number\">1</span>:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -<span class=\"hljs-number\">1</span>\n                sma_signal.append(-<span class=\"hljs-number\">1</span>)\n            <span class=\"hljs-keyword\">else</span>:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(<span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(<span class=\"hljs-number\">0</span>)\n            \n    <span class=\"hljs-keyword\">return</span> buy_price, sell_price, sma_signal\n\nsma_20 = df[<span class=\"hljs-string\">'kma'</span>]\nsma_50 = df[<span class=\"hljs-string\">'sma'</span>]\n\nbuy_price, sell_price, signal = implement_sma_strategy(df[<span class=\"hljs-string\">'Close'</span>], sma_20, sma_50)\n</code></pre>\n<div class=\"content-ad\"></div>\n<ul>\n<li>우리 Position 생성하기</li>\n</ul>\n<pre><code class=\"hljs language-js\">position = []\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(signal)):\n    <span class=\"hljs-keyword\">if</span> signal[i] > <span class=\"hljs-number\">1</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n    <span class=\"hljs-attr\">else</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">1</span>)\n        \n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(df[<span class=\"hljs-string\">'Close'</span>])):\n    <span class=\"hljs-keyword\">if</span> signal[i] == <span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">1</span>\n    elif signal[i] == -<span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-attr\">else</span>:\n        position[i] = position[i-<span class=\"hljs-number\">1</span>]\n\nsma_20 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_20).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_20'</span>})\nsma_50 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_50).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_50'</span>}) \nsignal = pd.<span class=\"hljs-title class_\">DataFrame</span>(signal).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_signal'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\nposition = pd.<span class=\"hljs-title class_\">DataFrame</span>(position).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_position'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.<span class=\"hljs-title function_\">concat</span>(frames, join = <span class=\"hljs-string\">'inner'</span>, axis = <span class=\"hljs-number\">1</span>)\nstrategy = strategy.<span class=\"hljs-title function_\">reset_index</span>().<span class=\"hljs-title function_\">drop</span>(<span class=\"hljs-string\">'Date'</span>, axis = <span class=\"hljs-number\">1</span>)\n\ndf_ret = pd.<span class=\"hljs-title class_\">DataFrame</span>(np.<span class=\"hljs-title function_\">diff</span>(df[<span class=\"hljs-string\">'Close'</span>])).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'returns'</span>})\nsma_strategy_ret = []\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(df_ret)):\n    <span class=\"hljs-attr\">try</span>:\n        returns = df_ret[<span class=\"hljs-string\">'returns'</span>][i]*strategy[<span class=\"hljs-string\">'sma_position'</span>][i]\n        sma_strategy_ret.<span class=\"hljs-title function_\">append</span>(returns)\n    <span class=\"hljs-attr\">except</span>:\n        pass\n    \nsma_strategy_ret_df = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_strategy_ret).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_returns'</span>})\n</code></pre>\n<ul>\n<li>BAC KMA/SMA 트레이딩 신호 플로팅</li>\n</ul>\n<pre><code class=\"hljs language-js\">plt.<span class=\"hljs-title function_\">plot</span>(df[<span class=\"hljs-string\">'Close'</span>], alpha = <span class=\"hljs-number\">0.3</span>, label = <span class=\"hljs-string\">'BAC'</span>)\nplt.<span class=\"hljs-title function_\">plot</span>(sma_20, alpha = <span class=\"hljs-number\">0.6</span>, label = <span class=\"hljs-string\">'KMA'</span>)\nplt.<span class=\"hljs-title function_\">plot</span>(sma_50, alpha = <span class=\"hljs-number\">0.6</span>, label = <span class=\"hljs-string\">'SMA40'</span>)\nplt.<span class=\"hljs-title function_\">scatter</span>(df.<span class=\"hljs-property\">index</span>, buy_price, marker = <span class=\"hljs-string\">'^'</span>, s = <span class=\"hljs-number\">200</span>, color = <span class=\"hljs-string\">'darkblue'</span>, label = <span class=\"hljs-string\">'매수 신호'</span>)\nplt.<span class=\"hljs-title function_\">scatter</span>(df.<span class=\"hljs-property\">index</span>, sell_price, marker = <span class=\"hljs-string\">'v'</span>, s = <span class=\"hljs-number\">200</span>, color = <span class=\"hljs-string\">'crimson'</span>, label = <span class=\"hljs-string\">'매도 신호'</span>)\nplt.<span class=\"hljs-title function_\">legend</span>(loc = <span class=\"hljs-string\">'lower right'</span>)\nplt.<span class=\"hljs-title function_\">xlabel</span>(<span class=\"hljs-string\">'날짜'</span>)\nplt.<span class=\"hljs-title function_\">ylabel</span>(<span class=\"hljs-string\">'종가 USD'</span>)\nplt.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">'BAC KMA/SMA 트레이딩 신호'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<div class=\"content-ad\"></div>\n<p><img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_3.png\" alt=\"이미지\"></p>\n<ul>\n<li>저희 전략의 백테스팅을 수행 중입니다.</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> math\n<span class=\"hljs-keyword\">from</span> termcolor <span class=\"hljs-keyword\">import</span> colored <span class=\"hljs-keyword\">as</span> cl\n투자금 = <span class=\"hljs-number\">100000</span>\n주식수 = math.floor(투자금 / df[<span class=\"hljs-string\">'Close'</span>].iloc[<span class=\"hljs-number\">1</span>])\nsma_투자_수익 = []\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(sma_strategy_ret_df[<span class=\"hljs-string\">'sma_returns'</span>])):\n    수익 = 주식수 * sma_strategy_ret_df[<span class=\"hljs-string\">'sma_returns'</span>].iloc[i]\n    sma_투자_수익.append(수익)\n\nsma_투자_수익_df = pd.DataFrame(sma_투자_수익).rename(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'투자_수익'</span>})\n총_투자_수익 = <span class=\"hljs-built_in\">round</span>(<span class=\"hljs-built_in\">sum</span>(sma_투자_수익_df[<span class=\"hljs-string\">'투자_수익'</span>]), <span class=\"hljs-number\">2</span>)\n<span class=\"hljs-built_in\">print</span>(cl(<span class=\"hljs-string\">'BAC에 10만 달러를 투자하여 전략으로 얻은 이익: ${}'</span>.<span class=\"hljs-built_in\">format</span>(총_투자_수익), attrs = [<span class=\"hljs-string\">'bold'</span>]))\n\nBAC에 <span class=\"hljs-number\">10</span>만 달러를 투자하여 전략으로 얻은 이익: $<span class=\"hljs-number\">29026.39</span>\n</code></pre>\n<h2>SMA 20–50 트레이딩 전략</h2>\n<div class=\"content-ad\"></div>\n<ul>\n<li>표준 SMA 20-50 거래 전략 구현</li>\n</ul>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">sma</span>(<span class=\"hljs-params\">data, n</span>):\n    sma = data.rolling(window=n).mean()\n    <span class=\"hljs-keyword\">return</span> pd.DataFrame(sma)\n\nn = [<span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">50</span>]\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> n:\n    df[<span class=\"hljs-string\">f'sma_<span class=\"hljs-subst\">{i}</span>'</span>] = sma(df[<span class=\"hljs-string\">'Close'</span>], i)\n\nClose       sma_20    sma_50         sma_40\nDate    \n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">39.700001</span> <span class=\"hljs-number\">38.3415</span> <span class=\"hljs-number\">37.4868</span> <span class=\"hljs-number\">37.64750</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">39.320000</span> <span class=\"hljs-number\">38.4300</span> <span class=\"hljs-number\">37.5650</span> <span class=\"hljs-number\">37.69250</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">38.720001</span> <span class=\"hljs-number\">38.5155</span> <span class=\"hljs-number\">37.6192</span> <span class=\"hljs-number\">37.72800</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">30</span> <span class=\"hljs-number\">38.630001</span> <span class=\"hljs-number\">38.5995</span> <span class=\"hljs-number\">37.6712</span> <span class=\"hljs-number\">37.75775</span>\n<span class=\"hljs-number\">2024</span>-05-<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">39.990002</span> <span class=\"hljs-number\">38.7550</span> <span class=\"hljs-number\">37.7360</span> <span class=\"hljs-number\">37.83450</span>\n</code></pre>\n<ul>\n<li>SMA 20-50 플로팅</li>\n</ul>\n<pre><code class=\"hljs language-python\">plt.plot(df[<span class=\"hljs-string\">'Close'</span>], label=<span class=\"hljs-string\">'BAC'</span>, linewidth=<span class=\"hljs-number\">5</span>, alpha=<span class=\"hljs-number\">0.3</span>)\nplt.plot(df[<span class=\"hljs-string\">'sma_20'</span>], label=<span class=\"hljs-string\">'SMA 20'</span>)\nplt.plot(df[<span class=\"hljs-string\">'sma_50'</span>], label=<span class=\"hljs-string\">'SMA 50'</span>)\nplt.title(<span class=\"hljs-string\">'BAC Simple Moving Averages (20, 50)'</span>)\nplt.legend(loc=<span class=\"hljs-string\">'upper left'</span>)\n\nplt.xlabel(<span class=\"hljs-string\">'Date'</span>)\nplt.ylabel(<span class=\"hljs-string\">'Close Price USD'</span>)\nplt.show()\n</code></pre>\n<div class=\"content-ad\"></div>\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_4.png\">\n<ul>\n<li>implement_sma_strategy 함수를 사용하여 BAC SMA (20,50) 거래 신호를 생성합니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\">def <span class=\"hljs-title function_\">implement_sma_strategy</span>(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = <span class=\"hljs-number\">0</span>\n    \n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(data)):\n        <span class=\"hljs-keyword\">if</span> sma1.<span class=\"hljs-property\">iloc</span>[i] > sma2.<span class=\"hljs-property\">iloc</span>[i]:\n            <span class=\"hljs-keyword\">if</span> signal != <span class=\"hljs-number\">1</span>:\n                buy_price.<span class=\"hljs-title function_\">append</span>(data.<span class=\"hljs-property\">iloc</span>[i])\n                sell_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                signal = <span class=\"hljs-number\">1</span>\n                sma_signal.<span class=\"hljs-title function_\">append</span>(signal)\n            <span class=\"hljs-attr\">else</span>:\n                buy_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                sell_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                sma_signal.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n        elif sma2.<span class=\"hljs-property\">iloc</span>[i] > sma1.<span class=\"hljs-property\">iloc</span>[i]:\n            <span class=\"hljs-keyword\">if</span> signal != -<span class=\"hljs-number\">1</span>:\n                buy_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                sell_price.<span class=\"hljs-title function_\">append</span>(data.<span class=\"hljs-property\">iloc</span>[i])\n                signal = -<span class=\"hljs-number\">1</span>\n                sma_signal.<span class=\"hljs-title function_\">append</span>(-<span class=\"hljs-number\">1</span>)\n            <span class=\"hljs-attr\">else</span>:\n                buy_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                sell_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n                sma_signal.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-attr\">else</span>:\n            buy_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n            sell_price.<span class=\"hljs-title function_\">append</span>(np.<span class=\"hljs-property\">nan</span>)\n            sma_signal.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n            \n    <span class=\"hljs-keyword\">return</span> buy_price, sell_price, sma_signal\n\nsma_20 = df[<span class=\"hljs-string\">'sma_20'</span>]\nsma_50 = df[<span class=\"hljs-string\">'sma_50'</span>]\n\nbuy_price, sell_price, signal = <span class=\"hljs-title function_\">implement_sma_strategy</span>(df[<span class=\"hljs-string\">'Close'</span>], sma_20, sma_50)\n</code></pre>\n<ul>\n<li>BAC SMA (20,50) 거래 신호를 플로팅합니다.</li>\n</ul>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\">plt.<span class=\"hljs-title function_\">plot</span>(df[<span class=\"hljs-string\">'Close'</span>], alpha = <span class=\"hljs-number\">0.3</span>, label = <span class=\"hljs-string\">'BAC'</span>)\nplt.<span class=\"hljs-title function_\">plot</span>(sma_20, alpha = <span class=\"hljs-number\">0.6</span>, label = <span class=\"hljs-string\">'SMA 20'</span>)\nplt.<span class=\"hljs-title function_\">plot</span>(sma_50, alpha = <span class=\"hljs-number\">0.6</span>, label = <span class=\"hljs-string\">'SMA 50'</span>)\nplt.<span class=\"hljs-title function_\">scatter</span>(df.<span class=\"hljs-property\">index</span>, buy_price, marker = <span class=\"hljs-string\">'^'</span>, s = <span class=\"hljs-number\">200</span>, color = <span class=\"hljs-string\">'darkblue'</span>, label = <span class=\"hljs-string\">'BUY SIGNAL'</span>)\nplt.<span class=\"hljs-title function_\">scatter</span>(df.<span class=\"hljs-property\">index</span>, sell_price, marker = <span class=\"hljs-string\">'v'</span>, s = <span class=\"hljs-number\">200</span>, color = <span class=\"hljs-string\">'crimson'</span>, label = <span class=\"hljs-string\">'SELL SIGNAL'</span>)\nplt.<span class=\"hljs-title function_\">legend</span>(loc = <span class=\"hljs-string\">'upper left'</span>)\nplt.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">'BAC SMA CROSSOVER TRADING SIGNALS'</span>)\nplt.<span class=\"hljs-title function_\">xlabel</span>(<span class=\"hljs-string\">'Date'</span>)\nplt.<span class=\"hljs-title function_\">ylabel</span>(<span class=\"hljs-string\">'Close Price USD'</span>)\nplt.<span class=\"hljs-title function_\">show</span>()\n</code></pre>\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_5.png\">\n<ul>\n<li>포지션 생성</li>\n</ul>\n<pre><code class=\"hljs language-js\">position = []\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(signal)):\n    <span class=\"hljs-keyword\">if</span> signal[i] > <span class=\"hljs-number\">1</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n    <span class=\"hljs-attr\">else</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">1</span>)\n        \n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(df[<span class=\"hljs-string\">'Close'</span>])):\n    <span class=\"hljs-keyword\">if</span> signal[i] == <span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">1</span>\n    elif signal[i] == -<span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-attr\">else</span>:\n        position[i] = position[i-<span class=\"hljs-number\">1</span>]\n\nsma_20 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_20).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_20'</span>})\nsma_50 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_50).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_50'</span>}) \nsignal = pd.<span class=\"hljs-title class_\">DataFrame</span>(signal).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_signal'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\nposition = pd.<span class=\"hljs-title class_\">DataFrame</span>(position).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_position'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.<span class=\"hljs-title function_\">concat</span>(frames, join = <span class=\"hljs-string\">'inner'</span>, axis = <span class=\"hljs-number\">1</span>)\nstrategy = strategy.<span class=\"hljs-title function_\">reset_index</span>().<span class=\"hljs-title function_\">drop</span>(<span class=\"hljs-string\">'Date'</span>, axis = <span class=\"hljs-number\">1</span>)\n</code></pre>\n<div class=\"content-ad\"></div>\n<ul>\n<li>우리 전략의 백테스팅을 수행중입니다</li>\n</ul>\n<pre><code class=\"hljs language-js\">msft_ret = pd.<span class=\"hljs-title class_\">DataFrame</span>(np.<span class=\"hljs-title function_\">diff</span>(df[<span class=\"hljs-string\">'Close'</span>])).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'returns'</span>})\nsma_strategy_ret = []\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(msft_ret)):\n    <span class=\"hljs-attr\">try</span>:\n        returns = msft_ret[<span class=\"hljs-string\">'returns'</span>].<span class=\"hljs-property\">iloc</span>[i]*strategy[<span class=\"hljs-string\">'sma_position'</span>].<span class=\"hljs-property\">iloc</span>[i]\n        sma_strategy_ret.<span class=\"hljs-title function_\">append</span>(returns)\n    <span class=\"hljs-attr\">except</span>:\n        pass\n\nsma_strategy_ret_df = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_strategy_ret).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_returns'</span>})\n\ninvestment_value = <span class=\"hljs-number\">100000</span>\nnumber_of_stocks = math.<span class=\"hljs-title function_\">floor</span>(investment_value/df[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-property\">iloc</span>[<span class=\"hljs-number\">1</span>])\nsma_investment_ret = []\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(sma_strategy_ret_df[<span class=\"hljs-string\">'sma_returns'</span>])):\n    returns = number_of_stocks*sma_strategy_ret_df[<span class=\"hljs-string\">'sma_returns'</span>].<span class=\"hljs-property\">iloc</span>[i]\n    sma_investment_ret.<span class=\"hljs-title function_\">append</span>(returns)\n\nsma_investment_ret_df = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_investment_ret).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'investment_returns'</span>})\ntotal_investment_ret = <span class=\"hljs-title function_\">round</span>(<span class=\"hljs-title function_\">sum</span>(sma_investment_ret_df[<span class=\"hljs-string\">'investment_returns'</span>]), <span class=\"hljs-number\">2</span>)\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-title function_\">cl</span>(<span class=\"hljs-string\">'장기 배당 수익 전략에 $100K 투자로 얻은 이익: ${}'</span>.<span class=\"hljs-title function_\">format</span>(total_investment_ret), attrs = [<span class=\"hljs-string\">'bold'</span>]))\n\n장기 배당 수익 전략에 $100K 투자로 얻은 이익: $13473<span class=\"hljs-number\">.41</span>\n</code></pre>\n<h2>수동 매수 &#x26; 보유 전략</h2>\n<ul>\n<li>일일 수익에 기반한 누적 수익률 계산 중</li>\n</ul>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\">df[<span class=\"hljs-string\">'daily_return'</span>] = df[<span class=\"hljs-string\">'Close'</span>].<span class=\"hljs-title function_\">pct_change</span>()\n# 누적 수익률 계산\ndf[<span class=\"hljs-string\">'cum_return'</span>] = np.<span class=\"hljs-title function_\">exp</span>(np.<span class=\"hljs-title function_\">log1p</span>(df[<span class=\"hljs-string\">'daily_return'</span>]).<span class=\"hljs-title function_\">cumsum</span>())\n\n투자금 = <span class=\"hljs-number\">100000</span>\n수익률=(df[<span class=\"hljs-string\">'cum_return'</span>].<span class=\"hljs-property\">iloc</span>[-<span class=\"hljs-number\">1</span>]-<span class=\"hljs-number\">1</span>)*투자금\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-title function_\">round</span>(수익률,<span class=\"hljs-number\">2</span>))\n<span class=\"hljs-number\">19337.52</span>\n\n수익=<span class=\"hljs-title function_\">round</span>(수익률,<span class=\"hljs-number\">2</span>)\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-title function_\">cl</span>(<span class=\"hljs-string\">'BAC에 10만 달러를 투자하여 Buy &#x26; Hold 전략에서 얻은 수익: ${} '</span>.<span class=\"hljs-title function_\">format</span>(수익), attrs = [<span class=\"hljs-string\">'bold'</span>]))\n\n<span class=\"hljs-variable constant_\">BAC</span>에 <span class=\"hljs-number\">10</span>만 달러를 투자하여 <span class=\"hljs-title class_\">Buy</span> &#x26; <span class=\"hljs-title class_\">Hold</span> 전략에서 얻은 수익: $19337<span class=\"hljs-number\">.52</span> \n</code></pre>\n<ul>\n<li>결과 그래프 그리기</li>\n</ul>\n<pre><code class=\"hljs language-js\">df[<span class=\"hljs-string\">'cum_return'</span>].<span class=\"hljs-title function_\">plot</span>()\nplt.<span class=\"hljs-title function_\">title</span>(<span class=\"hljs-string\">'BAC Buy-Hold 누적 수익률'</span>)\n</code></pre>\n<img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_6.png\">\n<div class=\"content-ad\"></div>\n<h2>결론</h2>\n<ul>\n<li>2023년 1월 3일부터 2024년 5월 31일까지의 백테스트 결과를 기반으로, KMA 알고 트레이딩 전략은 SMA 크로스오버 및 Buy &#x26; Hold 전략에 비해 매우 유망한 성과를 보여주었습니다.</li>\n</ul>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable constant_\">BAC</span>에 <span class=\"hljs-number\">10</span>만 달러를 투자하여 <span class=\"hljs-variable constant_\">KMA</span> 전략으로 얻은 이익 : $29026<span class=\"hljs-number\">.39</span>\n\n<span class=\"hljs-variable constant_\">BAC</span>에 <span class=\"hljs-number\">10</span>만 달러를 투자하여 <span class=\"hljs-title class_\">Buy</span> &#x26; <span class=\"hljs-title class_\">Hold</span> 전략으로 얻은 이익 : $19337<span class=\"hljs-number\">.52</span>\n\n<span class=\"hljs-variable constant_\">BAC</span>에 <span class=\"hljs-number\">10</span>만 달러를 투자하여 <span class=\"hljs-variable constant_\">SMA</span> 크로스오버 전략으로 얻은 이익 : $13473<span class=\"hljs-number\">.41</span>\n</code></pre>\n<p><img src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_7.png\" alt=\"이미지\"></p>\n<div class=\"content-ad\"></div>\n<ul>\n<li>우리는 KF가 TTI의 제한을 극복하고 algo-trading 전략의 성능을 향상시킬 수 있다는 것을 보여줬어요.</li>\n<li>비선형 시스템, 이상치 및 잡음을 효율적이고 견고하게 처리하면서 동시에 최적 부드량화와 자동 매개변수 추정이 가능한 KF 프레임워크는 모든 KF 수정사항과 이점을 함께 포함할 수 있게 해 줄 거에요.</li>\n</ul>\n<h2>전체 Python 코드 및 입출력</h2>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np \n<span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd \n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt\n<span class=\"hljs-keyword\">import</span> yfinance <span class=\"hljs-keyword\">as</span> yf\n<span class=\"hljs-keyword\">from</span> pandas_datareader <span class=\"hljs-keyword\">import</span> data <span class=\"hljs-keyword\">as</span> web\n<span class=\"hljs-keyword\">from</span> sklearn.<span class=\"hljs-property\">decomposition</span> <span class=\"hljs-keyword\">import</span> <span class=\"hljs-variable constant_\">PCA</span>\n<span class=\"hljs-keyword\">import</span> seaborn <span class=\"hljs-keyword\">as</span> sns\n<span class=\"hljs-keyword\">from</span> datetime <span class=\"hljs-keyword\">import</span> datetime <span class=\"hljs-keyword\">as</span> dt, timedelta <span class=\"hljs-keyword\">as</span> td\n<span class=\"hljs-keyword\">from</span> pykalman <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">KalmanFilter</span>\nsns.<span class=\"hljs-title function_\">set</span>()\n\ndata = yf.<span class=\"hljs-title function_\">download</span>(<span class=\"hljs-string\">'BAC'</span>, start=<span class=\"hljs-string\">'2023-01-01'</span>, end=<span class=\"hljs-string\">'2024-06-01'</span>)\n\ndf=data.<span class=\"hljs-title function_\">drop</span>(columns=[<span class=\"hljs-string\">'Open'</span>, <span class=\"hljs-string\">'High'</span>,<span class=\"hljs-string\">'Low'</span>,<span class=\"hljs-string\">'Adj Close'</span>,<span class=\"hljs-string\">'Volume'</span>])\ndf.<span class=\"hljs-title function_\">tail</span>()\n\n<span class=\"hljs-title class_\">Close</span>\n<span class=\"hljs-title class_\">Date</span> \n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">24</span> <span class=\"hljs-number\">39.700001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">28</span> <span class=\"hljs-number\">39.320000</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">29</span> <span class=\"hljs-number\">38.720001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">30</span> <span class=\"hljs-number\">38.630001</span>\n<span class=\"hljs-number\">2024</span>-<span class=\"hljs-number\">05</span>-<span class=\"hljs-number\">31</span> <span class=\"hljs-number\">39.990002</span>\n\n<span class=\"hljs-keyword\">import</span> matplotlib.<span class=\"hljs-property\">pyplot</span> <span class=\"hljs-keyword\">as</span> plt \n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> math\n<span class=\"hljs-keyword\">from</span> termcolor <span class=\"hljs-keyword\">import</span> colored <span class=\"hljs-keyword\">as</span> cl \n\n<span class=\"hljs-keyword\">from</span> pykalman <span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">KalmanFilter</span>\n\nplt.<span class=\"hljs-property\">style</span>.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-string\">'fivethirtyeight'</span>)\nplt.<span class=\"hljs-property\">rcParams</span>[<span class=\"hljs-string\">'figure.figsize'</span>] = (<span class=\"hljs-number\">15</span>, <span class=\"hljs-number\">8</span>)\n\nkf = <span class=\"hljs-title class_\">KalmanFilter</span>(\n    transition_matrices = [<span class=\"hljs-number\">1</span>],\n    observation_matrices = [<span class=\"hljs-number\">1</span>],\n    initial_state_mean = <span class=\"hljs-number\">0</span>,\n    initial_state_covariance = <span class=\"hljs-number\">1</span>,\n    observation_covariance=<span class=\"hljs-number\">1</span>,\n    transition_covariance=<span class=\"hljs-number\">0.01</span>\n)\nstate_means, _ = kf.<span class=\"hljs-title function_\">filter</span>(df.<span class=\"hljs-property\">values</span>)\nstate_means = pd.<span class=\"hljs-title class_\">Series</span>(state_means.<span class=\"hljs-title function_\">flatten</span>(), index=df.<span class=\"hljs-property\">index</span>)\n\n...\n\n<span class=\"hljs-title function_\">print</span>(signal)\n[<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, -<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, ...\n\nposition = []\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(signal)):\n    <span class=\"hljs-keyword\">if</span> signal[i] > <span class=\"hljs-number\">1</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">0</span>)\n    <span class=\"hljs-attr\">else</span>:\n        position.<span class=\"hljs-title function_\">append</span>(<span class=\"hljs-number\">1</span>)\n        \n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-title function_\">range</span>(<span class=\"hljs-title function_\">len</span>(df[<span class=\"hljs-string\">'Close'</span>])):\n    <span class=\"hljs-keyword\">if</span> signal[i] == <span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">1</span>\n    elif signal[i] == -<span class=\"hljs-number\">1</span>:\n        position[i] = <span class=\"hljs-number\">0</span>\n    <span class=\"hljs-attr\">else</span>:\n        position[i] = position[i-<span class=\"hljs-number\">1</span>]\n\nsma_20 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_20).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_20'</span>})\nsma_50 = pd.<span class=\"hljs-title class_\">DataFrame</span>(sma_50).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_50'</span>}) \nsignal = pd.<span class=\"hljs-title class_\">DataFrame</span>(signal).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_signal'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\nposition = pd.<span class=\"hljs-title class_\">DataFrame</span>(position).<span class=\"hljs-title function_\">rename</span>(columns = {<span class=\"hljs-number\">0</span>:<span class=\"hljs-string\">'sma_position'</span>}).<span class=\"hljs-title function_\">set_index</span>(df.<span class=\"hljs-property\">index</span>)\n\n...\n\n<span class=\"hljs-title function_\">print</span>(<span class=\"hljs-title function_\">cl</span>(<span class=\"hljs-string\">'100K달러를 BAC에 투자하여 전략으로 얻은 이익 : ${}'</span>.<span class=\"hljs-title function_\">format</span>(total_investment_ret), attrs = [<span class=\"hljs-string\">'bold'</span>]))\n\n100K달러를 <span class=\"hljs-variable constant_\">BAC</span>에 투자하여 전략으로 얻은 이익 : $13473<span class=\"hljs-number\">.41</span>\n</code></pre>\n<h2>더 알아보기</h2>\n<div class=\"content-ad\"></div>\n<ul>\n<li>신호/잡음 비율이 낮은 칼만 필터 기반 객체 추적</li>\n<li>칼만 필터를 사용한 대상 궤적 추적 성능 QC 분석</li>\n<li>견고한 1차원 칼만 필터의 해부학</li>\n<li>칼만 필터를 사용한 주식 시장 변동성 예측</li>\n</ul>\n<h2>참고 자료</h2>\n<ul>\n<li>파이썬에서 SMA를 이용한 알고리즘 트레이딩</li>\n<li>금융 분야에서의 칼만 필터 (KF)</li>\n<li>칼만 필터를 기반으로 한 트레이딩 전략 구현</li>\n<li>파이썬에서 칼만 필터, 칼만 스무서, EM 알고리즘 구현</li>\n<li>칼만 필터를 활용한 주식 거래 마스터하기: 포괄적인 가이드</li>\n<li>파이썬에서 주식 가격 예측을 위한 칼만 필터 사용</li>\n<li>주식 거래에서의 칼만 필터</li>\n<li>시장 탁계를 탐색하는 주식 분석에서의 칼만 필터</li>\n</ul>\n<h2>연락처</h2>\n<div class=\"content-ad\"></div>\n<ul>\n<li>웹사이트</li>\n<li>GitHub</li>\n<li>X/트위터</li>\n<li>핀터레스트</li>\n<li>마스토돈</li>\n<li>텀블러</li>\n</ul>\n</body>\n</html>\n"},"__N_SSG":true}