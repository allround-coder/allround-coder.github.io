{"pageProps":{"post":{"title":"Nodejs에서 Role-Based Access Control RBAC 구현하기","description":"","date":"2024-05-14 14:52","slug":"2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs","content":"\n\n역할 기반 액세스 제어 (RBAC)는 응용 프로그램 보안의 중요한 측면입니다. 조직 또는 응용 프로그램 내에서 사용자의 역할에 따라 리소스에 대한 액세스를 관리하고 제한하는 구조화된 접근 방식을 제공합니다. 이 포괄적인 안내서에서는 RBAC 개념을 탐색하고 혜택을 논의하며 Node.js 응용 프로그램에 RBAC를 구현하는 과정을 안내합니다. 이 글을 마치면 직접 프로젝트에 대해 RBAC를 설계하고 구현하는 방법을 명확히 이해할 수 있을 것입니다.\n\n![2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0](/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0.png)\n\n# 목차\n\n- 역할 기반 액세스 제어 (RBAC) 소개\n\n\n\n- RBAC이란 무엇인가요?\n- RBAC의 장점들\n\n- Node.js 환경 설정하기\n\n- 준비물\n- 프로젝트 구조\n\n- 예시 프로젝트: RBAC 실습하기\n\n\n\n- 간단한 업무 관리 시스템 구축\n- 역할 및 권한 정의\n- 인증 및 권한 부여 구현\n- RBAC 시스템 테스트\n\n- 최상의 실천 방법 및 보안 고려 사항\n\n- 데이터 유효성 검사\n- 감사 추적\n- 세분화된 권한\n- 정기적인 업데이트 및 모니터링\n\n- 결론\n\n\n\n# 1. 역할 기반 액세스 제어 (RBAC) 소개\n\n# RBAC란 무엇인가요?\n\n역할 기반 액세스 제어 (RBAC)은 시스템 액세스를 인가된 사용자로 제한하는 보안 개념입니다. RBAC에서는 액세스 권한이 역할과 연관되며 사용자에게 하나 이상의 역할이 할당됩니다. 이러한 역할은 사용자가 시스템 내에서 어떤 작업이나 작업을 수행할 수 있는지를 정의합니다.\n\nRBAC는 권한을 중앙 집중화하여 액세스 제어를 간소화하며, 관리자가 고수준에서 사용자 액세스를 관리할 수 있게 합니다. 사용자가 자신의 역할을 수행하는 데 필요한 권한만 갖도록 보장하여 보안을 강화하며, 무단 조치의 위험을 줄입니다.\n\n\n\n# 롤 기반 인증 이해하기\n\n롤 기반 인증은 사용자에게 역할을 할당하고 해당 역할에 따라 리소스에 대한 액세스를 결정하는 액세스 제어 방법입니다. 보통 각 역할에는 관련된 권한 집합이 있고, 사용자들은 할당된 역할에 기반하여 리소스에 액세스 권한이 부여됩니다.\n\n응용 프로그램에 따라 역할은 다양할 수 있지만 일반적으로 사용되는 역할은 다음과 같습니다:\n\n- Admin: 일반적으로 모든 기능에 액세스하고 관리 작업을 수행할 수 있는 관리 권한이 있는 사용자입니다.\n- User: 기본 기능 및 기능에 액세스 권한이 있는 표준 사용자입니다.\n- Moderator: 콘텐츠를 조절하거나 사용자를 관리하는 역할을 맡은 권한이 있는 사용자입니다.\n- Guest: 인증되지 않은 사용자로서 애플리케이션에 제한된 액세스 권한을 갖는 사용자입니다.\n\n\n\n# RBAC의 장점\n\nRBAC를 구현하면 다음과 같은 여러 가지 이점이 있습니다:\n\n- 보안: RBAC는 응용 프로그램 내에서 미인가된 액세스나 작업의 위험을 최소화하여 보안 취약점을 줄입니다.\n- 간편함: RBAC는 권한을 역할로 그룹화하여 사용자 액세스 관리를 간편하게 만들어 관리를 더 간편하게 합니다.\n- 확장성: RBAC는 매우 확장 가능하여 소규모 및 대규모 응용 프로그램에 모두 적합합니다.\n- 준수: GDPR 및 HIPAA와 같은 많은 규제 프레임워크는 RBAC와 같은 견고한 액세스 제어 메커니즘을 요구합니다.\n- 감사 기능: RBAC를 사용하면 사용자 작업을 추적하고 감사할 수 있어 보안 침해를 식별하는 데 중요합니다.\n\n이제 RBAC의 개념과 장점을 이해했으니, Node.js 애플리케이션에서 구현해 봅시다.\n\n\n\n# 2. Node.js 환경 설정하기\n\n# 요구 사항\n\nRBAC 구현에 들어가기 전에, 다음의 요구 사항이 갖춰져 있는지 확인해주세요:\n\n- 시스템에 Node.js가 설치되어 있어야 합니다.\n- 코드 편집기(예: Visual Studio Code)가 필요합니다.\n- JavaScript와 Node.js의 기본 지식이 요구됩니다.\n- Node.js 애플리케이션을 실행하기 위한 터미널 또는 명령 프롬프트가 있어야 합니다.\n- 의존성을 설치하기 위한 npm(Node Package Manager)이 필요합니다.\n\n\n\n# 프로젝트 구조\n\n이번 튜토리얼에서 사용할 기본 프로젝트 구조입니다:\n\n```js\nrbca/\n│\n├── helpers/\n│   ├── db.js\n│   ├── errorHandler.js\n│   ├── jwt.js\n│   └── role.js\n│\n├── models/\n│   └── user.js\n│\n├── public/\n│   └── stylesheets/\n│       └── style.css\n│\n├── routes/\n│   ├── index.js\n│   └── user.controllers.js\n│\n├── services/\n│   └── user.services.js\n│\n├── views/\n│   ├── error.jade\n│   ├── index.jade\n│   └── layout.jade\n│\n├── .gitignore\n├── README.md\n├── app.js\n├── config.json\n├── package-lock.json\n└── package.json\n```\n\n이 프로젝트 구조는 튜토리얼을 진행하면서 점진적으로 구성해 나갈 것입니다.\n\n\n\n# 의존성 설치\n\n```js\nnpm install bcryptjs@^2.4.3 cookie-parser@~1.4.4 cors@^2.8.5 debug@~2.6.9 express@~4.16.1 express-jwt@^6.0.0 http-errors@~1.6.3 jade@~1.11.0 jsonwebtoken@^8.5.1 mongoose@^5.9.25 morgan@~1.9.1 rootpath@^0.1.2 --save\n```\n\n# helpers/db.js:\n\n```js\nconst config = require(\"../config.json\");\nconst mongoose = require(\"mongoose\");\nconst conenctionOptions = {\n  useCreateIndex: true,\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n  useFindAndModify: false,\n};\ntry {\n  mongoose\n    .connect(\n      process.env.MONGODB_URI || config.connectionString,\n      conenctionOptions\n    )\n    .then((res) => console.log(`MOngoDB connected Successfully..!`));\n} catch (error) {\n  console.log(`MongoDB Error: `, error.message);\n  process.exit(1);\n}\n\nmongoose.Promise = global.Promise;\n\nmodule.exports = {\n  User: require(\"../models/user\"),\n};\n```\n\n\n\n- mongoose 모듈을 가져옵니다\n- 설정에서 데이터베이스 URL을 읽어옵니다\n- 연결 옵션을 설정합니다\n- 연결 및 오류 이벤트를 처리합니다\n- Promise 라이브러리를 구성합니다\n- 다른 곳에서 사용할 모델을 내보냅니다\n\nhelpers/errorHandler.js:\n\n```js\nfunction errorHandler(err, req, res, next) {\n  if (typeof err === \"string\") {\n    // 사용자 정의 애플리케이션 오류\n    return res.status(400).json({ message: err });\n  }\n  if (err.name === \"ValidationError\") {\n    // mongoose 유효성 검사 오류\n    return res.status(400).json({ message: err.message });\n  }\n\n  if (err.name === \"UnauthorizedError\") {\n    // jwt 인증 오류\n    return res.status(401).json({ message: \"잘못된 토큰\" });\n  }\n\n  // 기본적으로 500 서버 오류\n  return res.status(500).json({ message: err.message });\n}\n\nmodule.exports = errorHandler;\n```\n\nhelpers/jwt.js:\n\n\n\n```js\nconst expressJwt = require(\"express-jwt\");\nconst config = require(\"../config.json\");\nconst db = require(\"../helpers/db\");\n\nfunction jwt(roles = []) {\n  // roles 매개변수는 단일 역할 문자열 (예: Role.User 또는 'User')이거나 역할 배열 ([Role.Admin, Role.User] 또는 ['Admin', 'User'])일 수 있습니다.\n  if (typeof roles === \"string\") {\n    roles = [roles];\n    console.log(roles);\n  }\n\n  const secret = config.secret;\n\n  return [\n    // JWT 토큰을 인증하고 사용자를 요청 객체(req.user)에 추가합니다.\n    expressJwt({ secret, algorithms: [\"HS256\"] }),\n\n    // 사용자 역할에 따라 권한 부여\n    async (req, res, next) => {\n      const user = await db.User.findById(req.user.sub);\n\n      if (!user || (roles.length && !roles.includes(user.role))) {\n        // 사용자 역할이 허가되지 않았습니다.\n        return res.status(401).json({ message: \"Only Admin is Authorized!\" });\n      }\n      // 인증 및 권한 부여 성공\n      req.user.role = user.role;\n      next();\n    },\n  ];\n}\n\nmodule.exports = jwt;\n```\n\nhelpers/role.js:\n\n```js\nmodule.exports = {\n  Admin: \"Admin\",\n  User: \"User\",\n};\n```\n\nmodels/user.js:\n\n\n\n\n```js\nconst mongoose = require(\"mongoose\");\nconst Schema = mongoose.Schema;\n\nconst schema = new Schema({\n  email: { type: String, unique: true, required: true },\n  firstName: { type: String, required: true },\n  lastName: { type: String, required: true },\n  password: { type: String, required: true },\n  role: { type: String, required: true },\n  createdDate: { type: Date, default: Date.now },\n});\n\nschema.set(\"toJSON\", {\n  virtuals: true,\n  versionKey: false,\n  transform: function (doc, ret) {\n    delete ret._id, delete ret.password;\n  },\n});\n\nmodule.exports = mongoose.model(\"User\", schema);\n```\n\nroutes/index.js:\n\n```js\nvar express = require('express');\nvar router = express.Router();\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.render('index', { title: 'Express' });\n});\n\nmodule.exports = router;\n```\n\nroutes/user.controllers.js:\n\n\n\n\n```js\nconst express = require(\"express\");\nconst router = express.Router();\nconst userServices = require(\"../services/user.services\");\nconst Role = require(\"../helpers/role\");\nconst jwt = require(\"../helpers/jwt\");\n\n// 라우트\nrouter.post(\"/authenticate\", authenticate);\nrouter.post(\"/register\", register);\nrouter.get(\"/\", jwt(Role.Admin), getAll);\nrouter.get(\"/current\", jwt(), getCurrent);\nrouter.get(\"/:id\", getById);\nrouter.put(\"/:id\", update);\nrouter.delete(\"/:id\", _delete);\n\nmodule.exports = router;\n\n// 라우트 함수\nfunction authenticate(req, res, next) {\n  userServices\n    .authenticate(req.body)\n    .then((user) => {\n      console.log(user);\n      user\n        ? res.json({ user: user, message: \"사용자가 로그인되었습니다.\" })\n        : res\n            .status(400)\n            .json({ message: \"사용자 이름 또는 비밀번호가 잘못되었습니다.\" });\n    })\n    .catch((error) => next(error));\n}\n\nfunction register(req, res, next) {\n  userServices\n    .create(req.body)\n    .then((user) =>\n      res.json({\n        user: user,\n        message: `이메일 ${req.body.email}으로 성공적으로 등록되었습니다.`,\n      })\n    )\n    .catch((error) => next(error));\n}\n\nfunction getAll(req, res, next) {\n  const currentUser = req.user;\n\n  if (currentUser.role !== Role.Admin) {\n    return res.status(401).json({ message: \"권한이 없습니다!\" });\n  }\n  userServices\n    .getAll()\n    .then((users) => res.json(users))\n    .catch((err) => next(err));\n}\n\nfunction getCurrent(req, res, next) {\n  console.log(req);\n  userServices\n    .getById(req.user.sub)\n    .then((user) => (user ? res.json(user) : res.status(404)))\n    .catch((error) => next(error));\n}\n\nfunction getById(req, res, next) {\n  userServices\n    .getById(req.params.id)\n    .then((user) => {\n      if (!user) {\n        res.status(404).json({ message: \"사용자를 찾을 수 없습니다!\" });\n        next();\n      }\n      return res.json(user);\n    })\n    .catch((error) => next(error));\n}\n\nfunction update(req, res, next) {\n  userServices\n    .update(req.params.id, req.body)\n    .then(() =>\n      res.json({\n        message: `ID가 ${req.params.id}인 사용자가 성공적으로 업데이트되었습니다.`,\n      })\n    )\n    .catch((error) => next(error));\n}\n\nfunction _delete(req, res, next) {\n  userServices\n    .delete(req.params.id)\n    .then(() =>\n      res.json({\n        message: `ID가 ${req.params.id}인 사용자가 성공적으로 삭제되었습니다.`,\n      })\n    )\n    .catch((error) => next(error));\n}\n```\n\nservices/user.services.js:\n\n```js\nconst jwt = require(\"jsonwebtoken\");\nconst bcrypt = require(\"bcryptjs\");\nconst config = require(\"../config.json\");\nconst db = require(\"../helpers/db\");\nconst User = db.User;\n\n// 사용자 자격 증명을 인증하는 함수\nasync function authenticate({ email, password }) {\n  // 이메일로 사용자 찾기\n  const user = await User.findOne({ email });\n  console.log(\"사용자 모델\", user);\n  // 사용자가 있고 암호가 일치하면 토큰 생성\n  if (user && bcrypt.compareSync(password, user.password)) {\n    const token = jwt.sign({ sub: user.id, role: user.role }, config.secret, {\n      expiresIn: \"7d\",\n    });\n    \n    return { ...user.toJSON(), token };\n  }\n}\n\n// 모든 사용자 가져오기\nasync function getAll() {\n  return await User.find();\n}\n\n// ID를 사용하여 사용자 가져오기\nasync function getById(id) {\n  console.log(\"ID를 찾는 중: \", id);\n  return await User.findById(id);\n}\n\n// 사용자 추가\nasync function create(userParam) {\n  // 사용자가 있는지 확인\n  const user = await User.findOne({ email: userParam.email });\n  // 유효성 검사\n  if (user) throw `동일한 이메일이 이미 존재합니다: ${userParam.email}`;\n\n  // 사용자 객체 생성\n  const newUser = new User(userParam);\n  if (userParam.password) {\n    newUser.password = bcrypt.hashSync(userParam.password, 10);\n  }\n\n  await newUser.save();\n}\n\n// 사용자 업데이트\nasync function update(id, userParam) {\n  const user = await User.findById(id);\n  if (!user) throw \"사용자를 찾을 수 없습니다.\";\n  if (\n    user.email !== userParam.email &&\n    (await User.findOne({ email: userParam.email }))\n  ) {\n    throw `동일한 이메일을 가진 사용자가 이미 존재합니다: ${userParam.email}`;\n  }\n\n  if (userParam.password) {\n    userParam.password = bcrypt.hashSync(userParam.password, 10);\n  }\n\n  // 사용자 객체 복사\n  Object.assign(user, userParam);\n  await user.save();\n}\n\nasync function _delete(id) {\n  await User.findByIdAndRemove(id);\n}\n\nmodule.exports = {\n  authenticate,\n  getAll,\n  getById,\n  create,\n  update,\n  delete: _delete,\n};\n```\n\n\n\n```js\n레이아웃 확장\n\n콘텐츠 블록\n  h1= 메시지\n  h2= 오류 상태\n  pre #{error.stack}\n```\n\nviews/index.jade:\n\n```js\n레이아웃 확장\n\n콘텐츠 블록\n  h1= 제목\n  p 환영합니다 #{title}\n```\n\nviews/layout.jade:\n\n\n\n```json\n{\n  \"database\": {\n    \"host\": \"localhost\",\n    \"username\": \"admin\",\n    \"password\": \"password123\",\n    \"port\": 3306\n  },\n  \"server\": {\n    \"port\": 5000,\n    \"corsOptions\": {\n      \"origin\": \"*\"\n    }\n  }\n}\n```\n\n\n\n```json\n{\n  \"connectionString\": \"//당신의 MONGODB URI\",\n  \"secret\": \"//JWT 토큰을 위한 원하는 시크릿 키\"\n}\n```\n\n사용자 등록\n\n![사진](/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_1.png)\n\n사용자 인증\n\n\n\n\n![Current User](/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_2.png)\n\n![Unauthorize](/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_3.png)\n\n\n\n\n<img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_4.png\" />\n\n# 7. 모범 사례 및 보안 주의 사항\n\nNode.js 애플리케이션에서 RBAC를 구현할 때 다음 모범 사례와 보안 주의 사항을 고려해보세요:\n\n# 데이터 유효성 검사\n\n\n\n사용자 입력을 항상 유효성 검사하여 SQL 인젝션, XSS 공격 등과 같은 보안 취약점을 방지하세요. 데이터 무결성을 보장하기 위해 유효성 검사 라이브러리나 프레임워크를 사용하세요.\n\n## 감사 로그\n\n사용자 활동과 액세스 시도를 추적하기 위해 감사 로그를 구현하세요. 이는 보안 위반이나 무단 활동을 식별하는 데 중요할 수 있습니다.\n\n## 세분화된 권한\n\n\n\n사용자가 자신의 업무를 수행하는 데 필요한 최소한의 권한을 보장하기 위해 세밀한 권한을 정의하십시오. 역할에 권한을 너무 많이 할당하지 않도록 주의하십시오.\n\n## 정기적인 업데이트와 모니터링\n\nRBAC 시스템을 최신 상태로 유지하십시오. 응용 프로그램이 발전함에 따라 역할과 권한을 조정해야 할 수 있습니다. 보안을 유지하기 위해 정기적으로 RBAC 정책을 모니터링하고 검토하십시오.\n\n## 저와 소통하기:\n\n\n\nLinkedin: [https://www.linkedin.com/in/suneel-kumar-52164625a/](https://www.linkedin.com/in/suneel-kumar-52164625a/)\n\n# 8. 결론\n\n이 포괄적인 안내서에서는 Role-Based Access Control (RBAC)의 개념을 탐구하고 Node.js 애플리케이션에 구현하는 방법을 시연했습니다. 역할 및 권한 정의, 사용자 인증, 역할 할당, 역할 기반 미들웨어, 그리고 RBAC가 작동하는 방식을 보여 주기 위해 샘플 작업 관리 시스템을 만들었습니다.\n\nRBAC를 구현함으로써 Node.js 애플리케이션의 보안을 크게 향상시키고 사용자 액세스를 효과적으로 제어하며 보안 위협을 줄일 수 있습니다. 또한, 최적의 방법을 따르고 보안 고려 사항을 고려함으로써 RBAC 시스템의 견고성을 보장할 수 있습니다.","ogImage":{"url":"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0.png"},"coverImage":"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0.png","tag":["Tech"],"readingTime":13},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<p>역할 기반 액세스 제어 (RBAC)는 응용 프로그램 보안의 중요한 측면입니다. 조직 또는 응용 프로그램 내에서 사용자의 역할에 따라 리소스에 대한 액세스를 관리하고 제한하는 구조화된 접근 방식을 제공합니다. 이 포괄적인 안내서에서는 RBAC 개념을 탐색하고 혜택을 논의하며 Node.js 응용 프로그램에 RBAC를 구현하는 과정을 안내합니다. 이 글을 마치면 직접 프로젝트에 대해 RBAC를 설계하고 구현하는 방법을 명확히 이해할 수 있을 것입니다.</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0.png\" alt=\"2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_0\"></p>\n<h1>목차</h1>\n<ul>\n<li>\n<p>역할 기반 액세스 제어 (RBAC) 소개</p>\n</li>\n<li>\n<p>RBAC이란 무엇인가요?</p>\n</li>\n<li>\n<p>RBAC의 장점들</p>\n</li>\n<li>\n<p>Node.js 환경 설정하기</p>\n</li>\n<li>\n<p>준비물</p>\n</li>\n<li>\n<p>프로젝트 구조</p>\n</li>\n<li>\n<p>예시 프로젝트: RBAC 실습하기</p>\n</li>\n<li>\n<p>간단한 업무 관리 시스템 구축</p>\n</li>\n<li>\n<p>역할 및 권한 정의</p>\n</li>\n<li>\n<p>인증 및 권한 부여 구현</p>\n</li>\n<li>\n<p>RBAC 시스템 테스트</p>\n</li>\n<li>\n<p>최상의 실천 방법 및 보안 고려 사항</p>\n</li>\n<li>\n<p>데이터 유효성 검사</p>\n</li>\n<li>\n<p>감사 추적</p>\n</li>\n<li>\n<p>세분화된 권한</p>\n</li>\n<li>\n<p>정기적인 업데이트 및 모니터링</p>\n</li>\n<li>\n<p>결론</p>\n</li>\n</ul>\n<h1>1. 역할 기반 액세스 제어 (RBAC) 소개</h1>\n<h1>RBAC란 무엇인가요?</h1>\n<p>역할 기반 액세스 제어 (RBAC)은 시스템 액세스를 인가된 사용자로 제한하는 보안 개념입니다. RBAC에서는 액세스 권한이 역할과 연관되며 사용자에게 하나 이상의 역할이 할당됩니다. 이러한 역할은 사용자가 시스템 내에서 어떤 작업이나 작업을 수행할 수 있는지를 정의합니다.</p>\n<p>RBAC는 권한을 중앙 집중화하여 액세스 제어를 간소화하며, 관리자가 고수준에서 사용자 액세스를 관리할 수 있게 합니다. 사용자가 자신의 역할을 수행하는 데 필요한 권한만 갖도록 보장하여 보안을 강화하며, 무단 조치의 위험을 줄입니다.</p>\n<h1>롤 기반 인증 이해하기</h1>\n<p>롤 기반 인증은 사용자에게 역할을 할당하고 해당 역할에 따라 리소스에 대한 액세스를 결정하는 액세스 제어 방법입니다. 보통 각 역할에는 관련된 권한 집합이 있고, 사용자들은 할당된 역할에 기반하여 리소스에 액세스 권한이 부여됩니다.</p>\n<p>응용 프로그램에 따라 역할은 다양할 수 있지만 일반적으로 사용되는 역할은 다음과 같습니다:</p>\n<ul>\n<li>Admin: 일반적으로 모든 기능에 액세스하고 관리 작업을 수행할 수 있는 관리 권한이 있는 사용자입니다.</li>\n<li>User: 기본 기능 및 기능에 액세스 권한이 있는 표준 사용자입니다.</li>\n<li>Moderator: 콘텐츠를 조절하거나 사용자를 관리하는 역할을 맡은 권한이 있는 사용자입니다.</li>\n<li>Guest: 인증되지 않은 사용자로서 애플리케이션에 제한된 액세스 권한을 갖는 사용자입니다.</li>\n</ul>\n<h1>RBAC의 장점</h1>\n<p>RBAC를 구현하면 다음과 같은 여러 가지 이점이 있습니다:</p>\n<ul>\n<li>보안: RBAC는 응용 프로그램 내에서 미인가된 액세스나 작업의 위험을 최소화하여 보안 취약점을 줄입니다.</li>\n<li>간편함: RBAC는 권한을 역할로 그룹화하여 사용자 액세스 관리를 간편하게 만들어 관리를 더 간편하게 합니다.</li>\n<li>확장성: RBAC는 매우 확장 가능하여 소규모 및 대규모 응용 프로그램에 모두 적합합니다.</li>\n<li>준수: GDPR 및 HIPAA와 같은 많은 규제 프레임워크는 RBAC와 같은 견고한 액세스 제어 메커니즘을 요구합니다.</li>\n<li>감사 기능: RBAC를 사용하면 사용자 작업을 추적하고 감사할 수 있어 보안 침해를 식별하는 데 중요합니다.</li>\n</ul>\n<p>이제 RBAC의 개념과 장점을 이해했으니, Node.js 애플리케이션에서 구현해 봅시다.</p>\n<h1>2. Node.js 환경 설정하기</h1>\n<h1>요구 사항</h1>\n<p>RBAC 구현에 들어가기 전에, 다음의 요구 사항이 갖춰져 있는지 확인해주세요:</p>\n<ul>\n<li>시스템에 Node.js가 설치되어 있어야 합니다.</li>\n<li>코드 편집기(예: Visual Studio Code)가 필요합니다.</li>\n<li>JavaScript와 Node.js의 기본 지식이 요구됩니다.</li>\n<li>Node.js 애플리케이션을 실행하기 위한 터미널 또는 명령 프롬프트가 있어야 합니다.</li>\n<li>의존성을 설치하기 위한 npm(Node Package Manager)이 필요합니다.</li>\n</ul>\n<h1>프로젝트 구조</h1>\n<p>이번 튜토리얼에서 사용할 기본 프로젝트 구조입니다:</p>\n<pre><code class=\"hljs language-js\">rbca/\n│\n├── helpers/\n│   ├── db.<span class=\"hljs-property\">js</span>\n│   ├── errorHandler.<span class=\"hljs-property\">js</span>\n│   ├── jwt.<span class=\"hljs-property\">js</span>\n│   └── role.<span class=\"hljs-property\">js</span>\n│\n├── models/\n│   └── user.<span class=\"hljs-property\">js</span>\n│\n├── public/\n│   └── stylesheets/\n│       └── style.<span class=\"hljs-property\">css</span>\n│\n├── routes/\n│   ├── index.<span class=\"hljs-property\">js</span>\n│   └── user.<span class=\"hljs-property\">controllers</span>.<span class=\"hljs-property\">js</span>\n│\n├── services/\n│   └── user.<span class=\"hljs-property\">services</span>.<span class=\"hljs-property\">js</span>\n│\n├── views/\n│   ├── error.<span class=\"hljs-property\">jade</span>\n│   ├── index.<span class=\"hljs-property\">jade</span>\n│   └── layout.<span class=\"hljs-property\">jade</span>\n│\n├── .<span class=\"hljs-property\">gitignore</span>\n├── <span class=\"hljs-variable constant_\">README</span>.<span class=\"hljs-property\">md</span>\n├── app.<span class=\"hljs-property\">js</span>\n├── config.<span class=\"hljs-property\">json</span>\n├── package-lock.<span class=\"hljs-property\">json</span>\n└── package.<span class=\"hljs-property\">json</span>\n</code></pre>\n<p>이 프로젝트 구조는 튜토리얼을 진행하면서 점진적으로 구성해 나갈 것입니다.</p>\n<h1>의존성 설치</h1>\n<pre><code class=\"hljs language-js\">npm install bcryptjs@^<span class=\"hljs-number\">2.4</span><span class=\"hljs-number\">.3</span> cookie-parser@~<span class=\"hljs-number\">1.4</span><span class=\"hljs-number\">.4</span> cors@^<span class=\"hljs-number\">2.8</span><span class=\"hljs-number\">.5</span> debug@~<span class=\"hljs-number\">2.6</span><span class=\"hljs-number\">.9</span> express@~<span class=\"hljs-number\">4.16</span><span class=\"hljs-number\">.1</span> express-jwt@^<span class=\"hljs-number\">6.0</span><span class=\"hljs-number\">.0</span> http-errors@~<span class=\"hljs-number\">1.6</span><span class=\"hljs-number\">.3</span> jade@~<span class=\"hljs-number\">1.11</span><span class=\"hljs-number\">.0</span> jsonwebtoken@^<span class=\"hljs-number\">8.5</span><span class=\"hljs-number\">.1</span> mongoose@^<span class=\"hljs-number\">5.9</span><span class=\"hljs-number\">.25</span> morgan@~<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.1</span> rootpath@^<span class=\"hljs-number\">0.1</span><span class=\"hljs-number\">.2</span> --save\n</code></pre>\n<h1>helpers/db.js:</h1>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> config = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../config.json\"</span>);\n<span class=\"hljs-keyword\">const</span> mongoose = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"mongoose\"</span>);\n<span class=\"hljs-keyword\">const</span> conenctionOptions = {\n  <span class=\"hljs-attr\">useCreateIndex</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">useNewUrlParser</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">useUnifiedTopology</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">useFindAndModify</span>: <span class=\"hljs-literal\">false</span>,\n};\n<span class=\"hljs-keyword\">try</span> {\n  mongoose\n    .<span class=\"hljs-title function_\">connect</span>(\n      process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">MONGODB_URI</span> || config.<span class=\"hljs-property\">connectionString</span>,\n      conenctionOptions\n    )\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =></span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`MOngoDB connected Successfully..!`</span>));\n} <span class=\"hljs-keyword\">catch</span> (error) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`MongoDB Error: `</span>, error.<span class=\"hljs-property\">message</span>);\n  process.<span class=\"hljs-title function_\">exit</span>(<span class=\"hljs-number\">1</span>);\n}\n\nmongoose.<span class=\"hljs-property\">Promise</span> = <span class=\"hljs-variable language_\">global</span>.<span class=\"hljs-property\">Promise</span>;\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-title class_\">User</span>: <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../models/user\"</span>),\n};\n</code></pre>\n<ul>\n<li>mongoose 모듈을 가져옵니다</li>\n<li>설정에서 데이터베이스 URL을 읽어옵니다</li>\n<li>연결 옵션을 설정합니다</li>\n<li>연결 및 오류 이벤트를 처리합니다</li>\n<li>Promise 라이브러리를 구성합니다</li>\n<li>다른 곳에서 사용할 모델을 내보냅니다</li>\n</ul>\n<p>helpers/errorHandler.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">errorHandler</span>(<span class=\"hljs-params\">err, req, res, next</span>) {\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> err === <span class=\"hljs-string\">\"string\"</span>) {\n    <span class=\"hljs-comment\">// 사용자 정의 애플리케이션 오류</span>\n    <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">400</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: err });\n  }\n  <span class=\"hljs-keyword\">if</span> (err.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">\"ValidationError\"</span>) {\n    <span class=\"hljs-comment\">// mongoose 유효성 검사 오류</span>\n    <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">400</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: err.<span class=\"hljs-property\">message</span> });\n  }\n\n  <span class=\"hljs-keyword\">if</span> (err.<span class=\"hljs-property\">name</span> === <span class=\"hljs-string\">\"UnauthorizedError\"</span>) {\n    <span class=\"hljs-comment\">// jwt 인증 오류</span>\n    <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"잘못된 토큰\"</span> });\n  }\n\n  <span class=\"hljs-comment\">// 기본적으로 500 서버 오류</span>\n  <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">500</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: err.<span class=\"hljs-property\">message</span> });\n}\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = errorHandler;\n</code></pre>\n<p>helpers/jwt.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> expressJwt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"express-jwt\"</span>);\n<span class=\"hljs-keyword\">const</span> config = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../config.json\"</span>);\n<span class=\"hljs-keyword\">const</span> db = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../helpers/db\"</span>);\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">jwt</span>(<span class=\"hljs-params\">roles = []</span>) {\n  <span class=\"hljs-comment\">// roles 매개변수는 단일 역할 문자열 (예: Role.User 또는 'User')이거나 역할 배열 ([Role.Admin, Role.User] 또는 ['Admin', 'User'])일 수 있습니다.</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> roles === <span class=\"hljs-string\">\"string\"</span>) {\n    roles = [roles];\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(roles);\n  }\n\n  <span class=\"hljs-keyword\">const</span> secret = config.<span class=\"hljs-property\">secret</span>;\n\n  <span class=\"hljs-keyword\">return</span> [\n    <span class=\"hljs-comment\">// JWT 토큰을 인증하고 사용자를 요청 객체(req.user)에 추가합니다.</span>\n    <span class=\"hljs-title function_\">expressJwt</span>({ secret, <span class=\"hljs-attr\">algorithms</span>: [<span class=\"hljs-string\">\"HS256\"</span>] }),\n\n    <span class=\"hljs-comment\">// 사용자 역할에 따라 권한 부여</span>\n    <span class=\"hljs-keyword\">async</span> (req, res, next) => {\n      <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> db.<span class=\"hljs-property\">User</span>.<span class=\"hljs-title function_\">findById</span>(req.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">sub</span>);\n\n      <span class=\"hljs-keyword\">if</span> (!user || (roles.<span class=\"hljs-property\">length</span> &#x26;&#x26; !roles.<span class=\"hljs-title function_\">includes</span>(user.<span class=\"hljs-property\">role</span>))) {\n        <span class=\"hljs-comment\">// 사용자 역할이 허가되지 않았습니다.</span>\n        <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"Only Admin is Authorized!\"</span> });\n      }\n      <span class=\"hljs-comment\">// 인증 및 권한 부여 성공</span>\n      req.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">role</span> = user.<span class=\"hljs-property\">role</span>;\n      <span class=\"hljs-title function_\">next</span>();\n    },\n  ];\n}\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = jwt;\n</code></pre>\n<p>helpers/role.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-title class_\">Admin</span>: <span class=\"hljs-string\">\"Admin\"</span>,\n  <span class=\"hljs-title class_\">User</span>: <span class=\"hljs-string\">\"User\"</span>,\n};\n</code></pre>\n<p>models/user.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> mongoose = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"mongoose\"</span>);\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Schema</span> = mongoose.<span class=\"hljs-property\">Schema</span>;\n\n<span class=\"hljs-keyword\">const</span> schema = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Schema</span>({\n  <span class=\"hljs-attr\">email</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>, <span class=\"hljs-attr\">unique</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">firstName</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">lastName</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">password</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">role</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">String</span>, <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span> },\n  <span class=\"hljs-attr\">createdDate</span>: { <span class=\"hljs-attr\">type</span>: <span class=\"hljs-title class_\">Date</span>, <span class=\"hljs-attr\">default</span>: <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-property\">now</span> },\n});\n\nschema.<span class=\"hljs-title function_\">set</span>(<span class=\"hljs-string\">\"toJSON\"</span>, {\n  <span class=\"hljs-attr\">virtuals</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">versionKey</span>: <span class=\"hljs-literal\">false</span>,\n  <span class=\"hljs-attr\">transform</span>: <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">doc, ret</span>) {\n    <span class=\"hljs-keyword\">delete</span> ret.<span class=\"hljs-property\">_id</span>, <span class=\"hljs-keyword\">delete</span> ret.<span class=\"hljs-property\">password</span>;\n  },\n});\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = mongoose.<span class=\"hljs-title function_\">model</span>(<span class=\"hljs-string\">\"User\"</span>, schema);\n</code></pre>\n<p>routes/index.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'express'</span>);\n<span class=\"hljs-keyword\">var</span> router = express.<span class=\"hljs-title class_\">Router</span>();\n\n<span class=\"hljs-comment\">/* GET home page. */</span>\nrouter.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'/'</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  res.<span class=\"hljs-title function_\">render</span>(<span class=\"hljs-string\">'index'</span>, { <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">'Express'</span> });\n});\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = router;\n</code></pre>\n<p>routes/user.controllers.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"express\"</span>);\n<span class=\"hljs-keyword\">const</span> router = express.<span class=\"hljs-title class_\">Router</span>();\n<span class=\"hljs-keyword\">const</span> userServices = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../services/user.services\"</span>);\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">Role</span> = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../helpers/role\"</span>);\n<span class=\"hljs-keyword\">const</span> jwt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../helpers/jwt\"</span>);\n\n<span class=\"hljs-comment\">// 라우트</span>\nrouter.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">\"/authenticate\"</span>, authenticate);\nrouter.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">\"/register\"</span>, register);\nrouter.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">\"/\"</span>, <span class=\"hljs-title function_\">jwt</span>(<span class=\"hljs-title class_\">Role</span>.<span class=\"hljs-property\">Admin</span>), getAll);\nrouter.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">\"/current\"</span>, <span class=\"hljs-title function_\">jwt</span>(), getCurrent);\nrouter.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">\"/:id\"</span>, getById);\nrouter.<span class=\"hljs-title function_\">put</span>(<span class=\"hljs-string\">\"/:id\"</span>, update);\nrouter.<span class=\"hljs-title function_\">delete</span>(<span class=\"hljs-string\">\"/:id\"</span>, _delete);\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = router;\n\n<span class=\"hljs-comment\">// 라우트 함수</span>\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">authenticate</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  userServices\n    .<span class=\"hljs-title function_\">authenticate</span>(req.<span class=\"hljs-property\">body</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">user</span>) =></span> {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(user);\n      user\n        ? res.<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">user</span>: user, <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"사용자가 로그인되었습니다.\"</span> })\n        : res\n            .<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">400</span>)\n            .<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"사용자 이름 또는 비밀번호가 잘못되었습니다.\"</span> });\n    })\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">register</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  userServices\n    .<span class=\"hljs-title function_\">create</span>(req.<span class=\"hljs-property\">body</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">user</span>) =></span>\n      res.<span class=\"hljs-title function_\">json</span>({\n        <span class=\"hljs-attr\">user</span>: user,\n        <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">`이메일 <span class=\"hljs-subst\">${req.body.email}</span>으로 성공적으로 등록되었습니다.`</span>,\n      })\n    )\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getAll</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  <span class=\"hljs-keyword\">const</span> currentUser = req.<span class=\"hljs-property\">user</span>;\n\n  <span class=\"hljs-keyword\">if</span> (currentUser.<span class=\"hljs-property\">role</span> !== <span class=\"hljs-title class_\">Role</span>.<span class=\"hljs-property\">Admin</span>) {\n    <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">401</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"권한이 없습니다!\"</span> });\n  }\n  userServices\n    .<span class=\"hljs-title function_\">getAll</span>()\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">users</span>) =></span> res.<span class=\"hljs-title function_\">json</span>(users))\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">err</span>) =></span> <span class=\"hljs-title function_\">next</span>(err));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getCurrent</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(req);\n  userServices\n    .<span class=\"hljs-title function_\">getById</span>(req.<span class=\"hljs-property\">user</span>.<span class=\"hljs-property\">sub</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">user</span>) =></span> (user ? res.<span class=\"hljs-title function_\">json</span>(user) : res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">404</span>)))\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getById</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  userServices\n    .<span class=\"hljs-title function_\">getById</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">user</span>) =></span> {\n      <span class=\"hljs-keyword\">if</span> (!user) {\n        res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">404</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">\"사용자를 찾을 수 없습니다!\"</span> });\n        <span class=\"hljs-title function_\">next</span>();\n      }\n      <span class=\"hljs-keyword\">return</span> res.<span class=\"hljs-title function_\">json</span>(user);\n    })\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">update</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  userServices\n    .<span class=\"hljs-title function_\">update</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>, req.<span class=\"hljs-property\">body</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =></span>\n      res.<span class=\"hljs-title function_\">json</span>({\n        <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">`ID가 <span class=\"hljs-subst\">${req.params.id}</span>인 사용자가 성공적으로 업데이트되었습니다.`</span>,\n      })\n    )\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_delete</span>(<span class=\"hljs-params\">req, res, next</span>) {\n  userServices\n    .<span class=\"hljs-title function_\">delete</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>)\n    .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =></span>\n      res.<span class=\"hljs-title function_\">json</span>({\n        <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">`ID가 <span class=\"hljs-subst\">${req.params.id}</span>인 사용자가 성공적으로 삭제되었습니다.`</span>,\n      })\n    )\n    .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =></span> <span class=\"hljs-title function_\">next</span>(error));\n}\n</code></pre>\n<p>services/user.services.js:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> jwt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"jsonwebtoken\"</span>);\n<span class=\"hljs-keyword\">const</span> bcrypt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"bcryptjs\"</span>);\n<span class=\"hljs-keyword\">const</span> config = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../config.json\"</span>);\n<span class=\"hljs-keyword\">const</span> db = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"../helpers/db\"</span>);\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">User</span> = db.<span class=\"hljs-property\">User</span>;\n\n<span class=\"hljs-comment\">// 사용자 자격 증명을 인증하는 함수</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">authenticate</span>(<span class=\"hljs-params\">{ email, password }</span>) {\n  <span class=\"hljs-comment\">// 이메일로 사용자 찾기</span>\n  <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findOne</span>({ email });\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"사용자 모델\"</span>, user);\n  <span class=\"hljs-comment\">// 사용자가 있고 암호가 일치하면 토큰 생성</span>\n  <span class=\"hljs-keyword\">if</span> (user &#x26;&#x26; bcrypt.<span class=\"hljs-title function_\">compareSync</span>(password, user.<span class=\"hljs-property\">password</span>)) {\n    <span class=\"hljs-keyword\">const</span> token = jwt.<span class=\"hljs-title function_\">sign</span>({ <span class=\"hljs-attr\">sub</span>: user.<span class=\"hljs-property\">id</span>, <span class=\"hljs-attr\">role</span>: user.<span class=\"hljs-property\">role</span> }, config.<span class=\"hljs-property\">secret</span>, {\n      <span class=\"hljs-attr\">expiresIn</span>: <span class=\"hljs-string\">\"7d\"</span>,\n    });\n    \n    <span class=\"hljs-keyword\">return</span> { ...user.<span class=\"hljs-title function_\">toJSON</span>(), token };\n  }\n}\n\n<span class=\"hljs-comment\">// 모든 사용자 가져오기</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getAll</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">find</span>();\n}\n\n<span class=\"hljs-comment\">// ID를 사용하여 사용자 가져오기</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getById</span>(<span class=\"hljs-params\">id</span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"ID를 찾는 중: \"</span>, id);\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findById</span>(id);\n}\n\n<span class=\"hljs-comment\">// 사용자 추가</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">create</span>(<span class=\"hljs-params\">userParam</span>) {\n  <span class=\"hljs-comment\">// 사용자가 있는지 확인</span>\n  <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findOne</span>({ <span class=\"hljs-attr\">email</span>: userParam.<span class=\"hljs-property\">email</span> });\n  <span class=\"hljs-comment\">// 유효성 검사</span>\n  <span class=\"hljs-keyword\">if</span> (user) <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-string\">`동일한 이메일이 이미 존재합니다: <span class=\"hljs-subst\">${userParam.email}</span>`</span>;\n\n  <span class=\"hljs-comment\">// 사용자 객체 생성</span>\n  <span class=\"hljs-keyword\">const</span> newUser = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span>(userParam);\n  <span class=\"hljs-keyword\">if</span> (userParam.<span class=\"hljs-property\">password</span>) {\n    newUser.<span class=\"hljs-property\">password</span> = bcrypt.<span class=\"hljs-title function_\">hashSync</span>(userParam.<span class=\"hljs-property\">password</span>, <span class=\"hljs-number\">10</span>);\n  }\n\n  <span class=\"hljs-keyword\">await</span> newUser.<span class=\"hljs-title function_\">save</span>();\n}\n\n<span class=\"hljs-comment\">// 사용자 업데이트</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">update</span>(<span class=\"hljs-params\">id, userParam</span>) {\n  <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findById</span>(id);\n  <span class=\"hljs-keyword\">if</span> (!user) <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-string\">\"사용자를 찾을 수 없습니다.\"</span>;\n  <span class=\"hljs-keyword\">if</span> (\n    user.<span class=\"hljs-property\">email</span> !== userParam.<span class=\"hljs-property\">email</span> &#x26;&#x26;\n    (<span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findOne</span>({ <span class=\"hljs-attr\">email</span>: userParam.<span class=\"hljs-property\">email</span> }))\n  ) {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-string\">`동일한 이메일을 가진 사용자가 이미 존재합니다: <span class=\"hljs-subst\">${userParam.email}</span>`</span>;\n  }\n\n  <span class=\"hljs-keyword\">if</span> (userParam.<span class=\"hljs-property\">password</span>) {\n    userParam.<span class=\"hljs-property\">password</span> = bcrypt.<span class=\"hljs-title function_\">hashSync</span>(userParam.<span class=\"hljs-property\">password</span>, <span class=\"hljs-number\">10</span>);\n  }\n\n  <span class=\"hljs-comment\">// 사용자 객체 복사</span>\n  <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">assign</span>(user, userParam);\n  <span class=\"hljs-keyword\">await</span> user.<span class=\"hljs-title function_\">save</span>();\n}\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">_delete</span>(<span class=\"hljs-params\">id</span>) {\n  <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">User</span>.<span class=\"hljs-title function_\">findByIdAndRemove</span>(id);\n}\n\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  authenticate,\n  getAll,\n  getById,\n  create,\n  update,\n  <span class=\"hljs-attr\">delete</span>: _delete,\n};\n</code></pre>\n<pre><code class=\"hljs language-js\">레이아웃 확장\n\n콘텐츠 블록\n  h1= 메시지\n  h2= 오류 상태\n  pre #{error.<span class=\"hljs-property\">stack</span>}\n</code></pre>\n<p>views/index.jade:</p>\n<pre><code class=\"hljs language-js\">레이아웃 확장\n\n콘텐츠 블록\n  h1= 제목\n  p 환영합니다 #{title}\n</code></pre>\n<p>views/layout.jade:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"database\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"host\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"localhost\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"username\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"admin\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"password\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"password123\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"port\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">3306</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"server\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"port\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">5000</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"corsOptions\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"origin\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"*\"</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"connectionString\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"//당신의 MONGODB URI\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"secret\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"//JWT 토큰을 위한 원하는 시크릿 키\"</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>사용자 등록</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_1.png\" alt=\"사진\"></p>\n<p>사용자 인증</p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_2.png\" alt=\"Current User\"></p>\n<p><img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_3.png\" alt=\"Unauthorize\"></p>\n<img src=\"/assets/img/2024-05-14-ImplementingRole-BasedAccessControlRBACinNodejs_4.png\">\n<h1>7. 모범 사례 및 보안 주의 사항</h1>\n<p>Node.js 애플리케이션에서 RBAC를 구현할 때 다음 모범 사례와 보안 주의 사항을 고려해보세요:</p>\n<h1>데이터 유효성 검사</h1>\n<p>사용자 입력을 항상 유효성 검사하여 SQL 인젝션, XSS 공격 등과 같은 보안 취약점을 방지하세요. 데이터 무결성을 보장하기 위해 유효성 검사 라이브러리나 프레임워크를 사용하세요.</p>\n<h2>감사 로그</h2>\n<p>사용자 활동과 액세스 시도를 추적하기 위해 감사 로그를 구현하세요. 이는 보안 위반이나 무단 활동을 식별하는 데 중요할 수 있습니다.</p>\n<h2>세분화된 권한</h2>\n<p>사용자가 자신의 업무를 수행하는 데 필요한 최소한의 권한을 보장하기 위해 세밀한 권한을 정의하십시오. 역할에 권한을 너무 많이 할당하지 않도록 주의하십시오.</p>\n<h2>정기적인 업데이트와 모니터링</h2>\n<p>RBAC 시스템을 최신 상태로 유지하십시오. 응용 프로그램이 발전함에 따라 역할과 권한을 조정해야 할 수 있습니다. 보안을 유지하기 위해 정기적으로 RBAC 정책을 모니터링하고 검토하십시오.</p>\n<h2>저와 소통하기:</h2>\n<p>Linkedin: <a href=\"https://www.linkedin.com/in/suneel-kumar-52164625a/\" rel=\"nofollow\" target=\"_blank\">https://www.linkedin.com/in/suneel-kumar-52164625a/</a></p>\n<h1>8. 결론</h1>\n<p>이 포괄적인 안내서에서는 Role-Based Access Control (RBAC)의 개념을 탐구하고 Node.js 애플리케이션에 구현하는 방법을 시연했습니다. 역할 및 권한 정의, 사용자 인증, 역할 할당, 역할 기반 미들웨어, 그리고 RBAC가 작동하는 방식을 보여 주기 위해 샘플 작업 관리 시스템을 만들었습니다.</p>\n<p>RBAC를 구현함으로써 Node.js 애플리케이션의 보안을 크게 향상시키고 사용자 액세스를 효과적으로 제어하며 보안 위협을 줄일 수 있습니다. 또한, 최적의 방법을 따르고 보안 고려 사항을 고려함으로써 RBAC 시스템의 견고성을 보장할 수 있습니다.</p>\n</body>\n</html>\n"},"__N_SSG":true}