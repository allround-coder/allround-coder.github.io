{"pageProps":{"post":{"title":"Nextjs 14 앱에서 NextAuth와 Prisma로 인증 구현하는 방법","description":"","date":"2024-06-22 03:25","slug":"2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma","content":"\n\n<img src=\"/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_0.png\" />\n\n안녕하세요! 이번 튜토리얼에서는 NextJS 앱에 인증을 추가하는 방법을 Next Auth를 사용하여 보여드릴 거에요. 저는 NextJS 애플리케이션을 실행하기 위해 런타임으로 bun을 사용할 거에요.\n\nStep I : Next 14 프로젝트 설정하기\n\n```js\nbunx create-next-app@latest next-auth-prisma\n```\n\n<div class=\"content-ad\"></div>\n\n위의 명령어를 입력하시거나 프로젝트 설정을 위해 NextJS의 공식 문서를 참고하시면 됩니다.\n\n단계 II: NextAuth API route 설정\n\nNext 앱을 설치한 후에는 다음 명령어를 통해 앱 안에 next-auth 패키지를 설치해야 합니다.\n\n```js\nbun add next-auth\n```\n\n<div class=\"content-ad\"></div>\n\n이제 다음 인증에 사용할 인증 옵션을 구성해야 합니다. 기본 폴더로 이동하여 lib라는 새 폴더를 만들고 lib 폴더 안에 auth.ts라는 새 파일을 만들고 다음 코드를 복사하세요.\n\n/lib/auth.ts\n\n```js\nimport type { NextAuthOptions } from \"next-auth\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\n\nexport const authOptions: NextAuthOptions = {\n  session: {\n    strategy: \"jwt\",\n  },\n  providers: [\n    CredentialsProvider({\n      name: \"Email and Password\",\n      credentials: {\n        email: {\n          label: \"Email\",\n          type: \"email\",\n          placeholder: \"example@example.com\",\n        },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        const user = { id: \"1\", name: \"Admin\", email: \"admin@admin.com\" };\n        return user;\n      },\n    }),\n  ],\n};\n```\n\n위 코드는 다음 인증 구성 설정 프로세스를 보여줍니다. 저는 next-auth에서 CredentialsProvider를 사용했지만 Google, Github, Facebook 등의 다른 프로바이더를 사용할 수 있습니다. 이러한 프로바이더를 구현하려면 해당 프로바이더의 구성에 대해 공식 문서를 참조하세요.\n\n<div class=\"content-ad\"></div>\n\n지금 자격 증명 객체에는 로그인 양식에 표시되는 이메일과 비밀번호가 필드로 포함되어 있습니다. 인증 단계에는 목업 사용자 객체를 반환하는 더미 자격 증명이 있습니다.\n\n다음 단계는 NextAuth에서 인증 요청을 처리하는 API 경로를 생성하는 것입니다. 시작하려면 앱 디렉토리 내에 api라는 새 폴더를 만들고 그 안에 auth라는 새 폴더를 만들어주시고 auth 내부에 catch-all-routes 폴더 [...nextauth]을 만든 다음 auth 폴더 내에 route.ts라는 이름의 파일을 만들어주시고 다음 코드를 붙여넣어주세요.\n\n/app/api/auth/[…nextauth]/route.ts\n\n```js\nimport { authOptions } from \"@/lib/auth\";\nimport NextAuth from \"next-auth\";\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n```\n\n<div class=\"content-ad\"></div>\n\n프렌들리하게 번역하면 다음과 같습니다:\n\n우리는 이전에 NextAuth 함수 안에서 미리 구성한 authOptions를 가져왔고, next auth 핸들러를 내보냈습니다.\n\n3단계: 버튼 만들기\n\n애플리케이션의 페이지 간 이동을 쉽게 하기 위해 브라우저에 수동으로 URL을 입력하는 대신 버튼을 만들겠습니다. 기본 폴더 내에 components라는 새 폴더를 만들고 buttons.component.tsx라는 파일을 생성하세요.\n\n/components/buttons.component.tsx\n\n<div class=\"content-ad\"></div>\n\n```js\n\"use client\";\n\nimport { signIn, signOut } from \"next-auth/react\";\nimport Link from \"next/link\";\n\nexport const LoginButton = () => {\n  return (\n    <button style={ marginRight: 10 } onClick={() => signIn()}>\n      Sign in\n    </button>\n  );\n};\n\nexport const RegisterButton = () => {\n  return (\n    <Link href=\"/register\" style={ marginRight: 10 }>\n      Register\n    </Link>\n  );\n};\n\nexport const LogoutButton = () => {\n  return (\n    <button style={ marginRight: 10 } onClick={() => signOut()}>\n      Sign Out\n    </button>\n  );\n};\n\nexport const ProfileButton = () => {\n  return <Link href=\"/profile\">Profile</Link>;\n};\n```\n\n이제 홈 컴포넌트에서 버튼들을 import하세요.\n\n```js\nimport {\n  LoginButton,\n  LogoutButton,\n  ProfileButton,\n  RegisterButton,\n} from \"@/components/buttons.component\";\n\nexport default function Home() {\n  return (\n    <main\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        height: \"70vh\",\n      }}\n    >\n      <div>\n        <LoginButton />\n        <RegisterButton />\n        <LogoutButton />\n        <ProfileButton />\n      </div>\n    </main>\n  );\n}\n```\n\n이제 NextAuth에서 JWT 인증을 추가해야 하므로 프로젝트의 루트 디렉토리 내 .env 파일에 JWT의 시크릿을 정의해야 합니다.\n\n\n<div class=\"content-ad\"></div>\n\n```yaml\n#.env\n\nNEXTAUTH_SECRET=secret\nNEXTAUTH_URL=http://localhost:3000\n\n이제 http://localhost:3000/를 방문하여 애플리케이션에 액세스하고 홈페이지에서 클릭하여 로그인 버튼을 누르면 로그인 양식으로 이동합니다.\n\n![이미지](/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_1.png)\n```\n\n<div class=\"content-ad\"></div>\n\nWe have mock credentials, so feel free to use any email and password to submit the form. Once the submission is successful, you will be redirected back to the home page. At that point, you can view the application's cookies.\n\n![Cookie Image](/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_2.png)\n\nStep IV: Integrating with database\n\nFor real-world users, we need to connect to a database. I will be using PostgreSQL as the database and Prisma as the ORM.\n\n<div class=\"content-ad\"></div>\n\n새 데이터베이스를 생성하고 데이터베이스 URL을 .env 파일에 넣으세요\n\n```js\nDATABASE_URL=postgresql://postgres:pawan123@localhost:5432/next-auth?schema=public\n```\n\n이제 다음 명령어를 사용하여 prisma ORM과 bcryptjs를 설치하여 사용자 비밀번호를 해싱하세요.\n\n```js\nnpm add @prisma/client bcryptjs && npm add -D ts-node prisma @types/bcryptjs\n```\n\n<div class=\"content-ad\"></div>\n\n프리즈마를 설정하고 포스트그리스 데이터베이스에 연결하려면 다음 명령을 실행하여 프로젝트에서 프리즈마를 초기화하고 포스트그레스SQL용 데이터 소스를 만드세요.\n\n```js\nnpx prisma init --datasource-provider postgresql\n```\n\n이제 schema.prisma 파일 내에 User 모델을 만들어보세요.\n\n```js\n// 이것은 당신의 프리즈마 스키마 파일입니다.\n// 자세한 내용은 다음 문서에서 확인하세요: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel User {\n  id       String @id @default(uuid())\n  name     String\n  email    String @unique\n  password String\n}\n```\n\n<div class=\"content-ad\"></div>\n\n이제 새 사용자를 생성하고 데이터베이스에 저장하는 등록 기능을 만들 수 있지만, 나는 직접 데이터베이스에 사용자를 입력할 것이다. 시작하려면 prisma 디렉토리에 seed.ts 파일을 만들고 아래 코드를 복사해 넣어라.\n\nprisma/seed.ts\n\n```js\nimport { PrismaClient } from \"@prisma/client\";\nimport { hash } from \"bcryptjs\";\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  const password = await hash(\"password123\", 12);\n  const user = await prisma.user.upsert({\n    where: { email: \"admin@admin.com\" },\n    update: {},\n    create: {\n      email: \"admin@admin.com\",\n      name: \"Admin\",\n      password,\n    },\n  });\n  console.log({ user });\n}\nmain()\n  .then(() => prisma.$disconnect())\n  .catch(async (e) => {\n    console.error(e);\n    await prisma.$disconnect();\n    process.exit(1);\n  });\n```\n\n쉽게 테스트 사용자로 데이터베이스에 시드(seed)를 생성할 수 있도록 하기 위해 package.json 파일에 스크립트를 추가할 것이다. 파일을 열어 다음 스크립트를 추가하라:\n\n<div class=\"content-ad\"></div>\n\n```json\n{\n    \"prisma\": {\n        \"seed\": \"ts-node --compiler-options {\\\"module\\\":\\\"CommonJS\\\"} prisma/seed.ts\"\n    }\n}\n```\n\n이제 다음 명령을 사용하여 마이그레이션을 생성하고 사용자 스키마를 데이터베이스에 푸시하세요.\n\n```js\nnpx prisma migrate dev --name init\n```\n\n마이그레이션을 생성한 후 다음 명령을 사용하여 데이터베이스에 사용자를 시드하세요.\n\n<div class=\"content-ad\"></div>\n\n```js\nnpx prisma db seed\n```\n\n이제 PostgreSQL 데이터베이스와 통신할 수 있도록 @prisma/client 패키지를 사용하여 전역 PrismaClient 인스턴스를 생성할 것입니다. 이를 위해 lib 폴더 안에 prisma.ts라는 파일을 만들고 다음 코드를 추가해주세요.\n\n```js\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: [\"query\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n```\n\nPrisma와 데이터베이스 설정을 완료했으니, 이제 auth.ts 파일에서 로그인 양식을 인증할 것입니다.\n\n<div class=\"content-ad\"></div>\n\n```js\nimport { prisma } from \"@/lib/prisma\";\nimport { compare } from \"bcryptjs\";\nimport type { NextAuthOptions } from \"next-auth\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\n\nexport const authOptions: NextAuthOptions = {\n  session: {\n    strategy: \"jwt\",\n  },\n  providers: [\n    CredentialsProvider({\n      name: \"로그인\",\n      credentials: {\n        email: {\n          label: \"이메일\",\n          type: \"email\",\n          placeholder: \"example@example.com\",\n        },\n        password: { label: \"비밀번호\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: {\n            email: credentials.email,\n          },\n        });\n\n        if (!user || !(await compare(credentials.password, user.password))) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          randomKey: \"일부 랜덤 키\",\n        };\n      },\n    }),\n  ],\n};\n```\n\n이제 사용자 정의 키를 추가할 수 있습니다. 다음은 NextAuth 구성의 콜백 속성에서 콜백을 수정하는 방법입니다. 이렇게 하면 세션 개체와 JWT에 필요한 정보를 포함시킬 수 있으며 응용 프로그램에 언제든지 어디서나 액세스할 수 있습니다.\n\n```js\ncallbacks: {\n    session: ({ session, token }) => {\n      console.log(\"세션 콜백\", { session, token });\n      return {\n        ...session,\n        user: {\n          ...session.user,\n          id: token.id,\n          randomKey: token.randomKey,\n        },\n      };\n    },\n    jwt: ({ token, user }) => {\n      console.log(\"JWT 콜백\", { token, user });\n      if (user) {\n        const u = user as unknown as any;\n        return {\n          ...token,\n          id: u.id,\n          randomKey: u.randomKey,\n        };\n      }\n      return token;\n    },\n  },\n```\n\nStep V: NextAuth 세션 데이터 가져오기\n\n\n<div class=\"content-ad\"></div>\n\nnext 앱 내에서 권한이 부여된 사용자 세션 데이터를 얻는 두 가지 방법이 있습니다.\n\ni. 서버 컴포넌트에서\n\n서버 컴포넌트 내에서 세션 데이터를 가져오기 위해 getServerSession 함수를 사용할 수 있습니다.\n\n```js\nimport {\n  LoginButton,\n  LogoutButton,\n  ProfileButton,\n  RegisterButton,\n} from \"@/components/buttons.component\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\n\nexport default async function Home() {\n  const session = await getServerSession(authOptions);\n  console.log(session);\n\n  return (\n    <main\n      style={{\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        height: \"70vh\",\n      }}\n    >\n      <div>\n        <LoginButton />\n        <RegisterButton />\n        <LogoutButton />\n        <ProfileButton />\n\n        <h1>Server Session</h1>\n        <pre>{JSON.stringify(session)}</pre>\n      </div>\n    </main>\n  );\n}\n```\n\n<div class=\"content-ad\"></div>\n\n서버 페이지를 무단 사용자로부터 보호하기 위해 미인가 사용자를 signin 페이지로 리다이렉트하는 다음 코드를 사용할 수 있습니다.\n\n```js\nif (!session) {\n    redirect(\"/api/auth/signin\");\n}\n```\n\nii. 클라이언트 컴포넌트\n\n클라이언트 컴포넌트에서 세션 데이터를 검색하려면 next auth에서 제공하는 세션 제공자를 사용하고 앱을 세션 제공자로 래핑해야 합니다.\n\n<div class=\"content-ad\"></div>\n\n기본 디렉토리에 providers 폴더를 만들고, NextAuthProvider.tsx라는 새 파일을 생성한 다음 아래 코드를 붙여넣어주세요.\n\n```js\n\"use client\";\n\nimport { SessionProvider } from \"next-auth/react\";\n\ntype Props = {\n  children?: React.ReactNode;\n};\n\nexport const NextAuthProvider = ({ children }: Props) => {\n  return <SessionProvider>{children}</SessionProvider>;\n};\n```\n\n이제 layout.tsx 파일에서 프로바이더를 감싸주세요.\n\n```js\nimport { NextAuthProvider } from \"./providers/NextAuthProvider\";\n\nexport const metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <html lang=\"en\">\n      <body>\n        <NextAuthProvider>{children}</NextAuthProvider>\n      </body>\n    </html>\n  );\n}\n```\n\n<div class=\"content-ad\"></div>\n\n이제 세션 데이터를 가져오는 클라이언트 컴포넌트를 생성해보세요.\n\n```js\n\"use client\";\n\nimport { useSession } from \"next-auth/react\";\n\nexport const User = () => {\n  const { data: session } = useSession();\n\n  return (\n    <>\n      <h1>Client Session</h1>\n      <pre>{JSON.stringify(session)}</pre>\n    </>\n  );\n};\n```\n\n이제 권한이 없는 사용자로부터 클라이언트 컴포넌트를 보호하기 위해 아래 코드를 클라이언트 컴포넌트에 붙여넣어주세요.\n\n```js\nconst { status } = useSession({\n    required: true,\n    onUnauthenticated() {\n      redirect(\"/api/auth/signin\");\n    },\n  });\n\n  if (status === \"loading\") {\n    return <p>Loading....</p>;\n  }\n```\n\n<div class=\"content-ad\"></div>\n\n결론\n\n이 튜토리얼에서는 NextAuth를 새로운 Next.js 14 앱에 통합하는 방법에 대해 배웠습니다. 이 글이 유익하고 즐거웠기를 바랍니다. 피드백이나 질문이 있으면 언제든 댓글을 남겨주세요.","ogImage":{"url":"/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_0.png"},"coverImage":"/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_0.png","tag":["Tech"],"readingTime":12},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<img src=\"/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_0.png\">\n<p>안녕하세요! 이번 튜토리얼에서는 NextJS 앱에 인증을 추가하는 방법을 Next Auth를 사용하여 보여드릴 거에요. 저는 NextJS 애플리케이션을 실행하기 위해 런타임으로 bun을 사용할 거에요.</p>\n<p>Step I : Next 14 프로젝트 설정하기</p>\n<pre><code class=\"hljs language-js\">bunx create-next-app@latest next-auth-prisma\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>위의 명령어를 입력하시거나 프로젝트 설정을 위해 NextJS의 공식 문서를 참고하시면 됩니다.</p>\n<p>단계 II: NextAuth API route 설정</p>\n<p>Next 앱을 설치한 후에는 다음 명령어를 통해 앱 안에 next-auth 패키지를 설치해야 합니다.</p>\n<pre><code class=\"hljs language-js\">bun add next-auth\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>이제 다음 인증에 사용할 인증 옵션을 구성해야 합니다. 기본 폴더로 이동하여 lib라는 새 폴더를 만들고 lib 폴더 안에 auth.ts라는 새 파일을 만들고 다음 코드를 복사하세요.</p>\n<p>/lib/auth.ts</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> type { <span class=\"hljs-title class_\">NextAuthOptions</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">CredentialsProvider</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth/providers/credentials\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">authOptions</span>: <span class=\"hljs-title class_\">NextAuthOptions</span> = {\n  <span class=\"hljs-attr\">session</span>: {\n    <span class=\"hljs-attr\">strategy</span>: <span class=\"hljs-string\">\"jwt\"</span>,\n  },\n  <span class=\"hljs-attr\">providers</span>: [\n    <span class=\"hljs-title class_\">CredentialsProvider</span>({\n      <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"Email and Password\"</span>,\n      <span class=\"hljs-attr\">credentials</span>: {\n        <span class=\"hljs-attr\">email</span>: {\n          <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"Email\"</span>,\n          <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"email\"</span>,\n          <span class=\"hljs-attr\">placeholder</span>: <span class=\"hljs-string\">\"example@example.com\"</span>,\n        },\n        <span class=\"hljs-attr\">password</span>: { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"Password\"</span>, <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"password\"</span> },\n      },\n      <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">authorize</span>(<span class=\"hljs-params\">credentials</span>) {\n        <span class=\"hljs-keyword\">const</span> user = { <span class=\"hljs-attr\">id</span>: <span class=\"hljs-string\">\"1\"</span>, <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"Admin\"</span>, <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">\"admin@admin.com\"</span> };\n        <span class=\"hljs-keyword\">return</span> user;\n      },\n    }),\n  ],\n};\n</code></pre>\n<p>위 코드는 다음 인증 구성 설정 프로세스를 보여줍니다. 저는 next-auth에서 CredentialsProvider를 사용했지만 Google, Github, Facebook 등의 다른 프로바이더를 사용할 수 있습니다. 이러한 프로바이더를 구현하려면 해당 프로바이더의 구성에 대해 공식 문서를 참조하세요.</p>\n<div class=\"content-ad\"></div>\n<p>지금 자격 증명 객체에는 로그인 양식에 표시되는 이메일과 비밀번호가 필드로 포함되어 있습니다. 인증 단계에는 목업 사용자 객체를 반환하는 더미 자격 증명이 있습니다.</p>\n<p>다음 단계는 NextAuth에서 인증 요청을 처리하는 API 경로를 생성하는 것입니다. 시작하려면 앱 디렉토리 내에 api라는 새 폴더를 만들고 그 안에 auth라는 새 폴더를 만들어주시고 auth 내부에 catch-all-routes 폴더 [...nextauth]을 만든 다음 auth 폴더 내에 route.ts라는 이름의 파일을 만들어주시고 다음 코드를 붙여넣어주세요.</p>\n<p>/app/api/auth/[…nextauth]/route.ts</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { authOptions } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@/lib/auth\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">NextAuth</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth\"</span>;\n\n<span class=\"hljs-keyword\">const</span> handler = <span class=\"hljs-title class_\">NextAuth</span>(authOptions);\n<span class=\"hljs-keyword\">export</span> { handler <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable constant_\">GET</span>, handler <span class=\"hljs-keyword\">as</span> <span class=\"hljs-variable constant_\">POST</span> };\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>프렌들리하게 번역하면 다음과 같습니다:</p>\n<p>우리는 이전에 NextAuth 함수 안에서 미리 구성한 authOptions를 가져왔고, next auth 핸들러를 내보냈습니다.</p>\n<p>3단계: 버튼 만들기</p>\n<p>애플리케이션의 페이지 간 이동을 쉽게 하기 위해 브라우저에 수동으로 URL을 입력하는 대신 버튼을 만들겠습니다. 기본 폴더 내에 components라는 새 폴더를 만들고 buttons.component.tsx라는 파일을 생성하세요.</p>\n<p>/components/buttons.component.tsx</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">\"use client\"</span>;\n\n<span class=\"hljs-keyword\">import</span> { signIn, signOut } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth/react\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">Link</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next/link\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">LoginButton</span> = (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{</span> <span class=\"hljs-attr\">marginRight:</span> <span class=\"hljs-attr\">10</span> } <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{()</span> =></span> signIn()}>\n      Sign in\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span></span>\n  );\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">RegisterButton</span> = (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"/register\"</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{</span> <span class=\"hljs-attr\">marginRight:</span> <span class=\"hljs-attr\">10</span> }></span>\n      Register\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Link</span>></span></span>\n  );\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">LogoutButton</span> = (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{</span> <span class=\"hljs-attr\">marginRight:</span> <span class=\"hljs-attr\">10</span> } <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{()</span> =></span> signOut()}>\n      Sign Out\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">button</span>></span></span>\n  );\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">ProfileButton</span> = (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"/profile\"</span>></span>Profile<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Link</span>></span></span>;\n};\n</code></pre>\n<p>이제 홈 컴포넌트에서 버튼들을 import하세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> {\n  <span class=\"hljs-title class_\">LoginButton</span>,\n  <span class=\"hljs-title class_\">LogoutButton</span>,\n  <span class=\"hljs-title class_\">ProfileButton</span>,\n  <span class=\"hljs-title class_\">RegisterButton</span>,\n} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@/components/buttons.component\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Home</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">main</span>\n      <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{{</span>\n        <span class=\"hljs-attr\">display:</span> \"<span class=\"hljs-attr\">flex</span>\",\n        <span class=\"hljs-attr\">justifyContent:</span> \"<span class=\"hljs-attr\">center</span>\",\n        <span class=\"hljs-attr\">alignItems:</span> \"<span class=\"hljs-attr\">center</span>\",\n        <span class=\"hljs-attr\">height:</span> \"<span class=\"hljs-attr\">70vh</span>\",\n      }}\n    ></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">LoginButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">RegisterButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">LogoutButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ProfileButton</span> /></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">main</span>></span></span>\n  );\n}\n</code></pre>\n<p>이제 NextAuth에서 JWT 인증을 추가해야 하므로 프로젝트의 루트 디렉토리 내 .env 파일에 JWT의 시크릿을 정의해야 합니다.</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-comment\">#.env</span>\n\n<span class=\"hljs-string\">NEXTAUTH_SECRET=secret</span>\n<span class=\"hljs-string\">NEXTAUTH_URL=http://localhost:3000</span>\n\n<span class=\"hljs-string\">이제</span> <span class=\"hljs-string\">http://localhost:3000/를</span> <span class=\"hljs-string\">방문하여</span> <span class=\"hljs-string\">애플리케이션에</span> <span class=\"hljs-string\">액세스하고</span> <span class=\"hljs-string\">홈페이지에서</span> <span class=\"hljs-string\">클릭하여</span> <span class=\"hljs-string\">로그인</span> <span class=\"hljs-string\">버튼을</span> <span class=\"hljs-string\">누르면</span> <span class=\"hljs-string\">로그인</span> <span class=\"hljs-string\">양식으로</span> <span class=\"hljs-string\">이동합니다.</span>\n\n<span class=\"hljs-type\">![</span><span class=\"hljs-string\">이미지](/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_1.png)</span>\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>We have mock credentials, so feel free to use any email and password to submit the form. Once the submission is successful, you will be redirected back to the home page. At that point, you can view the application's cookies.</p>\n<p><img src=\"/assets/img/2024-06-22-BuildingAuthenticationinaNextjs14AppUsingNextAuthandPrisma_2.png\" alt=\"Cookie Image\"></p>\n<p>Step IV: Integrating with database</p>\n<p>For real-world users, we need to connect to a database. I will be using PostgreSQL as the database and Prisma as the ORM.</p>\n<div class=\"content-ad\"></div>\n<p>새 데이터베이스를 생성하고 데이터베이스 URL을 .env 파일에 넣으세요</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable constant_\">DATABASE_URL</span>=<span class=\"hljs-attr\">postgresql</span>:<span class=\"hljs-comment\">//postgres:pawan123@localhost:5432/next-auth?schema=public</span>\n</code></pre>\n<p>이제 다음 명령어를 사용하여 prisma ORM과 bcryptjs를 설치하여 사용자 비밀번호를 해싱하세요.</p>\n<pre><code class=\"hljs language-js\">npm add @prisma/client bcryptjs &#x26;&#x26; npm add -D ts-node prisma @types/bcryptjs\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>프리즈마를 설정하고 포스트그리스 데이터베이스에 연결하려면 다음 명령을 실행하여 프로젝트에서 프리즈마를 초기화하고 포스트그레스SQL용 데이터 소스를 만드세요.</p>\n<pre><code class=\"hljs language-js\">npx prisma init --datasource-provider postgresql\n</code></pre>\n<p>이제 schema.prisma 파일 내에 User 모델을 만들어보세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// 이것은 당신의 프리즈마 스키마 파일입니다.</span>\n<span class=\"hljs-comment\">// 자세한 내용은 다음 문서에서 확인하세요: https://pris.ly/d/prisma-schema</span>\n\ngenerator client {\n  provider = <span class=\"hljs-string\">\"prisma-client-js\"</span>\n}\n\ndatasource db {\n  provider = <span class=\"hljs-string\">\"postgresql\"</span>\n  url      = <span class=\"hljs-title function_\">env</span>(<span class=\"hljs-string\">\"DATABASE_URL\"</span>)\n}\n\nmodel <span class=\"hljs-title class_\">User</span> {\n  id       <span class=\"hljs-title class_\">String</span> @id @<span class=\"hljs-title function_\">default</span>(<span class=\"hljs-title function_\">uuid</span>())\n  name     <span class=\"hljs-title class_\">String</span>\n  email    <span class=\"hljs-title class_\">String</span> @unique\n  password <span class=\"hljs-title class_\">String</span>\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>이제 새 사용자를 생성하고 데이터베이스에 저장하는 등록 기능을 만들 수 있지만, 나는 직접 데이터베이스에 사용자를 입력할 것이다. 시작하려면 prisma 디렉토리에 seed.ts 파일을 만들고 아래 코드를 복사해 넣어라.</p>\n<p>prisma/seed.ts</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">PrismaClient</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@prisma/client\"</span>;\n<span class=\"hljs-keyword\">import</span> { hash } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"bcryptjs\"</span>;\n\n<span class=\"hljs-keyword\">const</span> prisma = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PrismaClient</span>();\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">main</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> password = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">hash</span>(<span class=\"hljs-string\">\"password123\"</span>, <span class=\"hljs-number\">12</span>);\n  <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">upsert</span>({\n    <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">\"admin@admin.com\"</span> },\n    <span class=\"hljs-attr\">update</span>: {},\n    <span class=\"hljs-attr\">create</span>: {\n      <span class=\"hljs-attr\">email</span>: <span class=\"hljs-string\">\"admin@admin.com\"</span>,\n      <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"Admin\"</span>,\n      password,\n    },\n  });\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>({ user });\n}\n<span class=\"hljs-title function_\">main</span>()\n  .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =></span> prisma.$disconnect())\n  .<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-keyword\">async</span> (e) => {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(e);\n    <span class=\"hljs-keyword\">await</span> prisma.$disconnect();\n    process.<span class=\"hljs-title function_\">exit</span>(<span class=\"hljs-number\">1</span>);\n  });\n</code></pre>\n<p>쉽게 테스트 사용자로 데이터베이스에 시드(seed)를 생성할 수 있도록 하기 위해 package.json 파일에 스크립트를 추가할 것이다. 파일을 열어 다음 스크립트를 추가하라:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"prisma\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n        <span class=\"hljs-attr\">\"seed\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"ts-node --compiler-options {\\\"module\\\":\\\"CommonJS\\\"} prisma/seed.ts\"</span>\n    <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>이제 다음 명령을 사용하여 마이그레이션을 생성하고 사용자 스키마를 데이터베이스에 푸시하세요.</p>\n<pre><code class=\"hljs language-js\">npx prisma migrate dev --name init\n</code></pre>\n<p>마이그레이션을 생성한 후 다음 명령을 사용하여 데이터베이스에 사용자를 시드하세요.</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\">npx prisma db seed\n</code></pre>\n<p>이제 PostgreSQL 데이터베이스와 통신할 수 있도록 @prisma/client 패키지를 사용하여 전역 PrismaClient 인스턴스를 생성할 것입니다. 이를 위해 lib 폴더 안에 prisma.ts라는 파일을 만들고 다음 코드를 추가해주세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">PrismaClient</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@prisma/client\"</span>;\n\n<span class=\"hljs-keyword\">const</span> globalForPrisma = <span class=\"hljs-variable language_\">global</span> <span class=\"hljs-keyword\">as</span> unknown <span class=\"hljs-keyword\">as</span> { <span class=\"hljs-attr\">prisma</span>: <span class=\"hljs-title class_\">PrismaClient</span> };\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> prisma =\n  globalForPrisma.<span class=\"hljs-property\">prisma</span> ||\n  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PrismaClient</span>({\n    <span class=\"hljs-attr\">log</span>: [<span class=\"hljs-string\">\"query\"</span>],\n  });\n\n<span class=\"hljs-keyword\">if</span> (process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">NODE_ENV</span> !== <span class=\"hljs-string\">\"production\"</span>) globalForPrisma.<span class=\"hljs-property\">prisma</span> = prisma;\n</code></pre>\n<p>Prisma와 데이터베이스 설정을 완료했으니, 이제 auth.ts 파일에서 로그인 양식을 인증할 것입니다.</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { prisma } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@/lib/prisma\"</span>;\n<span class=\"hljs-keyword\">import</span> { compare } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"bcryptjs\"</span>;\n<span class=\"hljs-keyword\">import</span> type { <span class=\"hljs-title class_\">NextAuthOptions</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth\"</span>;\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-title class_\">CredentialsProvider</span> <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth/providers/credentials\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">authOptions</span>: <span class=\"hljs-title class_\">NextAuthOptions</span> = {\n  <span class=\"hljs-attr\">session</span>: {\n    <span class=\"hljs-attr\">strategy</span>: <span class=\"hljs-string\">\"jwt\"</span>,\n  },\n  <span class=\"hljs-attr\">providers</span>: [\n    <span class=\"hljs-title class_\">CredentialsProvider</span>({\n      <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">\"로그인\"</span>,\n      <span class=\"hljs-attr\">credentials</span>: {\n        <span class=\"hljs-attr\">email</span>: {\n          <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"이메일\"</span>,\n          <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"email\"</span>,\n          <span class=\"hljs-attr\">placeholder</span>: <span class=\"hljs-string\">\"example@example.com\"</span>,\n        },\n        <span class=\"hljs-attr\">password</span>: { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"비밀번호\"</span>, <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">\"password\"</span> },\n      },\n      <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">authorize</span>(<span class=\"hljs-params\">credentials</span>) {\n        <span class=\"hljs-keyword\">if</span> (!credentials?.<span class=\"hljs-property\">email</span> || !credentials.<span class=\"hljs-property\">password</span>) {\n          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n        }\n\n        <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">findUnique</span>({\n          <span class=\"hljs-attr\">where</span>: {\n            <span class=\"hljs-attr\">email</span>: credentials.<span class=\"hljs-property\">email</span>,\n          },\n        });\n\n        <span class=\"hljs-keyword\">if</span> (!user || !(<span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">compare</span>(credentials.<span class=\"hljs-property\">password</span>, user.<span class=\"hljs-property\">password</span>))) {\n          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n        }\n\n        <span class=\"hljs-keyword\">return</span> {\n          <span class=\"hljs-attr\">id</span>: user.<span class=\"hljs-property\">id</span>,\n          <span class=\"hljs-attr\">email</span>: user.<span class=\"hljs-property\">email</span>,\n          <span class=\"hljs-attr\">name</span>: user.<span class=\"hljs-property\">name</span>,\n          <span class=\"hljs-attr\">randomKey</span>: <span class=\"hljs-string\">\"일부 랜덤 키\"</span>,\n        };\n      },\n    }),\n  ],\n};\n</code></pre>\n<p>이제 사용자 정의 키를 추가할 수 있습니다. 다음은 NextAuth 구성의 콜백 속성에서 콜백을 수정하는 방법입니다. 이렇게 하면 세션 개체와 JWT에 필요한 정보를 포함시킬 수 있으며 응용 프로그램에 언제든지 어디서나 액세스할 수 있습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-attr\">callbacks</span>: {\n    <span class=\"hljs-attr\">session</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">{ session, token }</span>) =></span> {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"세션 콜백\"</span>, { session, token });\n      <span class=\"hljs-keyword\">return</span> {\n        ...session,\n        <span class=\"hljs-attr\">user</span>: {\n          ...session.<span class=\"hljs-property\">user</span>,\n          <span class=\"hljs-attr\">id</span>: token.<span class=\"hljs-property\">id</span>,\n          <span class=\"hljs-attr\">randomKey</span>: token.<span class=\"hljs-property\">randomKey</span>,\n        },\n      };\n    },\n    <span class=\"hljs-attr\">jwt</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">{ token, user }</span>) =></span> {\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">\"JWT 콜백\"</span>, { token, user });\n      <span class=\"hljs-keyword\">if</span> (user) {\n        <span class=\"hljs-keyword\">const</span> u = user <span class=\"hljs-keyword\">as</span> unknown <span class=\"hljs-keyword\">as</span> any;\n        <span class=\"hljs-keyword\">return</span> {\n          ...token,\n          <span class=\"hljs-attr\">id</span>: u.<span class=\"hljs-property\">id</span>,\n          <span class=\"hljs-attr\">randomKey</span>: u.<span class=\"hljs-property\">randomKey</span>,\n        };\n      }\n      <span class=\"hljs-keyword\">return</span> token;\n    },\n  },\n</code></pre>\n<p>Step V: NextAuth 세션 데이터 가져오기</p>\n<div class=\"content-ad\"></div>\n<p>next 앱 내에서 권한이 부여된 사용자 세션 데이터를 얻는 두 가지 방법이 있습니다.</p>\n<p>i. 서버 컴포넌트에서</p>\n<p>서버 컴포넌트 내에서 세션 데이터를 가져오기 위해 getServerSession 함수를 사용할 수 있습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> {\n  <span class=\"hljs-title class_\">LoginButton</span>,\n  <span class=\"hljs-title class_\">LogoutButton</span>,\n  <span class=\"hljs-title class_\">ProfileButton</span>,\n  <span class=\"hljs-title class_\">RegisterButton</span>,\n} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@/components/buttons.component\"</span>;\n<span class=\"hljs-keyword\">import</span> { getServerSession } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth\"</span>;\n<span class=\"hljs-keyword\">import</span> { authOptions } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"@/lib/auth\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">Home</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> session = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">getServerSession</span>(authOptions);\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(session);\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">main</span>\n      <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">{{</span>\n        <span class=\"hljs-attr\">display:</span> \"<span class=\"hljs-attr\">flex</span>\",\n        <span class=\"hljs-attr\">justifyContent:</span> \"<span class=\"hljs-attr\">center</span>\",\n        <span class=\"hljs-attr\">alignItems:</span> \"<span class=\"hljs-attr\">center</span>\",\n        <span class=\"hljs-attr\">height:</span> \"<span class=\"hljs-attr\">70vh</span>\",\n      }}\n    ></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">LoginButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">RegisterButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">LogoutButton</span> /></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ProfileButton</span> /></span>\n\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">h1</span>></span>Server Session<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">h1</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">pre</span>></span>{JSON.stringify(session)}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">pre</span>></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">div</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">main</span>></span></span>\n  );\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>서버 페이지를 무단 사용자로부터 보호하기 위해 미인가 사용자를 signin 페이지로 리다이렉트하는 다음 코드를 사용할 수 있습니다.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">if</span> (!session) {\n    <span class=\"hljs-title function_\">redirect</span>(<span class=\"hljs-string\">\"/api/auth/signin\"</span>);\n}\n</code></pre>\n<p>ii. 클라이언트 컴포넌트</p>\n<p>클라이언트 컴포넌트에서 세션 데이터를 검색하려면 next auth에서 제공하는 세션 제공자를 사용하고 앱을 세션 제공자로 래핑해야 합니다.</p>\n<div class=\"content-ad\"></div>\n<p>기본 디렉토리에 providers 폴더를 만들고, NextAuthProvider.tsx라는 새 파일을 생성한 다음 아래 코드를 붙여넣어주세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">\"use client\"</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">SessionProvider</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth/react\"</span>;\n\ntype <span class=\"hljs-title class_\">Props</span> = {\n  children?: <span class=\"hljs-title class_\">React</span>.<span class=\"hljs-property\">ReactNode</span>;\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">NextAuthProvider</span> = (<span class=\"hljs-params\">{ children }: Props</span>) => {\n  <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">SessionProvider</span>></span>{children}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">SessionProvider</span>></span></span>;\n};\n</code></pre>\n<p>이제 layout.tsx 파일에서 프로바이더를 감싸주세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">NextAuthProvider</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"./providers/NextAuthProvider\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> metadata = {\n  <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">\"Create Next App\"</span>,\n  <span class=\"hljs-attr\">description</span>: <span class=\"hljs-string\">\"Generated by create next app\"</span>,\n};\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">RootLayout</span>(<span class=\"hljs-params\">{\n  children,\n}: {\n  children: React.ReactNode;\n}</span>) {\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"en\"</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">body</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">NextAuthProvider</span>></span>{children}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">NextAuthProvider</span>></span>\n      <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">body</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">html</span>></span></span>\n  );\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>이제 세션 데이터를 가져오는 클라이언트 컴포넌트를 생성해보세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-string\">\"use client\"</span>;\n\n<span class=\"hljs-keyword\">import</span> { useSession } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">\"next-auth/react\"</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">User</span> = (<span class=\"hljs-params\"></span>) => {\n  <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">data</span>: session } = <span class=\"hljs-title function_\">useSession</span>();\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">h1</span>></span>Client Session<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">h1</span>></span>\n      <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">pre</span>></span>{JSON.stringify(session)}<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">pre</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/></span></span>\n  );\n};\n</code></pre>\n<p>이제 권한이 없는 사용자로부터 클라이언트 컴포넌트를 보호하기 위해 아래 코드를 클라이언트 컴포넌트에 붙여넣어주세요.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> { status } = <span class=\"hljs-title function_\">useSession</span>({\n    <span class=\"hljs-attr\">required</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-title function_\">onUnauthenticated</span>(<span class=\"hljs-params\"></span>) {\n      <span class=\"hljs-title function_\">redirect</span>(<span class=\"hljs-string\">\"/api/auth/signin\"</span>);\n    },\n  });\n\n  <span class=\"hljs-keyword\">if</span> (status === <span class=\"hljs-string\">\"loading\"</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">p</span>></span>Loading....<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">p</span>></span></span>;\n  }\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>결론</p>\n<p>이 튜토리얼에서는 NextAuth를 새로운 Next.js 14 앱에 통합하는 방법에 대해 배웠습니다. 이 글이 유익하고 즐거웠기를 바랍니다. 피드백이나 질문이 있으면 언제든 댓글을 남겨주세요.</p>\n</body>\n</html>\n"},"__N_SSG":true}