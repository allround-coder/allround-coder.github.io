{"pageProps":{"post":{"title":"Vite, Nginx 및 런타임에서 정적 웹 사이트용 환경 변수 적용하는 방법","description":"","date":"2024-05-17 20:51","slug":"2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime","content":"\n\n<img src=\"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_0.png\" />\n\n안녕하세요 여러분! 저는 Quadcode의 프런트엔드 개발자 Dmitry Pashkevich입니다. 오늘은 Vite 빌드 도구와 Nginx 웹 서버를 이용하여 정적 웹사이트에 런타임 환경 변수를 전달하는 방법을 공유하려고 합니다.\n\n프런트엔드 개발에서 흔한 작업은 애플리케이션에 환경 변수를 전달하는 것입니다. 애플리케이션이 실행되는 환경에 따라 다르게 동작하도록 환경 변수를 설정하는 작업이죠. 간단한 작업으로 보이지만 이를 문서에 설명된 대로 처리하려면 .env 파일을 옆에 두고 빌드를 실행해야 합니다... 각 환경에서 말이죠.\n\n솔루션을 찾은 것 같습니다. 그러나 이로 인해 각 환경마다 다른 빌드 프로세스와 이에 따른 다른 결과로 이어집니다.\n\n<div class=\"content-ad\"></div>\n\n실무에서 빌드 단계의 기능에 문제가 발생하는 경우가 종종 있습니다. 예를 들어 변경 사항을 적용할 때 한 환경을 위해 설정, 스크립트 등을 업데이트하는 것을 잊을 때가 있습니다. 결과적으로, 아티팩트도 다르기 때문에 애플리케이션 자체에 문제가 발생합니다.\n\n그러므로 모든 환경에 대해 하나의 빌드 아티팩트를 얻고 환경 변수 값을 전달할 수 있는 것이 더 나을 것으로 보입니다. 따라서 변수 값이 정확한 한 가지 문제를 해결하는 것이 빌드 단계를 조사하는 것보다 더 쉽습니다.\n\n그럼 이를 Vite와 Nginx 도구를 사용한 예제로 어떻게 수행할 수 있는지 살펴봅시다.\n\n# 저장소 준비\n\n<div class=\"content-ad\"></div>\n\n먼저 React + Typescript용 Vite 빌더에서 제공하는 템플릿을 사용하여 프로젝트를 생성해보겠습니다.\n\n```js\nnpm create vite@latest vite-nginx-dynamic-env-variables-example -- \n--template react-ts && cd vite-nginx-dynamic-env-variables-example && npm \ninstal\n```\n\n# 프로젝트 구성 준비\n\n위 명령어를 성공적으로 실행한 후, 새로 생성된 프로젝트를 좋아하는 IDE에서 열고 목표 솔루션을 만들기 시작해봅시다.\n\n<div class=\"content-ad\"></div>\n\n파일 src/vite-env.d.ts를 수정해보세요. IDE 힌팅을 활성화하기 위해 사용 가능한 환경 변수 유형에 대한 설명을 추가할 거에요.\n\n```js\n/// <reference types=\"vite/client\" />\n\ninterface ImportMetaEnv {\n    readonly VITE_VERSION: string\n}\n\ninterface ImportMeta {\n    readonly env: ImportMetaEnv\n}\n```\n\n이제 IDE가 사용 가능한 환경 변수에 대한 힌트를 제공할 거예요.\n\n다음으로, 환경 변수 템플릿이 들어 있는 파일을 생성해볼게요: src/shared/projectEnvVariables.ts. 그리고 아래 내용을 추가해주세요.\n\n<div class=\"content-ad\"></div>\n\n```js\ntype ProjectEnvVariablesType = Pick<ImportMetaEnv, 'VITE_VERSION'>\n\n\n// 환경 변수 템플릿 런타임에 대체되도록\nconst projectEnvVariables: ProjectEnvVariablesType = {\n   VITE_VERSION: '${VITE_VERSION}',\n}\n\n\n// 런타임에서 변수 값을 반환하거나 빌드 결과로 얻음\nexport const getProjectEnvVariables = (): {\n   envVariables: ProjectEnvVariablesType\n} => {\n   return {\n       envVariables: {\n           VITE_VERSION: !projectEnvVariables.VITE_VERSION.includes('VITE_') ? projectEnvVariables.VITE_VERSION : import.meta.env.VITE_VERSION,\n       }\n   }\n}\n```\n\n그 다음, 위의 파일이 빌드 단계 후 예측 가능한 이름을 갖도록 빌드 구성을 vite.config.ts에 변경해야 합니다. 이를 위해 구성에 rollup을 위한 섹션을 추가해주세요.\n\n```js\nimport { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n   plugins: [react()],\n   build: {\n       rollupOptions: {\n           output: {\n               format: 'es',\n               globals: {\n                   react: 'React',\n                   'react-dom': 'ReactDOM',\n               },\n               manualChunks(id) {\n                   if (/projectEnvVariables.ts/.test(id)) {\n                       return 'projectEnvVariables'\n                   }\n               },\n           },\n       }\n   }\n}\n```\n\nmanualChunks 섹션에서 사용자 정의 청크를 생성하고, 파일을 빌드한 후 이 파일을 환경 변수로 대체할 수 있도록 일부 이름을 저장합니다.\n\n\n<div class=\"content-ad\"></div>\n\nsrc/App.tsx 파일을 수정하여 환경 변수의 값들을 확인해봅시다.\n\n```js\nimport { getProjectEnvVariables } from \"./shared/projectEnvVariables.ts\";\n\nconst { envVariables } = getProjectEnvVariables()\n\nfunction App() {\n return (\n     <>\n         <h1>VITE_VERSION</h1>\n         <div>{envVariables.VITE_VERSION}</div>\n\n         <hr />\n\n         <h2>import.meta.env.VITE_VERSION</h2>\n         <div>{import.meta.env.VITE_VERSION}</div>\n     </>\n )\n}\n\nexport default App\n```\n\n다음으로, 빌드를 실행하여 빌드 단계 이후에 변수를 대체하는 데 필요한 청크를 얻었는지 확인해봅시다.\n\n```js\nnpm run build\n```\n\n<div class=\"content-ad\"></div>\n\n빌드가 완료되면 dist/assets 디렉토리로 이동하세요. 이전에 구성한 projectEnvVariables*이라는 청크가 존재하는 것을 확인할 수 있을 겁니다.\n\n![이미지](/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_1.png)\n\n이제 연이어 실험을 진행해보겠습니다.\n\n원하는 빌드 결과를 얻는 데 쉽게 이해할 수 있도록, 각 빌드는 지정된 환경 변수로 수행될 것입니다. 이를 통해 getProjectEnvVariables 함수에서 환경 변수의 값을 반환하는 조건을 시각적으로 확인할 수 있습니다.\n\n<div class=\"content-ad\"></div>\n\n첫 번째 실험을 위해 프로젝트 루트에 다음 내용을 포함한 .env 파일을 생성해주세요.\n\n```js\nVITE_VERSION=dev\n```\n\n프로젝트 빌드를 시작하고 빌드 결과를 확인하는 모드로 전환해봅시다.\n\n```js\nnpm run build && npm run preview\n```\n\n<div class=\"content-ad\"></div>\n\nhttp://localhost:4173/로 이동하면 구성에서 직접 환경 변수로부터 읽은 변수의 두 개의 동일한 값이 표시됩니다.\n\n![image](/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_2.png)\n\n두 번째 실험에서는 애플리케이션을 빌드한 후 생성된 dist/assets/projectEnvVariables-wa84hTgi.js 파일에서 변수를 변경해보겠습니다. 이 파일에서 $'VITE_VERSION' 값이 들어있는 줄을 dev_from_env로 바꿔주세요. 브라우저에서 페이지를 새로고침하면 구성 getProjectEnvVariables에서 읽은 화면의 변수가 업데이트된 버전으로 표시됩니다.\n\n![image](/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_3.png)\n\n<div class=\"content-ad\"></div>\n\n모든 것이 예상대로 작동합니다! 이제 변수 대체를 자동화할 차례입니다.\n\n# 도커 + Nginx 환경 설정 준비\n\nDocker 컨테이너를 사용하여 Nginx 웹 서버를 실행하기 전에 초기화 스크립트를 실행하고 envsubst를 사용하여 환경 변수를 대체하는 변수 대체의 자동화를 보여 드리겠습니다.\n\n프로젝트 루트에 .docker 디렉토리를 만들어 Nginx 웹 서버를 위한 구성 내용을 넣어주시면 됩니다. Nginx 구성의 완전한 예시는 저장소에 있으며, 아래는 .docker/app/nginx/init-scripts/100-init-project-env-variables.sh 파일의 bash 코드입니다. 이 코드는 환경 변수를 대체합니다.\n\n<div class=\"content-ad\"></div>\n\n```sh\n#!/usr/bin/env sh\n\nset -ex\n\n#환경 변수를 치환해야 하는 파일을 찾습니다.\nprojectEnvVariables=$(ls -t /usr/share/nginx/html/assets/projectEnvVariables*.js | head -n1)\n\n#환경 변수를 치환합니다.\nenvsubst < \"$projectEnvVariables\" > ./projectEnvVariables_temp\ncp ./projectEnvVariables_temp \"$projectEnvVariables\"\nrm ./projectEnvVariables_temp\n```\n\n이후에, 프로젝트 루트에서 다음 내용을 가진 Dockerfile을 생성하세요. 이 Dockerfile은 애플리케이션을 빌드하고 정적 파일을 제공하기 위해 Nginx 웹 서버를 실행하는 내용을 설명합니다.\n\n```dockerfile\nFROM node:20-alpine as builder\n\nWORKDIR /app\n\nCOPY package.json package-lock.json ./\n\nRUN npm ci\n\nCOPY . .\n\nARG NODE_ENV=production\nENV NODE_ENV=${NODE_ENV}\n\nRUN npm run build\n\nFROM nginx:alpine\n\nARG VITE_VERSION=dev\nENV VITE_VERSION=${VITE_VERSION}\n\nARG PORT=80\nENV NGINX_PORT=${PORT}\nENV NGINX_HOST=localhost\n\nEXPOSE ${PORT}\n\nCOPY .docker/app/nginx/nginx.conf /etc/nginx/nginx.conf\nCOPY .docker/app/nginx/conf.d/ /etc/nginx/conf.d/\nCOPY .docker/app/entrypoint.sh /entrypoint.sh\nCOPY .docker/app/nginx/init-scripts/ /docker-entrypoint.d/\n\nWORKDIR /usr/share/nginx/html\n\nCOPY --from=builder /app/dist ./\n```\n\n이제 컨테이너를 빌드해봅시다.\n  \n\n<div class=\"content-ad\"></div>\n\n```js\ndocker build -t\nvite-nginx-dynamic-env-variables-example .\n```\n\n다음으로, 응용 프로그램에서 사용할 환경 변수에 대한 새로운 값을 가진 작성된 컨테이너를 실행해 봅시다.\n\n```js\ndocker run -p 81:80 -e VITE_VERSION=FROM_NGINX\nvite-nginx-dynamic-env-variables-example\n```\nhttp://127.0.0.1:81 으로 이동하여, 환경 변수가 현재 값으로 초기화되었음을 확인할 수 있습니다. 직접 읽은 환경 변수는 여전히 이전 값으로 남아 있습니다.```\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_4.png\" />\n\n# 결론\n\n이렇게 하면 실행 중에 환경 변수를 정적으로 빌드된 애플리케이션에 대체하여 모든 환경에서 통합 빌드가 가능합니다.\n\n코드는 저장소에서 찾을 수 있습니다.","ogImage":{"url":"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_0.png"},"coverImage":"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_0.png","tag":["Tech"],"readingTime":7},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h1: \"h1\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    img: \"img\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_0.png\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"안녕하세요 여러분! 저는 Quadcode의 프런트엔드 개발자 Dmitry Pashkevich입니다. 오늘은 Vite 빌드 도구와 Nginx 웹 서버를 이용하여 정적 웹사이트에 런타임 환경 변수를 전달하는 방법을 공유하려고 합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"프런트엔드 개발에서 흔한 작업은 애플리케이션에 환경 변수를 전달하는 것입니다. 애플리케이션이 실행되는 환경에 따라 다르게 동작하도록 환경 변수를 설정하는 작업이죠. 간단한 작업으로 보이지만 이를 문서에 설명된 대로 처리하려면 .env 파일을 옆에 두고 빌드를 실행해야 합니다... 각 환경에서 말이죠.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"솔루션을 찾은 것 같습니다. 그러나 이로 인해 각 환경마다 다른 빌드 프로세스와 이에 따른 다른 결과로 이어집니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"실무에서 빌드 단계의 기능에 문제가 발생하는 경우가 종종 있습니다. 예를 들어 변경 사항을 적용할 때 한 환경을 위해 설정, 스크립트 등을 업데이트하는 것을 잊을 때가 있습니다. 결과적으로, 아티팩트도 다르기 때문에 애플리케이션 자체에 문제가 발생합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그러므로 모든 환경에 대해 하나의 빌드 아티팩트를 얻고 환경 변수 값을 전달할 수 있는 것이 더 나을 것으로 보입니다. 따라서 변수 값이 정확한 한 가지 문제를 해결하는 것이 빌드 단계를 조사하는 것보다 더 쉽습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그럼 이를 Vite와 Nginx 도구를 사용한 예제로 어떻게 수행할 수 있는지 살펴봅시다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"저장소 준비\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"먼저 React + Typescript용 Vite 빌더에서 제공하는 템플릿을 사용하여 프로젝트를 생성해보겠습니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"npm create vite@latest vite-nginx-dynamic-env-variables-example -- \\n--template react-ts && cd vite-nginx-dynamic-env-variables-example && npm \\ninstal\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"프로젝트 구성 준비\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"위 명령어를 성공적으로 실행한 후, 새로 생성된 프로젝트를 좋아하는 IDE에서 열고 목표 솔루션을 만들기 시작해봅시다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"파일 src/vite-env.d.ts를 수정해보세요. IDE 힌팅을 활성화하기 위해 사용 가능한 환경 변수 유형에 대한 설명을 추가할 거에요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"/// <reference types=\\\"vite/client\\\" />\"\n        }), \"\\n\\ninterface \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ImportMetaEnv\"\n        }), \" {\\n    readonly \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"VITE_VERSION\"\n        }), \": string\\n}\\n\\ninterface \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ImportMeta\"\n        }), \" {\\n    readonly \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"env\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ImportMetaEnv\"\n        }), \"\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 IDE가 사용 가능한 환경 변수에 대한 힌트를 제공할 거예요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음으로, 환경 변수 템플릿이 들어 있는 파일을 생성해볼게요: src/shared/projectEnvVariables.ts. 그리고 아래 내용을 추가해주세요.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"type \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ProjectEnvVariablesType\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Pick\"\n        }), \"<\", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ImportMetaEnv\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'VITE_VERSION'\"\n        }), \">\\n\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// 환경 변수 템플릿 런타임에 대체되도록\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"projectEnvVariables\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ProjectEnvVariablesType\"\n        }), \" = {\\n   \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"VITE_VERSION\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'${VITE_VERSION}'\"\n        }), \",\\n}\\n\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// 런타임에서 변수 값을 반환하거나 빌드 결과로 얻음\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" getProjectEnvVariables = (): {\\n   \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"envVariables\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"ProjectEnvVariablesType\"\n        }), \"\\n} => {\\n   \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" {\\n       \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"envVariables\"\n        }), \": {\\n           \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"VITE_VERSION\"\n        }), \": !projectEnvVariables.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"VITE_VERSION\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"includes\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'VITE_'\"\n        }), \") ? projectEnvVariables.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"VITE_VERSION\"\n        }), \" : \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"meta\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"env\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"VITE_VERSION\"\n        }), \",\\n       }\\n   }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그 다음, 위의 파일이 빌드 단계 후 예측 가능한 이름을 갖도록 빌드 구성을 vite.config.ts에 변경해야 합니다. 이를 위해 구성에 rollup을 위한 섹션을 추가해주세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { defineConfig } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'vite'\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" react \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'@vitejs/plugin-react'\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// https://vitejs.dev/config/\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"defineConfig\"\n        }), \"({\\n   \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"plugins\"\n        }), \": [\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"react\"\n        }), \"()],\\n   \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"build\"\n        }), \": {\\n       \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"rollupOptions\"\n        }), \": {\\n           \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"output\"\n        }), \": {\\n               \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"format\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'es'\"\n        }), \",\\n               \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"globals\"\n        }), \": {\\n                   \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"react\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'React'\"\n        }), \",\\n                   \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'react-dom'\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'ReactDOM'\"\n        }), \",\\n               },\\n               \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"manualChunks\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"id\"\n        }), \") {\\n                   \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-regexp\",\n          children: \"/projectEnvVariables.ts/\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"test\"\n        }), \"(id)) {\\n                       \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"'projectEnvVariables'\"\n        }), \"\\n                   }\\n               },\\n           },\\n       }\\n   }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"manualChunks 섹션에서 사용자 정의 청크를 생성하고, 파일을 빌드한 후 이 파일을 환경 변수로 대체할 수 있도록 일부 이름을 저장합니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"src/App.tsx 파일을 수정하여 환경 변수의 값들을 확인해봅시다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { getProjectEnvVariables } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"./shared/projectEnvVariables.ts\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { envVariables } = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getProjectEnvVariables\"\n        }), \"()\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"App\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" (\\n     \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"<>\"\n          }), \"\\n         \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"h1\"\n            }), \">\"]\n          }), \"VITE_VERSION\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"h1\"\n            }), \">\"]\n          }), \"\\n         \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"div\"\n            }), \">\"]\n          }), \"{envVariables.VITE_VERSION}\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"div\"\n            }), \">\"]\n          }), \"\\n\\n         \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"hr\"\n            }), \" />\"]\n          }), \"\\n\\n         \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"h2\"\n            }), \">\"]\n          }), \"import.meta.env.VITE_VERSION\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"h2\"\n            }), \">\"]\n          }), \"\\n         \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"<\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"div\"\n            }), \">\"]\n          }), \"{import.meta.env.VITE_VERSION}\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"</\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"div\"\n            }), \">\"]\n          }), \"\\n     \", _jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"</>\"\n          })]\n        }), \"\\n )\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"App\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음으로, 빌드를 실행하여 빌드 단계 이후에 변수를 대체하는 데 필요한 청크를 얻었는지 확인해봅시다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"npm run build\\n\"\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"빌드가 완료되면 dist/assets 디렉토리로 이동하세요. 이전에 구성한 projectEnvVariables*이라는 청크가 존재하는 것을 확인할 수 있을 겁니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_1.png\",\n        alt: \"이미지\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 연이어 실험을 진행해보겠습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"원하는 빌드 결과를 얻는 데 쉽게 이해할 수 있도록, 각 빌드는 지정된 환경 변수로 수행될 것입니다. 이를 통해 getProjectEnvVariables 함수에서 환경 변수의 값을 반환하는 조건을 시각적으로 확인할 수 있습니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"첫 번째 실험을 위해 프로젝트 루트에 다음 내용을 포함한 .env 파일을 생성해주세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VITE_VERSION\"\n        }), \"=dev\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"프로젝트 빌드를 시작하고 빌드 결과를 확인하는 모드로 전환해봅시다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"npm run build && npm run preview\\n\"\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"http://localhost:4173/로 이동하면 구성에서 직접 환경 변수로부터 읽은 변수의 두 개의 동일한 값이 표시됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_2.png\",\n        alt: \"image\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"두 번째 실험에서는 애플리케이션을 빌드한 후 생성된 dist/assets/projectEnvVariables-wa84hTgi.js 파일에서 변수를 변경해보겠습니다. 이 파일에서 $'VITE_VERSION' 값이 들어있는 줄을 dev_from_env로 바꿔주세요. 브라우저에서 페이지를 새로고침하면 구성 getProjectEnvVariables에서 읽은 화면의 변수가 업데이트된 버전으로 표시됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_3.png\",\n        alt: \"image\"\n      })\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"모든 것이 예상대로 작동합니다! 이제 변수 대체를 자동화할 차례입니다.\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"도커 + Nginx 환경 설정 준비\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Docker 컨테이너를 사용하여 Nginx 웹 서버를 실행하기 전에 초기화 스크립트를 실행하고 envsubst를 사용하여 환경 변수를 대체하는 변수 대체의 자동화를 보여 드리겠습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"프로젝트 루트에 .docker 디렉토리를 만들어 Nginx 웹 서버를 위한 구성 내용을 넣어주시면 됩니다. Nginx 구성의 완전한 예시는 저장소에 있으며, 아래는 .docker/app/nginx/init-scripts/100-init-project-env-variables.sh 파일의 bash 코드입니다. 이 코드는 환경 변수를 대체합니다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-sh\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-meta\",\n          children: \"#!/usr/bin/env sh\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"set\"\n        }), \" -ex\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"#환경 변수를 치환해야 하는 파일을 찾습니다.\"\n        }), \"\\nprojectEnvVariables=$(\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"ls\"\n        }), \" -t /usr/share/nginx/html/assets/projectEnvVariables*.js | \", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"head\"\n        }), \" -n1)\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"#환경 변수를 치환합니다.\"\n        }), \"\\nenvsubst < \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$projectEnvVariables\"\n          }), \"\\\"\"]\n        }), \" > ./projectEnvVariables_temp\\n\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"cp\"\n        }), \" ./projectEnvVariables_temp \", _jsxs(_components.span, {\n          className: \"hljs-string\",\n          children: [\"\\\"\", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"$projectEnvVariables\"\n          }), \"\\\"\"]\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-built_in\",\n          children: \"rm\"\n        }), \" ./projectEnvVariables_temp\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이후에, 프로젝트 루트에서 다음 내용을 가진 Dockerfile을 생성하세요. 이 Dockerfile은 애플리케이션을 빌드하고 정적 파일을 제공하기 위해 Nginx 웹 서버를 실행하는 내용을 설명합니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-dockerfile\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"FROM\"\n        }), \" node:\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"20\"\n        }), \"-alpine as builder\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"WORKDIR\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" /app\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" package.json package-lock.json ./\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"RUN\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" npm ci\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" . .\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ARG\"\n        }), \" NODE_ENV=production\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ENV\"\n        }), \" NODE_ENV=${NODE_ENV}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"RUN\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" npm run build\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"FROM\"\n        }), \" nginx:alpine\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ARG\"\n        }), \" VITE_VERSION=dev\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ENV\"\n        }), \" VITE_VERSION=${VITE_VERSION}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ARG\"\n        }), \" PORT=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"80\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ENV\"\n        }), \" NGINX_PORT=${PORT}\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"ENV\"\n        }), \" NGINX_HOST=localhost\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"EXPOSE\"\n        }), \" ${PORT}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" .docker/app/nginx/nginx.conf /etc/nginx/nginx.conf\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" .docker/app/nginx/conf.d/ /etc/nginx/conf.d/\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" .docker/app/entrypoint.sh /entrypoint.sh\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" .docker/app/nginx/init-scripts/ /docker-entrypoint.d/\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"WORKDIR\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" /usr/share/nginx/html\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"COPY\"\n        }), _jsx(_components.span, {\n          className: \"bash\",\n          children: \" --from=builder /app/dist ./\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 컨테이너를 빌드해봅시다.\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"docker build -t\\nvite-nginx-dynamic-env-variables-example .\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음으로, 응용 프로그램에서 사용할 환경 변수에 대한 새로운 값을 가진 작성된 컨테이너를 실행해 봅시다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"docker run -p \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"81\"\n        }), \":\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"80\"\n        }), \" -e \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VITE_VERSION\"\n        }), \"=\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"FROM_NGINX\"\n        }), \"\\nvite-nginx-dynamic-env-variables-example\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"http://127.0.0.1:81 으로 이동하여, 환경 변수가 현재 값으로 초기화되었음을 확인할 수 있습니다. 직접 읽은 환경 변수는 여전히 이전 값으로 남아 있습니다.```\"\n    }), \"\\n\", _jsx(\"div\", {\n      class: \"content-ad\"\n    }), \"\\n\", _jsx(\"img\", {\n      src: \"/assets/img/2024-05-17-ViteNginxandenvironmentvariablesforastaticwebsiteatruntime_4.png\"\n    }), \"\\n\", _jsx(_components.h1, {\n      children: \"결론\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이렇게 하면 실행 중에 환경 변수를 정적으로 빌드된 애플리케이션에 대체하여 모든 환경에서 통합 빌드가 가능합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"코드는 저장소에서 찾을 수 있습니다.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true}