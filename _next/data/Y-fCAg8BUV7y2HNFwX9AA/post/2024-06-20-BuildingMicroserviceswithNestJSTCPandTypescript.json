{"pageProps":{"post":{"title":"NestJS, TCP ë° Typescriptë¡œ Microservices êµ¬ì¶•í•˜ê¸°","description":"","date":"2024-06-20 00:09","slug":"2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript","content":"\n\n## ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ì„œë¡œ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_0.png)\n\ní”„ë¡œì íŠ¸ê°€ ì ì  ì»¤ì§€ë©´ì„œ ë”ìš± ê³ ê¸‰ ì•„í‚¤í…ì²˜ê°€ í•„ìš”í•´ì§‘ë‹ˆë‹¤. ê·¸ë˜ì„œ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ë¡œì„œ, í˜„ëŒ€ì ì´ê³  ì¸ê¸° ìˆëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ì†Œê°œí•˜ê³ ì í•©ë‹ˆë‹¤. ì´ ì•„í‚¤í…ì²˜ëŠ” SOA (Service Oriented Architecture) ê°œë…ì„ ë”°ë¦…ë‹ˆë‹¤.\n\nì´ ê¸€ì—ì„œëŠ” ë‹¨ì¼ì²´ì™€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì°¨ì´ë¥¼ ì´ì•¼ê¸°í•˜ê³ , NestJS, TCP ë° Typescriptë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ë ¤ê³  í•©ë‹ˆë‹¤. ë¨¼ì € ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n# ë¯¸í¬ë¡œì„œë¹„ìŠ¤ë€ ë¬´ì—‡ì¸ê°€\n\në¯¸í¬ë¡œì„œë¹„ìŠ¤ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì˜ ì•„í‚¤í…ì²˜ì  ê´€ì ìœ¼ë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì‘ê³  ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤ë¡œ êµ¬ì„±ë˜ì–´ ì„œë¡œ ì •ì˜ëœ APIë¥¼ í†µí•´ í†µì‹ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ê° ì„œë¹„ìŠ¤ëŠ” íŠ¹ì • ì‘ì—…ì´ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œë¥¼ ì§€ì›í•˜ë©° ë‹¤ë¥¸ ëª¨ë“ˆ ë° ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¥í•˜ê³  ë” ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆì–´ í˜ì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©° ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì‹œì¥ì— ë¹ ë¥´ê²Œ ë‚´ë†“ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.\n\nëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ì™€ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì£¼ìš” ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”? ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ì—ì„œëŠ” ëª¨ë“  ê¸°ëŠ¥ê³¼ ì„œë¹„ìŠ¤ê°€ ê²°í•©ë¼ ë‹¨ì¼ ë‹¨ìœ„ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” ê¸°ë°˜ ë¡œì§ì„ ì„œë¡œ ë‹¤ë¥¸ ì‘ì—…ì´ë‚˜ ì„œë¹„ìŠ¤ë¡œ ë¶„í•´í•˜ì—¬ ê°œë³„ì ìœ¼ë¡œ ê°œë°œí•˜ê³ , ë°°í¬í•˜ë©° APIë¥¼ í†µí•´ ë…¸ì¶œí•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤.\n\në” ë‚˜ì€ ì´í•´ë¥¼ ìœ„í•´ ì €í¬ëŠ” í•¨ê»˜ NestJSì—ì„œ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•  ì˜ˆì •ì…ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\n# í”„ë¡œì íŠ¸ ì„¤ì •í•˜ê¸°\n\nì‹œì‘í•˜ê¸° ì „ì—, ì €í¬ í”„ë¡œì íŠ¸ì˜ ë‘ ê°€ì§€ ì£¼ìš” ì¸¡ë©´ì„ ê°•ì¡°í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤:\n\n- auth-microservice: ì‚¬ìš©ì ê¶Œí•œì„ ê´€ë¦¬í•˜ëŠ” ì¸ì¦ ì„œë¹„ìŠ¤\n- API Gateway: í´ë¼ì´ì–¸íŠ¸ì™€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì‚¬ì´ì— ìœ„ì¹˜í•˜ë©° HTTP API ì—”ë“œí¬ì¸íŠ¸ë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ì„œë¹„ìŠ¤\n\nê°„ëµíˆ ì„¤ëª…í•˜ë©´, ì‚¬ìš©ìê°€ ìê²© ì¦ëª…ìœ¼ë¡œ /api/login ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ë©´ API ê²Œì´íŠ¸ì›¨ì´ì— ì—°ê²°ë©ë‹ˆë‹¤. API ê²Œì´íŠ¸ì›¨ì´ëŠ” ê·¸ëŸ° ë‹¤ìŒ ìš”ì²­-ì‘ë‹µ ìŠ¤íƒ€ì¼ì˜ ë©”ì‹œì§€ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì™€ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì €í¬ ì•±ì´ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤.\n\n<div class=\"content-ad\"></div>\n\nì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•  ì˜ˆì •ì´ë¯€ë¡œ ì—¬ëŸ¬ ì•±ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í¬í•¨ëœ ë‹¨ì¼ ë²„ì „ ê´€ë¦¬ ì½”ë“œ ì €ì¥ì†Œì¸ ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ë¥¼ ê°€ì§€ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë…¸-ì €ì¥ì†Œì—ì„œ ì›¹ ì•± ë° ì„œë¹„ìŠ¤ë¥¼ ë¹Œë“œí•˜ê³  í™•ì¥í•  ìˆ˜ ìˆëŠ” Nx ë„êµ¬ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\n\nìš°ì„  ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤:\n\n```js\nnpx create-nx-workspace nestjs-microservices --preset=nest\n```\n\nì•± ì´ë¦„ì„ api-gatewayë¡œ ì§€ì •í•´ì£¼ì„¸ìš”.\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_1.png\" />\n\nì´ì œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ í”„ë¡œì íŠ¸ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•´ë´…ì‹œë‹¤:\n\n```js\ncd nestjs-microservices\nnpm i @nestjs/microservices class-validator class-transformer\n```\n\n# Auth ëª¨ë“ˆ ì¶”ê°€í•˜ê¸°\n\n<div class=\"content-ad\"></div>\n\nìš°ë¦¬ í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìœ¼ë¯€ë¡œ, nxëŠ” ì´ë¯¸ API Gateway ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤. ì´ì œ API Gateway ì•±ì—ì„œ ì¸ì¦ ëª¨ë“ˆì„ ë§Œë“¤ì–´ì„œ ì¸ì¦ ê´€ë ¨ ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.\n\nì‚¬ìš©ìê°€ ì•±ì— ìš”ì²­ì„ ë³´ë‚´ë©´ API Gatewayê°€ ìš”ì²­ì„ ë°›ì•„ì„œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë™ì¼í•œ ë°ì´í„° ìœ í˜•ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ëª¨ë†€ë¦¬í¬ ë‚´ì—ì„œ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì½”ë“œë¥¼ ì—¬ê¸°ì €ê¸° ì¤‘ë³µ ìƒì„±í•˜ì§€ ì•Šê³  ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:\n\n```js\nnx g @nx/nest:lib shared\n```\n\nì´ì œ dto í´ë”ë¥¼ ë§Œë“¤ì–´ì„œ create-user.dto.ts íŒŒì¼ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”:\n\n<div class=\"content-ad\"></div>\n\n```ts\n// shared/src/lib/dto/create-user.dto.ts\n\nimport { IsNotEmpty, IsString } from 'class-validator';\n\nexport class CreateUserDto {\n  @IsString()\n  @IsNotEmpty()\n  username: string;\n\n  @IsNotEmpty()\n  password: string;\n}\n```\n\në˜í•œ tsconfig.base.jsonì— ê²½ë¡œ í•­ëª©ì„ ì¶”ê°€í•˜ê³  ì ˆëŒ€ ê²½ë¡œë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```json\n{\n  ...\n  \"compilerOptions\": {\n    ...\n    \"paths\": {\n      \"@nestjs-microservices/shared\": [\"shared/src/index.ts\"]\n    }\n  },\n  ...\n}\n```\n\nNestJSëŠ” ê¸°ë³¸ TCP ì „ì†¡ ê³„ì¸µì„ ì‚¬ìš©í•˜ì—¬ ì„œë¡œ ë‹¤ë¥¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ê°„ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. NestJSëŠ” microservice ì „ì†¡ìë¥¼ ì„¤ëª…í•˜ëŠ” ê°ì²´ ë°°ì—´ì„ ì¸ìë¡œë°›ëŠ” static register() ë©”ì„œë“œë¥¼ ë…¸ì¶œí•˜ëŠ” ClientsModuleì„ ì œê³µí•©ë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œ ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ auth.service.tsë¥¼ ì¶”ê°€í•˜ê³  AUTH_MICROSERVICEë¥¼ ë“±ë¡í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\n// apps/api-gateway/src/auth/auth.module.ts\n\nimport { Module } from '@nestjs/common';\nimport { ClientsModule, Transport } from '@nestjs/microservices';\n\nimport { AuthController } from './auth.controller';\nimport { AuthService } from './auth.service';\n\n@Module({\n  imports: [\n    ClientsModule.register([\n      {\n        name: 'AUTH_MICROSERVICE',\n        transport: Transport.TCP,\n        options: {\n          host: 'localhost',\n          port: 3001,\n        },\n      },\n    ]),\n  ],\n  providers: [AuthService],\n  controllers: [AuthController],\n})\nexport class AuthModule {}\n```\n\nìœ„ ì½”ë“œì—ì„œ ê° transporterëŠ” name ì†ì„±, ì„ íƒì ì¸ transport ì†ì„± (ê¸°ë³¸ê°’ì€ Transport.TCP), ê·¸ë¦¬ê³  ì„ íƒì ì¸ transporterì— íŠ¹í™”ëœ options ì†ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n\nëª¨ë“ˆì„ importí•œ í›„ì—ëŠ” @Inject() ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ auth.service.ts íŒŒì¼ì—ì„œ AUTH_MICROSERVICE transporter ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±ëœ ClientProxy ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤:\n\n```js\n// apps/api-gateway/src/auth/auth.service.ts\n\nimport { Inject, Injectable } from '@nestjs/common';\nimport { ClientProxy } from '@nestjs/microservices';\n\nimport { CreateUserDto, User } from '@nestjs-microservices/shared';\n\n@Injectable()\nexport class AuthService {\n  constructor(\n    @Inject('AUTH_MICROSERVICE') private readonly authClient: ClientProxy\n  ) {}\n\n  getUser(createUserDto: CreateUserDto) {\n    return this.authClient.send<User, CreateUserDto>('get_user', createUserDto);\n  }\n\n  createUser(createUserDto: CreateUserDto) {\n    return this.authClient.send<User, CreateUserDto>('create_user', createUserDto);\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\nìœ„ì—ì„œ ë³´ë“¯ì´, get_user ë˜ëŠ” create_user íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë“±ë¡í•  ë•Œ ì´ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\n\nsend ë©”ì„œë“œëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µìœ¼ë¡œ Observableì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‘ ê°€ì§€ ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:\n\n- pattern â€” @MessagePattern() ë°ì½”ë ˆì´í„°ì—ì„œ ì •ì˜ëœ ê²ƒ ì¤‘ í•˜ë‚˜\n- payload â€” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€\n\në§ˆì§€ë§‰ìœ¼ë¡œ, login ë° signupì„ ìœ„í•œ ë‘ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°–ëŠ” AuthController í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\n// apps/api-gateway/src/auth/auth.controller.ts\n\nimport { Body, Controller, Post, BadRequestException } from '@nestjs/common';\nimport { lastValueFrom } from 'rxjs';\n\nimport { CreateUserDto, User } from '@nestjs-microservices/shared';\n\nimport { AuthService } from './auth.service';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(private readonly authService: AuthService) {}\n\n  @Post('login')\n  async login(@Body() createUserDto: CreateUserDto) {\n    const user: User = await lastValueFrom(this.authService.getUser(createUserDto), {\n      defaultValue: undefined,\n    });\n    if (!user) {\n      throw new BadRequestException('Invalid credentials');\n    }\n\n    const isMatch = user.password === createUserDto.password;\n    if (!isMatch) {\n      throw new BadRequestException('Incorrect password');\n    }\n\n    console.log(`User ${user.username} successfully logged in.`);\n\n    return user;\n  }\n\n  @Post('signup')\n  async signup(@Body() createUserDto: CreateUserDto) {\n    const user: User = await lastValueFrom(this.authService.getUser(createUserDto), {\n      defaultValue: undefined,\n    });\n    if (user) {\n      throw new BadRequestException(\n        `Username ${createUserDto.username} already exists!`\n      );\n    }\n\n    return this.authService.createUser(createUserDto);\n  }\n}\n```\n\nì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´, getUser ë° createUser ì¸ì¦ í´ë¼ì´ì–¸íŠ¸ ë©”ì„œë“œëŠ” Obserableì„ ë°˜í™˜í•˜ë¯€ë¡œ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ê¸° ì „ì— ëª…ì‹œì ìœ¼ë¡œ êµ¬ë…í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ rxjsì—ì„œ ê°€ì ¸ì˜¨ lastValueFrom ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Observableì„ Promiseë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ìƒì„±\n\nì´ì œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì²« ë²ˆì§¸ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤:\n\n<div class=\"content-ad\"></div>\n\n```js\nnx g @nx/nest:app auth-microservice\n```\n\nì•ˆë…•í•˜ì„¸ìš”! auth-microservice ì•±ì˜ main.ts íŒŒì¼ ë‚´ bootstrap() í•¨ìˆ˜ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë¥¼ NestFactory.createMicroservice() ë©”ì†Œë“œë¡œ ì—…ë°ì´íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤:\n\n```js\n// apps/auth-microservice/src/main.ts\n\nimport { Logger } from '@nestjs/common';\nimport { NestFactory } from '@nestjs/core';\nimport { Transport, MicroserviceOptions } from '@nestjs/microservices';\n\nimport { AppModule } from './app/app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.createMicroservice<MicroserviceOptions>(\n    AppModule,\n    {\n      transport: Transport.TCP,\n      options: {\n        host: 'localhost',\n        port: 3001,\n      },\n    }\n  );\n\n  await app.listen();\n\n  Logger.log('ğŸš€ Auth microservice is listening');\n}\n\nbootstrap();\n```\n\nNestFactory í´ë˜ìŠ¤ì˜ createMicroservice() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ì£¼ ê°„ë‹¨í•˜ì£ ! ë§Œì•½ ê¶ê¸ˆí•œ ì ì´ ìˆê±°ë‚˜ ë„ì›€ì´ í•„ìš”í•˜ì‹œë‹¤ë©´ ì–¸ì œë“ ì§€ ë¬¼ì–´ì£¼ì„¸ìš”! ğŸ˜Šâœ¨\n\n\n<div class=\"content-ad\"></div>\n\nê·¸ëŸ¬ë©´ ì‚¬ìš©ì ì—”í‹°í‹°ë¥¼ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ìƒì„±í•˜ì—¬ UsersRepository í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•  ê²ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```js\n// shared/src/lib/entities/user.entity.ts\n\nexport class User {\n  id?: number;\n  username: string;\n  password: string;\n}\n```\n\nìš°ë¦¬ëŠ” ì–´ë–¤ ë°ì´í„°ë² ì´ìŠ¤ë„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©° ê°„ê²°í•¨ì„ ìœ„í•´ ì´ ë°ëª¨ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•  ê²ë‹ˆë‹¤. UserRepository í´ë˜ìŠ¤ë¥¼ í¬í•¨í•œ ê°„ë‹¨í•œ user.repository.ts íŒŒì¼ì„ ë§Œë“¤ì–´ë³´ì£ .\n\n```js\n// apps/auth-microservice/src/app/user.repository.ts\n\nimport { Injectable } from '@nestjs/common';\n\nimport { CreateUserDto, User } from '@nestjs-microservices/shared';\n\n@Injectable()\nexport class UserRepository {\n  private users: User[] = [];\n\n  save(user: CreateUserDto): User {\n    const newUser = new User();\n    newUser.id = this.users.length + 1;\n    newUser.username = user.username;\n    newUser.password = user.password;\n    this.users.push(newUser);\n    return newUser;\n  }\n\n  findOne(username: string): User | undefined {\n    return this.users.find((user) => user.username === username);\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\nì´ì œ createUser() ë° getUser()ë¥¼ app.service.tsì—ì„œ UserRepository ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  ì°¾ëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•  ê²ƒì…ë‹ˆë‹¤:\n\n```js\n// apps/auth-microservice/src/app/app.service.ts\n\nimport { Injectable } from '@nestjs/common';\n\nimport { CreateUserDto, User } from '@nestjs-microservices/shared';\n\nimport { UserRepository } from './user.repository';\n\n@Injectable()\nexport class AppService {\n  constructor(private readonly userRepository: UserRepository) {}\n\n  createUser(newUser: CreateUserDto): User {\n    return this.userRepository.save(newUser);\n  }\n\n  getUser(username: string): User | undefined {\n    return this.userRepository.findOne(username);\n  }\n}\n```\n\në§ˆì§€ë§‰ìœ¼ë¡œ, @nestjs/microservices íŒ¨í‚¤ì§€ì—ì„œ ê°€ì ¸ì˜¨ @MessagePattern() ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­-ì‘ë‹µ íŒ¨ëŸ¬ë‹¤ì„ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë©”ì†Œë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n\n```js\n// apps/auth-microservice/src/app/app.controller.ts\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @MessagePattern('get_user') // get_user ë©”ì‹œì§€ íŒ¨í„´ì„ ìˆ˜ì‹  ëŒ€ê¸°\n  handleGetUser(user: CreateUserDto) {\n    return this.appService.getUser(user.username);\n  }\n\n  @MessagePattern('create_user') // create_user ë©”ì‹œì§€ íŒ¨í„´ì„ ìˆ˜ì‹  ëŒ€ê¸°\n  handleCreateUser(newUser: CreateUserDto) {\n    return this.appService.createUser(newUser);\n  }\n}\n```\n\n<div class=\"content-ad\"></div>\n\nìœ„ ì½”ë“œì—ì„œ handleGetUser() ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ëŠ” get_user ë©”ì‹œì§€ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ì´ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ëœ CreateUserDto ìœ í˜•ì˜ ì‚¬ìš©ìë¥¼ ì¸ìë¡œ ì·¨í•©ë‹ˆë‹¤.\n\n# ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸\n\nëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ê°œë³„ì ìœ¼ë¡œ ë³„ë„ì˜ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:\n\n```js\nnx serve api-gateway\nnx serve auth-microservice\n```\n\n<div class=\"content-ad\"></div>\n\nì•±ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Postmanì´ë‚˜ ë‹¤ë¥¸ API í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.\n\n## ì˜ëª»ëœ ìê²© ì¦ëª…ìœ¼ë¡œ ë¡œê·¸ì¸\n\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_2.png\" />\n\n## ê°€ì…\n\n<div class=\"content-ad\"></div>\n\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_3.png\" />\n\n## ë¡œê·¸ì¸\n\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_4.png\" />\n\n## ë™ì¼í•œ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ê°€ì…\n\n<div class=\"content-ad\"></div>\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_5.png)\n\n# ê²°ë¡ \n\nì½”ë“œë¥¼ ëª¨ë‘ í™•ì¸í•˜ë ¤ë©´ GitHub ë§í¬ë¥¼ í´ë¦­í•˜ì„¸ìš”.\n\nì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ â€” ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì¦ê±°ìš´ ì½”ë”© ë˜ì„¸ìš”!\n\n<div class=\"content-ad\"></div>\n\n# ìì›","ogImage":{"url":"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_0.png"},"coverImage":"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_0.png","tag":["Tech"],"readingTime":11},"content":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta content=\"width=device-width, initial-scale=1\" name=\"viewport\">\n</head>\n<body>\n<h2>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ì„œë¡œ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë°©ë²•</h2>\n<p><img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_0.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<p>í”„ë¡œì íŠ¸ê°€ ì ì  ì»¤ì§€ë©´ì„œ ë”ìš± ê³ ê¸‰ ì•„í‚¤í…ì²˜ê°€ í•„ìš”í•´ì§‘ë‹ˆë‹¤. ê·¸ë˜ì„œ ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ë¡œì„œ, í˜„ëŒ€ì ì´ê³  ì¸ê¸° ìˆëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¥¼ ì†Œê°œí•˜ê³ ì í•©ë‹ˆë‹¤. ì´ ì•„í‚¤í…ì²˜ëŠ” SOA (Service Oriented Architecture) ê°œë…ì„ ë”°ë¦…ë‹ˆë‹¤.</p>\n<p>ì´ ê¸€ì—ì„œëŠ” ë‹¨ì¼ì²´ì™€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì°¨ì´ë¥¼ ì´ì•¼ê¸°í•˜ê³ , NestJS, TCP ë° Typescriptë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ë“œë¦¬ë ¤ê³  í•©ë‹ˆë‹¤. ë¨¼ì € ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ê°€ ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<div class=\"content-ad\"></div>\n<h1>ë¯¸í¬ë¡œì„œë¹„ìŠ¤ë€ ë¬´ì—‡ì¸ê°€</h1>\n<p>ë¯¸í¬ë¡œì„œë¹„ìŠ¤ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì˜ ì•„í‚¤í…ì²˜ì  ê´€ì ìœ¼ë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ê°€ ì‘ê³  ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤ë¡œ êµ¬ì„±ë˜ì–´ ì„œë¡œ ì •ì˜ëœ APIë¥¼ í†µí•´ í†µì‹ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ê° ì„œë¹„ìŠ¤ëŠ” íŠ¹ì • ì‘ì—…ì´ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œë¥¼ ì§€ì›í•˜ë©° ë‹¤ë¥¸ ëª¨ë“ˆ ë° ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¥í•˜ê³  ë” ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆì–´ í˜ì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©° ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì‹œì¥ì— ë¹ ë¥´ê²Œ ë‚´ë†“ì„ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>\n<p>ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ì™€ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì£¼ìš” ì°¨ì´ëŠ” ë¬´ì—‡ì¸ê°€ìš”? ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ì—ì„œëŠ” ëª¨ë“  ê¸°ëŠ¥ê³¼ ì„œë¹„ìŠ¤ê°€ ê²°í•©ë¼ ë‹¨ì¼ ë‹¨ìœ„ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” ê¸°ë°˜ ë¡œì§ì„ ì„œë¡œ ë‹¤ë¥¸ ì‘ì—…ì´ë‚˜ ì„œë¹„ìŠ¤ë¡œ ë¶„í•´í•˜ì—¬ ê°œë³„ì ìœ¼ë¡œ ê°œë°œí•˜ê³ , ë°°í¬í•˜ë©° APIë¥¼ í†µí•´ ë…¸ì¶œí•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤.</p>\n<p>ë” ë‚˜ì€ ì´í•´ë¥¼ ìœ„í•´ ì €í¬ëŠ” í•¨ê»˜ NestJSì—ì„œ ë¯¸í¬ë¡œì„œë¹„ìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ê°œë°œí•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>\n<div class=\"content-ad\"></div>\n<h1>í”„ë¡œì íŠ¸ ì„¤ì •í•˜ê¸°</h1>\n<p>ì‹œì‘í•˜ê¸° ì „ì—, ì €í¬ í”„ë¡œì íŠ¸ì˜ ë‘ ê°€ì§€ ì£¼ìš” ì¸¡ë©´ì„ ê°•ì¡°í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤:</p>\n<ul>\n<li>auth-microservice: ì‚¬ìš©ì ê¶Œí•œì„ ê´€ë¦¬í•˜ëŠ” ì¸ì¦ ì„œë¹„ìŠ¤</li>\n<li>API Gateway: í´ë¼ì´ì–¸íŠ¸ì™€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì‚¬ì´ì— ìœ„ì¹˜í•˜ë©° HTTP API ì—”ë“œí¬ì¸íŠ¸ë¡œë¶€í„° ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ì„œë¹„ìŠ¤</li>\n</ul>\n<p>ê°„ëµíˆ ì„¤ëª…í•˜ë©´, ì‚¬ìš©ìê°€ ìê²© ì¦ëª…ìœ¼ë¡œ /api/login ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ë©´ API ê²Œì´íŠ¸ì›¨ì´ì— ì—°ê²°ë©ë‹ˆë‹¤. API ê²Œì´íŠ¸ì›¨ì´ëŠ” ê·¸ëŸ° ë‹¤ìŒ ìš”ì²­-ì‘ë‹µ ìŠ¤íƒ€ì¼ì˜ ë©”ì‹œì§€ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì™€ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì €í¬ ì•±ì´ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<div class=\"content-ad\"></div>\n<p>ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•  ì˜ˆì •ì´ë¯€ë¡œ ì—¬ëŸ¬ ì•±ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í¬í•¨ëœ ë‹¨ì¼ ë²„ì „ ê´€ë¦¬ ì½”ë“œ ì €ì¥ì†Œì¸ ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ë¥¼ ê°€ì§€ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë…¸-ì €ì¥ì†Œì—ì„œ ì›¹ ì•± ë° ì„œë¹„ìŠ¤ë¥¼ ë¹Œë“œí•˜ê³  í™•ì¥í•  ìˆ˜ ìˆëŠ” Nx ë„êµ¬ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ìš°ì„  ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-js\">npx create-nx-workspace nestjs-microservices --preset=nest\n</code></pre>\n<p>ì•± ì´ë¦„ì„ api-gatewayë¡œ ì§€ì •í•´ì£¼ì„¸ìš”.</p>\n<div class=\"content-ad\"></div>\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_1.png\">\n<p>ì´ì œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ í”„ë¡œì íŠ¸ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•´ë´…ì‹œë‹¤:</p>\n<pre><code class=\"hljs language-js\">cd nestjs-microservices\nnpm i @nestjs/microservices <span class=\"hljs-keyword\">class</span>-validator <span class=\"hljs-keyword\">class</span>-transformer\n</code></pre>\n<h1>Auth ëª¨ë“ˆ ì¶”ê°€í•˜ê¸°</h1>\n<div class=\"content-ad\"></div>\n<p>ìš°ë¦¬ í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìœ¼ë¯€ë¡œ, nxëŠ” ì´ë¯¸ API Gateway ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤. ì´ì œ API Gateway ì•±ì—ì„œ ì¸ì¦ ëª¨ë“ˆì„ ë§Œë“¤ì–´ì„œ ì¸ì¦ ê´€ë ¨ ìš”ì²­ì„ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ì‚¬ìš©ìê°€ ì•±ì— ìš”ì²­ì„ ë³´ë‚´ë©´ API Gatewayê°€ ìš”ì²­ì„ ë°›ì•„ì„œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë™ì¼í•œ ë°ì´í„° ìœ í˜•ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ í”¼í•˜ê¸° ìœ„í•´ ëª¨ë†€ë¦¬í¬ ë‚´ì—ì„œ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì½”ë“œë¥¼ ì—¬ê¸°ì €ê¸° ì¤‘ë³µ ìƒì„±í•˜ì§€ ì•Šê³  ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">nx g @nx/<span class=\"hljs-attr\">nest</span>:lib shared\n</code></pre>\n<p>ì´ì œ dto í´ë”ë¥¼ ë§Œë“¤ì–´ì„œ create-user.dto.ts íŒŒì¼ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-comment\">// shared/src/lib/dto/create-user.dto.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">IsNotEmpty</span>, <span class=\"hljs-title class_\">IsString</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'class-validator'</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CreateUserDto</span> {\n  <span class=\"hljs-meta\">@IsString</span>()\n  <span class=\"hljs-meta\">@IsNotEmpty</span>()\n  <span class=\"hljs-attr\">username</span>: <span class=\"hljs-built_in\">string</span>;\n\n  <span class=\"hljs-meta\">@IsNotEmpty</span>()\n  <span class=\"hljs-attr\">password</span>: <span class=\"hljs-built_in\">string</span>;\n}\n</code></pre>\n<p>ë˜í•œ tsconfig.base.jsonì— ê²½ë¡œ í•­ëª©ì„ ì¶”ê°€í•˜ê³  ì ˆëŒ€ ê²½ë¡œë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  ...\n  <span class=\"hljs-attr\">\"compilerOptions\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    ...\n    <span class=\"hljs-attr\">\"paths\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"@nestjs-microservices/shared\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"shared/src/index.ts\"</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  ...\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>NestJSëŠ” ê¸°ë³¸ TCP ì „ì†¡ ê³„ì¸µì„ ì‚¬ìš©í•˜ì—¬ ì„œë¡œ ë‹¤ë¥¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ê°„ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. NestJSëŠ” microservice ì „ì†¡ìë¥¼ ì„¤ëª…í•˜ëŠ” ê°ì²´ ë°°ì—´ì„ ì¸ìë¡œë°›ëŠ” static register() ë©”ì„œë“œë¥¼ ë…¸ì¶œí•˜ëŠ” ClientsModuleì„ ì œê³µí•©ë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œ ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ auth.service.tsë¥¼ ì¶”ê°€í•˜ê³  AUTH_MICROSERVICEë¥¼ ë“±ë¡í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/api-gateway/src/auth/auth.module.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Module</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">ClientsModule</span>, <span class=\"hljs-title class_\">Transport</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/microservices'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">AuthController</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./auth.controller'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">AuthService</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./auth.service'</span>;\n\n@<span class=\"hljs-title class_\">Module</span>({\n  <span class=\"hljs-attr\">imports</span>: [\n    <span class=\"hljs-title class_\">ClientsModule</span>.<span class=\"hljs-title function_\">register</span>([\n      {\n        <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">'AUTH_MICROSERVICE'</span>,\n        <span class=\"hljs-attr\">transport</span>: <span class=\"hljs-title class_\">Transport</span>.<span class=\"hljs-property\">TCP</span>,\n        <span class=\"hljs-attr\">options</span>: {\n          <span class=\"hljs-attr\">host</span>: <span class=\"hljs-string\">'localhost'</span>,\n          <span class=\"hljs-attr\">port</span>: <span class=\"hljs-number\">3001</span>,\n        },\n      },\n    ]),\n  ],\n  <span class=\"hljs-attr\">providers</span>: [<span class=\"hljs-title class_\">AuthService</span>],\n  <span class=\"hljs-attr\">controllers</span>: [<span class=\"hljs-title class_\">AuthController</span>],\n})\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AuthModule</span> {}\n</code></pre>\n<p>ìœ„ ì½”ë“œì—ì„œ ê° transporterëŠ” name ì†ì„±, ì„ íƒì ì¸ transport ì†ì„± (ê¸°ë³¸ê°’ì€ Transport.TCP), ê·¸ë¦¬ê³  ì„ íƒì ì¸ transporterì— íŠ¹í™”ëœ options ì†ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>\n<p>ëª¨ë“ˆì„ importí•œ í›„ì—ëŠ” @Inject() ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ auth.service.ts íŒŒì¼ì—ì„œ AUTH_MICROSERVICE transporter ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±ëœ ClientProxy ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/api-gateway/src/auth/auth.service.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Inject</span>, <span class=\"hljs-title class_\">Injectable</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">ClientProxy</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/microservices'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">CreateUserDto</span>, <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs-microservices/shared'</span>;\n\n@<span class=\"hljs-title class_\">Injectable</span>()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AuthService</span> {\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">\n    @Inject(<span class=\"hljs-string\">'AUTH_MICROSERVICE'</span>) private readonly authClient: ClientProxy\n  </span>) {}\n\n  <span class=\"hljs-title function_\">getUser</span>(<span class=\"hljs-params\">createUserDto: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">authClient</span>.<span class=\"hljs-property\">send</span>&#x3C;<span class=\"hljs-title class_\">User</span>, <span class=\"hljs-title class_\">CreateUserDto</span>>(<span class=\"hljs-string\">'get_user'</span>, createUserDto);\n  }\n\n  <span class=\"hljs-title function_\">createUser</span>(<span class=\"hljs-params\">createUserDto: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">authClient</span>.<span class=\"hljs-property\">send</span>&#x3C;<span class=\"hljs-title class_\">User</span>, <span class=\"hljs-title class_\">CreateUserDto</span>>(<span class=\"hljs-string\">'create_user'</span>, createUserDto);\n  }\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>ìœ„ì—ì„œ ë³´ë“¯ì´, get_user ë˜ëŠ” create_user íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë“±ë¡í•  ë•Œ ì´ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<p>send ë©”ì„œë“œëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µìœ¼ë¡œ Observableì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‘ ê°€ì§€ ì¸ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>\n<ul>\n<li>pattern â€” @MessagePattern() ë°ì½”ë ˆì´í„°ì—ì„œ ì •ì˜ëœ ê²ƒ ì¤‘ í•˜ë‚˜</li>\n<li>payload â€” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— ì „ë‹¬í•˜ë ¤ëŠ” ë©”ì‹œì§€</li>\n</ul>\n<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, login ë° signupì„ ìœ„í•œ ë‘ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°–ëŠ” AuthController í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/api-gateway/src/auth/auth.controller.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Body</span>, <span class=\"hljs-title class_\">Controller</span>, <span class=\"hljs-title class_\">Post</span>, <span class=\"hljs-title class_\">BadRequestException</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n<span class=\"hljs-keyword\">import</span> { lastValueFrom } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'rxjs'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">CreateUserDto</span>, <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs-microservices/shared'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">AuthService</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./auth.service'</span>;\n\n@<span class=\"hljs-title class_\">Controller</span>(<span class=\"hljs-string\">'auth'</span>)\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AuthController</span> {\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">private readonly authService: AuthService</span>) {}\n\n  @<span class=\"hljs-title class_\">Post</span>(<span class=\"hljs-string\">'login'</span>)\n  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">login</span>(<span class=\"hljs-params\">@Body() createUserDto: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">user</span>: <span class=\"hljs-title class_\">User</span> = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">lastValueFrom</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">authService</span>.<span class=\"hljs-title function_\">getUser</span>(createUserDto), {\n      <span class=\"hljs-attr\">defaultValue</span>: <span class=\"hljs-literal\">undefined</span>,\n    });\n    <span class=\"hljs-keyword\">if</span> (!user) {\n      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BadRequestException</span>(<span class=\"hljs-string\">'Invalid credentials'</span>);\n    }\n\n    <span class=\"hljs-keyword\">const</span> isMatch = user.<span class=\"hljs-property\">password</span> === createUserDto.<span class=\"hljs-property\">password</span>;\n    <span class=\"hljs-keyword\">if</span> (!isMatch) {\n      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BadRequestException</span>(<span class=\"hljs-string\">'Incorrect password'</span>);\n    }\n\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`User <span class=\"hljs-subst\">${user.username}</span> successfully logged in.`</span>);\n\n    <span class=\"hljs-keyword\">return</span> user;\n  }\n\n  @<span class=\"hljs-title class_\">Post</span>(<span class=\"hljs-string\">'signup'</span>)\n  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">signup</span>(<span class=\"hljs-params\">@Body() createUserDto: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">user</span>: <span class=\"hljs-title class_\">User</span> = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">lastValueFrom</span>(<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">authService</span>.<span class=\"hljs-title function_\">getUser</span>(createUserDto), {\n      <span class=\"hljs-attr\">defaultValue</span>: <span class=\"hljs-literal\">undefined</span>,\n    });\n    <span class=\"hljs-keyword\">if</span> (user) {\n      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BadRequestException</span>(\n        <span class=\"hljs-string\">`Username <span class=\"hljs-subst\">${createUserDto.username}</span> already exists!`</span>\n      );\n    }\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">authService</span>.<span class=\"hljs-title function_\">createUser</span>(createUserDto);\n  }\n}\n</code></pre>\n<p>ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´, getUser ë° createUser ì¸ì¦ í´ë¼ì´ì–¸íŠ¸ ë©”ì„œë“œëŠ” Obserableì„ ë°˜í™˜í•˜ë¯€ë¡œ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ê¸° ì „ì— ëª…ì‹œì ìœ¼ë¡œ êµ¬ë…í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ rxjsì—ì„œ ê°€ì ¸ì˜¨ lastValueFrom ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Observableì„ Promiseë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h1>ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ìƒì„±</h1>\n<p>ì´ì œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì²« ë²ˆì§¸ ì¸ì¦ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•  ê²ƒì…ë‹ˆë‹¤:</p>\n<div class=\"content-ad\"></div>\n<pre><code class=\"hljs language-js\">nx g @nx/<span class=\"hljs-attr\">nest</span>:app auth-microservice\n</code></pre>\n<p>ì•ˆë…•í•˜ì„¸ìš”! auth-microservice ì•±ì˜ main.ts íŒŒì¼ ë‚´ bootstrap() í•¨ìˆ˜ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë¥¼ NestFactory.createMicroservice() ë©”ì†Œë“œë¡œ ì—…ë°ì´íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/auth-microservice/src/main.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Logger</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">NestFactory</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/core'</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Transport</span>, <span class=\"hljs-title class_\">MicroserviceOptions</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/microservices'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">AppModule</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./app/app.module'</span>;\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">bootstrap</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title class_\">NestFactory</span>.<span class=\"hljs-property\">createMicroservice</span>&#x3C;<span class=\"hljs-title class_\">MicroserviceOptions</span>>(\n    <span class=\"hljs-title class_\">AppModule</span>,\n    {\n      <span class=\"hljs-attr\">transport</span>: <span class=\"hljs-title class_\">Transport</span>.<span class=\"hljs-property\">TCP</span>,\n      <span class=\"hljs-attr\">options</span>: {\n        <span class=\"hljs-attr\">host</span>: <span class=\"hljs-string\">'localhost'</span>,\n        <span class=\"hljs-attr\">port</span>: <span class=\"hljs-number\">3001</span>,\n      },\n    }\n  );\n\n  <span class=\"hljs-keyword\">await</span> app.<span class=\"hljs-title function_\">listen</span>();\n\n  <span class=\"hljs-title class_\">Logger</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">'ğŸš€ Auth microservice is listening'</span>);\n}\n\n<span class=\"hljs-title function_\">bootstrap</span>();\n</code></pre>\n<p>NestFactory í´ë˜ìŠ¤ì˜ createMicroservice() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ì£¼ ê°„ë‹¨í•˜ì£ ! ë§Œì•½ ê¶ê¸ˆí•œ ì ì´ ìˆê±°ë‚˜ ë„ì›€ì´ í•„ìš”í•˜ì‹œë‹¤ë©´ ì–¸ì œë“ ì§€ ë¬¼ì–´ì£¼ì„¸ìš”! ğŸ˜Šâœ¨</p>\n<div class=\"content-ad\"></div>\n<p>ê·¸ëŸ¬ë©´ ì‚¬ìš©ì ì—”í‹°í‹°ë¥¼ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ìƒì„±í•˜ì—¬ UsersRepository í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•  ê²ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// shared/src/lib/entities/user.entity.ts</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> {\n  id?: number;\n  <span class=\"hljs-attr\">username</span>: string;\n  <span class=\"hljs-attr\">password</span>: string;\n}\n</code></pre>\n<p>ìš°ë¦¬ëŠ” ì–´ë–¤ ë°ì´í„°ë² ì´ìŠ¤ë„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©° ê°„ê²°í•¨ì„ ìœ„í•´ ì´ ë°ëª¨ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•  ê²ë‹ˆë‹¤. UserRepository í´ë˜ìŠ¤ë¥¼ í¬í•¨í•œ ê°„ë‹¨í•œ user.repository.ts íŒŒì¼ì„ ë§Œë“¤ì–´ë³´ì£ .</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/auth-microservice/src/app/user.repository.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Injectable</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">CreateUserDto</span>, <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs-microservices/shared'</span>;\n\n@<span class=\"hljs-title class_\">Injectable</span>()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UserRepository</span> {\n  private <span class=\"hljs-attr\">users</span>: <span class=\"hljs-title class_\">User</span>[] = [];\n\n  <span class=\"hljs-title function_\">save</span>(<span class=\"hljs-attr\">user</span>: <span class=\"hljs-title class_\">CreateUserDto</span>): <span class=\"hljs-title class_\">User</span> {\n    <span class=\"hljs-keyword\">const</span> newUser = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">User</span>();\n    newUser.<span class=\"hljs-property\">id</span> = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">users</span>.<span class=\"hljs-property\">length</span> + <span class=\"hljs-number\">1</span>;\n    newUser.<span class=\"hljs-property\">username</span> = user.<span class=\"hljs-property\">username</span>;\n    newUser.<span class=\"hljs-property\">password</span> = user.<span class=\"hljs-property\">password</span>;\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">push</span>(newUser);\n    <span class=\"hljs-keyword\">return</span> newUser;\n  }\n\n  <span class=\"hljs-title function_\">findOne</span>(<span class=\"hljs-attr\">username</span>: string): <span class=\"hljs-title class_\">User</span> | <span class=\"hljs-literal\">undefined</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">user</span>) =></span> user.<span class=\"hljs-property\">username</span> === username);\n  }\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>ì´ì œ createUser() ë° getUser()ë¥¼ app.service.tsì—ì„œ UserRepository ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  ì°¾ëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•  ê²ƒì…ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/auth-microservice/src/app/app.service.ts</span>\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">Injectable</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs/common'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">CreateUserDto</span>, <span class=\"hljs-title class_\">User</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'@nestjs-microservices/shared'</span>;\n\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">UserRepository</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./user.repository'</span>;\n\n@<span class=\"hljs-title class_\">Injectable</span>()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AppService</span> {\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">private readonly userRepository: UserRepository</span>) {}\n\n  <span class=\"hljs-title function_\">createUser</span>(<span class=\"hljs-attr\">newUser</span>: <span class=\"hljs-title class_\">CreateUserDto</span>): <span class=\"hljs-title class_\">User</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">userRepository</span>.<span class=\"hljs-title function_\">save</span>(newUser);\n  }\n\n  <span class=\"hljs-title function_\">getUser</span>(<span class=\"hljs-attr\">username</span>: string): <span class=\"hljs-title class_\">User</span> | <span class=\"hljs-literal\">undefined</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">userRepository</span>.<span class=\"hljs-title function_\">findOne</span>(username);\n  }\n}\n</code></pre>\n<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, @nestjs/microservices íŒ¨í‚¤ì§€ì—ì„œ ê°€ì ¸ì˜¨ @MessagePattern() ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­-ì‘ë‹µ íŒ¨ëŸ¬ë‹¤ì„ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ë©”ì†Œë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// apps/auth-microservice/src/app/app.controller.ts</span>\n\n@<span class=\"hljs-title class_\">Controller</span>()\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AppController</span> {\n  <span class=\"hljs-title function_\">constructor</span>(<span class=\"hljs-params\">private readonly appService: AppService</span>) {}\n\n  @<span class=\"hljs-title class_\">MessagePattern</span>(<span class=\"hljs-string\">'get_user'</span>) <span class=\"hljs-comment\">// get_user ë©”ì‹œì§€ íŒ¨í„´ì„ ìˆ˜ì‹  ëŒ€ê¸°</span>\n  <span class=\"hljs-title function_\">handleGetUser</span>(<span class=\"hljs-params\">user: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">appService</span>.<span class=\"hljs-title function_\">getUser</span>(user.<span class=\"hljs-property\">username</span>);\n  }\n\n  @<span class=\"hljs-title class_\">MessagePattern</span>(<span class=\"hljs-string\">'create_user'</span>) <span class=\"hljs-comment\">// create_user ë©”ì‹œì§€ íŒ¨í„´ì„ ìˆ˜ì‹  ëŒ€ê¸°</span>\n  <span class=\"hljs-title function_\">handleCreateUser</span>(<span class=\"hljs-params\">newUser: CreateUserDto</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">appService</span>.<span class=\"hljs-title function_\">createUser</span>(newUser);\n  }\n}\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>ìœ„ ì½”ë“œì—ì„œ handleGetUser() ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ëŠ” get_user ë©”ì‹œì§€ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ì´ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ëœ CreateUserDto ìœ í˜•ì˜ ì‚¬ìš©ìë¥¼ ì¸ìë¡œ ì·¨í•©ë‹ˆë‹¤.</p>\n<h1>ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸</h1>\n<p>ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ê°œë³„ì ìœ¼ë¡œ ë³„ë„ì˜ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:</p>\n<pre><code class=\"hljs language-js\">nx serve api-gateway\nnx serve auth-microservice\n</code></pre>\n<div class=\"content-ad\"></div>\n<p>ì•±ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Postmanì´ë‚˜ ë‹¤ë¥¸ API í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.</p>\n<h2>ì˜ëª»ëœ ìê²© ì¦ëª…ìœ¼ë¡œ ë¡œê·¸ì¸</h2>\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_2.png\">\n<h2>ê°€ì…</h2>\n<div class=\"content-ad\"></div>\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_3.png\">\n<h2>ë¡œê·¸ì¸</h2>\n<img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_4.png\">\n<h2>ë™ì¼í•œ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ê°€ì…</h2>\n<div class=\"content-ad\"></div>\n<p><img src=\"/assets/img/2024-06-20-BuildingMicroserviceswithNestJSTCPandTypescript_5.png\" alt=\"ì´ë¯¸ì§€\"></p>\n<h1>ê²°ë¡ </h1>\n<p>ì½”ë“œë¥¼ ëª¨ë‘ í™•ì¸í•˜ë ¤ë©´ GitHub ë§í¬ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>\n<p>ì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ â€” ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì¦ê±°ìš´ ì½”ë”© ë˜ì„¸ìš”!</p>\n<div class=\"content-ad\"></div>\n<h1>ìì›</h1>\n</body>\n</html>\n"},"__N_SSG":true}