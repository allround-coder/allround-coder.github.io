<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase" data-gatsby-head="true"/><meta name="twitter:title" content="잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 04:43" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/QH5Mz7n7Y6w0r4_gCGFQf/_buildManifest.js" defer=""></script><script src="/_next/static/QH5Mz7n7Y6w0r4_gCGFQf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">17<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<ul>
<li>대부분의 기술적거래지표(TTI)는 과거 주식 데이터에서 유래되며 미래 가격 흐름 반전을 예측하고 거래 결정을 내리는 데 거래자들에 의해 사용됩니다.</li>
<li>금융 시장 예측은 시간에 따라 변하는 시장 소음 수준이 뒤틀리는 기본 트렌드와 계절적 주기의 이미지를 왜곡하기 때문에 매우 어려운 작업임이 널리 인정되고 있습니다.</li>
<li>알고트레이딩에서 기술적 분석은 항상 패턴 및 신호를 식별하는 데 의존하지만 때로는 신뢰성 없는 것이 있을 수 있습니다. (신호/소음)`1.</li>
<li>실제로, 가짜 가격 변동 및 오작동이 잘못된 TTI 신호를 초래하여 리스크-수익 최적화를 감소시키고 좋지 않은 거래 전략을 야기할 수 있습니다.</li>
<li>본 게시물에서는 불확실하고 정확하지 않은 시계열 데이터에 기초한 숨겨진 변수의 소음이 적절한 확률 추정을 제공하는 칼만 필터(KF)를 사용하여 TTI의 상기한 단점을 다룰 것입니다.</li>
<li>KF는 선형 가우시안 상태 공간 모델에서 이론적으로 최적인 것으로 알려져 있으며, 추정된 오차 공분산을 최소화함으로써 베이지안 예측 및 수정의 최적의 재귀적 구현이라고 할 수 있습니다.</li>
<li>여기서, 우리의 목적은 짧은 윈도우 칼만 필터 이동 평균(KMA)를 도입하여 SMA 크로스오버 거래 전략의 극심한 소음 민감성을 줄이는 것입니다.</li>
<li>사례 예시로, BAC 주식의 예상 수익율을 비교하여 KMA, SMA 크로스오버 및 매수 &#x26; 보유 알고트레이딩 전략의 백테스트 분석을 수행할 것입니다.</li>
<li>비즈니스적인 측면에서, 제안된 연구는 계속되는 알고트레이딩 SaaS R&#x26;D 노력을 촉진하여 BAC에 대한 거래 봇 및 백테스팅 결과를 업데이트합니다. 이러한 노력은 은행이 대량의 핀테크 데이터를 분석하고 신속하게 거래를 실행하여 이윤을 극대화하고 인적 오류를 최소화합니다.</li>
</ul>
<p>우리의 접근 방식을 구체적으로 살펴보겠습니다.</p>
<h2>기본 Imports 및 설정</h2>
<div class="content-ad"></div>
<ul>
<li>현재 작업 디렉토리를 YOURPATH로 설정하기</li>
</ul>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> os
os.chdir(<span class="hljs-string">'YOURPATH'</span>)    <span class="hljs-comment"># 작업 디렉토리 설정</span>
os.getcwd()
</code></pre>
<ul>
<li>Python 라이브러리 가져오고 설치하기</li>
</ul>
<pre><code class="hljs language-python">!pip install yfinance, pykalman

<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd 
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt 
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> termcolor <span class="hljs-keyword">import</span> colored <span class="hljs-keyword">as</span> cl 
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> yfinance <span class="hljs-keyword">as</span> yf
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> pykalman <span class="hljs-keyword">import</span> KalmanFilter

plt.style.use(<span class="hljs-string">'fivethirtyeight'</span>)
plt.rcParams[<span class="hljs-string">'figure.figsize'</span>] = (<span class="hljs-number">12</span>, <span class="hljs-number">6</span>)
</code></pre>
<div class="content-ad"></div>
<h2>주식 데이터 입력 읽기</h2>
<ul>
<li>야후 파이낸스에서 BAC의 과거 데이터 가져오기</li>
</ul>
<pre><code class="hljs language-js">data = yf.<span class="hljs-title function_">download</span>(<span class="hljs-string">'BAC'</span>, start=<span class="hljs-string">'2023-01-01'</span>, end=<span class="hljs-string">'2024-06-01'</span>)

df=data.<span class="hljs-title function_">drop</span>(columns=[<span class="hljs-string">'Open'</span>, <span class="hljs-string">'High'</span>,<span class="hljs-string">'Low'</span>,<span class="hljs-string">'Adj Close'</span>,<span class="hljs-string">'Volume'</span>])
df.<span class="hljs-title function_">tail</span>()

           <span class="hljs-title class_">Close</span>
<span class="hljs-title class_">Date</span> 
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">24</span> <span class="hljs-number">39.700001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">28</span> <span class="hljs-number">39.320000</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">29</span> <span class="hljs-number">38.720001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">38.630001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">31</span> <span class="hljs-number">39.990002</span>
</code></pre>
<h2>KMA vs SMA40</h2>
<div class="content-ad"></div>
<ul>
<li>파이칼만(pykalman)을 사용한 KF 구현 및 SMA40 계산하기</li>
</ul>
<pre><code class="hljs language-python">kf = KalmanFilter(
    transition_matrices=[<span class="hljs-number">1</span>],
    observation_matrices=[<span class="hljs-number">1</span>],
    initial_state_mean=<span class="hljs-number">0</span>,
    initial_state_covariance=<span class="hljs-number">1</span>,
    observation_covariance=<span class="hljs-number">1</span>,
    transition_covariance=<span class="hljs-number">0.01</span>
)

state_means, _ = kf.<span class="hljs-built_in">filter</span>(df[<span class="hljs-string">'Close'</span>].values)
state_means = pd.Series(state_means.flatten(), index=df.index)
df[<span class="hljs-string">'kma'</span>] = state_means
df[<span class="hljs-string">'sma'</span>] = df[<span class="hljs-string">'Close'</span>].rolling(window=<span class="hljs-number">40</span>).mean()

df.tail()

           Close     kma       sma
Date   
<span class="hljs-number">2024</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">39.700001</span> <span class="hljs-number">38.568957</span> <span class="hljs-number">37.64750</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">28</span> <span class="hljs-number">39.320000</span> <span class="hljs-number">38.640400</span> <span class="hljs-number">37.69250</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">29</span> <span class="hljs-number">38.720001</span> <span class="hljs-number">38.647972</span> <span class="hljs-number">37.72800</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">30</span> <span class="hljs-number">38.630001</span> <span class="hljs-number">38.646262</span> <span class="hljs-number">37.75775</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">39.990002</span> <span class="hljs-number">38.774086</span> <span class="hljs-number">37.83450</span>
</code></pre>
<ul>
<li>여기에서 KF에 대해 더 알아보기.</li>
<li>KMA vs SMA40 그래프 그리기</li>
</ul>
<pre><code class="hljs language-python">plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">6</span>))
plt.plot(df[<span class="hljs-string">'Close'</span>], label=<span class="hljs-string">'BAC'</span>, linewidth=<span class="hljs-number">5</span>, alpha=<span class="hljs-number">0.3</span>)
plt.plot(df[<span class="hljs-string">'kma'</span>], label=<span class="hljs-string">'KMA'</span>)
plt.plot(df[<span class="hljs-string">'sma'</span>], label=<span class="hljs-string">'SMA40'</span>)
plt.title(<span class="hljs-string">'BAC KMA/SMA'</span>)
plt.xlabel(<span class="hljs-string">'Date'</span>)
plt.ylabel(<span class="hljs-string">'Close Price USD'</span>)
plt.legend(loc=<span class="hljs-string">'upper left'</span>)
plt.show()
</code></pre>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_1.png">
<h2>KMA vs SMA20</h2>
<ul>
<li>KMA와 20일 이동평균(SMA)을 비교</li>
</ul>
<pre><code class="hljs language-js">mean30 = df[<span class="hljs-string">'Close'</span>].<span class="hljs-title function_">rolling</span>(<span class="hljs-variable language_">window</span>=<span class="hljs-number">20</span>).<span class="hljs-title function_">mean</span>()

#plt.<span class="hljs-title function_">figure</span>(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">6</span>))
plt.<span class="hljs-title function_">plot</span>(state_means)
plt.<span class="hljs-title function_">plot</span>(df[<span class="hljs-string">'Close'</span>])
plt.<span class="hljs-title function_">plot</span>(mean30)
plt.<span class="hljs-title function_">title</span>(<span class="hljs-string">'Kalman filter estimate of average'</span>, fontsize=<span class="hljs-number">20</span>)
plt.<span class="hljs-title function_">legend</span>([<span class="hljs-string">'Kalman'</span>, <span class="hljs-string">'Price'</span>, <span class="hljs-string">'20-day MA'</span>], fontsize=<span class="hljs-number">20</span>)
plt.<span class="hljs-title function_">xlabel</span>(<span class="hljs-string">'Date'</span>)
plt.<span class="hljs-title function_">ylabel</span>(<span class="hljs-string">'Close Price USD'</span>)
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_2.png" alt="이미지"></p>
<h2>KMA-SMA40 Trading Strategy</h2>
<ul>
<li><code>implement_sma_strategy</code> 함수를 사용하여 KMA-SMA40 트레이딩 전략 구현하기</li>
</ul>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">implement_sma_strategy</span>(<span class="hljs-params">data, short_window, long_window</span>):
    sma1 = short_window
    sma2 = long_window
    buy_price = []
    sell_price = []
    sma_signal = []
    signal = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):
        <span class="hljs-keyword">if</span> sma1.iloc[i] > sma2.iloc[i]:
            <span class="hljs-keyword">if</span> signal != <span class="hljs-number">1</span>:
                buy_price.append(data.iloc[i])
                sell_price.append(np.nan)
                signal = <span class="hljs-number">1</span>
                sma_signal.append(signal)
            <span class="hljs-keyword">else</span>:
                buy_price.append(np.nan)
                sell_price.append(np.nan)
                sma_signal.append(<span class="hljs-number">0</span>)
        <span class="hljs-keyword">elif</span> sma2.iloc[i] > sma1.iloc[i]:
            <span class="hljs-keyword">if</span> signal != -<span class="hljs-number">1</span>:
                buy_price.append(np.nan)
                sell_price.append(data.iloc[i])
                signal = -<span class="hljs-number">1</span>
                sma_signal.append(-<span class="hljs-number">1</span>)
            <span class="hljs-keyword">else</span>:
                buy_price.append(np.nan)
                sell_price.append(np.nan)
                sma_signal.append(<span class="hljs-number">0</span>)
        <span class="hljs-keyword">else</span>:
            buy_price.append(np.nan)
            sell_price.append(np.nan)
            sma_signal.append(<span class="hljs-number">0</span>)
            
    <span class="hljs-keyword">return</span> buy_price, sell_price, sma_signal

sma_20 = df[<span class="hljs-string">'kma'</span>]
sma_50 = df[<span class="hljs-string">'sma'</span>]

buy_price, sell_price, signal = implement_sma_strategy(df[<span class="hljs-string">'Close'</span>], sma_20, sma_50)
</code></pre>
<div class="content-ad"></div>
<ul>
<li>우리 Position 생성하기</li>
</ul>
<pre><code class="hljs language-js">position = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(signal)):
    <span class="hljs-keyword">if</span> signal[i] > <span class="hljs-number">1</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
    <span class="hljs-attr">else</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">1</span>)
        
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(df[<span class="hljs-string">'Close'</span>])):
    <span class="hljs-keyword">if</span> signal[i] == <span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">1</span>
    elif signal[i] == -<span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">0</span>
    <span class="hljs-attr">else</span>:
        position[i] = position[i-<span class="hljs-number">1</span>]

sma_20 = pd.<span class="hljs-title class_">DataFrame</span>(sma_20).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_20'</span>})
sma_50 = pd.<span class="hljs-title class_">DataFrame</span>(sma_50).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_50'</span>}) 
signal = pd.<span class="hljs-title class_">DataFrame</span>(signal).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_signal'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)
position = pd.<span class="hljs-title class_">DataFrame</span>(position).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_position'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)

frames = [sma_20, sma_50, signal, position]
strategy = pd.<span class="hljs-title function_">concat</span>(frames, join = <span class="hljs-string">'inner'</span>, axis = <span class="hljs-number">1</span>)
strategy = strategy.<span class="hljs-title function_">reset_index</span>().<span class="hljs-title function_">drop</span>(<span class="hljs-string">'Date'</span>, axis = <span class="hljs-number">1</span>)

df_ret = pd.<span class="hljs-title class_">DataFrame</span>(np.<span class="hljs-title function_">diff</span>(df[<span class="hljs-string">'Close'</span>])).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'returns'</span>})
sma_strategy_ret = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(df_ret)):
    <span class="hljs-attr">try</span>:
        returns = df_ret[<span class="hljs-string">'returns'</span>][i]*strategy[<span class="hljs-string">'sma_position'</span>][i]
        sma_strategy_ret.<span class="hljs-title function_">append</span>(returns)
    <span class="hljs-attr">except</span>:
        pass
    
sma_strategy_ret_df = pd.<span class="hljs-title class_">DataFrame</span>(sma_strategy_ret).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_returns'</span>})
</code></pre>
<ul>
<li>BAC KMA/SMA 트레이딩 신호 플로팅</li>
</ul>
<pre><code class="hljs language-js">plt.<span class="hljs-title function_">plot</span>(df[<span class="hljs-string">'Close'</span>], alpha = <span class="hljs-number">0.3</span>, label = <span class="hljs-string">'BAC'</span>)
plt.<span class="hljs-title function_">plot</span>(sma_20, alpha = <span class="hljs-number">0.6</span>, label = <span class="hljs-string">'KMA'</span>)
plt.<span class="hljs-title function_">plot</span>(sma_50, alpha = <span class="hljs-number">0.6</span>, label = <span class="hljs-string">'SMA40'</span>)
plt.<span class="hljs-title function_">scatter</span>(df.<span class="hljs-property">index</span>, buy_price, marker = <span class="hljs-string">'^'</span>, s = <span class="hljs-number">200</span>, color = <span class="hljs-string">'darkblue'</span>, label = <span class="hljs-string">'매수 신호'</span>)
plt.<span class="hljs-title function_">scatter</span>(df.<span class="hljs-property">index</span>, sell_price, marker = <span class="hljs-string">'v'</span>, s = <span class="hljs-number">200</span>, color = <span class="hljs-string">'crimson'</span>, label = <span class="hljs-string">'매도 신호'</span>)
plt.<span class="hljs-title function_">legend</span>(loc = <span class="hljs-string">'lower right'</span>)
plt.<span class="hljs-title function_">xlabel</span>(<span class="hljs-string">'날짜'</span>)
plt.<span class="hljs-title function_">ylabel</span>(<span class="hljs-string">'종가 USD'</span>)
plt.<span class="hljs-title function_">title</span>(<span class="hljs-string">'BAC KMA/SMA 트레이딩 신호'</span>)
plt.<span class="hljs-title function_">show</span>()
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_3.png" alt="이미지"></p>
<ul>
<li>저희 전략의 백테스팅을 수행 중입니다.</li>
</ul>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> termcolor <span class="hljs-keyword">import</span> colored <span class="hljs-keyword">as</span> cl
투자금 = <span class="hljs-number">100000</span>
주식수 = math.floor(투자금 / df[<span class="hljs-string">'Close'</span>].iloc[<span class="hljs-number">1</span>])
sma_투자_수익 = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(sma_strategy_ret_df[<span class="hljs-string">'sma_returns'</span>])):
    수익 = 주식수 * sma_strategy_ret_df[<span class="hljs-string">'sma_returns'</span>].iloc[i]
    sma_투자_수익.append(수익)

sma_투자_수익_df = pd.DataFrame(sma_투자_수익).rename(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'투자_수익'</span>})
총_투자_수익 = <span class="hljs-built_in">round</span>(<span class="hljs-built_in">sum</span>(sma_투자_수익_df[<span class="hljs-string">'투자_수익'</span>]), <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(cl(<span class="hljs-string">'BAC에 10만 달러를 투자하여 전략으로 얻은 이익: ${}'</span>.<span class="hljs-built_in">format</span>(총_투자_수익), attrs = [<span class="hljs-string">'bold'</span>]))

BAC에 <span class="hljs-number">10</span>만 달러를 투자하여 전략으로 얻은 이익: $<span class="hljs-number">29026.39</span>
</code></pre>
<h2>SMA 20–50 트레이딩 전략</h2>
<div class="content-ad"></div>
<ul>
<li>표준 SMA 20-50 거래 전략 구현</li>
</ul>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sma</span>(<span class="hljs-params">data, n</span>):
    sma = data.rolling(window=n).mean()
    <span class="hljs-keyword">return</span> pd.DataFrame(sma)

n = [<span class="hljs-number">20</span>, <span class="hljs-number">50</span>]
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> n:
    df[<span class="hljs-string">f'sma_<span class="hljs-subst">{i}</span>'</span>] = sma(df[<span class="hljs-string">'Close'</span>], i)

Close       sma_20    sma_50         sma_40
Date    
<span class="hljs-number">2024</span>-05-<span class="hljs-number">24</span> <span class="hljs-number">39.700001</span> <span class="hljs-number">38.3415</span> <span class="hljs-number">37.4868</span> <span class="hljs-number">37.64750</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">28</span> <span class="hljs-number">39.320000</span> <span class="hljs-number">38.4300</span> <span class="hljs-number">37.5650</span> <span class="hljs-number">37.69250</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">29</span> <span class="hljs-number">38.720001</span> <span class="hljs-number">38.5155</span> <span class="hljs-number">37.6192</span> <span class="hljs-number">37.72800</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">30</span> <span class="hljs-number">38.630001</span> <span class="hljs-number">38.5995</span> <span class="hljs-number">37.6712</span> <span class="hljs-number">37.75775</span>
<span class="hljs-number">2024</span>-05-<span class="hljs-number">31</span> <span class="hljs-number">39.990002</span> <span class="hljs-number">38.7550</span> <span class="hljs-number">37.7360</span> <span class="hljs-number">37.83450</span>
</code></pre>
<ul>
<li>SMA 20-50 플로팅</li>
</ul>
<pre><code class="hljs language-python">plt.plot(df[<span class="hljs-string">'Close'</span>], label=<span class="hljs-string">'BAC'</span>, linewidth=<span class="hljs-number">5</span>, alpha=<span class="hljs-number">0.3</span>)
plt.plot(df[<span class="hljs-string">'sma_20'</span>], label=<span class="hljs-string">'SMA 20'</span>)
plt.plot(df[<span class="hljs-string">'sma_50'</span>], label=<span class="hljs-string">'SMA 50'</span>)
plt.title(<span class="hljs-string">'BAC Simple Moving Averages (20, 50)'</span>)
plt.legend(loc=<span class="hljs-string">'upper left'</span>)

plt.xlabel(<span class="hljs-string">'Date'</span>)
plt.ylabel(<span class="hljs-string">'Close Price USD'</span>)
plt.show()
</code></pre>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_4.png">
<ul>
<li>implement_sma_strategy 함수를 사용하여 BAC SMA (20,50) 거래 신호를 생성합니다.</li>
</ul>
<pre><code class="hljs language-js">def <span class="hljs-title function_">implement_sma_strategy</span>(data, short_window, long_window):
    sma1 = short_window
    sma2 = long_window
    buy_price = []
    sell_price = []
    sma_signal = []
    signal = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(data)):
        <span class="hljs-keyword">if</span> sma1.<span class="hljs-property">iloc</span>[i] > sma2.<span class="hljs-property">iloc</span>[i]:
            <span class="hljs-keyword">if</span> signal != <span class="hljs-number">1</span>:
                buy_price.<span class="hljs-title function_">append</span>(data.<span class="hljs-property">iloc</span>[i])
                sell_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                signal = <span class="hljs-number">1</span>
                sma_signal.<span class="hljs-title function_">append</span>(signal)
            <span class="hljs-attr">else</span>:
                buy_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                sell_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                sma_signal.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
        elif sma2.<span class="hljs-property">iloc</span>[i] > sma1.<span class="hljs-property">iloc</span>[i]:
            <span class="hljs-keyword">if</span> signal != -<span class="hljs-number">1</span>:
                buy_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                sell_price.<span class="hljs-title function_">append</span>(data.<span class="hljs-property">iloc</span>[i])
                signal = -<span class="hljs-number">1</span>
                sma_signal.<span class="hljs-title function_">append</span>(-<span class="hljs-number">1</span>)
            <span class="hljs-attr">else</span>:
                buy_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                sell_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
                sma_signal.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
        <span class="hljs-attr">else</span>:
            buy_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
            sell_price.<span class="hljs-title function_">append</span>(np.<span class="hljs-property">nan</span>)
            sma_signal.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
            
    <span class="hljs-keyword">return</span> buy_price, sell_price, sma_signal

sma_20 = df[<span class="hljs-string">'sma_20'</span>]
sma_50 = df[<span class="hljs-string">'sma_50'</span>]

buy_price, sell_price, signal = <span class="hljs-title function_">implement_sma_strategy</span>(df[<span class="hljs-string">'Close'</span>], sma_20, sma_50)
</code></pre>
<ul>
<li>BAC SMA (20,50) 거래 신호를 플로팅합니다.</li>
</ul>
<div class="content-ad"></div>
<pre><code class="hljs language-js">plt.<span class="hljs-title function_">plot</span>(df[<span class="hljs-string">'Close'</span>], alpha = <span class="hljs-number">0.3</span>, label = <span class="hljs-string">'BAC'</span>)
plt.<span class="hljs-title function_">plot</span>(sma_20, alpha = <span class="hljs-number">0.6</span>, label = <span class="hljs-string">'SMA 20'</span>)
plt.<span class="hljs-title function_">plot</span>(sma_50, alpha = <span class="hljs-number">0.6</span>, label = <span class="hljs-string">'SMA 50'</span>)
plt.<span class="hljs-title function_">scatter</span>(df.<span class="hljs-property">index</span>, buy_price, marker = <span class="hljs-string">'^'</span>, s = <span class="hljs-number">200</span>, color = <span class="hljs-string">'darkblue'</span>, label = <span class="hljs-string">'BUY SIGNAL'</span>)
plt.<span class="hljs-title function_">scatter</span>(df.<span class="hljs-property">index</span>, sell_price, marker = <span class="hljs-string">'v'</span>, s = <span class="hljs-number">200</span>, color = <span class="hljs-string">'crimson'</span>, label = <span class="hljs-string">'SELL SIGNAL'</span>)
plt.<span class="hljs-title function_">legend</span>(loc = <span class="hljs-string">'upper left'</span>)
plt.<span class="hljs-title function_">title</span>(<span class="hljs-string">'BAC SMA CROSSOVER TRADING SIGNALS'</span>)
plt.<span class="hljs-title function_">xlabel</span>(<span class="hljs-string">'Date'</span>)
plt.<span class="hljs-title function_">ylabel</span>(<span class="hljs-string">'Close Price USD'</span>)
plt.<span class="hljs-title function_">show</span>()
</code></pre>
<img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_5.png">
<ul>
<li>포지션 생성</li>
</ul>
<pre><code class="hljs language-js">position = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(signal)):
    <span class="hljs-keyword">if</span> signal[i] > <span class="hljs-number">1</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
    <span class="hljs-attr">else</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">1</span>)
        
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(df[<span class="hljs-string">'Close'</span>])):
    <span class="hljs-keyword">if</span> signal[i] == <span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">1</span>
    elif signal[i] == -<span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">0</span>
    <span class="hljs-attr">else</span>:
        position[i] = position[i-<span class="hljs-number">1</span>]

sma_20 = pd.<span class="hljs-title class_">DataFrame</span>(sma_20).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_20'</span>})
sma_50 = pd.<span class="hljs-title class_">DataFrame</span>(sma_50).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_50'</span>}) 
signal = pd.<span class="hljs-title class_">DataFrame</span>(signal).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_signal'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)
position = pd.<span class="hljs-title class_">DataFrame</span>(position).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_position'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)

frames = [sma_20, sma_50, signal, position]
strategy = pd.<span class="hljs-title function_">concat</span>(frames, join = <span class="hljs-string">'inner'</span>, axis = <span class="hljs-number">1</span>)
strategy = strategy.<span class="hljs-title function_">reset_index</span>().<span class="hljs-title function_">drop</span>(<span class="hljs-string">'Date'</span>, axis = <span class="hljs-number">1</span>)
</code></pre>
<div class="content-ad"></div>
<ul>
<li>우리 전략의 백테스팅을 수행중입니다</li>
</ul>
<pre><code class="hljs language-js">msft_ret = pd.<span class="hljs-title class_">DataFrame</span>(np.<span class="hljs-title function_">diff</span>(df[<span class="hljs-string">'Close'</span>])).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'returns'</span>})
sma_strategy_ret = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(msft_ret)):
    <span class="hljs-attr">try</span>:
        returns = msft_ret[<span class="hljs-string">'returns'</span>].<span class="hljs-property">iloc</span>[i]*strategy[<span class="hljs-string">'sma_position'</span>].<span class="hljs-property">iloc</span>[i]
        sma_strategy_ret.<span class="hljs-title function_">append</span>(returns)
    <span class="hljs-attr">except</span>:
        pass

sma_strategy_ret_df = pd.<span class="hljs-title class_">DataFrame</span>(sma_strategy_ret).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_returns'</span>})

investment_value = <span class="hljs-number">100000</span>
number_of_stocks = math.<span class="hljs-title function_">floor</span>(investment_value/df[<span class="hljs-string">'Close'</span>].<span class="hljs-property">iloc</span>[<span class="hljs-number">1</span>])
sma_investment_ret = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(sma_strategy_ret_df[<span class="hljs-string">'sma_returns'</span>])):
    returns = number_of_stocks*sma_strategy_ret_df[<span class="hljs-string">'sma_returns'</span>].<span class="hljs-property">iloc</span>[i]
    sma_investment_ret.<span class="hljs-title function_">append</span>(returns)

sma_investment_ret_df = pd.<span class="hljs-title class_">DataFrame</span>(sma_investment_ret).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'investment_returns'</span>})
total_investment_ret = <span class="hljs-title function_">round</span>(<span class="hljs-title function_">sum</span>(sma_investment_ret_df[<span class="hljs-string">'investment_returns'</span>]), <span class="hljs-number">2</span>)
<span class="hljs-title function_">print</span>(<span class="hljs-title function_">cl</span>(<span class="hljs-string">'장기 배당 수익 전략에 $100K 투자로 얻은 이익: ${}'</span>.<span class="hljs-title function_">format</span>(total_investment_ret), attrs = [<span class="hljs-string">'bold'</span>]))

장기 배당 수익 전략에 $100K 투자로 얻은 이익: $13473<span class="hljs-number">.41</span>
</code></pre>
<h2>수동 매수 &#x26; 보유 전략</h2>
<ul>
<li>일일 수익에 기반한 누적 수익률 계산 중</li>
</ul>
<div class="content-ad"></div>
<pre><code class="hljs language-js">df[<span class="hljs-string">'daily_return'</span>] = df[<span class="hljs-string">'Close'</span>].<span class="hljs-title function_">pct_change</span>()
# 누적 수익률 계산
df[<span class="hljs-string">'cum_return'</span>] = np.<span class="hljs-title function_">exp</span>(np.<span class="hljs-title function_">log1p</span>(df[<span class="hljs-string">'daily_return'</span>]).<span class="hljs-title function_">cumsum</span>())

투자금 = <span class="hljs-number">100000</span>
수익률=(df[<span class="hljs-string">'cum_return'</span>].<span class="hljs-property">iloc</span>[-<span class="hljs-number">1</span>]-<span class="hljs-number">1</span>)*투자금
<span class="hljs-title function_">print</span>(<span class="hljs-title function_">round</span>(수익률,<span class="hljs-number">2</span>))
<span class="hljs-number">19337.52</span>

수익=<span class="hljs-title function_">round</span>(수익률,<span class="hljs-number">2</span>)
<span class="hljs-title function_">print</span>(<span class="hljs-title function_">cl</span>(<span class="hljs-string">'BAC에 10만 달러를 투자하여 Buy &#x26; Hold 전략에서 얻은 수익: ${} '</span>.<span class="hljs-title function_">format</span>(수익), attrs = [<span class="hljs-string">'bold'</span>]))

<span class="hljs-variable constant_">BAC</span>에 <span class="hljs-number">10</span>만 달러를 투자하여 <span class="hljs-title class_">Buy</span> &#x26; <span class="hljs-title class_">Hold</span> 전략에서 얻은 수익: $19337<span class="hljs-number">.52</span> 
</code></pre>
<ul>
<li>결과 그래프 그리기</li>
</ul>
<pre><code class="hljs language-js">df[<span class="hljs-string">'cum_return'</span>].<span class="hljs-title function_">plot</span>()
plt.<span class="hljs-title function_">title</span>(<span class="hljs-string">'BAC Buy-Hold 누적 수익률'</span>)
</code></pre>
<img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_6.png">
<div class="content-ad"></div>
<h2>결론</h2>
<ul>
<li>2023년 1월 3일부터 2024년 5월 31일까지의 백테스트 결과를 기반으로, KMA 알고 트레이딩 전략은 SMA 크로스오버 및 Buy &#x26; Hold 전략에 비해 매우 유망한 성과를 보여주었습니다.</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">BAC</span>에 <span class="hljs-number">10</span>만 달러를 투자하여 <span class="hljs-variable constant_">KMA</span> 전략으로 얻은 이익 : $29026<span class="hljs-number">.39</span>

<span class="hljs-variable constant_">BAC</span>에 <span class="hljs-number">10</span>만 달러를 투자하여 <span class="hljs-title class_">Buy</span> &#x26; <span class="hljs-title class_">Hold</span> 전략으로 얻은 이익 : $19337<span class="hljs-number">.52</span>

<span class="hljs-variable constant_">BAC</span>에 <span class="hljs-number">10</span>만 달러를 투자하여 <span class="hljs-variable constant_">SMA</span> 크로스오버 전략으로 얻은 이익 : $13473<span class="hljs-number">.41</span>
</code></pre>
<p><img src="/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_7.png" alt="이미지"></p>
<div class="content-ad"></div>
<ul>
<li>우리는 KF가 TTI의 제한을 극복하고 algo-trading 전략의 성능을 향상시킬 수 있다는 것을 보여줬어요.</li>
<li>비선형 시스템, 이상치 및 잡음을 효율적이고 견고하게 처리하면서 동시에 최적 부드량화와 자동 매개변수 추정이 가능한 KF 프레임워크는 모든 KF 수정사항과 이점을 함께 포함할 수 있게 해 줄 거에요.</li>
</ul>
<h2>전체 Python 코드 및 입출력</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np 
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd 
<span class="hljs-keyword">import</span> matplotlib.<span class="hljs-property">pyplot</span> <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> yfinance <span class="hljs-keyword">as</span> yf
<span class="hljs-keyword">from</span> pandas_datareader <span class="hljs-keyword">import</span> data <span class="hljs-keyword">as</span> web
<span class="hljs-keyword">from</span> sklearn.<span class="hljs-property">decomposition</span> <span class="hljs-keyword">import</span> <span class="hljs-variable constant_">PCA</span>
<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime <span class="hljs-keyword">as</span> dt, timedelta <span class="hljs-keyword">as</span> td
<span class="hljs-keyword">from</span> pykalman <span class="hljs-keyword">import</span> <span class="hljs-title class_">KalmanFilter</span>
sns.<span class="hljs-title function_">set</span>()

data = yf.<span class="hljs-title function_">download</span>(<span class="hljs-string">'BAC'</span>, start=<span class="hljs-string">'2023-01-01'</span>, end=<span class="hljs-string">'2024-06-01'</span>)

df=data.<span class="hljs-title function_">drop</span>(columns=[<span class="hljs-string">'Open'</span>, <span class="hljs-string">'High'</span>,<span class="hljs-string">'Low'</span>,<span class="hljs-string">'Adj Close'</span>,<span class="hljs-string">'Volume'</span>])
df.<span class="hljs-title function_">tail</span>()

<span class="hljs-title class_">Close</span>
<span class="hljs-title class_">Date</span> 
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">24</span> <span class="hljs-number">39.700001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">28</span> <span class="hljs-number">39.320000</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">29</span> <span class="hljs-number">38.720001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">38.630001</span>
<span class="hljs-number">2024</span>-<span class="hljs-number">05</span>-<span class="hljs-number">31</span> <span class="hljs-number">39.990002</span>

<span class="hljs-keyword">import</span> matplotlib.<span class="hljs-property">pyplot</span> <span class="hljs-keyword">as</span> plt 
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> termcolor <span class="hljs-keyword">import</span> colored <span class="hljs-keyword">as</span> cl 

<span class="hljs-keyword">from</span> pykalman <span class="hljs-keyword">import</span> <span class="hljs-title class_">KalmanFilter</span>

plt.<span class="hljs-property">style</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">'fivethirtyeight'</span>)
plt.<span class="hljs-property">rcParams</span>[<span class="hljs-string">'figure.figsize'</span>] = (<span class="hljs-number">15</span>, <span class="hljs-number">8</span>)

kf = <span class="hljs-title class_">KalmanFilter</span>(
    transition_matrices = [<span class="hljs-number">1</span>],
    observation_matrices = [<span class="hljs-number">1</span>],
    initial_state_mean = <span class="hljs-number">0</span>,
    initial_state_covariance = <span class="hljs-number">1</span>,
    observation_covariance=<span class="hljs-number">1</span>,
    transition_covariance=<span class="hljs-number">0.01</span>
)
state_means, _ = kf.<span class="hljs-title function_">filter</span>(df.<span class="hljs-property">values</span>)
state_means = pd.<span class="hljs-title class_">Series</span>(state_means.<span class="hljs-title function_">flatten</span>(), index=df.<span class="hljs-property">index</span>)

...

<span class="hljs-title function_">print</span>(signal)
[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ...

position = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(signal)):
    <span class="hljs-keyword">if</span> signal[i] > <span class="hljs-number">1</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">0</span>)
    <span class="hljs-attr">else</span>:
        position.<span class="hljs-title function_">append</span>(<span class="hljs-number">1</span>)
        
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(<span class="hljs-title function_">len</span>(df[<span class="hljs-string">'Close'</span>])):
    <span class="hljs-keyword">if</span> signal[i] == <span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">1</span>
    elif signal[i] == -<span class="hljs-number">1</span>:
        position[i] = <span class="hljs-number">0</span>
    <span class="hljs-attr">else</span>:
        position[i] = position[i-<span class="hljs-number">1</span>]

sma_20 = pd.<span class="hljs-title class_">DataFrame</span>(sma_20).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_20'</span>})
sma_50 = pd.<span class="hljs-title class_">DataFrame</span>(sma_50).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_50'</span>}) 
signal = pd.<span class="hljs-title class_">DataFrame</span>(signal).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_signal'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)
position = pd.<span class="hljs-title class_">DataFrame</span>(position).<span class="hljs-title function_">rename</span>(columns = {<span class="hljs-number">0</span>:<span class="hljs-string">'sma_position'</span>}).<span class="hljs-title function_">set_index</span>(df.<span class="hljs-property">index</span>)

...

<span class="hljs-title function_">print</span>(<span class="hljs-title function_">cl</span>(<span class="hljs-string">'100K달러를 BAC에 투자하여 전략으로 얻은 이익 : ${}'</span>.<span class="hljs-title function_">format</span>(total_investment_ret), attrs = [<span class="hljs-string">'bold'</span>]))

100K달러를 <span class="hljs-variable constant_">BAC</span>에 투자하여 전략으로 얻은 이익 : $13473<span class="hljs-number">.41</span>
</code></pre>
<h2>더 알아보기</h2>
<div class="content-ad"></div>
<ul>
<li>신호/잡음 비율이 낮은 칼만 필터 기반 객체 추적</li>
<li>칼만 필터를 사용한 대상 궤적 추적 성능 QC 분석</li>
<li>견고한 1차원 칼만 필터의 해부학</li>
<li>칼만 필터를 사용한 주식 시장 변동성 예측</li>
</ul>
<h2>참고 자료</h2>
<ul>
<li>파이썬에서 SMA를 이용한 알고리즘 트레이딩</li>
<li>금융 분야에서의 칼만 필터 (KF)</li>
<li>칼만 필터를 기반으로 한 트레이딩 전략 구현</li>
<li>파이썬에서 칼만 필터, 칼만 스무서, EM 알고리즘 구현</li>
<li>칼만 필터를 활용한 주식 거래 마스터하기: 포괄적인 가이드</li>
<li>파이썬에서 주식 가격 예측을 위한 칼만 필터 사용</li>
<li>주식 거래에서의 칼만 필터</li>
<li>시장 탁계를 탐색하는 주식 분석에서의 칼만 필터</li>
</ul>
<h2>연락처</h2>
<div class="content-ad"></div>
<ul>
<li>웹사이트</li>
<li>GitHub</li>
<li>X/트위터</li>
<li>핀터레스트</li>
<li>마스토돈</li>
<li>텀블러</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"잡음 저항 칼만 필터 이동 평균KMA 대 단순 이동 평균SMA 교차 알고 트레이딩 전략 BAC 쇼케이스","description":"","date":"2024-06-20 04:43","slug":"2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase","content":"\n\n- 대부분의 기술적거래지표(TTI)는 과거 주식 데이터에서 유래되며 미래 가격 흐름 반전을 예측하고 거래 결정을 내리는 데 거래자들에 의해 사용됩니다.\n- 금융 시장 예측은 시간에 따라 변하는 시장 소음 수준이 뒤틀리는 기본 트렌드와 계절적 주기의 이미지를 왜곡하기 때문에 매우 어려운 작업임이 널리 인정되고 있습니다.\n- 알고트레이딩에서 기술적 분석은 항상 패턴 및 신호를 식별하는 데 의존하지만 때로는 신뢰성 없는 것이 있을 수 있습니다. (신호/소음)`1.\n- 실제로, 가짜 가격 변동 및 오작동이 잘못된 TTI 신호를 초래하여 리스크-수익 최적화를 감소시키고 좋지 않은 거래 전략을 야기할 수 있습니다.\n- 본 게시물에서는 불확실하고 정확하지 않은 시계열 데이터에 기초한 숨겨진 변수의 소음이 적절한 확률 추정을 제공하는 칼만 필터(KF)를 사용하여 TTI의 상기한 단점을 다룰 것입니다.\n- KF는 선형 가우시안 상태 공간 모델에서 이론적으로 최적인 것으로 알려져 있으며, 추정된 오차 공분산을 최소화함으로써 베이지안 예측 및 수정의 최적의 재귀적 구현이라고 할 수 있습니다. \n- 여기서, 우리의 목적은 짧은 윈도우 칼만 필터 이동 평균(KMA)를 도입하여 SMA 크로스오버 거래 전략의 극심한 소음 민감성을 줄이는 것입니다.\n- 사례 예시로, BAC 주식의 예상 수익율을 비교하여 KMA, SMA 크로스오버 및 매수 \u0026 보유 알고트레이딩 전략의 백테스트 분석을 수행할 것입니다.\n- 비즈니스적인 측면에서, 제안된 연구는 계속되는 알고트레이딩 SaaS R\u0026D 노력을 촉진하여 BAC에 대한 거래 봇 및 백테스팅 결과를 업데이트합니다. 이러한 노력은 은행이 대량의 핀테크 데이터를 분석하고 신속하게 거래를 실행하여 이윤을 극대화하고 인적 오류를 최소화합니다.\n\n우리의 접근 방식을 구체적으로 살펴보겠습니다.\n\n## 기본 Imports 및 설정\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 현재 작업 디렉토리를 YOURPATH로 설정하기\n\n```python\nimport os\nos.chdir('YOURPATH')    # 작업 디렉토리 설정\nos.getcwd()\n```\n\n- Python 라이브러리 가져오고 설치하기\n\n```python\n!pip install yfinance, pykalman\n\nimport pandas as pd \nimport matplotlib.pyplot as plt \nimport requests\nimport math\nfrom termcolor import colored as cl \nimport numpy as np\nimport yfinance as yf\nimport matplotlib.pyplot as plt\nfrom pykalman import KalmanFilter\n\nplt.style.use('fivethirtyeight')\nplt.rcParams['figure.figsize'] = (12, 6)\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 주식 데이터 입력 읽기\n\n- 야후 파이낸스에서 BAC의 과거 데이터 가져오기\n\n```js\ndata = yf.download('BAC', start='2023-01-01', end='2024-06-01')\n\ndf=data.drop(columns=['Open', 'High','Low','Adj Close','Volume'])\ndf.tail()\n\n           Close\nDate \n2024-05-24 39.700001\n2024-05-28 39.320000\n2024-05-29 38.720001\n2024-05-30 38.630001\n2024-05-31 39.990002\n```\n\n## KMA vs SMA40\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 파이칼만(pykalman)을 사용한 KF 구현 및 SMA40 계산하기\n\n```python\nkf = KalmanFilter(\n    transition_matrices=[1],\n    observation_matrices=[1],\n    initial_state_mean=0,\n    initial_state_covariance=1,\n    observation_covariance=1,\n    transition_covariance=0.01\n)\n\nstate_means, _ = kf.filter(df['Close'].values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\ndf['kma'] = state_means\ndf['sma'] = df['Close'].rolling(window=40).mean()\n\ndf.tail()\n\n           Close     kma       sma\nDate   \n2024-05-24 39.700001 38.568957 37.64750\n2024-05-28 39.320000 38.640400 37.69250\n2024-05-29 38.720001 38.647972 37.72800\n2024-05-30 38.630001 38.646262 37.75775\n2024-05-31 39.990002 38.774086 37.83450\n```\n\n- 여기에서 KF에 대해 더 알아보기.\n- KMA vs SMA40 그래프 그리기\n\n```python\nplt.figure(figsize=(12,6))\nplt.plot(df['Close'], label='BAC', linewidth=5, alpha=0.3)\nplt.plot(df['kma'], label='KMA')\nplt.plot(df['sma'], label='SMA40')\nplt.title('BAC KMA/SMA')\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.legend(loc='upper left')\nplt.show()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_1.png\" /\u003e\n\n## KMA vs SMA20\n\n- KMA와 20일 이동평균(SMA)을 비교\n\n```js\nmean30 = df['Close'].rolling(window=20).mean()\n\n#plt.figure(figsize=(12,6))\nplt.plot(state_means)\nplt.plot(df['Close'])\nplt.plot(mean30)\nplt.title('Kalman filter estimate of average', fontsize=20)\nplt.legend(['Kalman', 'Price', '20-day MA'], fontsize=20)\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_2.png)\n\n## KMA-SMA40 Trading Strategy\n\n- `implement_sma_strategy` 함수를 사용하여 KMA-SMA40 트레이딩 전략 구현하기\n\n```python\ndef implement_sma_strategy(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = 0\n    \n    for i in range(len(data)):\n        if sma1.iloc[i] \u003e sma2.iloc[i]:\n            if signal != 1:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = 1\n                sma_signal.append(signal)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        elif sma2.iloc[i] \u003e sma1.iloc[i]:\n            if signal != -1:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -1\n                sma_signal.append(-1)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        else:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(0)\n            \n    return buy_price, sell_price, sma_signal\n\nsma_20 = df['kma']\nsma_50 = df['sma']\n\nbuy_price, sell_price, signal = implement_sma_strategy(df['Close'], sma_20, sma_50)\n```\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 우리 Position 생성하기\n\n```js\nposition = []\nfor i in range(len(signal)):\n    if signal[i] \u003e 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.concat(frames, join = 'inner', axis = 1)\nstrategy = strategy.reset_index().drop('Date', axis = 1)\n\ndf_ret = pd.DataFrame(np.diff(df['Close'])).rename(columns = {0:'returns'})\nsma_strategy_ret = []\n\nfor i in range(len(df_ret)):\n    try:\n        returns = df_ret['returns'][i]*strategy['sma_position'][i]\n        sma_strategy_ret.append(returns)\n    except:\n        pass\n    \nsma_strategy_ret_df = pd.DataFrame(sma_strategy_ret).rename(columns = {0:'sma_returns'})\n```\n\n- BAC KMA/SMA 트레이딩 신호 플로팅\n\n```js\nplt.plot(df['Close'], alpha = 0.3, label = 'BAC')\nplt.plot(sma_20, alpha = 0.6, label = 'KMA')\nplt.plot(sma_50, alpha = 0.6, label = 'SMA40')\nplt.scatter(df.index, buy_price, marker = '^', s = 200, color = 'darkblue', label = '매수 신호')\nplt.scatter(df.index, sell_price, marker = 'v', s = 200, color = 'crimson', label = '매도 신호')\nplt.legend(loc = 'lower right')\nplt.xlabel('날짜')\nplt.ylabel('종가 USD')\nplt.title('BAC KMA/SMA 트레이딩 신호')\nplt.show()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_3.png)\n\n- 저희 전략의 백테스팅을 수행 중입니다.\n\n```python\nimport math\nfrom termcolor import colored as cl\n투자금 = 100000\n주식수 = math.floor(투자금 / df['Close'].iloc[1])\nsma_투자_수익 = []\n\nfor i in range(len(sma_strategy_ret_df['sma_returns'])):\n    수익 = 주식수 * sma_strategy_ret_df['sma_returns'].iloc[i]\n    sma_투자_수익.append(수익)\n\nsma_투자_수익_df = pd.DataFrame(sma_투자_수익).rename(columns = {0:'투자_수익'})\n총_투자_수익 = round(sum(sma_투자_수익_df['투자_수익']), 2)\nprint(cl('BAC에 10만 달러를 투자하여 전략으로 얻은 이익: ${}'.format(총_투자_수익), attrs = ['bold']))\n\nBAC에 10만 달러를 투자하여 전략으로 얻은 이익: $29026.39\n```\n\n## SMA 20–50 트레이딩 전략\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 표준 SMA 20-50 거래 전략 구현\n\n```python\ndef sma(data, n):\n    sma = data.rolling(window=n).mean()\n    return pd.DataFrame(sma)\n\nn = [20, 50]\nfor i in n:\n    df[f'sma_{i}'] = sma(df['Close'], i)\n\nClose       sma_20    sma_50         sma_40\nDate    \n2024-05-24 39.700001 38.3415 37.4868 37.64750\n2024-05-28 39.320000 38.4300 37.5650 37.69250\n2024-05-29 38.720001 38.5155 37.6192 37.72800\n2024-05-30 38.630001 38.5995 37.6712 37.75775\n2024-05-31 39.990002 38.7550 37.7360 37.83450\n```\n\n- SMA 20-50 플로팅\n\n```python\nplt.plot(df['Close'], label='BAC', linewidth=5, alpha=0.3)\nplt.plot(df['sma_20'], label='SMA 20')\nplt.plot(df['sma_50'], label='SMA 50')\nplt.title('BAC Simple Moving Averages (20, 50)')\nplt.legend(loc='upper left')\n\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.show()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_4.png\" /\u003e\n\n- implement_sma_strategy 함수를 사용하여 BAC SMA (20,50) 거래 신호를 생성합니다.\n\n```js\ndef implement_sma_strategy(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = 0\n    \n    for i in range(len(data)):\n        if sma1.iloc[i] \u003e sma2.iloc[i]:\n            if signal != 1:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = 1\n                sma_signal.append(signal)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        elif sma2.iloc[i] \u003e sma1.iloc[i]:\n            if signal != -1:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -1\n                sma_signal.append(-1)\n            else:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(0)\n        else:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(0)\n            \n    return buy_price, sell_price, sma_signal\n\nsma_20 = df['sma_20']\nsma_50 = df['sma_50']\n\nbuy_price, sell_price, signal = implement_sma_strategy(df['Close'], sma_20, sma_50)\n```\n\n- BAC SMA (20,50) 거래 신호를 플로팅합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\r\nplt.plot(df['Close'], alpha = 0.3, label = 'BAC')\nplt.plot(sma_20, alpha = 0.6, label = 'SMA 20')\nplt.plot(sma_50, alpha = 0.6, label = 'SMA 50')\nplt.scatter(df.index, buy_price, marker = '^', s = 200, color = 'darkblue', label = 'BUY SIGNAL')\nplt.scatter(df.index, sell_price, marker = 'v', s = 200, color = 'crimson', label = 'SELL SIGNAL')\nplt.legend(loc = 'upper left')\nplt.title('BAC SMA CROSSOVER TRADING SIGNALS')\nplt.xlabel('Date')\nplt.ylabel('Close Price USD')\nplt.show()\r\n```\n\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_5.png\" /\u003e\n\n- 포지션 생성\n\n```js\r\nposition = []\nfor i in range(len(signal)):\n    if signal[i] \u003e 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.concat(frames, join = 'inner', axis = 1)\nstrategy = strategy.reset_index().drop('Date', axis = 1)\r\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 우리 전략의 백테스팅을 수행중입니다\n\n```js\nmsft_ret = pd.DataFrame(np.diff(df['Close'])).rename(columns = {0:'returns'})\nsma_strategy_ret = []\n\nfor i in range(len(msft_ret)):\n    try:\n        returns = msft_ret['returns'].iloc[i]*strategy['sma_position'].iloc[i]\n        sma_strategy_ret.append(returns)\n    except:\n        pass\n\nsma_strategy_ret_df = pd.DataFrame(sma_strategy_ret).rename(columns = {0:'sma_returns'})\n\ninvestment_value = 100000\nnumber_of_stocks = math.floor(investment_value/df['Close'].iloc[1])\nsma_investment_ret = []\n\nfor i in range(len(sma_strategy_ret_df['sma_returns'])):\n    returns = number_of_stocks*sma_strategy_ret_df['sma_returns'].iloc[i]\n    sma_investment_ret.append(returns)\n\nsma_investment_ret_df = pd.DataFrame(sma_investment_ret).rename(columns = {0:'investment_returns'})\ntotal_investment_ret = round(sum(sma_investment_ret_df['investment_returns']), 2)\nprint(cl('장기 배당 수익 전략에 $100K 투자로 얻은 이익: ${}'.format(total_investment_ret), attrs = ['bold']))\n\n장기 배당 수익 전략에 $100K 투자로 얻은 이익: $13473.41\n```\n\n## 수동 매수 \u0026 보유 전략\n\n- 일일 수익에 기반한 누적 수익률 계산 중\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ndf['daily_return'] = df['Close'].pct_change()\n# 누적 수익률 계산\ndf['cum_return'] = np.exp(np.log1p(df['daily_return']).cumsum())\n\n투자금 = 100000\n수익률=(df['cum_return'].iloc[-1]-1)*투자금\nprint(round(수익률,2))\n19337.52\n\n수익=round(수익률,2)\nprint(cl('BAC에 10만 달러를 투자하여 Buy \u0026 Hold 전략에서 얻은 수익: ${} '.format(수익), attrs = ['bold']))\n\nBAC에 10만 달러를 투자하여 Buy \u0026 Hold 전략에서 얻은 수익: $19337.52 \n```\n\n- 결과 그래프 그리기\n\n```js\ndf['cum_return'].plot()\nplt.title('BAC Buy-Hold 누적 수익률')\n```\n\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_6.png\" /\u003e\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 결론\n\n- 2023년 1월 3일부터 2024년 5월 31일까지의 백테스트 결과를 기반으로, KMA 알고 트레이딩 전략은 SMA 크로스오버 및 Buy \u0026 Hold 전략에 비해 매우 유망한 성과를 보여주었습니다.\n\n```js\nBAC에 10만 달러를 투자하여 KMA 전략으로 얻은 이익 : $29026.39\n\nBAC에 10만 달러를 투자하여 Buy \u0026 Hold 전략으로 얻은 이익 : $19337.52\n\nBAC에 10만 달러를 투자하여 SMA 크로스오버 전략으로 얻은 이익 : $13473.41\n```\n\n![이미지](/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_7.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 우리는 KF가 TTI의 제한을 극복하고 algo-trading 전략의 성능을 향상시킬 수 있다는 것을 보여줬어요.\n- 비선형 시스템, 이상치 및 잡음을 효율적이고 견고하게 처리하면서 동시에 최적 부드량화와 자동 매개변수 추정이 가능한 KF 프레임워크는 모든 KF 수정사항과 이점을 함께 포함할 수 있게 해 줄 거에요.\n\n## 전체 Python 코드 및 입출력\n\n```js\nimport numpy as np \nimport pandas as pd \nimport matplotlib.pyplot as plt\nimport yfinance as yf\nfrom pandas_datareader import data as web\nfrom sklearn.decomposition import PCA\nimport seaborn as sns\nfrom datetime import datetime as dt, timedelta as td\nfrom pykalman import KalmanFilter\nsns.set()\n\ndata = yf.download('BAC', start='2023-01-01', end='2024-06-01')\n\ndf=data.drop(columns=['Open', 'High','Low','Adj Close','Volume'])\ndf.tail()\n\nClose\nDate \n2024-05-24 39.700001\n2024-05-28 39.320000\n2024-05-29 38.720001\n2024-05-30 38.630001\n2024-05-31 39.990002\n\nimport matplotlib.pyplot as plt \nimport requests\nimport math\nfrom termcolor import colored as cl \n\nfrom pykalman import KalmanFilter\n\nplt.style.use('fivethirtyeight')\nplt.rcParams['figure.figsize'] = (15, 8)\n\nkf = KalmanFilter(\n    transition_matrices = [1],\n    observation_matrices = [1],\n    initial_state_mean = 0,\n    initial_state_covariance = 1,\n    observation_covariance=1,\n    transition_covariance=0.01\n)\nstate_means, _ = kf.filter(df.values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\n\n...\n\nprint(signal)\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, ...\n\nposition = []\nfor i in range(len(signal)):\n    if signal[i] \u003e 1:\n        position.append(0)\n    else:\n        position.append(1)\n        \nfor i in range(len(df['Close'])):\n    if signal[i] == 1:\n        position[i] = 1\n    elif signal[i] == -1:\n        position[i] = 0\n    else:\n        position[i] = position[i-1]\n\nsma_20 = pd.DataFrame(sma_20).rename(columns = {0:'sma_20'})\nsma_50 = pd.DataFrame(sma_50).rename(columns = {0:'sma_50'}) \nsignal = pd.DataFrame(signal).rename(columns = {0:'sma_signal'}).set_index(df.index)\nposition = pd.DataFrame(position).rename(columns = {0:'sma_position'}).set_index(df.index)\n\n...\n\nprint(cl('100K달러를 BAC에 투자하여 전략으로 얻은 이익 : ${}'.format(total_investment_ret), attrs = ['bold']))\n\n100K달러를 BAC에 투자하여 전략으로 얻은 이익 : $13473.41\r\n```\n\n## 더 알아보기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 신호/잡음 비율이 낮은 칼만 필터 기반 객체 추적\n- 칼만 필터를 사용한 대상 궤적 추적 성능 QC 분석\n- 견고한 1차원 칼만 필터의 해부학\n- 칼만 필터를 사용한 주식 시장 변동성 예측\n\n## 참고 자료\n\n- 파이썬에서 SMA를 이용한 알고리즘 트레이딩\n- 금융 분야에서의 칼만 필터 (KF)\n- 칼만 필터를 기반으로 한 트레이딩 전략 구현\n- 파이썬에서 칼만 필터, 칼만 스무서, EM 알고리즘 구현\n- 칼만 필터를 활용한 주식 거래 마스터하기: 포괄적인 가이드\n- 파이썬에서 주식 가격 예측을 위한 칼만 필터 사용\n- 주식 거래에서의 칼만 필터\n- 시장 탁계를 탐색하는 주식 분석에서의 칼만 필터\n\n## 연락처\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 웹사이트\n- GitHub\n- X/트위터\n- 핀터레스트\n- 마스토돈\n- 텀블러","ogImage":{"url":"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png"},"coverImage":"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_0.png","tag":["Tech"],"readingTime":17},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cul\u003e\n\u003cli\u003e대부분의 기술적거래지표(TTI)는 과거 주식 데이터에서 유래되며 미래 가격 흐름 반전을 예측하고 거래 결정을 내리는 데 거래자들에 의해 사용됩니다.\u003c/li\u003e\n\u003cli\u003e금융 시장 예측은 시간에 따라 변하는 시장 소음 수준이 뒤틀리는 기본 트렌드와 계절적 주기의 이미지를 왜곡하기 때문에 매우 어려운 작업임이 널리 인정되고 있습니다.\u003c/li\u003e\n\u003cli\u003e알고트레이딩에서 기술적 분석은 항상 패턴 및 신호를 식별하는 데 의존하지만 때로는 신뢰성 없는 것이 있을 수 있습니다. (신호/소음)`1.\u003c/li\u003e\n\u003cli\u003e실제로, 가짜 가격 변동 및 오작동이 잘못된 TTI 신호를 초래하여 리스크-수익 최적화를 감소시키고 좋지 않은 거래 전략을 야기할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e본 게시물에서는 불확실하고 정확하지 않은 시계열 데이터에 기초한 숨겨진 변수의 소음이 적절한 확률 추정을 제공하는 칼만 필터(KF)를 사용하여 TTI의 상기한 단점을 다룰 것입니다.\u003c/li\u003e\n\u003cli\u003eKF는 선형 가우시안 상태 공간 모델에서 이론적으로 최적인 것으로 알려져 있으며, 추정된 오차 공분산을 최소화함으로써 베이지안 예측 및 수정의 최적의 재귀적 구현이라고 할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e여기서, 우리의 목적은 짧은 윈도우 칼만 필터 이동 평균(KMA)를 도입하여 SMA 크로스오버 거래 전략의 극심한 소음 민감성을 줄이는 것입니다.\u003c/li\u003e\n\u003cli\u003e사례 예시로, BAC 주식의 예상 수익율을 비교하여 KMA, SMA 크로스오버 및 매수 \u0026#x26; 보유 알고트레이딩 전략의 백테스트 분석을 수행할 것입니다.\u003c/li\u003e\n\u003cli\u003e비즈니스적인 측면에서, 제안된 연구는 계속되는 알고트레이딩 SaaS R\u0026#x26;D 노력을 촉진하여 BAC에 대한 거래 봇 및 백테스팅 결과를 업데이트합니다. 이러한 노력은 은행이 대량의 핀테크 데이터를 분석하고 신속하게 거래를 실행하여 이윤을 극대화하고 인적 오류를 최소화합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e우리의 접근 방식을 구체적으로 살펴보겠습니다.\u003c/p\u003e\n\u003ch2\u003e기본 Imports 및 설정\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e현재 작업 디렉토리를 YOURPATH로 설정하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\nos.chdir(\u003cspan class=\"hljs-string\"\u003e'YOURPATH'\u003c/span\u003e)    \u003cspan class=\"hljs-comment\"\u003e# 작업 디렉토리 설정\u003c/span\u003e\nos.getcwd()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003ePython 라이브러리 가져오고 설치하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e!pip install yfinance, pykalman\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e pd \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.pyplot \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e math\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e termcolor \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e colored \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e cl \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e np\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e yfinance \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e yf\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.pyplot \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pykalman \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e KalmanFilter\n\nplt.style.use(\u003cspan class=\"hljs-string\"\u003e'fivethirtyeight'\u003c/span\u003e)\nplt.rcParams[\u003cspan class=\"hljs-string\"\u003e'figure.figsize'\u003c/span\u003e] = (\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e주식 데이터 입력 읽기\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e야후 파이낸스에서 BAC의 과거 데이터 가져오기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edata = yf.\u003cspan class=\"hljs-title function_\"\u003edownload\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e, start=\u003cspan class=\"hljs-string\"\u003e'2023-01-01'\u003c/span\u003e, end=\u003cspan class=\"hljs-string\"\u003e'2024-06-01'\u003c/span\u003e)\n\ndf=data.\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(columns=[\u003cspan class=\"hljs-string\"\u003e'Open'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'High'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Low'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Adj Close'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Volume'\u003c/span\u003e])\ndf.\u003cspan class=\"hljs-title function_\"\u003etail\u003c/span\u003e()\n\n           \u003cspan class=\"hljs-title class_\"\u003eClose\u003c/span\u003e\n\u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e \n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.700001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.320000\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.720001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.630001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e31\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.990002\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eKMA vs SMA40\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e파이칼만(pykalman)을 사용한 KF 구현 및 SMA40 계산하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003ekf = KalmanFilter(\n    transition_matrices=[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],\n    observation_matrices=[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],\n    initial_state_mean=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    initial_state_covariance=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    observation_covariance=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    transition_covariance=\u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e\n)\n\nstate_means, _ = kf.\u003cspan class=\"hljs-built_in\"\u003efilter\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].values)\nstate_means = pd.Series(state_means.flatten(), index=df.index)\ndf[\u003cspan class=\"hljs-string\"\u003e'kma'\u003c/span\u003e] = state_means\ndf[\u003cspan class=\"hljs-string\"\u003e'sma'\u003c/span\u003e] = df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].rolling(window=\u003cspan class=\"hljs-number\"\u003e40\u003c/span\u003e).mean()\n\ndf.tail()\n\n           Close     kma       sma\nDate   \n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.700001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.568957\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.64750\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.320000\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.640400\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.69250\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.720001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.647972\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.72800\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.630001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.646262\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.75775\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e31\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.990002\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.774086\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.83450\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e여기에서 KF에 대해 더 알아보기.\u003c/li\u003e\n\u003cli\u003eKMA vs SMA40 그래프 그리기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eplt.figure(figsize=(\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e))\nplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e, linewidth=\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, alpha=\u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e)\nplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'kma'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'KMA'\u003c/span\u003e)\nplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'sma'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'SMA40'\u003c/span\u003e)\nplt.title(\u003cspan class=\"hljs-string\"\u003e'BAC KMA/SMA'\u003c/span\u003e)\nplt.xlabel(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e)\nplt.ylabel(\u003cspan class=\"hljs-string\"\u003e'Close Price USD'\u003c/span\u003e)\nplt.legend(loc=\u003cspan class=\"hljs-string\"\u003e'upper left'\u003c/span\u003e)\nplt.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_1.png\"\u003e\n\u003ch2\u003eKMA vs SMA20\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eKMA와 20일 이동평균(SMA)을 비교\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003emean30 = df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003erolling\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emean\u003c/span\u003e()\n\n#plt.\u003cspan class=\"hljs-title function_\"\u003efigure\u003c/span\u003e(figsize=(\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e))\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(state_means)\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(mean30)\nplt.\u003cspan class=\"hljs-title function_\"\u003etitle\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Kalman filter estimate of average'\u003c/span\u003e, fontsize=\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003elegend\u003c/span\u003e([\u003cspan class=\"hljs-string\"\u003e'Kalman'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Price'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'20-day MA'\u003c/span\u003e], fontsize=\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003exlabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eylabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Close Price USD'\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_2.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003eKMA-SMA40 Trading Strategy\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eimplement_sma_strategy\u003c/code\u003e 함수를 사용하여 KMA-SMA40 트레이딩 전략 구현하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eimplement_sma_strategy\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata, short_window, long_window\u003c/span\u003e):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(data)):\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e sma1.iloc[i] \u003e sma2.iloc[i]:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal != \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n                buy_price.append(data.iloc[i])\n                sell_price.append(np.nan)\n                signal = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n                sma_signal.append(signal)\n            \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003eelif\u003c/span\u003e sma2.iloc[i] \u003e sma1.iloc[i]:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal != -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n                buy_price.append(np.nan)\n                sell_price.append(data.iloc[i])\n                signal = -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n                sma_signal.append(-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n            \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n                buy_price.append(np.nan)\n                sell_price.append(np.nan)\n                sma_signal.append(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e:\n            buy_price.append(np.nan)\n            sell_price.append(np.nan)\n            sma_signal.append(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n            \n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e buy_price, sell_price, sma_signal\n\nsma_20 = df[\u003cspan class=\"hljs-string\"\u003e'kma'\u003c/span\u003e]\nsma_50 = df[\u003cspan class=\"hljs-string\"\u003e'sma'\u003c/span\u003e]\n\nbuy_price, sell_price, signal = implement_sma_strategy(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], sma_20, sma_50)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e우리 Position 생성하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eposition = []\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(signal)):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] \u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        \n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    elif signal[i] == -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position[i] = position[i-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n\nsma_20 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_20).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_20'\u003c/span\u003e})\nsma_50 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_50).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_50'\u003c/span\u003e}) \nsignal = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(signal).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_signal'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\nposition = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(position).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_position'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.\u003cspan class=\"hljs-title function_\"\u003econcat\u003c/span\u003e(frames, join = \u003cspan class=\"hljs-string\"\u003e'inner'\u003c/span\u003e, axis = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\nstrategy = strategy.\u003cspan class=\"hljs-title function_\"\u003ereset_index\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e, axis = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\ndf_ret = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(np.\u003cspan class=\"hljs-title function_\"\u003ediff\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'returns'\u003c/span\u003e})\nsma_strategy_ret = []\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df_ret)):\n    \u003cspan class=\"hljs-attr\"\u003etry\u003c/span\u003e:\n        returns = df_ret[\u003cspan class=\"hljs-string\"\u003e'returns'\u003c/span\u003e][i]*strategy[\u003cspan class=\"hljs-string\"\u003e'sma_position'\u003c/span\u003e][i]\n        sma_strategy_ret.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(returns)\n    \u003cspan class=\"hljs-attr\"\u003eexcept\u003c/span\u003e:\n        pass\n    \nsma_strategy_ret_df = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_strategy_ret).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eBAC KMA/SMA 트레이딩 신호 플로팅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], alpha = \u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(sma_20, alpha = \u003cspan class=\"hljs-number\"\u003e0.6\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'KMA'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(sma_50, alpha = \u003cspan class=\"hljs-number\"\u003e0.6\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'SMA40'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003escatter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e, buy_price, marker = \u003cspan class=\"hljs-string\"\u003e'^'\u003c/span\u003e, s = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, color = \u003cspan class=\"hljs-string\"\u003e'darkblue'\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'매수 신호'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003escatter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e, sell_price, marker = \u003cspan class=\"hljs-string\"\u003e'v'\u003c/span\u003e, s = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, color = \u003cspan class=\"hljs-string\"\u003e'crimson'\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'매도 신호'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003elegend\u003c/span\u003e(loc = \u003cspan class=\"hljs-string\"\u003e'lower right'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003exlabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'날짜'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eylabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'종가 USD'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003etitle\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC KMA/SMA 트레이딩 신호'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_3.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e저희 전략의 백테스팅을 수행 중입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e math\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e termcolor \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e colored \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e cl\n투자금 = \u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e\n주식수 = math.floor(투자금 / df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].iloc[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e])\nsma_투자_수익 = []\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(sma_strategy_ret_df[\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e])):\n    수익 = 주식수 * sma_strategy_ret_df[\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e].iloc[i]\n    sma_투자_수익.append(수익)\n\nsma_투자_수익_df = pd.DataFrame(sma_투자_수익).rename(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'투자_수익'\u003c/span\u003e})\n총_투자_수익 = \u003cspan class=\"hljs-built_in\"\u003eround\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003esum\u003c/span\u003e(sma_투자_수익_df[\u003cspan class=\"hljs-string\"\u003e'투자_수익'\u003c/span\u003e]), \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(cl(\u003cspan class=\"hljs-string\"\u003e'BAC에 10만 달러를 투자하여 전략으로 얻은 이익: ${}'\u003c/span\u003e.\u003cspan class=\"hljs-built_in\"\u003eformat\u003c/span\u003e(총_투자_수익), attrs = [\u003cspan class=\"hljs-string\"\u003e'bold'\u003c/span\u003e]))\n\nBAC에 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e만 달러를 투자하여 전략으로 얻은 이익: $\u003cspan class=\"hljs-number\"\u003e29026.39\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSMA 20–50 트레이딩 전략\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e표준 SMA 20-50 거래 전략 구현\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esma\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata, n\u003c/span\u003e):\n    sma = data.rolling(window=n).mean()\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e pd.DataFrame(sma)\n\nn = [\u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e]\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e n:\n    df[\u003cspan class=\"hljs-string\"\u003ef'sma_\u003cspan class=\"hljs-subst\"\u003e{i}\u003c/span\u003e'\u003c/span\u003e] = sma(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], i)\n\nClose       sma_20    sma_50         sma_40\nDate    \n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.700001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.3415\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.4868\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.64750\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.320000\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.4300\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.5650\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.69250\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.720001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.5155\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.6192\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.72800\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.630001\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.5995\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.6712\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.75775\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-05-\u003cspan class=\"hljs-number\"\u003e31\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.990002\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.7550\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.7360\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e37.83450\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eSMA 20-50 플로팅\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e, linewidth=\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, alpha=\u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e)\nplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'sma_20'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'SMA 20'\u003c/span\u003e)\nplt.plot(df[\u003cspan class=\"hljs-string\"\u003e'sma_50'\u003c/span\u003e], label=\u003cspan class=\"hljs-string\"\u003e'SMA 50'\u003c/span\u003e)\nplt.title(\u003cspan class=\"hljs-string\"\u003e'BAC Simple Moving Averages (20, 50)'\u003c/span\u003e)\nplt.legend(loc=\u003cspan class=\"hljs-string\"\u003e'upper left'\u003c/span\u003e)\n\nplt.xlabel(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e)\nplt.ylabel(\u003cspan class=\"hljs-string\"\u003e'Close Price USD'\u003c/span\u003e)\nplt.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_4.png\"\u003e\n\u003cul\u003e\n\u003cli\u003eimplement_sma_strategy 함수를 사용하여 BAC SMA (20,50) 거래 신호를 생성합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edef \u003cspan class=\"hljs-title function_\"\u003eimplement_sma_strategy\u003c/span\u003e(data, short_window, long_window):\n    sma1 = short_window\n    sma2 = long_window\n    buy_price = []\n    sell_price = []\n    sma_signal = []\n    signal = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(data)):\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e sma1.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i] \u003e sma2.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i]:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal != \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n                buy_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(data.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i])\n                sell_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                signal = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n                sma_signal.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(signal)\n            \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n                buy_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                sell_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                sma_signal.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        elif sma2.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i] \u003e sma1.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i]:\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal != -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n                buy_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                sell_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(data.\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i])\n                signal = -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n                sma_signal.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n            \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n                buy_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                sell_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n                sma_signal.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n            buy_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n            sell_price.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(np.\u003cspan class=\"hljs-property\"\u003enan\u003c/span\u003e)\n            sma_signal.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n            \n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e buy_price, sell_price, sma_signal\n\nsma_20 = df[\u003cspan class=\"hljs-string\"\u003e'sma_20'\u003c/span\u003e]\nsma_50 = df[\u003cspan class=\"hljs-string\"\u003e'sma_50'\u003c/span\u003e]\n\nbuy_price, sell_price, signal = \u003cspan class=\"hljs-title function_\"\u003eimplement_sma_strategy\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], sma_20, sma_50)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eBAC SMA (20,50) 거래 신호를 플로팅합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e], alpha = \u003cspan class=\"hljs-number\"\u003e0.3\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(sma_20, alpha = \u003cspan class=\"hljs-number\"\u003e0.6\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'SMA 20'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e(sma_50, alpha = \u003cspan class=\"hljs-number\"\u003e0.6\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'SMA 50'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003escatter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e, buy_price, marker = \u003cspan class=\"hljs-string\"\u003e'^'\u003c/span\u003e, s = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, color = \u003cspan class=\"hljs-string\"\u003e'darkblue'\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'BUY SIGNAL'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003escatter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e, sell_price, marker = \u003cspan class=\"hljs-string\"\u003e'v'\u003c/span\u003e, s = \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, color = \u003cspan class=\"hljs-string\"\u003e'crimson'\u003c/span\u003e, label = \u003cspan class=\"hljs-string\"\u003e'SELL SIGNAL'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003elegend\u003c/span\u003e(loc = \u003cspan class=\"hljs-string\"\u003e'upper left'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003etitle\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC SMA CROSSOVER TRADING SIGNALS'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003exlabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eylabel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Close Price USD'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-title function_\"\u003eshow\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_5.png\"\u003e\n\u003cul\u003e\n\u003cli\u003e포지션 생성\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eposition = []\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(signal)):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] \u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        \n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    elif signal[i] == -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position[i] = position[i-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n\nsma_20 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_20).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_20'\u003c/span\u003e})\nsma_50 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_50).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_50'\u003c/span\u003e}) \nsignal = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(signal).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_signal'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\nposition = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(position).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_position'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\n\nframes = [sma_20, sma_50, signal, position]\nstrategy = pd.\u003cspan class=\"hljs-title function_\"\u003econcat\u003c/span\u003e(frames, join = \u003cspan class=\"hljs-string\"\u003e'inner'\u003c/span\u003e, axis = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\nstrategy = strategy.\u003cspan class=\"hljs-title function_\"\u003ereset_index\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Date'\u003c/span\u003e, axis = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e우리 전략의 백테스팅을 수행중입니다\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003emsft_ret = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(np.\u003cspan class=\"hljs-title function_\"\u003ediff\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'returns'\u003c/span\u003e})\nsma_strategy_ret = []\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(msft_ret)):\n    \u003cspan class=\"hljs-attr\"\u003etry\u003c/span\u003e:\n        returns = msft_ret[\u003cspan class=\"hljs-string\"\u003e'returns'\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i]*strategy[\u003cspan class=\"hljs-string\"\u003e'sma_position'\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i]\n        sma_strategy_ret.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(returns)\n    \u003cspan class=\"hljs-attr\"\u003eexcept\u003c/span\u003e:\n        pass\n\nsma_strategy_ret_df = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_strategy_ret).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e})\n\ninvestment_value = \u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e\nnumber_of_stocks = math.\u003cspan class=\"hljs-title function_\"\u003efloor\u003c/span\u003e(investment_value/df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e])\nsma_investment_ret = []\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(sma_strategy_ret_df[\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e])):\n    returns = number_of_stocks*sma_strategy_ret_df[\u003cspan class=\"hljs-string\"\u003e'sma_returns'\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[i]\n    sma_investment_ret.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(returns)\n\nsma_investment_ret_df = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_investment_ret).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'investment_returns'\u003c/span\u003e})\ntotal_investment_ret = \u003cspan class=\"hljs-title function_\"\u003eround\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003esum\u003c/span\u003e(sma_investment_ret_df[\u003cspan class=\"hljs-string\"\u003e'investment_returns'\u003c/span\u003e]), \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'장기 배당 수익 전략에 $100K 투자로 얻은 이익: ${}'\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eformat\u003c/span\u003e(total_investment_ret), attrs = [\u003cspan class=\"hljs-string\"\u003e'bold'\u003c/span\u003e]))\n\n장기 배당 수익 전략에 $100K 투자로 얻은 이익: $13473\u003cspan class=\"hljs-number\"\u003e.41\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e수동 매수 \u0026#x26; 보유 전략\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e일일 수익에 기반한 누적 수익률 계산 중\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf[\u003cspan class=\"hljs-string\"\u003e'daily_return'\u003c/span\u003e] = df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003epct_change\u003c/span\u003e()\n# 누적 수익률 계산\ndf[\u003cspan class=\"hljs-string\"\u003e'cum_return'\u003c/span\u003e] = np.\u003cspan class=\"hljs-title function_\"\u003eexp\u003c/span\u003e(np.\u003cspan class=\"hljs-title function_\"\u003elog1p\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'daily_return'\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003ecumsum\u003c/span\u003e())\n\n투자금 = \u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e\n수익률=(df[\u003cspan class=\"hljs-string\"\u003e'cum_return'\u003c/span\u003e].\u003cspan class=\"hljs-property\"\u003eiloc\u003c/span\u003e[-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)*투자금\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eround\u003c/span\u003e(수익률,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n\u003cspan class=\"hljs-number\"\u003e19337.52\u003c/span\u003e\n\n수익=\u003cspan class=\"hljs-title function_\"\u003eround\u003c/span\u003e(수익률,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC에 10만 달러를 투자하여 Buy \u0026#x26; Hold 전략에서 얻은 수익: ${} '\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eformat\u003c/span\u003e(수익), attrs = [\u003cspan class=\"hljs-string\"\u003e'bold'\u003c/span\u003e]))\n\n\u003cspan class=\"hljs-variable constant_\"\u003eBAC\u003c/span\u003e에 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e만 달러를 투자하여 \u003cspan class=\"hljs-title class_\"\u003eBuy\u003c/span\u003e \u0026#x26; \u003cspan class=\"hljs-title class_\"\u003eHold\u003c/span\u003e 전략에서 얻은 수익: $19337\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e결과 그래프 그리기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf[\u003cspan class=\"hljs-string\"\u003e'cum_return'\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eplot\u003c/span\u003e()\nplt.\u003cspan class=\"hljs-title function_\"\u003etitle\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC Buy-Hold 누적 수익률'\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_6.png\"\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e결론\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e2023년 1월 3일부터 2024년 5월 31일까지의 백테스트 결과를 기반으로, KMA 알고 트레이딩 전략은 SMA 크로스오버 및 Buy \u0026#x26; Hold 전략에 비해 매우 유망한 성과를 보여주었습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eBAC\u003c/span\u003e에 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e만 달러를 투자하여 \u003cspan class=\"hljs-variable constant_\"\u003eKMA\u003c/span\u003e 전략으로 얻은 이익 : $29026\u003cspan class=\"hljs-number\"\u003e.39\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable constant_\"\u003eBAC\u003c/span\u003e에 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e만 달러를 투자하여 \u003cspan class=\"hljs-title class_\"\u003eBuy\u003c/span\u003e \u0026#x26; \u003cspan class=\"hljs-title class_\"\u003eHold\u003c/span\u003e 전략으로 얻은 이익 : $19337\u003cspan class=\"hljs-number\"\u003e.52\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable constant_\"\u003eBAC\u003c/span\u003e에 \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e만 달러를 투자하여 \u003cspan class=\"hljs-variable constant_\"\u003eSMA\u003c/span\u003e 크로스오버 전략으로 얻은 이익 : $13473\u003cspan class=\"hljs-number\"\u003e.41\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase_7.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e우리는 KF가 TTI의 제한을 극복하고 algo-trading 전략의 성능을 향상시킬 수 있다는 것을 보여줬어요.\u003c/li\u003e\n\u003cli\u003e비선형 시스템, 이상치 및 잡음을 효율적이고 견고하게 처리하면서 동시에 최적 부드량화와 자동 매개변수 추정이 가능한 KF 프레임워크는 모든 KF 수정사항과 이점을 함께 포함할 수 있게 해 줄 거에요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e전체 Python 코드 및 입출력\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e np \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e pd \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.\u003cspan class=\"hljs-property\"\u003epyplot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e yfinance \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e yf\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pandas_datareader \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e data \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e web\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e sklearn.\u003cspan class=\"hljs-property\"\u003edecomposition\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePCA\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e seaborn \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e sns\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e datetime \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e dt, timedelta \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e td\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pykalman \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKalmanFilter\u003c/span\u003e\nsns.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e()\n\ndata = yf.\u003cspan class=\"hljs-title function_\"\u003edownload\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'BAC'\u003c/span\u003e, start=\u003cspan class=\"hljs-string\"\u003e'2023-01-01'\u003c/span\u003e, end=\u003cspan class=\"hljs-string\"\u003e'2024-06-01'\u003c/span\u003e)\n\ndf=data.\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(columns=[\u003cspan class=\"hljs-string\"\u003e'Open'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'High'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Low'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Adj Close'\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e'Volume'\u003c/span\u003e])\ndf.\u003cspan class=\"hljs-title function_\"\u003etail\u003c/span\u003e()\n\n\u003cspan class=\"hljs-title class_\"\u003eClose\u003c/span\u003e\n\u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e \n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.700001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e28\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.320000\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.720001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e38.630001\u003c/span\u003e\n\u003cspan class=\"hljs-number\"\u003e2024\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e05\u003c/span\u003e-\u003cspan class=\"hljs-number\"\u003e31\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e39.990002\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.\u003cspan class=\"hljs-property\"\u003epyplot\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e math\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e termcolor \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e colored \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e cl \n\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e pykalman \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKalmanFilter\u003c/span\u003e\n\nplt.\u003cspan class=\"hljs-property\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fivethirtyeight'\u003c/span\u003e)\nplt.\u003cspan class=\"hljs-property\"\u003ercParams\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'figure.figsize'\u003c/span\u003e] = (\u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e)\n\nkf = \u003cspan class=\"hljs-title class_\"\u003eKalmanFilter\u003c/span\u003e(\n    transition_matrices = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],\n    observation_matrices = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],\n    initial_state_mean = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    initial_state_covariance = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    observation_covariance=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    transition_covariance=\u003cspan class=\"hljs-number\"\u003e0.01\u003c/span\u003e\n)\nstate_means, _ = kf.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003evalues\u003c/span\u003e)\nstate_means = pd.\u003cspan class=\"hljs-title class_\"\u003eSeries\u003c/span\u003e(state_means.\u003cspan class=\"hljs-title function_\"\u003eflatten\u003c/span\u003e(), index=df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\n\n...\n\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(signal)\n[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, ...\n\nposition = []\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(signal)):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] \u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position.\u003cspan class=\"hljs-title function_\"\u003eappend\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        \n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df[\u003cspan class=\"hljs-string\"\u003e'Close'\u003c/span\u003e])):\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e signal[i] == \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n    elif signal[i] == -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e:\n        position[i] = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eelse\u003c/span\u003e:\n        position[i] = position[i-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\n\nsma_20 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_20).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_20'\u003c/span\u003e})\nsma_50 = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(sma_50).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_50'\u003c/span\u003e}) \nsignal = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(signal).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_signal'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\nposition = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(position).\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'sma_position'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003eset_index\u003c/span\u003e(df.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e)\n\n...\n\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'100K달러를 BAC에 투자하여 전략으로 얻은 이익 : ${}'\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eformat\u003c/span\u003e(total_investment_ret), attrs = [\u003cspan class=\"hljs-string\"\u003e'bold'\u003c/span\u003e]))\n\n100K달러를 \u003cspan class=\"hljs-variable constant_\"\u003eBAC\u003c/span\u003e에 투자하여 전략으로 얻은 이익 : $13473\u003cspan class=\"hljs-number\"\u003e.41\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e더 알아보기\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e신호/잡음 비율이 낮은 칼만 필터 기반 객체 추적\u003c/li\u003e\n\u003cli\u003e칼만 필터를 사용한 대상 궤적 추적 성능 QC 분석\u003c/li\u003e\n\u003cli\u003e견고한 1차원 칼만 필터의 해부학\u003c/li\u003e\n\u003cli\u003e칼만 필터를 사용한 주식 시장 변동성 예측\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e참고 자료\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e파이썬에서 SMA를 이용한 알고리즘 트레이딩\u003c/li\u003e\n\u003cli\u003e금융 분야에서의 칼만 필터 (KF)\u003c/li\u003e\n\u003cli\u003e칼만 필터를 기반으로 한 트레이딩 전략 구현\u003c/li\u003e\n\u003cli\u003e파이썬에서 칼만 필터, 칼만 스무서, EM 알고리즘 구현\u003c/li\u003e\n\u003cli\u003e칼만 필터를 활용한 주식 거래 마스터하기: 포괄적인 가이드\u003c/li\u003e\n\u003cli\u003e파이썬에서 주식 가격 예측을 위한 칼만 필터 사용\u003c/li\u003e\n\u003cli\u003e주식 거래에서의 칼만 필터\u003c/li\u003e\n\u003cli\u003e시장 탁계를 탐색하는 주식 분석에서의 칼만 필터\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e연락처\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e웹사이트\u003c/li\u003e\n\u003cli\u003eGitHub\u003c/li\u003e\n\u003cli\u003eX/트위터\u003c/li\u003e\n\u003cli\u003e핀터레스트\u003c/li\u003e\n\u003cli\u003e마스토돈\u003c/li\u003e\n\u003cli\u003e텀블러\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-Noise-ResistantKalmanFilterMovingAverageKMAvsSMACrossoverAlgo-TradingStrategiesBACShowcase"},"buildId":"QH5Mz7n7Y6w0r4_gCGFQf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>