<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>대용량 JSON 파일을 효율적으로 전송하는 방법 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-05-20-HowToTransferLargeJSONFilesEfficiently" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="대용량 JSON 파일을 효율적으로 전송하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="대용량 JSON 파일을 효율적으로 전송하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-05-20-HowToTransferLargeJSONFilesEfficiently" data-gatsby-head="true"/><meta name="twitter:title" content="대용량 JSON 파일을 효율적으로 전송하는 방법 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-20 21:43" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_buildManifest.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">대용량 JSON 파일을 효율적으로 전송하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="대용량 JSON 파일을 효율적으로 전송하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 20, 2024</span><span class="posts_reading_time__f7YPP">9<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-20-HowToTransferLargeJSONFilesEfficiently&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png">
<p>대규모 JSON 데이터를 전송할 때, 기존 방식을 사용하면 데이터 처리를 시작하기 전에 완전한 JSON 데이터를 수신해야 하므로 사용자 경험에 영향을 줄 수 있습니다. 이 문제를 해결하기 위해 기존의 JSON 스트림 구문 분석 라이브러리를 사용할 수 있습니다. 예를 들어 내부적으로 TextDecoder API를 사용하는 @streamparser/json이 있습니다.</p>
<p>TextDecoder API는 이진 데이터 (일반적으로 ArrayBuffer 또는 TypedArray)를 문자열로 디코딩하기 위한 JavaScript API입니다. 이는 Web 플랫폼의 일부이며 텍스트 인코딩의 디코딩을 처리하는 데 주로 사용됩니다. 예를 들어, 서버로부터 수신한 스트리밍 데이터, 파일 데이터 등을 처리하는 데 사용됩니다.</p>
<h1>TextDecoder API 사용 이유</h1>
<div class="content-ad"></div>
<p>웹 애플리케이션에서 이진 데이터를 다룰 때, 이 데이터를 읽을 수 있는 문자열 형식으로 변환해야 하는 경우가 종종 있습니다. TextDecoder를 사용하면 이를 효율적이고 편리하게 할 수 있습니다.</p>
<p>TextDecoder API에는 다음과 같은 기능이 있습니다:</p>
<ul>
<li>효율적: 수동으로 바이트 단위로 처리하는 것보다 효율적이며, 문자열로 직접 디코딩이 가능합니다.</li>
<li>여러 인코딩 지원: 다양한 텍스트 인코딩(예: UTF-8, UTF-16, ISO-8859-1 등)을 지원합니다.</li>
<li>스트리밍 처리 지원: 데이터를 조각조각으로 처리할 수 있어 대용량 데이터 스트림 또는 실시간 처리가 필요한 데이터에 적합합니다.</li>
</ul>
<h1>TextDecoder API 사용 방법</h1>
<div class="content-ad"></div>
<p>다음으로, TextDecoder API를 사용하는 네 가지 시나리오를 소개하겠습니다:</p>
<ul>
<li>서로 다른 인코딩된 바이너리 데이터 해독</li>
<li>스트리밍 JSON 데이터 디코딩</li>
<li>대용량 JSON 파일의 데이터 청크 디코딩</li>
</ul>
<h2>1. 서로 다른 인코딩된 바이너리 데이터 해독</h2>
<pre><code class="hljs language-js"><span class="hljs-comment">// 다른 인코딩으로 TextDecoder 인스턴스 생성</span>
<span class="hljs-keyword">const</span> utf16Decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-16'</span>);
<span class="hljs-keyword">const</span> iso88591Decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'iso-8859-1'</span>);

<span class="hljs-keyword">const</span> utf16Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([<span class="hljs-number">0x0048</span>, <span class="hljs-number">0x0065</span>, <span class="hljs-number">0x006C</span>, <span class="hljs-number">0x006C</span>, <span class="hljs-number">0x006F</span>]);
<span class="hljs-keyword">const</span> iso88591Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">72</span>, <span class="hljs-number">101</span>, <span class="hljs-number">108</span>, <span class="hljs-number">108</span>, <span class="hljs-number">111</span>]);

<span class="hljs-comment">// 문자열로 디코딩</span>
<span class="hljs-keyword">const</span> utf16String = utf16Decoder.<span class="hljs-title function_">decode</span>(utf16Array);
<span class="hljs-keyword">const</span> iso88591String = iso88591Decoder.<span class="hljs-title function_">decode</span>(iso88591Array);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(utf16String); <span class="hljs-comment">// 출력："Hello"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iso88591String); <span class="hljs-comment">// 출력："Hello"</span>
</code></pre>
<div class="content-ad"></div>
<h2>2. 스트리밍 JSON 데이터 디코딩</h2>
<p>먼저, 결과를 살펴봅시다:</p>
<p><img src="/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_1.png" alt="이미지"></p>
<p>위의 예제에서는 Node.js의 http 모듈을 사용하여 로컬 SSE (서버 전송 이벤트) 서버를 빠르게 구축합니다.</p>
<div class="content-ad"></div>
<p>server.js</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">"http"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =></span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">"/sse"</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/event-stream"</span>,
      <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
      <span class="hljs-title class_">Connection</span>: <span class="hljs-string">"keep-alive"</span>,
      <span class="hljs-string">"Access-Control-Allow-Origin"</span>: <span class="hljs-string">"*"</span>,
      <span class="hljs-string">"Access-Control-Allow-Headers"</span>:
        <span class="hljs-string">"Origin, X-Requested-With, Content-Type, Accept"</span>,
    });

    <span class="hljs-keyword">let</span> id = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =></span> {
      <span class="hljs-keyword">const</span> data = {
        <span class="hljs-attr">id</span>: id,
        <span class="hljs-attr">message</span>: <span class="hljs-string">`This is message <span class="hljs-subst">${id}</span>`</span>,
        <span class="hljs-attr">timestamp</span>: +<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
      };
      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>\n\n`</span>);

      <span class="hljs-keyword">if</span> (id == <span class="hljs-number">5</span>) {
        res.<span class="hljs-title function_">write</span>(<span class="hljs-string">"event: end\n"</span>);
        res.<span class="hljs-title function_">write</span>(<span class="hljs-string">"data: End of stream\n\n"</span>);
        <span class="hljs-built_in">clearInterval</span>(interval);
        res.<span class="hljs-title function_">end</span>();
      }

      id++;
    }, <span class="hljs-number">1000</span>);

    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">() =></span> {
      <span class="hljs-built_in">clearInterval</span>(interval);
    });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">"404 Not Found"</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =></span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<p>sse 핸들러에서는 Content-Type 응답 헤더의 유형을 "text/event-stream"으로 설정하여 클라이언트에게 스트리밍 데이터를 반환한다는 것을 알려줍니다.</p>
<p>index.html</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">&#x3C;!<span class="hljs-variable constant_">DOCTYPE</span> html>
&#x3C;html lang="en">
&#x3C;head>
    &#x3C;meta charset="UTF-8">
    &#x3C;meta name="viewport" content="width=device-width, initial-scale=1.0">
    &#x3C;title>SSE &#x26; TextDecoder&#x3C;/title>
&#x3C;/head>
&#x3C;body>
    &#x3C;h1>서버-전송 이벤트 JSON 스트림 데이터 디코딩&#x3C;/h1>
    &#x3C;div id="messages">&#x3C;/div>
    &#x3C;script src="client.js">&#x3C;/script>
&#x3C;/body>
&#x3C;/html>
</code></pre>
<p>client.js</p>
<pre><code class="hljs language-js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function">() =></span> {
  <span class="hljs-keyword">const</span> messagesDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#messages"</span>);
  <span class="hljs-keyword">const</span> textDecoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">"utf-8"</span>);

  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:3000/sse"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =></span> {
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadableStream</span>({
      <span class="hljs-title function_">start</span>(<span class="hljs-params">controller</span>) {
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">push</span>(<span class="hljs-params"></span>) {
          reader.<span class="hljs-title function_">read</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ done, value }</span>) =></span> {
            <span class="hljs-keyword">if</span> (done) {
              controller.<span class="hljs-title function_">close</span>();
              <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">const</span> chunk = textDecoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> });
            <span class="hljs-keyword">const</span> lines = chunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">"\n"</span>);

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
              <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"data: "</span>)) {
                <span class="hljs-keyword">const</span> json = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>);
                <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);
                <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"p"</span>);
                p.<span class="hljs-property">textContent</span> = <span class="hljs-string">`ID: <span class="hljs-subst">${data.id}</span>, Message: <span class="hljs-subst">${data.message}</span>, Timestamp: <span class="hljs-subst">${data.timestamp}</span>`</span>;
                messagesDiv.<span class="hljs-title function_">appendChild</span>(p);
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"event: end"</span>)) {
                <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"p"</span>);
                p.<span class="hljs-property">textContent</span> = <span class="hljs-string">"스트림의 끝"</span>;
                messagesDiv.<span class="hljs-title function_">appendChild</span>(p);
                <span class="hljs-keyword">return</span>;
              }
            }
            <span class="hljs-title function_">push</span>();
          });
        }
        <span class="hljs-title function_">push</span>();
      },
    });
  });
});
</code></pre>
<p>SSE 이벤트 스트림은 간단한 텍스트 데이터 스트림이며 해당 텍스트는 UTF-8 형식을 사용하여 인코딩됩니다. 따라서 textDecoder 객체를 생성할 때 인코딩을 utf-8로 설정해야 합니다. 텍스트Decoder 객체가 준비되면 해당 객체가 제공하는 decode 메소드를 호출하여 디코딩할 수 있습니다.</p>
<div class="content-ad"></div>
<h2>3. 대용량 JSON 파일에서 데이터 청크 디코딩하기</h2>
<p>다시 한번, 먼저 결과를 살펴봅시다:</p>
<p><img src="/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_2.png" alt="이미지"></p>
<p>위 그림에서 JSON 데이터 출력은 다음 large.json 파일에서 나온 것입니다. 우리는 파일을 0.5KB씩 잘라서 500ms마다 다음 청크를 보내는 방식으로 처리합니다. @streamparser/json 라이브러리를 사용하여 JSON 청크를 파싱할 수 있는 기능을 구현했습니다.</p>
<div class="content-ad"></div>
<p>large.json</p>
<pre><code class="hljs language-js">[
  {},
  {
    <span class="hljs-string">"image"</span>: [
      {
        <span class="hljs-string">"shape"</span>: <span class="hljs-string">"rect"</span>,
        <span class="hljs-string">"fill"</span>: <span class="hljs-string">"#333"</span>,
        <span class="hljs-string">"stroke"</span>: <span class="hljs-string">"#999"</span>,
        <span class="hljs-string">"x"</span>: <span class="hljs-number">0.5e1</span>,
        <span class="hljs-string">"y"</span>: <span class="hljs-number">0.5</span>,
        <span class="hljs-string">"z"</span>: <span class="hljs-number">0.8</span>,
        <span class="hljs-string">"w"</span>: <span class="hljs-number">0.5e5</span>,
        <span class="hljs-string">"u"</span>: <span class="hljs-number">2e10</span>,
        <span class="hljs-string">"foo"</span>: <span class="hljs-number">2e1</span>,
        <span class="hljs-string">"bar"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-string">"width"</span>: <span class="hljs-number">47</span>,
        <span class="hljs-string">"height"</span>: <span class="hljs-number">47</span>
      }
    ],
    <span class="hljs-string">"corners"</span>: { <span class="hljs-string">"1"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"3"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"7"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"9"</span>: <span class="hljs-literal">true</span> }
  },
 ...
]
</code></pre>
<p>json-server.js</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">"http"</span>);
<span class="hljs-keyword">const</span> { join } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> { readFileSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;

<span class="hljs-keyword">const</span> largeJson = <span class="hljs-title function_">readFileSync</span>(<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"large.json"</span>)).<span class="hljs-title function_">toString</span>();

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =></span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">"/stream-json"</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
      <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
      <span class="hljs-title class_">Connection</span>: <span class="hljs-string">"keep-alive"</span>,
      <span class="hljs-string">"Access-Control-Allow-Origin"</span>: <span class="hljs-string">"*"</span>,
      <span class="hljs-string">"Access-Control-Allow-Headers"</span>:
        <span class="hljs-string">"Origin, X-Requested-With, Content-Type, Accept"</span>,
    });

    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CHUNK_SIZE</span> = <span class="hljs-number">512</span>;
    <span class="hljs-keyword">let</span> position = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =></span> {
      <span class="hljs-keyword">const</span> chunk = largeJson.<span class="hljs-title function_">slice</span>(position, position + <span class="hljs-variable constant_">CHUNK_SIZE</span>);
      res.<span class="hljs-title function_">write</span>(chunk);
      position += <span class="hljs-variable constant_">CHUNK_SIZE</span>;

      <span class="hljs-keyword">if</span> (position >= largeJson.<span class="hljs-property">length</span>) {
        <span class="hljs-built_in">clearInterval</span>(interval);
        res.<span class="hljs-title function_">end</span>();
      }
    }, <span class="hljs-number">500</span>);

    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">() =></span> {
      <span class="hljs-built_in">clearInterval</span>(interval);
    });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">"404 Not Found"</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =></span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server is running on http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<div class="content-ad"></div>
<p>stream.html</p>
<pre><code class="hljs language-js">&#x3C;!<span class="hljs-variable constant_">DOCTYPE</span> html>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">head</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">title</span>></span>Stream JSON<span class="hljs-tag">&#x3C;/<span class="hljs-name">title</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">head</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">body</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">h1</span>></span>Stream JSON<span class="hljs-tag">&#x3C;/<span class="hljs-name">h1</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messages"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>></span><span class="javascript">
      <span class="hljs-keyword">import</span> { <span class="hljs-title class_">JSON</span>Parser } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://cdn.jsdelivr.net/npm/@streamparser/json-whatwg@0.0.21/+esm"</span>;
      <span class="hljs-keyword">const</span> messagesDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#messages"</span>);

      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-keyword">async</span> () => {
        <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span>Parser();

        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:3000/stream-json"</span>);

        <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">pipeThrough</span>(parser).<span class="hljs-title function_">getReader</span>();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          <span class="hljs-keyword">const</span> { done, <span class="hljs-attr">value</span>: parsedElementInfo } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
          <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

          <span class="hljs-keyword">const</span> { value, key, parent, stack, partial } = parsedElementInfo;
          <span class="hljs-keyword">if</span> (partial) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Parsing value: <span class="hljs-subst">${value}</span>... (still parsing)`</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"p"</span>);
            p.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(value)}</span>`</span>;
            messagesDiv.<span class="hljs-title function_">appendChild</span>(p);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Value parsed: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(value)}</span>`</span>);
          }
        }
      });
    </span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">body</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">html</span>></span></span>
</code></pre>
<p>@streamparser/json 라이브러리는 다른 용도도 있어요. 관심이 있다면 사용 설명서를 살펴보세요. TextDecoder API에 대한 다른 유용한 사용 사례가 있으면 댓글을 남겨주세요.</p>
<p>TypeScript는 정말 멋지고 배울 가치가 있어요. TypeScript를 배우고 싶다면 Medium이나 Twitter에서 저를 팔로우해서 TS와 JS에 관한 더 많은 내용을 읽을 수 있어요!</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"대용량 JSON 파일을 효율적으로 전송하는 방법","description":"","date":"2024-05-20 21:43","slug":"2024-05-20-HowToTransferLargeJSONFilesEfficiently","content":"\n\n\u003cimg src=\"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png\" /\u003e\n\n대규모 JSON 데이터를 전송할 때, 기존 방식을 사용하면 데이터 처리를 시작하기 전에 완전한 JSON 데이터를 수신해야 하므로 사용자 경험에 영향을 줄 수 있습니다. 이 문제를 해결하기 위해 기존의 JSON 스트림 구문 분석 라이브러리를 사용할 수 있습니다. 예를 들어 내부적으로 TextDecoder API를 사용하는 @streamparser/json이 있습니다.\n\nTextDecoder API는 이진 데이터 (일반적으로 ArrayBuffer 또는 TypedArray)를 문자열로 디코딩하기 위한 JavaScript API입니다. 이는 Web 플랫폼의 일부이며 텍스트 인코딩의 디코딩을 처리하는 데 주로 사용됩니다. 예를 들어, 서버로부터 수신한 스트리밍 데이터, 파일 데이터 등을 처리하는 데 사용됩니다.\n\n# TextDecoder API 사용 이유\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n웹 애플리케이션에서 이진 데이터를 다룰 때, 이 데이터를 읽을 수 있는 문자열 형식으로 변환해야 하는 경우가 종종 있습니다. TextDecoder를 사용하면 이를 효율적이고 편리하게 할 수 있습니다.\n\nTextDecoder API에는 다음과 같은 기능이 있습니다:\n\n- 효율적: 수동으로 바이트 단위로 처리하는 것보다 효율적이며, 문자열로 직접 디코딩이 가능합니다.\n- 여러 인코딩 지원: 다양한 텍스트 인코딩(예: UTF-8, UTF-16, ISO-8859-1 등)을 지원합니다.\n- 스트리밍 처리 지원: 데이터를 조각조각으로 처리할 수 있어 대용량 데이터 스트림 또는 실시간 처리가 필요한 데이터에 적합합니다.\n\n# TextDecoder API 사용 방법\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n다음으로, TextDecoder API를 사용하는 네 가지 시나리오를 소개하겠습니다:\n\n- 서로 다른 인코딩된 바이너리 데이터 해독\n- 스트리밍 JSON 데이터 디코딩\n- 대용량 JSON 파일의 데이터 청크 디코딩\n\n## 1. 서로 다른 인코딩된 바이너리 데이터 해독\n\n```js\n// 다른 인코딩으로 TextDecoder 인스턴스 생성\nconst utf16Decoder = new TextDecoder('utf-16');\nconst iso88591Decoder = new TextDecoder('iso-8859-1');\n\nconst utf16Array = new Uint16Array([0x0048, 0x0065, 0x006C, 0x006C, 0x006F]);\nconst iso88591Array = new Uint8Array([72, 101, 108, 108, 111]);\n\n// 문자열로 디코딩\nconst utf16String = utf16Decoder.decode(utf16Array);\nconst iso88591String = iso88591Decoder.decode(iso88591Array);\n\nconsole.log(utf16String); // 출력：\"Hello\"\nconsole.log(iso88591String); // 출력：\"Hello\"\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 2. 스트리밍 JSON 데이터 디코딩\n\n먼저, 결과를 살펴봅시다:\n\n![이미지](/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_1.png)\n\n위의 예제에서는 Node.js의 http 모듈을 사용하여 로컬 SSE (서버 전송 이벤트) 서버를 빠르게 구축합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nserver.js\n\n```js\nconst http = require(\"http\");\n\nconst PORT = 3000;\n\nconst server = http.createServer((req, res) =\u003e {\n  if (req.url === \"/sse\") {\n    res.writeHead(200, {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache\",\n      Connection: \"keep-alive\",\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Headers\":\n        \"Origin, X-Requested-With, Content-Type, Accept\",\n    });\n\n    let id = 1;\n    const interval = setInterval(() =\u003e {\n      const data = {\n        id: id,\n        message: `This is message ${id}`,\n        timestamp: +new Date(),\n      };\n      res.write(`data: ${JSON.stringify(data)}\\n\\n`);\n\n      if (id == 5) {\n        res.write(\"event: end\\n\");\n        res.write(\"data: End of stream\\n\\n\");\n        clearInterval(interval);\n        res.end();\n      }\n\n      id++;\n    }, 1000);\n\n    req.on(\"close\", () =\u003e {\n      clearInterval(interval);\n    });\n  } else {\n    res.writeHead(404, { \"Content-Type\": \"text/plain\" });\n    res.end(\"404 Not Found\");\n  }\n});\n\nserver.listen(PORT, () =\u003e {\n  console.log(`Server is running on http://localhost:${PORT}`);\n});\n```\n\nsse 핸들러에서는 Content-Type 응답 헤더의 유형을 \"text/event-stream\"으로 설정하여 클라이언트에게 스트리밍 데이터를 반환한다는 것을 알려줍니다.\n\nindex.html\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003cmeta charset=\"UTF-8\"\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u003ctitle\u003eSSE \u0026 TextDecoder\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    \u003ch1\u003e서버-전송 이벤트 JSON 스트림 데이터 디코딩\u003c/h1\u003e\n    \u003cdiv id=\"messages\"\u003e\u003c/div\u003e\n    \u003cscript src=\"client.js\"\u003e\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\nclient.js\n\n```js\ndocument.addEventListener(\"DOMContentLoaded\", () =\u003e {\n  const messagesDiv = document.querySelector(\"#messages\");\n  const textDecoder = new TextDecoder(\"utf-8\");\n\n  fetch(\"http://localhost:3000/sse\").then((response) =\u003e {\n    const reader = response.body.getReader();\n    return new ReadableStream({\n      start(controller) {\n        function push() {\n          reader.read().then(({ done, value }) =\u003e {\n            if (done) {\n              controller.close();\n              return;\n            }\n\n            const chunk = textDecoder.decode(value, { stream: true });\n            const lines = chunk.split(\"\\n\");\n\n            for (const line of lines) {\n              if (line.startsWith(\"data: \")) {\n                const json = line.slice(6);\n                const data = JSON.parse(json);\n                const p = document.createElement(\"p\");\n                p.textContent = `ID: ${data.id}, Message: ${data.message}, Timestamp: ${data.timestamp}`;\n                messagesDiv.appendChild(p);\n              } else if (line.startsWith(\"event: end\")) {\n                const p = document.createElement(\"p\");\n                p.textContent = \"스트림의 끝\";\n                messagesDiv.appendChild(p);\n                return;\n              }\n            }\n            push();\n          });\n        }\n        push();\n      },\n    });\n  });\n});\n```\n\nSSE 이벤트 스트림은 간단한 텍스트 데이터 스트림이며 해당 텍스트는 UTF-8 형식을 사용하여 인코딩됩니다. 따라서 textDecoder 객체를 생성할 때 인코딩을 utf-8로 설정해야 합니다. 텍스트Decoder 객체가 준비되면 해당 객체가 제공하는 decode 메소드를 호출하여 디코딩할 수 있습니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 3. 대용량 JSON 파일에서 데이터 청크 디코딩하기\n\n다시 한번, 먼저 결과를 살펴봅시다:\n\n![이미지](/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_2.png)\n\n위 그림에서 JSON 데이터 출력은 다음 large.json 파일에서 나온 것입니다. 우리는 파일을 0.5KB씩 잘라서 500ms마다 다음 청크를 보내는 방식으로 처리합니다. @streamparser/json 라이브러리를 사용하여 JSON 청크를 파싱할 수 있는 기능을 구현했습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\nlarge.json\n\n```js\n[\n  {},\n  {\n    \"image\": [\n      {\n        \"shape\": \"rect\",\n        \"fill\": \"#333\",\n        \"stroke\": \"#999\",\n        \"x\": 0.5e1,\n        \"y\": 0.5,\n        \"z\": 0.8,\n        \"w\": 0.5e5,\n        \"u\": 2e10,\n        \"foo\": 2e1,\n        \"bar\": 2,\n        \"width\": 47,\n        \"height\": 47\n      }\n    ],\n    \"corners\": { \"1\": true, \"3\": true, \"7\": true, \"9\": true }\n  },\n ...\n]\n```\n\njson-server.js\n\n```js\nconst http = require(\"http\");\nconst { join } = require(\"path\");\nconst { readFileSync } = require(\"fs\");\n\nconst PORT = 3000;\n\nconst largeJson = readFileSync(join(__dirname, \"large.json\")).toString();\n\nconst server = http.createServer((req, res) =\u003e {\n  if (req.url === \"/stream-json\") {\n    res.writeHead(200, {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-cache\",\n      Connection: \"keep-alive\",\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Headers\":\n        \"Origin, X-Requested-With, Content-Type, Accept\",\n    });\n\n    const CHUNK_SIZE = 512;\n    let position = 0;\n\n    const interval = setInterval(() =\u003e {\n      const chunk = largeJson.slice(position, position + CHUNK_SIZE);\n      res.write(chunk);\n      position += CHUNK_SIZE;\n\n      if (position \u003e= largeJson.length) {\n        clearInterval(interval);\n        res.end();\n      }\n    }, 500);\n\n    req.on(\"close\", () =\u003e {\n      clearInterval(interval);\n    });\n  } else {\n    res.writeHead(404, { \"Content-Type\": \"text/plain\" });\n    res.end(\"404 Not Found\");\n  }\n});\n\nserver.listen(PORT, () =\u003e {\n  console.log(`Server is running on http://localhost:${PORT}`);\n});\n``` \n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nstream.html\n\n```js\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"UTF-8\" /\u003e\n    \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e\n    \u003ctitle\u003eStream JSON\u003c/title\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003ch1\u003eStream JSON\u003c/h1\u003e\n    \u003cdiv id=\"messages\"\u003e\u003c/div\u003e\n    \u003cscript type=\"module\"\u003e\n      import { JSONParser } from \"https://cdn.jsdelivr.net/npm/@streamparser/json-whatwg@0.0.21/+esm\";\n      const messagesDiv = document.querySelector(\"#messages\");\n\n      document.addEventListener(\"DOMContentLoaded\", async () =\u003e {\n        const parser = new JSONParser();\n\n        const response = await fetch(\"http://localhost:3000/stream-json\");\n\n        const reader = response.body.pipeThrough(parser).getReader();\n        while (true) {\n          const { done, value: parsedElementInfo } = await reader.read();\n          if (done) break;\n\n          const { value, key, parent, stack, partial } = parsedElementInfo;\n          if (partial) {\n            console.log(`Parsing value: ${value}... (still parsing)`);\n          } else {\n            const p = document.createElement(\"p\");\n            p.textContent = `${JSON.stringify(value)}`;\n            messagesDiv.appendChild(p);\n            console.log(`Value parsed: ${JSON.stringify(value)}`);\n          }\n        }\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n@streamparser/json 라이브러리는 다른 용도도 있어요. 관심이 있다면 사용 설명서를 살펴보세요. TextDecoder API에 대한 다른 유용한 사용 사례가 있으면 댓글을 남겨주세요.\n\nTypeScript는 정말 멋지고 배울 가치가 있어요. TypeScript를 배우고 싶다면 Medium이나 Twitter에서 저를 팔로우해서 TS와 JS에 관한 더 많은 내용을 읽을 수 있어요!","ogImage":{"url":"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png"},"coverImage":"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png","tag":["Tech"],"readingTime":9},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_0.png\"\u003e\n\u003cp\u003e대규모 JSON 데이터를 전송할 때, 기존 방식을 사용하면 데이터 처리를 시작하기 전에 완전한 JSON 데이터를 수신해야 하므로 사용자 경험에 영향을 줄 수 있습니다. 이 문제를 해결하기 위해 기존의 JSON 스트림 구문 분석 라이브러리를 사용할 수 있습니다. 예를 들어 내부적으로 TextDecoder API를 사용하는 @streamparser/json이 있습니다.\u003c/p\u003e\n\u003cp\u003eTextDecoder API는 이진 데이터 (일반적으로 ArrayBuffer 또는 TypedArray)를 문자열로 디코딩하기 위한 JavaScript API입니다. 이는 Web 플랫폼의 일부이며 텍스트 인코딩의 디코딩을 처리하는 데 주로 사용됩니다. 예를 들어, 서버로부터 수신한 스트리밍 데이터, 파일 데이터 등을 처리하는 데 사용됩니다.\u003c/p\u003e\n\u003ch1\u003eTextDecoder API 사용 이유\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e웹 애플리케이션에서 이진 데이터를 다룰 때, 이 데이터를 읽을 수 있는 문자열 형식으로 변환해야 하는 경우가 종종 있습니다. TextDecoder를 사용하면 이를 효율적이고 편리하게 할 수 있습니다.\u003c/p\u003e\n\u003cp\u003eTextDecoder API에는 다음과 같은 기능이 있습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e효율적: 수동으로 바이트 단위로 처리하는 것보다 효율적이며, 문자열로 직접 디코딩이 가능합니다.\u003c/li\u003e\n\u003cli\u003e여러 인코딩 지원: 다양한 텍스트 인코딩(예: UTF-8, UTF-16, ISO-8859-1 등)을 지원합니다.\u003c/li\u003e\n\u003cli\u003e스트리밍 처리 지원: 데이터를 조각조각으로 처리할 수 있어 대용량 데이터 스트림 또는 실시간 처리가 필요한 데이터에 적합합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eTextDecoder API 사용 방법\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e다음으로, TextDecoder API를 사용하는 네 가지 시나리오를 소개하겠습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e서로 다른 인코딩된 바이너리 데이터 해독\u003c/li\u003e\n\u003cli\u003e스트리밍 JSON 데이터 디코딩\u003c/li\u003e\n\u003cli\u003e대용량 JSON 파일의 데이터 청크 디코딩\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e1. 서로 다른 인코딩된 바이너리 데이터 해독\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 다른 인코딩으로 TextDecoder 인스턴스 생성\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e utf16Decoder = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTextDecoder\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'utf-16'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e iso88591Decoder = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTextDecoder\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'iso-8859-1'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e utf16Array = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUint16Array\u003c/span\u003e([\u003cspan class=\"hljs-number\"\u003e0x0048\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x0065\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x006C\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x006C\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x006F\u003c/span\u003e]);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e iso88591Array = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUint8Array\u003c/span\u003e([\u003cspan class=\"hljs-number\"\u003e72\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e101\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e108\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e108\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e111\u003c/span\u003e]);\n\n\u003cspan class=\"hljs-comment\"\u003e// 문자열로 디코딩\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e utf16String = utf16Decoder.\u003cspan class=\"hljs-title function_\"\u003edecode\u003c/span\u003e(utf16Array);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e iso88591String = iso88591Decoder.\u003cspan class=\"hljs-title function_\"\u003edecode\u003c/span\u003e(iso88591Array);\n\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(utf16String); \u003cspan class=\"hljs-comment\"\u003e// 출력：\"Hello\"\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(iso88591String); \u003cspan class=\"hljs-comment\"\u003e// 출력：\"Hello\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e2. 스트리밍 JSON 데이터 디코딩\u003c/h2\u003e\n\u003cp\u003e먼저, 결과를 살펴봅시다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e위의 예제에서는 Node.js의 http 모듈을 사용하여 로컬 SSE (서버 전송 이벤트) 서버를 빠르게 구축합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eserver.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"http\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = http.\u003cspan class=\"hljs-title function_\"\u003ecreateServer\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\"/sse\"\u003c/span\u003e) {\n    res.\u003cspan class=\"hljs-title function_\"\u003ewriteHead\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n      \u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"text/event-stream\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Cache-Control\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"no-cache\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-title class_\"\u003eConnection\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"keep-alive\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Access-Control-Allow-Origin\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"*\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Access-Control-Allow-Headers\"\u003c/span\u003e:\n        \u003cspan class=\"hljs-string\"\u003e\"Origin, X-Requested-With, Content-Type, Accept\"\u003c/span\u003e,\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e id = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e interval = \u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = {\n        \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: id,\n        \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`This is message \u003cspan class=\"hljs-subst\"\u003e${id}\u003c/span\u003e`\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003etimestamp\u003c/span\u003e: +\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e(),\n      };\n      res.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`data: \u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(data)}\u003c/span\u003e\\n\\n`\u003c/span\u003e);\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (id == \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e) {\n        res.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"event: end\\n\"\u003c/span\u003e);\n        res.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"data: End of stream\\n\\n\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003eclearInterval\u003c/span\u003e(interval);\n        res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e();\n      }\n\n      id++;\n    }, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e);\n\n    req.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"close\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-built_in\"\u003eclearInterval\u003c/span\u003e(interval);\n    });\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    res.\u003cspan class=\"hljs-title function_\"\u003ewriteHead\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, { \u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"text/plain\"\u003c/span\u003e });\n    res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"404 Not Found\"\u003c/span\u003e);\n  }\n});\n\nserver.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Server is running on http://localhost:\u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e`\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003esse 핸들러에서는 Content-Type 응답 헤더의 유형을 \"text/event-stream\"으로 설정하여 클라이언트에게 스트리밍 데이터를 반환한다는 것을 알려줍니다.\u003c/p\u003e\n\u003cp\u003eindex.html\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;!\u003cspan class=\"hljs-variable constant_\"\u003eDOCTYPE\u003c/span\u003e html\u003e\n\u0026#x3C;html lang=\"en\"\u003e\n\u0026#x3C;head\u003e\n    \u0026#x3C;meta charset=\"UTF-8\"\u003e\n    \u0026#x3C;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e\n    \u0026#x3C;title\u003eSSE \u0026#x26; TextDecoder\u0026#x3C;/title\u003e\n\u0026#x3C;/head\u003e\n\u0026#x3C;body\u003e\n    \u0026#x3C;h1\u003e서버-전송 이벤트 JSON 스트림 데이터 디코딩\u0026#x3C;/h1\u003e\n    \u0026#x3C;div id=\"messages\"\u003e\u0026#x3C;/div\u003e\n    \u0026#x3C;script src=\"client.js\"\u003e\u0026#x3C;/script\u003e\n\u0026#x3C;/body\u003e\n\u0026#x3C;/html\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eclient.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"DOMContentLoaded\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e messagesDiv = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#messages\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e textDecoder = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTextDecoder\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"utf-8\"\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"http://localhost:3000/sse\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e reader = response.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetReader\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReadableStream\u003c/span\u003e({\n      \u003cspan class=\"hljs-title function_\"\u003estart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003econtroller\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n          reader.\u003cspan class=\"hljs-title function_\"\u003eread\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{ done, value }\u003c/span\u003e) =\u003e\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (done) {\n              controller.\u003cspan class=\"hljs-title function_\"\u003eclose\u003c/span\u003e();\n              \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n            }\n\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chunk = textDecoder.\u003cspan class=\"hljs-title function_\"\u003edecode\u003c/span\u003e(value, { \u003cspan class=\"hljs-attr\"\u003estream\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e lines = chunk.\u003cspan class=\"hljs-title function_\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"\\n\"\u003c/span\u003e);\n\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e line \u003cspan class=\"hljs-keyword\"\u003eof\u003c/span\u003e lines) {\n              \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (line.\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"data: \"\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e json = line.\u003cspan class=\"hljs-title function_\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparse\u003c/span\u003e(json);\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"p\"\u003c/span\u003e);\n                p.\u003cspan class=\"hljs-property\"\u003etextContent\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e`ID: \u003cspan class=\"hljs-subst\"\u003e${data.id}\u003c/span\u003e, Message: \u003cspan class=\"hljs-subst\"\u003e${data.message}\u003c/span\u003e, Timestamp: \u003cspan class=\"hljs-subst\"\u003e${data.timestamp}\u003c/span\u003e`\u003c/span\u003e;\n                messagesDiv.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(p);\n              } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (line.\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"event: end\"\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"p\"\u003c/span\u003e);\n                p.\u003cspan class=\"hljs-property\"\u003etextContent\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\"스트림의 끝\"\u003c/span\u003e;\n                messagesDiv.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(p);\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n              }\n            }\n            \u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e();\n          });\n        }\n        \u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e();\n      },\n    });\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSSE 이벤트 스트림은 간단한 텍스트 데이터 스트림이며 해당 텍스트는 UTF-8 형식을 사용하여 인코딩됩니다. 따라서 textDecoder 객체를 생성할 때 인코딩을 utf-8로 설정해야 합니다. 텍스트Decoder 객체가 준비되면 해당 객체가 제공하는 decode 메소드를 호출하여 디코딩할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e3. 대용량 JSON 파일에서 데이터 청크 디코딩하기\u003c/h2\u003e\n\u003cp\u003e다시 한번, 먼저 결과를 살펴봅시다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-20-HowToTransferLargeJSONFilesEfficiently_2.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e위 그림에서 JSON 데이터 출력은 다음 large.json 파일에서 나온 것입니다. 우리는 파일을 0.5KB씩 잘라서 500ms마다 다음 청크를 보내는 방식으로 처리합니다. @streamparser/json 라이브러리를 사용하여 JSON 청크를 파싱할 수 있는 기능을 구현했습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003elarge.json\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e[\n  {},\n  {\n    \u003cspan class=\"hljs-string\"\u003e\"image\"\u003c/span\u003e: [\n      {\n        \u003cspan class=\"hljs-string\"\u003e\"shape\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"rect\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"fill\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"#333\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"stroke\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"#999\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"x\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.5e1\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"y\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"z\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.8\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"w\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.5e5\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"u\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2e10\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"foo\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2e1\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"bar\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"width\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e47\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"height\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e47\u003c/span\u003e\n      }\n    ],\n    \u003cspan class=\"hljs-string\"\u003e\"corners\"\u003c/span\u003e: { \u003cspan class=\"hljs-string\"\u003e\"1\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"3\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"7\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"9\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }\n  },\n ...\n]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ejson-server.js\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"http\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { join } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"path\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { readFileSync } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"fs\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e largeJson = \u003cspan class=\"hljs-title function_\"\u003ereadFileSync\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string\"\u003e\"large.json\"\u003c/span\u003e)).\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = http.\u003cspan class=\"hljs-title function_\"\u003ecreateServer\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\"/stream-json\"\u003c/span\u003e) {\n    res.\u003cspan class=\"hljs-title function_\"\u003ewriteHead\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n      \u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"application/json\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Cache-Control\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"no-cache\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-title class_\"\u003eConnection\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"keep-alive\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Access-Control-Allow-Origin\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"*\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Access-Control-Allow-Headers\"\u003c/span\u003e:\n        \u003cspan class=\"hljs-string\"\u003e\"Origin, X-Requested-With, Content-Type, Accept\"\u003c/span\u003e,\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eCHUNK_SIZE\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e512\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e position = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e interval = \u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chunk = largeJson.\u003cspan class=\"hljs-title function_\"\u003eslice\u003c/span\u003e(position, position + \u003cspan class=\"hljs-variable constant_\"\u003eCHUNK_SIZE\u003c/span\u003e);\n      res.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(chunk);\n      position += \u003cspan class=\"hljs-variable constant_\"\u003eCHUNK_SIZE\u003c/span\u003e;\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (position \u003e= largeJson.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e) {\n        \u003cspan class=\"hljs-built_in\"\u003eclearInterval\u003c/span\u003e(interval);\n        res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e();\n      }\n    }, \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e);\n\n    req.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"close\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-built_in\"\u003eclearInterval\u003c/span\u003e(interval);\n    });\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    res.\u003cspan class=\"hljs-title function_\"\u003ewriteHead\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e, { \u003cspan class=\"hljs-string\"\u003e\"Content-Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"text/plain\"\u003c/span\u003e });\n    res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"404 Not Found\"\u003c/span\u003e);\n  }\n});\n\nserver.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Server is running on http://localhost:\u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e`\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003estream.html\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;!\u003cspan class=\"hljs-variable constant_\"\u003eDOCTYPE\u003c/span\u003e html\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"en\"\u003c/span\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"UTF-8\"\u003c/span\u003e /\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"viewport\"\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"width=device-width, initial-scale=1.0\"\u003c/span\u003e /\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u003e\u003c/span\u003eStream JSON\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u003e\u003c/span\u003eStream JSON\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"messages\"\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"module\"\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"javascript\"\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003eParser } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"https://cdn.jsdelivr.net/npm/@streamparser/json-whatwg@0.0.21/+esm\"\u003c/span\u003e;\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e messagesDiv = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#messages\"\u003c/span\u003e);\n\n      \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"DOMContentLoaded\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e parser = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003eParser();\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"http://localhost:3000/stream-json\"\u003c/span\u003e);\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e reader = response.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epipeThrough\u003c/span\u003e(parser).\u003cspan class=\"hljs-title function_\"\u003egetReader\u003c/span\u003e();\n        \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n          \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { done, \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: parsedElementInfo } = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e reader.\u003cspan class=\"hljs-title function_\"\u003eread\u003c/span\u003e();\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (done) \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n\n          \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { value, key, parent, stack, partial } = parsedElementInfo;\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (partial) {\n            \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Parsing value: \u003cspan class=\"hljs-subst\"\u003e${value}\u003c/span\u003e... (still parsing)`\u003c/span\u003e);\n          } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"p\"\u003c/span\u003e);\n            p.\u003cspan class=\"hljs-property\"\u003etextContent\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(value)}\u003c/span\u003e`\u003c/span\u003e;\n            messagesDiv.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(p);\n            \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Value parsed: \u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify(value)}\u003c/span\u003e`\u003c/span\u003e);\n          }\n        }\n      });\n    \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e@streamparser/json 라이브러리는 다른 용도도 있어요. 관심이 있다면 사용 설명서를 살펴보세요. TextDecoder API에 대한 다른 유용한 사용 사례가 있으면 댓글을 남겨주세요.\u003c/p\u003e\n\u003cp\u003eTypeScript는 정말 멋지고 배울 가치가 있어요. TypeScript를 배우고 싶다면 Medium이나 Twitter에서 저를 팔로우해서 TS와 JS에 관한 더 많은 내용을 읽을 수 있어요!\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-20-HowToTransferLargeJSONFilesEfficiently"},"buildId":"Y-fCAg8BUV7y2HNFwX9AA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>