<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>증명 개념 아두이노 UNO에서 비동기 프로그래밍 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="증명 개념 아두이노 UNO에서 비동기 프로그래밍 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="증명 개념 아두이노 UNO에서 비동기 프로그래밍 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO" data-gatsby-head="true"/><meta name="twitter:title" content="증명 개념 아두이노 UNO에서 비동기 프로그래밍 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-15 11:27" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-a8eda6c93e0b14fe.js" defer=""></script><script src="/_next/static/R94iUTCf1NWeBC_VXjTJG/_buildManifest.js" defer=""></script><script src="/_next/static/R94iUTCf1NWeBC_VXjTJG/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">증명 개념 아두이노 UNO에서 비동기 프로그래밍</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="증명 개념 아두이노 UNO에서 비동기 프로그래밍" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/assets/profile.jpg"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 15, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><img src="/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png"/>
<p>안녕하세요.</p>
<p>요즘 NodeJS의 작동 방식에 관심을 갖게 되었습니다. 한 스레드에서 여러 작업을 동시에 실행하는 것이 가능하다는 것이 흥미롭게 느껴졌죠. 그래서 스스로에게 물었습니다. 아두이노 UNO에서도 이와 같은 것이 가능할까요?</p>
<p>그래서 이것이 어떻게 작동하는지 알아보기 위해 조금 연구를 해봤는데, Node.js는 한 스레드에서 동시성을 달성하기 위해 2가지 알고리즘을 사용한다는 것을 깨달았습니다.</p>
<ul>
<li>
<p>이벤트 루프: 각기 다른 함수들로 이루어진 작업 목록을 저장하고 실행하는 역할을 담당합니다. 이러한 함수들은 쉽게 코루틴이 될 수 있습니다.</p>
</li>
<li>
<p>코루틴: 실행을 중단하고 나중에 다시 재개할 수 있는 함수 유형입니다.</p>
</li>
</ul>
<p>그래서 제가 Arduino UNO에서 동일한 동시성 시스템을 구현하기로 결정했습니다.</p>
<p>가장 쉬운 부분부터 시작했습니다. 코루틴입니다. C/C++은 내장 코루틴 지원이 없기 때문에, 자체 코루틴 시스템을 만들었습니다. 이를 위해 Duff의 장치라는 매우 유용한 알고리즘을 발견했습니다. 이 알고리즘은 코루틴과 직접적으로 관련되어 있지는 않지만, 코루틴 구현에 도움이 될 것입니다.</p>
<p>예, 주요 아이디어는 정적 상태 변수를 생성하여 코루틴의 상태를 기억할 수 있도록하는 것입니다. 그런 다음 switch 문을 사용하여 함수를 청크로 분할하고 상태 변수를 사용하여 필요한 부분을 실행할 수 있습니다. 내가 무슨 얘기를 하는지 이해 못 하겠다고요? 그래, 이런 느낌입니다!</p>
<pre><code class="hljs language-js">int <span class="hljs-title function_">coroutine</span>(<span class="hljs-params"></span>){
<span class="hljs-keyword">static</span> int state = <span class="hljs-number">0</span>;

     <span class="hljs-keyword">switch</span>(state){
         <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 0&quot;</span>); state++; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
                 <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 1&quot;</span>); state++; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
                 <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 2&quot;</span>); state++; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
                 <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 3&quot;</span>); state++; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
                 <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 4&quot;</span>); state++; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
                 <span class="hljs-keyword">do</span> { <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 5&quot;</span>); state=<span class="hljs-number">0</span>; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;          } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>);
     }

     <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>){
     <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">begin</span>( <span class="hljs-number">9600</span> );
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>){
     <span class="hljs-title function_">coroutine</span>();
     <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
}
</code></pre>
<p><img src="https://miro.medium.com/v2/resize:fit:852/1*FmR-nOMNpohwvWCPbysUiQ.gif" alt="이미지"/></p>
<p>좋죠? 하지만 이 방법을 사용하여보다 복잡한 코루틴을 작성한다고 상상해보세요. 그러다가 Duff 장치를 생성하는 것을 단순화하기 위해 매크로를 사용하기로 생각했습니다. 여기에는 몇 가지 매크로가 있습니다:</p>
<pre><code class="hljs language-js">#define coNext         <span class="hljs-keyword">do</span> { _state_ = __LINE__; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-attr">__LINE__</span>:; } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
#define <span class="hljs-title function_">coGoto</span>(<span class="hljs-variable constant_">VALUE</span>)  <span class="hljs-keyword">do</span> { _state_ = <span class="hljs-variable constant_">VALUE</span>   ; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;                 } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
#define <span class="hljs-title function_">coYield</span>(<span class="hljs-variable constant_">VALUE</span>) <span class="hljs-keyword">do</span> { _state_ = <span class="hljs-variable constant_">VALUE</span>   ; <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">case</span> <span class="hljs-attr">VALUE</span>:;    } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
</code></pre>
<pre><code class="hljs language-js">#define coStart <span class="hljs-keyword">static</span> int _state_ = <span class="hljs-number">0</span>; { <span class="hljs-keyword">switch</span>(_state_) { <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:;
#define coEnd <span class="hljs-keyword">do</span> { _state_ = <span class="hljs-number">0</span>; <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
#define coStop } _state_ = <span class="hljs-number">0</span>; <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>; }
#define <span class="hljs-title function_">coSet</span>(<span class="hljs-variable constant_">VALUE</span>) _state_ = <span class="hljs-variable constant_">VALUE</span>
#define coGet _state_
</code></pre>
<p>참고: 매우 유용한 다른 매크로도 추가되었습니다.</p>
<pre><code class="hljs language-js">#define <span class="hljs-title function_">coDelay</span>(<span class="hljs-variable constant_">VALUE</span>)  <span class="hljs-keyword">do</span> { <span class="hljs-keyword">static</span> auto tm = <span class="hljs-title function_">millis</span>()+<span class="hljs-variable constant_">VALUE</span>; <span class="hljs-keyword">while</span>( <span class="hljs-title function_">millis</span>() &lt; tm ){ coNext; } tm = <span class="hljs-title function_">millis</span>()+<span class="hljs-variable constant_">VALUE</span>; <span class="hljs-keyword">break</span>; } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
#define <span class="hljs-title function_">coUDelay</span>(<span class="hljs-variable constant_">VALUE</span>) <span class="hljs-keyword">do</span> { <span class="hljs-keyword">static</span> auto tm = <span class="hljs-title function_">micros</span>()+<span class="hljs-variable constant_">VALUE</span>; <span class="hljs-keyword">while</span>( <span class="hljs-title function_">micros</span>() &lt; tm ){ coNext; } tm = <span class="hljs-title function_">micros</span>()+<span class="hljs-variable constant_">VALUE</span>; <span class="hljs-keyword">break</span>; } <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span>)
#define <span class="hljs-title function_">coWait</span>(<span class="hljs-variable constant_">VALUE</span>)   <span class="hljs-keyword">do</span> { <span class="hljs-keyword">while</span>( !<span class="hljs-variable constant_">VALUE</span> ){ coNext; } } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)
</code></pre>
<p>이 구현의 작은 단점 중 하나는 switch 문을 사용하여 코루틴을 실행하기 때문에 코루틴 내에서 switch 문을 사용할 수 없다는 것입니다. 해당 경우는 코드를 완전히 깨뜨릴 것입니다.</p>
<p>이전 예제를 복제한다면 이렇게 될 것입니다:</p>
<pre><code class="hljs language-js">int <span class="hljs-title function_">coroutine</span>(<span class="hljs-params"></span>){
coStart

     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 0&quot;</span>); coNext;
     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 2&quot;</span>); coNext;
     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 3&quot;</span>); coNext;
     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 4&quot;</span>); coNext;
     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 5&quot;</span>); coNext;
     <span class="hljs-title function_">printf</span>(<span class="hljs-string">&quot;Hello World 6&quot;</span>);

<span class="hljs-title function_">coGoto</span>(<span class="hljs-number">0</span>);
coStop
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>){
     <span class="hljs-title class_">Serial</span>.<span class="hljs-title function_">begin</span>( <span class="hljs-number">9600</span> );
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>){
     <span class="hljs-title function_">coroutine</span>();
     <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
}
</code></pre>
<p>이제 실제 Arduino 프로젝트에서 이것을 적용한다면 어떻게 될까요?</p>
<p>아두이노 UNO에서 실행되는 3개의 비동기 프로세스를 실행하는 프로그램을 작성하고 싶다고 가정해보겠습니다. 이 프로그램은 일련의 LED를 켜고 끄게 할 것입니다. 아래에 코드가 있습니다:</p>
<pre><code class="hljs language-js">int <span class="hljs-title function_">coroutine1</span>(<span class="hljs-params"></span>){
     <span class="hljs-keyword">static</span> bool b=<span class="hljs-number">0</span>;
coStart

     <span class="hljs-title function_">digitalWrite</span>(<span class="hljs-number">7</span>,b);
     <span class="hljs-title function_">coDelay</span>(<span class="hljs-number">300</span>); b=!b;

<span class="hljs-title function_">coGoto</span>(<span class="hljs-number">0</span>);
coStop
}

int <span class="hljs-title function_">coroutine2</span>(<span class="hljs-params"></span>){
     <span class="hljs-keyword">static</span> bool b=<span class="hljs-number">0</span>;
coStart

     <span class="hljs-title function_">digitalWrite</span>(<span class="hljs-number">6</span>,b);
     <span class="hljs-title function_">coDelay</span>(<span class="hljs-number">1000</span>); b=!b;

<span class="hljs-title function_">coGoto</span>(<span class="hljs-number">0</span>);
coStop
}

int <span class="hljs-title function_">coroutine3</span>(<span class="hljs-params"></span>){
     <span class="hljs-keyword">static</span> int x=<span class="hljs-number">0</span>; <span class="hljs-keyword">static</span> bool b=<span class="hljs-number">0</span>;
     unsigned char pin[] = { <span class="hljs-number">13</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span> };
coStart

     <span class="hljs-keyword">while</span>( x--&gt;<span class="hljs-number">0</span> ){
         <span class="hljs-title function_">digitalWrite</span>( pin[x], b );
         <span class="hljs-title function_">coDelay</span>(<span class="hljs-number">100</span>);
     } b=!b; x=<span class="hljs-number">6</span>;

<span class="hljs-title function_">coGoto</span>(<span class="hljs-number">0</span>);
coStop
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"></span>){
     unsigned char pin[] = { <span class="hljs-number">13</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">7</span>, <span class="hljs-number">6</span> };
     <span class="hljs-keyword">for</span>( auto &amp;<span class="hljs-attr">x</span>: pin ) <span class="hljs-title function_">pinMode</span>( pin, <span class="hljs-variable constant_">OUTPUT</span> );
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>){
     <span class="hljs-title function_">coroutine1</span>();
     <span class="hljs-title function_">coroutine2</span>();
     <span class="hljs-title function_">coroutine3</span>();
}
</code></pre>
<p><img src="https://miro.medium.com/v2/resize:fit:852/1*LwDRI8sOZe-EVOxAEsgLHw.gif" alt="Animation"/></p>
<p>알아보기 쉽게 Arduino UNO에서 비동기 프로그래밍이 가능하다는 것을 확인할 수 있습니다. 시간이 부족해 이 데모에 대한 이벤트 루프를 구현하지 못했지만, loop 함수가 좋은 대체재가 됩니다. 이 글에 흥미를 느끼셨다면 제가 두 번째 파트를 작성해 이벤트 루프에 대해 설명해드릴게요. 이 프로젝트가 마음에 들었기를 바라며, 우리 다음에 또 뵙겠습니다.</p>
<p>이 글을 마치기 전에, 제가 만든 Nodepp라는 프레임워크를 소개하고 싶어요. 이 프레임워크는 NodeJS와 매우 유사한 구문으로 Arduino에서 비동기 코드를 작성할 수 있게 해주는 C++ 프레임워크입니다. 즐겁게 이용하시기를 바랍니다.</p>
<p>https://www.arduino.cc/reference/en/libraries/nodepp/</p></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"증명 개념 아두이노 UNO에서 비동기 프로그래밍","description":"","date":"2024-05-15 11:27","slug":"2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO","content":"\n\n\u003cimg src=\"/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png\" /\u003e\n\n안녕하세요.\n\n요즘 NodeJS의 작동 방식에 관심을 갖게 되었습니다. 한 스레드에서 여러 작업을 동시에 실행하는 것이 가능하다는 것이 흥미롭게 느껴졌죠. 그래서 스스로에게 물었습니다. 아두이노 UNO에서도 이와 같은 것이 가능할까요?\n\n그래서 이것이 어떻게 작동하는지 알아보기 위해 조금 연구를 해봤는데, Node.js는 한 스레드에서 동시성을 달성하기 위해 2가지 알고리즘을 사용한다는 것을 깨달았습니다.\n\n\n\n- 이벤트 루프: 각기 다른 함수들로 이루어진 작업 목록을 저장하고 실행하는 역할을 담당합니다. 이러한 함수들은 쉽게 코루틴이 될 수 있습니다.\n\n- 코루틴: 실행을 중단하고 나중에 다시 재개할 수 있는 함수 유형입니다. \n\n그래서 제가 Arduino UNO에서 동일한 동시성 시스템을 구현하기로 결정했습니다.\n\n가장 쉬운 부분부터 시작했습니다. 코루틴입니다. C/C++은 내장 코루틴 지원이 없기 때문에, 자체 코루틴 시스템을 만들었습니다. 이를 위해 Duff의 장치라는 매우 유용한 알고리즘을 발견했습니다. 이 알고리즘은 코루틴과 직접적으로 관련되어 있지는 않지만, 코루틴 구현에 도움이 될 것입니다.\n\n\n\n예, 주요 아이디어는 정적 상태 변수를 생성하여 코루틴의 상태를 기억할 수 있도록하는 것입니다. 그런 다음 switch 문을 사용하여 함수를 청크로 분할하고 상태 변수를 사용하여 필요한 부분을 실행할 수 있습니다. 내가 무슨 얘기를 하는지 이해 못 하겠다고요? 그래, 이런 느낌입니다!\n\n```js\nint coroutine(){\nstatic int state = 0;\n\n     switch(state){\n         case 0: do { printf(\"Hello World 0\"); state++; return 1; case 1:; } while(0);\n                 do { printf(\"Hello World 1\"); state++; return 1; case 2:; } while(0);\n                 do { printf(\"Hello World 2\"); state++; return 1; case 3:; } while(0);\n                 do { printf(\"Hello World 3\"); state++; return 1; case 4:; } while(0);\n                 do { printf(\"Hello World 4\"); state++; return 1; case 5:; } while(0);\n                 do { printf(\"Hello World 5\"); state=0; return 1;          } while(0);\n     }\n\n     return -1;\n\n}\n\nvoid setup(){\n     Serial.begin( 9600 );\n}\n\nvoid loop(){\n     coroutine();\n     delay(1000);\n}\n```\n\n![이미지](https://miro.medium.com/v2/resize:fit:852/1*FmR-nOMNpohwvWCPbysUiQ.gif)\n\n좋죠? 하지만 이 방법을 사용하여보다 복잡한 코루틴을 작성한다고 상상해보세요. 그러다가 Duff 장치를 생성하는 것을 단순화하기 위해 매크로를 사용하기로 생각했습니다. 여기에는 몇 가지 매크로가 있습니다:\n\n\n\n```js\n#define coNext         do { _state_ = __LINE__; return 1; case __LINE__:; } while (0)\n#define coGoto(VALUE)  do { _state_ = VALUE   ; return 1;                 } while (0)\n#define coYield(VALUE) do { _state_ = VALUE   ; return 1; case VALUE:;    } while (0)\n```\n\n```js\n#define coStart static int _state_ = 0; { switch(_state_) { case 0:;\n#define coEnd do { _state_ = 0; return -1; } while (0)\n#define coStop } _state_ = 0; return -1; }\n#define coSet(VALUE) _state_ = VALUE\n#define coGet _state_\n```\n\n참고: 매우 유용한 다른 매크로도 추가되었습니다.\n\n```js\n#define coDelay(VALUE)  do { static auto tm = millis()+VALUE; while( millis() \u003c tm ){ coNext; } tm = millis()+VALUE; break; } while (0)\n#define coUDelay(VALUE) do { static auto tm = micros()+VALUE; while( micros() \u003c tm ){ coNext; } tm = micros()+VALUE; break; } while (0)\n#define coWait(VALUE)   do { while( !VALUE ){ coNext; } } while(0)\n```\n\n이 구현의 작은 단점 중 하나는 switch 문을 사용하여 코루틴을 실행하기 때문에 코루틴 내에서 switch 문을 사용할 수 없다는 것입니다. 해당 경우는 코드를 완전히 깨뜨릴 것입니다.\n\n\n\n\n이전 예제를 복제한다면 이렇게 될 것입니다:\n\n```js\nint coroutine(){\ncoStart\n\n     printf(\"Hello World 0\"); coNext;\n     printf(\"Hello World 2\"); coNext;\n     printf(\"Hello World 3\"); coNext;\n     printf(\"Hello World 4\"); coNext;\n     printf(\"Hello World 5\"); coNext;\n     printf(\"Hello World 6\");\n\ncoGoto(0);\ncoStop\n}\n\nvoid setup(){\n     Serial.begin( 9600 );\n}\n\nvoid loop(){\n     coroutine();\n     delay(1000);\n}\n```\n\n이제 실제 Arduino 프로젝트에서 이것을 적용한다면 어떻게 될까요?\n\n아두이노 UNO에서 실행되는 3개의 비동기 프로세스를 실행하는 프로그램을 작성하고 싶다고 가정해보겠습니다. 이 프로그램은 일련의 LED를 켜고 끄게 할 것입니다. 아래에 코드가 있습니다:\n\n\n\n```js\nint coroutine1(){\n     static bool b=0;\ncoStart\n\n     digitalWrite(7,b);\n     coDelay(300); b=!b;\n\ncoGoto(0);\ncoStop\n}\n\nint coroutine2(){\n     static bool b=0;\ncoStart\n\n     digitalWrite(6,b);\n     coDelay(1000); b=!b;\n\ncoGoto(0);\ncoStop\n}\n\nint coroutine3(){\n     static int x=0; static bool b=0;\n     unsigned char pin[] = { 13, 12, 11, 10, 9, 8 };\ncoStart\n\n     while( x--\u003e0 ){\n         digitalWrite( pin[x], b );\n         coDelay(100);\n     } b=!b; x=6;\n\ncoGoto(0);\ncoStop\n}\n\nvoid setup(){\n     unsigned char pin[] = { 13, 12, 11, 10, 9, 8, 7, 6 };\n     for( auto \u0026x: pin ) pinMode( pin, OUTPUT );\n}\n\nvoid loop(){\n     coroutine1();\n     coroutine2();\n     coroutine3();\n}\n```\n\n![Animation](https://miro.medium.com/v2/resize:fit:852/1*LwDRI8sOZe-EVOxAEsgLHw.gif)\n\n알아보기 쉽게 Arduino UNO에서 비동기 프로그래밍이 가능하다는 것을 확인할 수 있습니다. 시간이 부족해 이 데모에 대한 이벤트 루프를 구현하지 못했지만, loop 함수가 좋은 대체재가 됩니다. 이 글에 흥미를 느끼셨다면 제가 두 번째 파트를 작성해 이벤트 루프에 대해 설명해드릴게요. 이 프로젝트가 마음에 들었기를 바라며, 우리 다음에 또 뵙겠습니다.\n\n이 글을 마치기 전에, 제가 만든 Nodepp라는 프레임워크를 소개하고 싶어요. 이 프레임워크는 NodeJS와 매우 유사한 구문으로 Arduino에서 비동기 코드를 작성할 수 있게 해주는 C++ 프레임워크입니다. 즐겁게 이용하시기를 바랍니다.\n\n\n\n\nhttps://www.arduino.cc/reference/en/libraries/nodepp/","ogImage":{"url":"/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png"},"coverImage":"/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png","tag":["Tech"],"readingTime":5},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    ul: \"ul\",\n    li: \"li\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    img: \"img\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(\"img\", {\n      src: \"/assets/img/2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO_0.png\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"안녕하세요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"요즘 NodeJS의 작동 방식에 관심을 갖게 되었습니다. 한 스레드에서 여러 작업을 동시에 실행하는 것이 가능하다는 것이 흥미롭게 느껴졌죠. 그래서 스스로에게 물었습니다. 아두이노 UNO에서도 이와 같은 것이 가능할까요?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그래서 이것이 어떻게 작동하는지 알아보기 위해 조금 연구를 해봤는데, Node.js는 한 스레드에서 동시성을 달성하기 위해 2가지 알고리즘을 사용한다는 것을 깨달았습니다.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"이벤트 루프: 각기 다른 함수들로 이루어진 작업 목록을 저장하고 실행하는 역할을 담당합니다. 이러한 함수들은 쉽게 코루틴이 될 수 있습니다.\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"코루틴: 실행을 중단하고 나중에 다시 재개할 수 있는 함수 유형입니다.\"\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그래서 제가 Arduino UNO에서 동일한 동시성 시스템을 구현하기로 결정했습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"가장 쉬운 부분부터 시작했습니다. 코루틴입니다. C/C++은 내장 코루틴 지원이 없기 때문에, 자체 코루틴 시스템을 만들었습니다. 이를 위해 Duff의 장치라는 매우 유용한 알고리즘을 발견했습니다. 이 알고리즘은 코루틴과 직접적으로 관련되어 있지는 않지만, 코루틴 구현에 도움이 될 것입니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"예, 주요 아이디어는 정적 상태 변수를 생성하여 코루틴의 상태를 기억할 수 있도록하는 것입니다. 그런 다음 switch 문을 사용하여 함수를 청크로 분할하고 상태 변수를 사용하여 필요한 부분을 실행할 수 있습니다. 내가 무슨 얘기를 하는지 이해 못 하겠다고요? 그래, 이런 느낌입니다!\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"int \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" int state = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \";\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"switch\"\n        }), \"(state){\\n         \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 0\\\"\"\n        }), \"); state++; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n                 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 1\\\"\"\n        }), \"); state++; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"2\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n                 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 2\\\"\"\n        }), \"); state++; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"3\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n                 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 3\\\"\"\n        }), \"); state++; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"4\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n                 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 4\\\"\"\n        }), \"); state++; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"5\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n                 \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 5\\\"\"\n        }), \"); state=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \";          } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\n     }\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" -\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \";\\n\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"setup\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Serial\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"begin\"\n        }), \"( \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"9600\"\n        }), \" );\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"loop\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine\"\n        }), \"();\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"delay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1000\"\n        }), \");\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://miro.medium.com/v2/resize:fit:852/1*FmR-nOMNpohwvWCPbysUiQ.gif\",\n        alt: \"이미지\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"좋죠? 하지만 이 방법을 사용하여보다 복잡한 코루틴을 작성한다고 상상해보세요. 그러다가 Duff 장치를 생성하는 것을 단순화하기 위해 매크로를 사용하기로 생각했습니다. 여기에는 몇 가지 매크로가 있습니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"#define coNext         \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { _state_ = __LINE__; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"__LINE__\"\n        }), \":; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coGoto\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \")  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { _state_ = \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"   ; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \";                 } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coYield\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { _state_ = \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"   ; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"VALUE\"\n        }), \":;    } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"#define coStart \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" int _state_ = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"; { \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"switch\"\n        }), \"(_state_) { \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"case\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \":;\\n#define coEnd \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { _state_ = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" -\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n#define coStop } _state_ = \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" -\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1\"\n        }), \"; }\\n#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coSet\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \") _state_ = \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"\\n#define coGet _state_\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"참고: 매우 유용한 다른 매크로도 추가되었습니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coDelay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \")  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" auto tm = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"millis\"\n        }), \"()+\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"( \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"millis\"\n        }), \"() \u003c tm ){ coNext; } tm = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"millis\"\n        }), \"()+\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"break\"\n        }), \"; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coUDelay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \") \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" auto tm = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"micros\"\n        }), \"()+\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"( \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"micros\"\n        }), \"() \u003c tm ){ coNext; } tm = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"micros\"\n        }), \"()+\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"break\"\n        }), \"; } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n#define \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coWait\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \")   \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"do\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"( !\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"VALUE\"\n        }), \" ){ coNext; } } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \")\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 구현의 작은 단점 중 하나는 switch 문을 사용하여 코루틴을 실행하기 때문에 코루틴 내에서 switch 문을 사용할 수 없다는 것입니다. 해당 경우는 코드를 완전히 깨뜨릴 것입니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이전 예제를 복제한다면 이렇게 될 것입니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"int \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\ncoStart\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 0\\\"\"\n        }), \"); coNext;\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 2\\\"\"\n        }), \"); coNext;\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 3\\\"\"\n        }), \"); coNext;\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 4\\\"\"\n        }), \"); coNext;\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 5\\\"\"\n        }), \"); coNext;\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"printf\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Hello World 6\\\"\"\n        }), \");\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coGoto\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\ncoStop\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"setup\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Serial\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"begin\"\n        }), \"( \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"9600\"\n        }), \" );\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"loop\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine\"\n        }), \"();\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"delay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1000\"\n        }), \");\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 실제 Arduino 프로젝트에서 이것을 적용한다면 어떻게 될까요?\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"아두이노 UNO에서 실행되는 3개의 비동기 프로세스를 실행하는 프로그램을 작성하고 싶다고 가정해보겠습니다. 이 프로그램은 일련의 LED를 켜고 끄게 할 것입니다. 아래에 코드가 있습니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"int \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine1\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" bool b=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \";\\ncoStart\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"digitalWrite\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"7\"\n        }), \",b);\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coDelay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"300\"\n        }), \"); b=!b;\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coGoto\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\ncoStop\\n}\\n\\nint \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine2\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" bool b=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \";\\ncoStart\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"digitalWrite\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"6\"\n        }), \",b);\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coDelay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"1000\"\n        }), \"); b=!b;\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coGoto\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\ncoStop\\n}\\n\\nint \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine3\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" int x=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \"; \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"static\"\n        }), \" bool b=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \";\\n     unsigned char pin[] = { \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"13\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"12\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"11\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"9\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"8\"\n        }), \" };\\ncoStart\\n\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"while\"\n        }), \"( x--\u003e\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \" ){\\n         \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"digitalWrite\"\n        }), \"( pin[x], b );\\n         \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coDelay\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \");\\n     } b=!b; x=\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"6\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coGoto\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"0\"\n        }), \");\\ncoStop\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"setup\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     unsigned char pin[] = { \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"13\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"12\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"11\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"10\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"9\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"8\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"7\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"6\"\n        }), \" };\\n     \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"for\"\n        }), \"( auto \u0026\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"x\"\n        }), \": pin ) \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"pinMode\"\n        }), \"( pin, \", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"OUTPUT\"\n        }), \" );\\n}\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"void\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"loop\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \"){\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine1\"\n        }), \"();\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine2\"\n        }), \"();\\n     \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"coroutine3\"\n        }), \"();\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"https://miro.medium.com/v2/resize:fit:852/1*LwDRI8sOZe-EVOxAEsgLHw.gif\",\n        alt: \"Animation\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"알아보기 쉽게 Arduino UNO에서 비동기 프로그래밍이 가능하다는 것을 확인할 수 있습니다. 시간이 부족해 이 데모에 대한 이벤트 루프를 구현하지 못했지만, loop 함수가 좋은 대체재가 됩니다. 이 글에 흥미를 느끼셨다면 제가 두 번째 파트를 작성해 이벤트 루프에 대해 설명해드릴게요. 이 프로젝트가 마음에 들었기를 바라며, 우리 다음에 또 뵙겠습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 글을 마치기 전에, 제가 만든 Nodepp라는 프레임워크를 소개하고 싶어요. 이 프레임워크는 NodeJS와 매우 유사한 구문으로 Arduino에서 비동기 코드를 작성할 수 있게 해주는 C++ 프레임워크입니다. 즐겁게 이용하시기를 바랍니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"https://www.arduino.cc/reference/en/libraries/nodepp/\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-15-ProofofConceptAsynchronousprogramminginArduinoUNO"},"buildId":"R94iUTCf1NWeBC_VXjTJG","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>