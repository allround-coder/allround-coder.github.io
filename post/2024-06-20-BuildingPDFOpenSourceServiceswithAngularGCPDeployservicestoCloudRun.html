<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun" data-gatsby-head="true"/><meta name="twitter:title" content="Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 05:44" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_buildManifest.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">5<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p><img src="/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png" alt="image"></p>
<p>안녕하세요! Angular (Analogjs), Firestore, Cloud Storage, 그리고 CloudRun을 이용하여 오픈 소스 PDF 서비스를 구축하는 여정에 오신 것을 환영합니다. 이 프로젝트는 제 지식을 공유하고 지속적으로 최상의 사례를 학습하며 동시에 커뮤니티에 기여하는 플랫폼으로 제공됩니다.</p>
<p>파트 1: 아키텍처 개요
파트 2: Cloud Run에 서비스 배포</p>
<p>데모: <a href="https://pdfun.xyz" rel="nofollow" target="_blank">https://pdfun.xyz</a></p>
<div class="content-ad"></div>
<p>해결책은 GCP 생태계를 중심으로 구축되었으므로 프로젝트를 GCP에 배포하는 것이 좋습니다. 그렇게 하면 서비스에 액세스할 수 있습니다. 해결책은 두 부분으로 구성됩니다:</p>
<ul>
<li>웹 UI (Analogjs — Angular): 사용자 상호작용 처리</li>
<li>백엔드 (Node — Express): PDF 파일 처리</li>
</ul>
<h1>왜 Cloud Run에 배포해야 하는가?</h1>
<p>Cloud Run은 Google Cloud Platform(GCP)에서 제공하는 완전히 관리되는 컴퓨팅 플랫폼으로 stateless 컨테이너를 자동으로 확장시킵니다. 그렇다면 왜 우리는 서비스를 배포할 때 Cloud Run을 선택해야 할까요? 여기에 몇 가지 이유가 있습니다:</p>
<div class="content-ad"></div>
<ul>
<li>Cloud Run은 장기 실행 작업을 지원하여 서비스를 배포하기에 훌륭한 선택입니다. 서비스는 최대 60분 동안 실행되며, 계산 시간이 많이 필요한 작업을 수용할 수 있습니다.</li>
<li>이외에도 Cloud Run은 자동 스케일링, 개발자 친화적 환경, 통합 로깅 및 모니터링, 사용량에 따른 요금 체계, 다양한 플랫폼 간 이식성 등의 혜택을 제공합니다. 이로써 PDF 서비스를 배포하기 위한 다목적이고 비용 효율적인 솔루션이 됩니다.</li>
</ul>
<h2>도커를 사용한 Google Cloud Run 배포</h2>
<p>Cloud Run은 서비스를 배포하기 위해 도커 이미지를 사용하므로, 필요한 작업은 애플리케이션을 이미지로 랩핑하는 것입니다.</p>
<h3>Prerequisites</h3>
<div class="content-ad"></div>
<p>시작하기 전에 다음 사항을 확인해주세요:</p>
<ul>
<li>활성화된 과금이 설정된 Google Cloud 프로젝트</li>
<li>로컬 머신에 설치된 도커</li>
<li>설치 및 초기화된 Google Cloud SDK</li>
</ul>
<p>더 자세한 지시 사항을 위해 클라우드런에 배포하는 방법 문서를 참고해주세요.</p>
<h2>도커 이미지 빌드하기</h2>
<div class="content-ad"></div>
<p>다음으로 프로젝트와 Docker 이미지를 빌드해야 합니다. 이는 docker build 명령을 사용하여 수행할 수 있습니다. 이미지에 레지스트리 이름을 태그하는 것을 잊지 마세요. 예를 들어:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// build-new-image.sh</span>

imageTag=${<span class="hljs-variable constant_">REGION</span>}-docker.<span class="hljs-property">pkg</span>.<span class="hljs-property">dev</span>/$GCLOUD_PROJECT/$REPO/$image

docker build -t $imageTag -f <span class="hljs-title class_">Dockerfile</span> --platform linux/x86_64 .
</code></pre>
<p>REGIONS, GCLOUD_PROJECT, REPO 및 image를 Google Cloud 프로젝트 ID, 이미지 이름 및 이미지 태그로 대체해주세요.</p>
<h2>Artefact Registry로 이미지 푸시</h2>
<div class="content-ad"></div>
<p>이미지를 빌드하고 나면, docker push 명령어를 사용하여 Artifact Registry에 이미지를 푸시할 수 있어요:</p>
<pre><code class="hljs language-js">docker push $imageTag
</code></pre>
<h2>클라우드 런(Cloud Run)에 새 서비스 생성하기</h2>
<p>이미지가 Artifact Registry에 등록되었으니, 클라우드 런에 새 서비스를 생성할 수 있어요. PDF 서비스를 배포하려면 다음 명령어를 실행하세요:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-bash">gcloud run deploy pdfun \
  --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun \
  --platform=managed --project=pdfun-prod --region=us-central1 \
  --allow-unauthenticated
</code></pre>
<p>이 명령은 서비스 이름이 pdfun인 Web UI를 Cloud Run에 배포하고 웹 사이트에 모두 접근할 수 있도록 허용합니다(<code>--allow-unauthenticated</code>).</p>
<h1>보너스: Nx를 활용하여 서비스 배포하기</h1>
<p>서비스를 배포할 때 Nx는 간편한 프로세스를 제공합니다. 구성 후에는 영향을 받는 앱만 배포할 수 있도록 하기 위해 yarn deploy를 실행하기만 하면 됩니다. 예를 들어 프론트엔드만 업데이트하는 경우 프론트엔드만 빌드되고 배포됩니다.</p>
<div class="content-ad"></div>
<p>저희가 배포 명령어를 실행한 후 무슨 일이 벌어지는지에 대해, 커밋을 비교하여 main 브랜치의 최신 커밋과 함께 영향 받는 프로젝트에 대해 배포 대상을 실행합니다.</p>
<p>pdfun 애플리케이션의 project.json을 확인해 봅시다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-comment">// project.json</span>

...

<span class="hljs-string">"deploy"</span>: {
  <span class="hljs-string">"executor"</span>: <span class="hljs-string">"nx:run-commands"</span>,
  <span class="hljs-string">"options"</span>: {
    <span class="hljs-string">"commands"</span>: [<span class="hljs-string">"nx deploy-docker pdf"</span>, <span class="hljs-string">"nx deploy-cloudrun pdf"</span>],
    <span class="hljs-string">"color"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"parallel"</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-string">"dependsOn"</span>: [
    {
      <span class="hljs-string">"target"</span>: <span class="hljs-string">"build"</span>
    }
  ]
},
<span class="hljs-string">"deploy-cloudrun"</span>: {
  <span class="hljs-string">"command"</span>: <span class="hljs-string">"gcloud run deploy pdfun --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun --platform=managed --project=pdfun-prod --region=us-central1 --allow-unauthenticated"</span>
},
<span class="hljs-string">"deploy-docker"</span>: {
  <span class="hljs-string">"command"</span>: <span class="hljs-string">"./build-new-image.sh --dir dist/pdf/analog --image pdfun"</span>,
  <span class="hljs-string">"parallel"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"dependsOn"</span>: [
    {
      <span class="hljs-string">"target"</span>: <span class="hljs-string">"copy"</span>
    }
  ]
},
</code></pre>
<p>그래서 deploy 대상이 실행되면 두 개의 다른 명령이 트리거됩니다:</p>
<pre><code class="hljs language-js">npx nx deploy-docker pdf
npx nx deploy-cloudrun pdf
</code></pre>
<p>이 명령들은 이어서 도커 이미지를 빌드하고 해당 이미지를 푸시한 후 Artifact Registry에 업로드된 이미지를 기반으로 Cloud Run 서비스를 배포할 것입니다.</p>
<div class="content-ad"></div>
<p>여기 결과입니다:</p>
<pre><code class="hljs language-js">dalenguyen$ yarn deploy

yarn run v1<span class="hljs-number">.22</span><span class="hljs-number">.19</span>
$ npx nx affected -t deploy --base=main~<span class="hljs-number">1</span> --head=main

 <span class="hljs-variable constant_">NX</span>   <span class="hljs-title class_">Running</span> target deploy <span class="hljs-keyword">for</span> <span class="hljs-number">2</span> projects and <span class="hljs-number">3</span>
 <span class="hljs-variable constant_">NX</span>   <span class="hljs-title class_">Running</span> target deploy <span class="hljs-keyword">for</span> <span class="hljs-number">2</span> projects and <span class="hljs-number">3</span> tasks they depend on

   ✔  nx run <span class="hljs-attr">domain</span>:build (<span class="hljs-number">6</span>초)
———————————————————————————————————————————————
   ✔  nx run <span class="hljs-attr">pdf</span>:<span class="hljs-attr">build</span>:production (<span class="hljs-number">17</span>초)
———————————————————————————————————————————————
   ✔  nx run <span class="hljs-attr">pdf</span>:deploy (<span class="hljs-number">17</span>초)
   ✔  nx run pdf-on-<span class="hljs-attr">create</span>:deploy (<span class="hljs-number">29</span>초)
———————————————————————————————————————————————

 <span class="hljs-variable constant_">NX</span>   <span class="hljs-number">2</span>개의 프로젝트 및 해당 종속 작업들을 위한 타겟 deploy가 성공적으로 실행되었습니다 (<span class="hljs-number">37</span>초)
</code></pre>
<p>로컬 환경에서 빌드 캐시를 활용하여 약 1분 내에 두 개의 서비스가 빌드되고 배포되었다는 것을 확인할 수 있어요!</p>
<h1>궁금한 점이 있으신가요?</h1>
<div class="content-ad"></div>
<p>문제가 있거나 궁금한 점이 있으면 언제든지 GitHub 레포지토리에 이슈를 생성해주세요. 또는 채팅을 통해 저와 대화할 수도 있어요. 도와드리고 피드백을 받는 것을 기쁘게 생각할 거예요.</p>
<p>다음 파트도 기대해주세요. 그때까지 즐거운 코딩 되세요!</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Angular 및 GCP를 활용한 PDF 오픈 소스 서비스 구축 - 클라우드 런으로 서비스 배포하기","description":"","date":"2024-06-20 05:44","slug":"2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun","content":"\n\n![image](/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png)\n\n안녕하세요! Angular (Analogjs), Firestore, Cloud Storage, 그리고 CloudRun을 이용하여 오픈 소스 PDF 서비스를 구축하는 여정에 오신 것을 환영합니다. 이 프로젝트는 제 지식을 공유하고 지속적으로 최상의 사례를 학습하며 동시에 커뮤니티에 기여하는 플랫폼으로 제공됩니다.\n\n파트 1: 아키텍처 개요\n파트 2: Cloud Run에 서비스 배포\n\n데모: https://pdfun.xyz\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n해결책은 GCP 생태계를 중심으로 구축되었으므로 프로젝트를 GCP에 배포하는 것이 좋습니다. 그렇게 하면 서비스에 액세스할 수 있습니다. 해결책은 두 부분으로 구성됩니다:\n\n- 웹 UI (Analogjs — Angular): 사용자 상호작용 처리\n- 백엔드 (Node — Express): PDF 파일 처리\n\n# 왜 Cloud Run에 배포해야 하는가?\n\nCloud Run은 Google Cloud Platform(GCP)에서 제공하는 완전히 관리되는 컴퓨팅 플랫폼으로 stateless 컨테이너를 자동으로 확장시킵니다. 그렇다면 왜 우리는 서비스를 배포할 때 Cloud Run을 선택해야 할까요? 여기에 몇 가지 이유가 있습니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- Cloud Run은 장기 실행 작업을 지원하여 서비스를 배포하기에 훌륭한 선택입니다. 서비스는 최대 60분 동안 실행되며, 계산 시간이 많이 필요한 작업을 수용할 수 있습니다.\n- 이외에도 Cloud Run은 자동 스케일링, 개발자 친화적 환경, 통합 로깅 및 모니터링, 사용량에 따른 요금 체계, 다양한 플랫폼 간 이식성 등의 혜택을 제공합니다. 이로써 PDF 서비스를 배포하기 위한 다목적이고 비용 효율적인 솔루션이 됩니다.\n\n## 도커를 사용한 Google Cloud Run 배포\n\nCloud Run은 서비스를 배포하기 위해 도커 이미지를 사용하므로, 필요한 작업은 애플리케이션을 이미지로 랩핑하는 것입니다.\n\n### Prerequisites\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n시작하기 전에 다음 사항을 확인해주세요:\n\n- 활성화된 과금이 설정된 Google Cloud 프로젝트\n- 로컬 머신에 설치된 도커\n- 설치 및 초기화된 Google Cloud SDK\n\n더 자세한 지시 사항을 위해 클라우드런에 배포하는 방법 문서를 참고해주세요.\n\n## 도커 이미지 빌드하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n다음으로 프로젝트와 Docker 이미지를 빌드해야 합니다. 이는 docker build 명령을 사용하여 수행할 수 있습니다. 이미지에 레지스트리 이름을 태그하는 것을 잊지 마세요. 예를 들어:\n\n```js\n// build-new-image.sh\n\nimageTag=${REGION}-docker.pkg.dev/$GCLOUD_PROJECT/$REPO/$image\n\ndocker build -t $imageTag -f Dockerfile --platform linux/x86_64 .\n```\n\nREGIONS, GCLOUD_PROJECT, REPO 및 image를 Google Cloud 프로젝트 ID, 이미지 이름 및 이미지 태그로 대체해주세요.\n\n## Artefact Registry로 이미지 푸시\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이미지를 빌드하고 나면, docker push 명령어를 사용하여 Artifact Registry에 이미지를 푸시할 수 있어요:\n\n```js\ndocker push $imageTag\n```\n\n## 클라우드 런(Cloud Run)에 새 서비스 생성하기\n\n이미지가 Artifact Registry에 등록되었으니, 클라우드 런에 새 서비스를 생성할 수 있어요. PDF 서비스를 배포하려면 다음 명령어를 실행하세요:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```bash\ngcloud run deploy pdfun \\\n  --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun \\\n  --platform=managed --project=pdfun-prod --region=us-central1 \\\n  --allow-unauthenticated\n```\n\n이 명령은 서비스 이름이 pdfun인 Web UI를 Cloud Run에 배포하고 웹 사이트에 모두 접근할 수 있도록 허용합니다(`--allow-unauthenticated`).\n\n# 보너스: Nx를 활용하여 서비스 배포하기\n\n서비스를 배포할 때 Nx는 간편한 프로세스를 제공합니다. 구성 후에는 영향을 받는 앱만 배포할 수 있도록 하기 위해 yarn deploy를 실행하기만 하면 됩니다. 예를 들어 프론트엔드만 업데이트하는 경우 프론트엔드만 빌드되고 배포됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저희가 배포 명령어를 실행한 후 무슨 일이 벌어지는지에 대해, 커밋을 비교하여 main 브랜치의 최신 커밋과 함께 영향 받는 프로젝트에 대해 배포 대상을 실행합니다.\n\npdfun 애플리케이션의 project.json을 확인해 봅시다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n// project.json\n\n...\n\n\"deploy\": {\n  \"executor\": \"nx:run-commands\",\n  \"options\": {\n    \"commands\": [\"nx deploy-docker pdf\", \"nx deploy-cloudrun pdf\"],\n    \"color\": true,\n    \"parallel\": false\n  },\n  \"dependsOn\": [\n    {\n      \"target\": \"build\"\n    }\n  ]\n},\n\"deploy-cloudrun\": {\n  \"command\": \"gcloud run deploy pdfun --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun --platform=managed --project=pdfun-prod --region=us-central1 --allow-unauthenticated\"\n},\n\"deploy-docker\": {\n  \"command\": \"./build-new-image.sh --dir dist/pdf/analog --image pdfun\",\n  \"parallel\": false,\n  \"dependsOn\": [\n    {\n      \"target\": \"copy\"\n    }\n  ]\n},\n```\n\n그래서 deploy 대상이 실행되면 두 개의 다른 명령이 트리거됩니다:\n\n```js\nnpx nx deploy-docker pdf\nnpx nx deploy-cloudrun pdf\n```\n\n이 명령들은 이어서 도커 이미지를 빌드하고 해당 이미지를 푸시한 후 Artifact Registry에 업로드된 이미지를 기반으로 Cloud Run 서비스를 배포할 것입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n여기 결과입니다:\n\n```js\ndalenguyen$ yarn deploy\n\nyarn run v1.22.19\n$ npx nx affected -t deploy --base=main~1 --head=main\n\n NX   Running target deploy for 2 projects and 3\n NX   Running target deploy for 2 projects and 3 tasks they depend on\n\n   ✔  nx run domain:build (6초)\n———————————————————————————————————————————————\n   ✔  nx run pdf:build:production (17초)\n———————————————————————————————————————————————\n   ✔  nx run pdf:deploy (17초)\n   ✔  nx run pdf-on-create:deploy (29초)\n———————————————————————————————————————————————\n\n NX   2개의 프로젝트 및 해당 종속 작업들을 위한 타겟 deploy가 성공적으로 실행되었습니다 (37초)\n```\n\n로컬 환경에서 빌드 캐시를 활용하여 약 1분 내에 두 개의 서비스가 빌드되고 배포되었다는 것을 확인할 수 있어요!\n\n# 궁금한 점이 있으신가요?\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n문제가 있거나 궁금한 점이 있으면 언제든지 GitHub 레포지토리에 이슈를 생성해주세요. 또는 채팅을 통해 저와 대화할 수도 있어요. 도와드리고 피드백을 받는 것을 기쁘게 생각할 거예요.\n\n다음 파트도 기대해주세요. 그때까지 즐거운 코딩 되세요!","ogImage":{"url":"/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png"},"coverImage":"/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png","tag":["Tech"],"readingTime":5},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun_0.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e안녕하세요! Angular (Analogjs), Firestore, Cloud Storage, 그리고 CloudRun을 이용하여 오픈 소스 PDF 서비스를 구축하는 여정에 오신 것을 환영합니다. 이 프로젝트는 제 지식을 공유하고 지속적으로 최상의 사례를 학습하며 동시에 커뮤니티에 기여하는 플랫폼으로 제공됩니다.\u003c/p\u003e\n\u003cp\u003e파트 1: 아키텍처 개요\n파트 2: Cloud Run에 서비스 배포\u003c/p\u003e\n\u003cp\u003e데모: \u003ca href=\"https://pdfun.xyz\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://pdfun.xyz\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e해결책은 GCP 생태계를 중심으로 구축되었으므로 프로젝트를 GCP에 배포하는 것이 좋습니다. 그렇게 하면 서비스에 액세스할 수 있습니다. 해결책은 두 부분으로 구성됩니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e웹 UI (Analogjs — Angular): 사용자 상호작용 처리\u003c/li\u003e\n\u003cli\u003e백엔드 (Node — Express): PDF 파일 처리\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e왜 Cloud Run에 배포해야 하는가?\u003c/h1\u003e\n\u003cp\u003eCloud Run은 Google Cloud Platform(GCP)에서 제공하는 완전히 관리되는 컴퓨팅 플랫폼으로 stateless 컨테이너를 자동으로 확장시킵니다. 그렇다면 왜 우리는 서비스를 배포할 때 Cloud Run을 선택해야 할까요? 여기에 몇 가지 이유가 있습니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eCloud Run은 장기 실행 작업을 지원하여 서비스를 배포하기에 훌륭한 선택입니다. 서비스는 최대 60분 동안 실행되며, 계산 시간이 많이 필요한 작업을 수용할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e이외에도 Cloud Run은 자동 스케일링, 개발자 친화적 환경, 통합 로깅 및 모니터링, 사용량에 따른 요금 체계, 다양한 플랫폼 간 이식성 등의 혜택을 제공합니다. 이로써 PDF 서비스를 배포하기 위한 다목적이고 비용 효율적인 솔루션이 됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e도커를 사용한 Google Cloud Run 배포\u003c/h2\u003e\n\u003cp\u003eCloud Run은 서비스를 배포하기 위해 도커 이미지를 사용하므로, 필요한 작업은 애플리케이션을 이미지로 랩핑하는 것입니다.\u003c/p\u003e\n\u003ch3\u003ePrerequisites\u003c/h3\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e시작하기 전에 다음 사항을 확인해주세요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e활성화된 과금이 설정된 Google Cloud 프로젝트\u003c/li\u003e\n\u003cli\u003e로컬 머신에 설치된 도커\u003c/li\u003e\n\u003cli\u003e설치 및 초기화된 Google Cloud SDK\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e더 자세한 지시 사항을 위해 클라우드런에 배포하는 방법 문서를 참고해주세요.\u003c/p\u003e\n\u003ch2\u003e도커 이미지 빌드하기\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e다음으로 프로젝트와 Docker 이미지를 빌드해야 합니다. 이는 docker build 명령을 사용하여 수행할 수 있습니다. 이미지에 레지스트리 이름을 태그하는 것을 잊지 마세요. 예를 들어:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// build-new-image.sh\u003c/span\u003e\n\nimageTag=${\u003cspan class=\"hljs-variable constant_\"\u003eREGION\u003c/span\u003e}-docker.\u003cspan class=\"hljs-property\"\u003epkg\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edev\u003c/span\u003e/$GCLOUD_PROJECT/$REPO/$image\n\ndocker build -t $imageTag -f \u003cspan class=\"hljs-title class_\"\u003eDockerfile\u003c/span\u003e --platform linux/x86_64 .\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eREGIONS, GCLOUD_PROJECT, REPO 및 image를 Google Cloud 프로젝트 ID, 이미지 이름 및 이미지 태그로 대체해주세요.\u003c/p\u003e\n\u003ch2\u003eArtefact Registry로 이미지 푸시\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이미지를 빌드하고 나면, docker push 명령어를 사용하여 Artifact Registry에 이미지를 푸시할 수 있어요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edocker push $imageTag\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e클라우드 런(Cloud Run)에 새 서비스 생성하기\u003c/h2\u003e\n\u003cp\u003e이미지가 Artifact Registry에 등록되었으니, 클라우드 런에 새 서비스를 생성할 수 있어요. PDF 서비스를 배포하려면 다음 명령어를 실행하세요:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003egcloud run deploy pdfun \\\n  --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun \\\n  --platform=managed --project=pdfun-prod --region=us-central1 \\\n  --allow-unauthenticated\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 명령은 서비스 이름이 pdfun인 Web UI를 Cloud Run에 배포하고 웹 사이트에 모두 접근할 수 있도록 허용합니다(\u003ccode\u003e--allow-unauthenticated\u003c/code\u003e).\u003c/p\u003e\n\u003ch1\u003e보너스: Nx를 활용하여 서비스 배포하기\u003c/h1\u003e\n\u003cp\u003e서비스를 배포할 때 Nx는 간편한 프로세스를 제공합니다. 구성 후에는 영향을 받는 앱만 배포할 수 있도록 하기 위해 yarn deploy를 실행하기만 하면 됩니다. 예를 들어 프론트엔드만 업데이트하는 경우 프론트엔드만 빌드되고 배포됩니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e저희가 배포 명령어를 실행한 후 무슨 일이 벌어지는지에 대해, 커밋을 비교하여 main 브랜치의 최신 커밋과 함께 영향 받는 프로젝트에 대해 배포 대상을 실행합니다.\u003c/p\u003e\n\u003cp\u003epdfun 애플리케이션의 project.json을 확인해 봅시다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// project.json\u003c/span\u003e\n\n...\n\n\u003cspan class=\"hljs-string\"\u003e\"deploy\"\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\"executor\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"nx:run-commands\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"options\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"commands\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"nx deploy-docker pdf\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"nx deploy-cloudrun pdf\"\u003c/span\u003e],\n    \u003cspan class=\"hljs-string\"\u003e\"color\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"parallel\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\"dependsOn\"\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"target\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"build\"\u003c/span\u003e\n    }\n  ]\n},\n\u003cspan class=\"hljs-string\"\u003e\"deploy-cloudrun\"\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\"command\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"gcloud run deploy pdfun --image=us-central1-docker.pkg.dev/pdfun-prod/pdf/pdfun --platform=managed --project=pdfun-prod --region=us-central1 --allow-unauthenticated\"\u003c/span\u003e\n},\n\u003cspan class=\"hljs-string\"\u003e\"deploy-docker\"\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\"command\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./build-new-image.sh --dir dist/pdf/analog --image pdfun\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"parallel\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"dependsOn\"\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"target\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"copy\"\u003c/span\u003e\n    }\n  ]\n},\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그래서 deploy 대상이 실행되면 두 개의 다른 명령이 트리거됩니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpx nx deploy-docker pdf\nnpx nx deploy-cloudrun pdf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 명령들은 이어서 도커 이미지를 빌드하고 해당 이미지를 푸시한 후 Artifact Registry에 업로드된 이미지를 기반으로 Cloud Run 서비스를 배포할 것입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e여기 결과입니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edalenguyen$ yarn deploy\n\nyarn run v1\u003cspan class=\"hljs-number\"\u003e.22\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e.19\u003c/span\u003e\n$ npx nx affected -t deploy --base=main~\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e --head=main\n\n \u003cspan class=\"hljs-variable constant_\"\u003eNX\u003c/span\u003e   \u003cspan class=\"hljs-title class_\"\u003eRunning\u003c/span\u003e target deploy \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e projects and \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n \u003cspan class=\"hljs-variable constant_\"\u003eNX\u003c/span\u003e   \u003cspan class=\"hljs-title class_\"\u003eRunning\u003c/span\u003e target deploy \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e projects and \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e tasks they depend on\n\n   ✔  nx run \u003cspan class=\"hljs-attr\"\u003edomain\u003c/span\u003e:build (\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e초)\n———————————————————————————————————————————————\n   ✔  nx run \u003cspan class=\"hljs-attr\"\u003epdf\u003c/span\u003e:\u003cspan class=\"hljs-attr\"\u003ebuild\u003c/span\u003e:production (\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e초)\n———————————————————————————————————————————————\n   ✔  nx run \u003cspan class=\"hljs-attr\"\u003epdf\u003c/span\u003e:deploy (\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e초)\n   ✔  nx run pdf-on-\u003cspan class=\"hljs-attr\"\u003ecreate\u003c/span\u003e:deploy (\u003cspan class=\"hljs-number\"\u003e29\u003c/span\u003e초)\n———————————————————————————————————————————————\n\n \u003cspan class=\"hljs-variable constant_\"\u003eNX\u003c/span\u003e   \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e개의 프로젝트 및 해당 종속 작업들을 위한 타겟 deploy가 성공적으로 실행되었습니다 (\u003cspan class=\"hljs-number\"\u003e37\u003c/span\u003e초)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e로컬 환경에서 빌드 캐시를 활용하여 약 1분 내에 두 개의 서비스가 빌드되고 배포되었다는 것을 확인할 수 있어요!\u003c/p\u003e\n\u003ch1\u003e궁금한 점이 있으신가요?\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e문제가 있거나 궁금한 점이 있으면 언제든지 GitHub 레포지토리에 이슈를 생성해주세요. 또는 채팅을 통해 저와 대화할 수도 있어요. 도와드리고 피드백을 받는 것을 기쁘게 생각할 거예요.\u003c/p\u003e\n\u003cp\u003e다음 파트도 기대해주세요. 그때까지 즐거운 코딩 되세요!\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-BuildingPDFOpenSourceServiceswithAngularGCPDeployservicestoCloudRun"},"buildId":"OFpTzInQeZKWBaqJEukNX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>