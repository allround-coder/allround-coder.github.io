<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Angular에서 Firebase 인증 사용하는 방법 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-23-Firebaseauthenticationinangular" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Angular에서 Firebase 인증 사용하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Angular에서 Firebase 인증 사용하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-23-Firebaseauthenticationinangular" data-gatsby-head="true"/><meta name="twitter:title" content="Angular에서 Firebase 인증 사용하는 방법 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 14:06" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/Rv-NbbtWUaja2joH5WkO_/_buildManifest.js" defer=""></script><script src="/_next/static/Rv-NbbtWUaja2joH5WkO_/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Angular에서 Firebase 인증 사용하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Angular에서 Firebase 인증 사용하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">12<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-Firebaseauthenticationinangular&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>이 기사에서는 Angular 프로젝트에 Firebase 인증을 Google Single Sign-On (SSO)과 빠르게 설정하는 방법을 제안합니다. 또한 선택한 백엔드에 인증된 요청을 하는 방법도 포함되어 있습니다.</p>
<p><img src="/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png" alt="이미지"></p>
<p>전체 코드는 여기에서 확인할 수 있습니다: <a href="https://github.com/Gabriel2409/demofirebase" rel="nofollow" target="_blank">https://github.com/Gabriel2409/demofirebase</a></p>
<h1>Firebase 설정</h1>
<div class="content-ad"></div>
<p>Firebase에 가서 새 프로젝트를 만들어주세요.</p>
<h2>앱 설치</h2>
<p>프로젝트 개요 페이지에서 Web 아이콘을 클릭하거나 +앱 추가 아이콘을 클릭하여 웹 애플리케이션을 추가하세요.</p>
<p><img src="/assets/img/2024-06-23-Firebaseauthenticationinangular_1.png" alt="이미지"></p>
<div class="content-ad"></div>
<p>열리는 창에서 앱에 이름을 지정하고, 예를 들어 myangularapp처럼 등록해주세요. Firebase 구성을 어딘가에 저장하세요. 다음과 같이 보여야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> firebaseConfig = {
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"&#x3C;firebase-api-key>"</span>,
  <span class="hljs-attr">authDomain</span>: <span class="hljs-string">"&#x3C;my-project-id>.firebaseapp.com"</span>,
  <span class="hljs-attr">projectId</span>: <span class="hljs-string">"&#x3C;my-project-id>"</span>,
  <span class="hljs-attr">storageBucket</span>: <span class="hljs-string">"&#x3C;my-project-id>.appspot.com"</span>,
  <span class="hljs-attr">messagingSenderId</span>: <span class="hljs-string">"&#x3C;my-messaging-sender-id"</span>,
  <span class="hljs-attr">appId</span>: <span class="hljs-string">"&#x3C;my-app-id>"</span>,
};
</code></pre>
<p>프로젝트 설정의 일반 탭(톱니바퀴 아이콘)로 이동하여 아무 때나 앱의 Firebase 구성에 액세스할 수 있음을 유념하세요.</p>
<h2>인증 설정</h2>
<div class="content-ad"></div>
<p>모든 제품으로 이동한 다음 <strong>인증</strong>을 선택하세요. <strong>로그인 방법</strong>에서 <strong>새로운 제공자 추가</strong>를 클릭하고 Google을 선택하세요. Firebase는 Google과 긴밀하게 통합되어 있기 때문에 별도의 설정이 필요하지 않습니다.</p>
<p>그게 다에요! 이제 Google SSO를 사용하여 Firebase 사용자를 인증할 준비가 되었습니다.</p>
<p>참고: 다른 제공자도 추가할 수 있습니다(예: 이메일/비밀번호, 아래 이미지 참조), 하지만 이 기사에서는 Google SSO에 중점을 두고 있습니다.</p>
<p><img src="/assets/img/2024-06-23-Firebaseauthenticationinangular_2.png" alt="이미지"></p>
<div class="content-ad"></div>
<h1>Angular 설정</h1>
<h2>프로젝트 생성</h2>
<p>먼저, npm install -g @angular/cli를 사용하여 Angular을 전역으로 설치하세요. 저는 버전 17.0.1을 사용하고 있어요.</p>
<p>그런 다음, demofirebase라는 새 폴더를 만들고 해당 폴더에서 ng new frontend --no-standalone --routing ssr=false을 실행하세요. 이렇게 하면 필요한 파일이 포함된 frontend 폴더가 생성됩니다. 이 단계를 마치면 저장소 구조는 다음과 같아야 합니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">demofirebase
└── frontend
</code></pre>
<p>하나의 추가 패키지가 필요합니다. frontend 폴더에서 npm i @angular/fire 명령어를 실행해주세요.</p>
<p>다음으로, 개발 및 프로덕션을 위한 환경을 생성할 때 ng g environments를 사용합니다.
이는 src/environments 폴더에 2개의 파일을 생성합니다: environment.development.ts와 environment.ts.
로컬에서 개발할 때는 environment.ts가 environment.development.ts로 대체되어 environment.ts에서 import를 하면 자동으로 environment.development.ts의 변수들을 사용할 수 있습니다. 이는 angular.json 파일에서 확인할 수 있습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-string">"fileReplacements"</span>: [
    {
        <span class="hljs-string">"replace"</span>: <span class="hljs-string">"src/environments/environment.ts"</span>,
        <span class="hljs-string">"with"</span>: <span class="hljs-string">"src/environments/environment.development.ts"</span>
    }
]
</code></pre>
<div class="content-ad"></div>
<p>Firebase 구성을 environment.development.ts에 붙여 넣으세요.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// environment.development.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {
  <span class="hljs-attr">production</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// 백엔드에 요청을 보낼 수 있는 가정</span>
  <span class="hljs-attr">backendUrl</span>: <span class="hljs-string">"http://127.0.0.1:8000"</span>,
  <span class="hljs-comment">// 콘솔에서 가져온 Firebase 구성입니다.</span>
  <span class="hljs-comment">// 이것은 민감한 정보가 아님을 주의하세요</span>
  <span class="hljs-attr">firebaseConfig</span>: {
    <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"&#x3C;firebase-api-key>"</span>,
    <span class="hljs-attr">authDomain</span>: <span class="hljs-string">"&#x3C;my-project-id>.firebaseapp.com"</span>,
    <span class="hljs-attr">projectId</span>: <span class="hljs-string">"&#x3C;my-project-id>"</span>,
    <span class="hljs-attr">storageBucket</span>: <span class="hljs-string">"&#x3C;my-project-id>.appspot.com"</span>,
    <span class="hljs-attr">messagingSenderId</span>: <span class="hljs-string">"&#x3C;my-messaging-sender-id"</span>,
    <span class="hljs-attr">appId</span>: <span class="hljs-string">"&#x3C;my-app-id>"</span>,
  },
};
</code></pre>
<p>참고: production용 (environment.ts 파일)으로 가시려면, backendUrl을 배포된 백엔드로, firebaseConfig을 production 구성으로 대체하시면 됩니다. Firebase 프로젝트는 여러 환경을 가질 수 없으므로 환경마다 프로젝트를 생성하는 것이 좋습니다. 지금은 빠른 진행을 위해 더미 값만 사용하셔서 IDE에서 필드 부족으로 에러가 발생하지 않도록 하세요.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// environment.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {
  <span class="hljs-attr">production</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">backendUrl</span>: <span class="hljs-string">"backendUrl"</span>,
  <span class="hljs-attr">firebaseConfig</span>: {},
};
</code></pre>
<div class="content-ad"></div>
<p>앱 모듈(app.module.ts)에 필요한 import 문을 추가하고 애플리케이션을 초기화하세요:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">//app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NgModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/platform-browser"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppRoutingModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./app-routing.module"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./app.component"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireAuthModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat/auth"</span>;
<span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">"../environments/environment"</span>;

@<span class="hljs-title class_">NgModule</span>({
  <span class="hljs-attr">declarations</span>: [<span class="hljs-title class_">AppComponent</span>],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">AngularFireAuthModule</span>,
    <span class="hljs-title class_">AngularFireModule</span>.<span class="hljs-title function_">initializeApp</span>(environment.<span class="hljs-property">firebaseConfig</span>),
    <span class="hljs-title class_">BrowserModule</span>,
    <span class="hljs-title class_">AppRoutingModule</span>,
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title class_">AppComponent</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h2>필요한 컴포넌트와 라우트 생성</h2>
<p>첫째로, Google SSO를 위한 컴포넌트를 생성하려면 'ng g c signin'을 사용하고, 랜딩 페이지를 위한 컴포넌트를 생성하려면 'ng g c landing'을 사용하세요.</p>
<div class="content-ad"></div>
<p>아래는 Markdown으로 테이블 태그를 변경하세요.</p>
<p>그럼, app-routing.module.ts을 수정하세요:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NgModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RouterModule</span>, <span class="hljs-title class_">Routes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/router"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SigninComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./signin/signin.component"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LandingComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./landing/landing.component"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  { <span class="hljs-attr">path</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">LandingComponent</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">"signin"</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">SigninComponent</span> },
];
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">RouterModule</span>.<span class="hljs-title function_">forRoot</span>(routes)],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">RouterModule</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppRoutingModule</span> {}
</code></pre>
<p>마지막으로, app.component를 수정하세요:</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// app.component.ts</span>
&#x3C;nav>
  <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">ul</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">routerLink</span>=<span class="hljs-string">"/"</span>></span>랜딩 페이지<span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">li</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">routerLink</span>=<span class="hljs-string">"/signin"</span>></span>로그인 페이지<span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">li</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">ul</span>></span></span>
&#x3C;/nav>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">router-outlet</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">router-outlet</span>></span></span>
</code></pre>
<div class="content-ad"></div>
<p>지금 ng serve를 실행하고 <a href="http://localhost:4200%EC%9C%BC%EB%A1%9C" rel="nofollow" target="_blank">http://localhost:4200으로</a> 이동하면 아주 아름다운 페이지를 볼 수 있고, 랜딩 페이지와 로그인 페이지 사이를 이동할 수 있습니다.</p>
<p><img src="/assets/img/2024-06-23-Firebaseauthenticationinangular_3.png" alt="이미지"></p>
<h2>구글 SSO 추가하기</h2>
<p>구글 SSO를 추가하려면 단순히 버튼에 click 이벤트 리스너를 추가하면 됩니다. 저는 재사용 가능하도록 지시어를 사용하는 것을 선호하는데, 아래에 제가 보여주는 구현 방법을 사용하시면 됩니다.</p>
<div class="content-ad"></div>
<p>구글 SSO를 실행하여 지시문을 만들고 app.module.ts에 자동으로 추가합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">//google-sso.directive.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Directive</span>, <span class="hljs-title class_">HostListener</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireAuth</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat/auth"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GoogleAuthProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@firebase/auth"</span>;

@<span class="hljs-title class_">Directive</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">"[googleSso]"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoogleSsoDirective</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private angularFireAuth: AngularFireAuth</span>) {}
  @<span class="hljs-title class_">HostListener</span>(<span class="hljs-string">"click"</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onClick</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> creds = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">angularFireAuth</span>.<span class="hljs-title function_">signInWithPopup</span>(
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoogleAuthProvider</span>(),
    );
    <span class="hljs-comment">// 자격 증명으로 할 일을 실행합니다, 예를 들어 Firestore에 추가하기...</span>
  }
}
</code></pre>
<p>app.module.ts에 지시문을 추가하십시오.</p>
<p>이제 로그인 페이지에서 해당 지시문을 사용할 수 있습니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">&#x3C;!-- signin.<span class="hljs-property">component</span>.<span class="hljs-property">html</span> -->
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">googleSso</span>></span>Google 계정으로 로그인<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span></span>
</code></pre>
<p>그게 다에요. 작동하는지 확인하려면 프론트엔드로 이동하여 만든 버튼을 클릭하세요. 로그인한 후에 Firebase 콘솔로 돌아가세요. 인증에서 사용자 탭으로 이동하면 로그인에 사용한 이메일이 나타날 것입니다.</p>
<p>계속 진행하기 전에 로그아웃이 가능하도록 로그인 구성요소를 수정해봅시다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// signin.component.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireAuth</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat/auth"</span>;
@<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">"app-signin"</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">"./signin.component.html"</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">"./signin.component.scss"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SigninComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">public angularFireAuth: AngularFireAuth</span>) {}
  <span class="hljs-title function_">logOut</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">angularFireAuth</span>.<span class="hljs-title function_">signOut</span>();
  }
}
</code></pre>
<div class="content-ad"></div>
<!-- signin.component.html -->
<p>@if (angularFireAuth.authState | async) {
&#x3C;button (click)="logOut()">Log out
} @else {
<button googlesso="">Sign in with google</button>
}</p>
<h2>Adding a route available only for logged in users</h2>
<p>Let’s create another component: ng g c require-auth</p>
<p>Then let’s create a guard: ng g g auth then select CanActivate</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-comment">// auth.guard.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CanActivateFn</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/router"</span>;
<span class="hljs-keyword">import</span> { inject } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireAuth</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat/auth"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">authGuard</span>: <span class="hljs-title class_">CanActivateFn</span> = <span class="hljs-keyword">async</span> (route, state) => {
  <span class="hljs-keyword">const</span> angularFireAuth = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">AngularFireAuth</span>);
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> angularFireAuth.<span class="hljs-property">currentUser</span>;
  <span class="hljs-comment">// coerce to boolean</span>
  <span class="hljs-keyword">const</span> isLoggedIn = !!user;
  <span class="hljs-keyword">return</span> isLoggedIn;
};
</code></pre>
<p>그런 다음 app-routing.module.ts의 라우트를 수정합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// app-routing.module.ts - new lines</span>
...
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RequireAuthComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./require-auth/require-auth.component'</span>;
<span class="hljs-keyword">import</span> { authGuard } <span class="hljs-keyword">from</span> <span class="hljs-string">'./auth.guard'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  ...
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'require-auth'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">RequireAuthComponent</span>,
    <span class="hljs-attr">canActivate</span>: [authGuard],
  },
];
...
</code></pre>
<p>app.component.html에 추가하세요.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">&#x3C;li>
  <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">routerLink</span>=<span class="hljs-string">"/require-auth"</span>></span>Auth protected<span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span></span>
&#x3C;/li>
</code></pre>
<p>이제 로그인한 상태에서만 액세스할 수 있는 경로가 생겼어요.</p>
<h2>백엔드 경로로 bearer 토큰을 보내는 인터셉터</h2>
<p>백엔드에서 요청을 인증하려면 Firebase에서 제공한 토큰을 Authorization 헤더에 추가해야 합니다. 백엔드에서는 토큰을 확인하는 작업을 담당할 것입니다(본 문서의 범위를 벗어남).</p>
<div class="content-ad"></div>
<p>ng g interceptor bearer-token 명령을 사용하여 interceptor를 생성하세요.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// bearer-token.interceptor.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HttpEvent</span>, <span class="hljs-title class_">HttpHandlerFn</span>, <span class="hljs-title class_">HttpInterceptorFn</span>, <span class="hljs-title class_">HttpRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common/http"</span>;
<span class="hljs-keyword">import</span> { inject } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AngularFireAuth</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/fire/compat/auth"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">from</span>, lastValueFrom } <span class="hljs-keyword">from</span> <span class="hljs-string">"rxjs"</span>;
<span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">"../environments/environment"</span>;

<span class="hljs-comment">// 토큰을 얻는 작업이 비동기적이므로 이 함수를 추가해야 합니다.</span>
<span class="hljs-keyword">const</span> addBearerToken = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">req</span>: <span class="hljs-title class_">HttpRequest</span>&#x3C;any>,
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">HttpHandlerFn</span>,
): <span class="hljs-title class_">Promise</span>&#x3C;<span class="hljs-title class_">HttpEvent</span>&#x3C;any>> => {
  <span class="hljs-keyword">const</span> angularFireAuth = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">AngularFireAuth</span>);
  <span class="hljs-keyword">const</span> firebaseUser = <span class="hljs-keyword">await</span> angularFireAuth.<span class="hljs-property">currentUser</span>;
  <span class="hljs-keyword">const</span> token = <span class="hljs-keyword">await</span> firebaseUser?.<span class="hljs-title function_">getIdToken</span>();
  <span class="hljs-keyword">if</span> (token) {
    req = req.<span class="hljs-title function_">clone</span>({
      <span class="hljs-attr">setHeaders</span>: { <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span> },
    });
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">lastValueFrom</span>(<span class="hljs-title function_">next</span>(req));
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">bearerTokenInterceptor</span>: <span class="hljs-title class_">HttpInterceptorFn</span> = <span class="hljs-function">(<span class="hljs-params">req, next</span>) =></span> {
  <span class="hljs-comment">// 이 bearer token을 백엔드로 보내는 요청에만 추가합니다.</span>
  <span class="hljs-comment">// 특정 요청에만 bearer token을 추가하도록 사용자 정의할 수 있습니다.</span>
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span>.<span class="hljs-title function_">startsWith</span>(environment.<span class="hljs-property">backendUrl</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">from</span>(<span class="hljs-title function_">addBearerToken</span>(req, next));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(req);
  }
};
</code></pre>
<p>그런 다음 app.module.ts에 provider를 추가해야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// app.module.ts</span>

...
<span class="hljs-keyword">import</span> { provideHttpClient, withInterceptors } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> { bearerTokenInterceptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bearer-token.interceptor'</span>;
...
  <span class="hljs-attr">providers</span>: [<span class="hljs-title function_">provideHttpClient</span>(<span class="hljs-title function_">withInterceptors</span>([bearerTokenInterceptor]))],
...
</code></pre>
<div class="content-ad"></div>
<p>마지막으로 확인해보기 위해 백엔드를 호출하는 서비스를 생성해봅시다: ng g s api</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// api.service.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HttpClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common/http"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">"../environments/environment"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"rxjs"</span>;

@<span class="hljs-title class_">Injectable</span>({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">"root"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiService</span> {
  <span class="hljs-comment">// 현재 사용자의 firebase 사용자 ID를 반환하는 백엔드 URL</span>
  userIdUrl = <span class="hljs-string">`<span class="hljs-subst">${environment.backendUrl}</span>/userid`</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private http: HttpClient</span>) {}
  <span class="hljs-title function_">getUserId</span>(): <span class="hljs-title class_">Observable</span>&#x3C;any> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userIdUrl</span>);
  }
}
</code></pre>
<p>그리고 랜딩 컴포넌트에서:</p>
<pre><code class="hljs language-js">&#x3C;button (click)=<span class="hljs-string">"getUserId()"</span>>사용자 <span class="hljs-variable constant_">ID</span> 가져오기&#x3C;/button>
</code></pre>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../api.service"</span>;
@<span class="hljs-title class_">Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">"app-landing"</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">"./landing.component.html"</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">"./landing.component.scss"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LandingComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private apiService: ApiService</span>) {}
  <span class="hljs-title function_">getUserId</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiService</span>.<span class="hljs-title function_">getUserId</span>().<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res),
      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err),
    });
  }
}
</code></pre>
<p>이제 백엔드에 요청을 보내는 버튼이 생겼어요. 개발자 도구의 네트워크 탭에서 인증되어 있다면 토큰이 Authorization 헤더에 추가되는 것을 확인할 수 있어요.</p>
<p><img src="/assets/img/2024-06-23-Firebaseauthenticationinangular_4.png" alt="이미지"></p>
<h2>추가 정보: Firebase는 로그인 정보를 어디에 저장하나요?</h2>
<div class="content-ad"></div>
<p>저희가 인터셉터를 사용할 때 다음 코드를 사용했습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> angularFireAuth = <span class="hljs-title function_">inject</span>(<span class="hljs-title class_">AngularFireAuth</span>);
<span class="hljs-keyword">const</span> firebaseUser = <span class="hljs-keyword">await</span> angularFireAuth.<span class="hljs-property">currentUser</span>;
<span class="hljs-keyword">const</span> token = <span class="hljs-keyword">await</span> firebaseUser?.<span class="hljs-title function_">getIdToken</span>();
</code></pre>
<p>하지만 이 코드는 실제로 어떻게 작동할까요? 정보는 어디에 저장되나요?</p>
<p>사실, Google SSO로 인증할 때, 인증 정보가 브라우저에 저장됩니다. 브라우저 개발자 도구를 열고 저장소 탭 (Chrome의 경우 Application)으로 이동하신 다음 Indexed DB로 이동해보세요.</p>
<div class="content-ad"></div>
<table></table>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Angular에서 Firebase 인증 사용하는 방법","description":"","date":"2024-06-23 14:06","slug":"2024-06-23-Firebaseauthenticationinangular","content":"\n\n이 기사에서는 Angular 프로젝트에 Firebase 인증을 Google Single Sign-On (SSO)과 빠르게 설정하는 방법을 제안합니다. 또한 선택한 백엔드에 인증된 요청을 하는 방법도 포함되어 있습니다.\n\n![이미지](/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png)\n\n전체 코드는 여기에서 확인할 수 있습니다: https://github.com/Gabriel2409/demofirebase\n\n# Firebase 설정\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nFirebase에 가서 새 프로젝트를 만들어주세요.\n\n## 앱 설치\n\n프로젝트 개요 페이지에서 Web 아이콘을 클릭하거나 +앱 추가 아이콘을 클릭하여 웹 애플리케이션을 추가하세요.\n\n![이미지](/assets/img/2024-06-23-Firebaseauthenticationinangular_1.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n열리는 창에서 앱에 이름을 지정하고, 예를 들어 myangularapp처럼 등록해주세요. Firebase 구성을 어딘가에 저장하세요. 다음과 같이 보여야 합니다:\n\n```js\nconst firebaseConfig = {\n  apiKey: \"\u003cfirebase-api-key\u003e\",\n  authDomain: \"\u003cmy-project-id\u003e.firebaseapp.com\",\n  projectId: \"\u003cmy-project-id\u003e\",\n  storageBucket: \"\u003cmy-project-id\u003e.appspot.com\",\n  messagingSenderId: \"\u003cmy-messaging-sender-id\",\n  appId: \"\u003cmy-app-id\u003e\",\n};\n```\n\n프로젝트 설정의 일반 탭(톱니바퀴 아이콘)로 이동하여 아무 때나 앱의 Firebase 구성에 액세스할 수 있음을 유념하세요.\n\n## 인증 설정\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n모든 제품으로 이동한 다음 **인증**을 선택하세요. **로그인 방법**에서 **새로운 제공자 추가**를 클릭하고 Google을 선택하세요. Firebase는 Google과 긴밀하게 통합되어 있기 때문에 별도의 설정이 필요하지 않습니다.\n\n그게 다에요! 이제 Google SSO를 사용하여 Firebase 사용자를 인증할 준비가 되었습니다.\n\n참고: 다른 제공자도 추가할 수 있습니다(예: 이메일/비밀번호, 아래 이미지 참조), 하지만 이 기사에서는 Google SSO에 중점을 두고 있습니다.\n\n![이미지](/assets/img/2024-06-23-Firebaseauthenticationinangular_2.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# Angular 설정\n\n## 프로젝트 생성\n\n먼저, npm install -g @angular/cli를 사용하여 Angular을 전역으로 설치하세요. 저는 버전 17.0.1을 사용하고 있어요.\n\n그런 다음, demofirebase라는 새 폴더를 만들고 해당 폴더에서 ng new frontend --no-standalone --routing ssr=false을 실행하세요. 이렇게 하면 필요한 파일이 포함된 frontend 폴더가 생성됩니다. 이 단계를 마치면 저장소 구조는 다음과 같아야 합니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ndemofirebase\n└── frontend\n```\n\n하나의 추가 패키지가 필요합니다. frontend 폴더에서 npm i @angular/fire 명령어를 실행해주세요.\n\n다음으로, 개발 및 프로덕션을 위한 환경을 생성할 때 ng g environments를 사용합니다.\n이는 src/environments 폴더에 2개의 파일을 생성합니다: environment.development.ts와 environment.ts.\n로컬에서 개발할 때는 environment.ts가 environment.development.ts로 대체되어 environment.ts에서 import를 하면 자동으로 environment.development.ts의 변수들을 사용할 수 있습니다. 이는 angular.json 파일에서 확인할 수 있습니다:\n\n```js\n\"fileReplacements\": [\n    {\n        \"replace\": \"src/environments/environment.ts\",\n        \"with\": \"src/environments/environment.development.ts\"\n    }\n]\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nFirebase 구성을 environment.development.ts에 붙여 넣으세요.\n\n```js\n// environment.development.ts\nexport const environment = {\n  production: false,\n  // 백엔드에 요청을 보낼 수 있는 가정\n  backendUrl: \"http://127.0.0.1:8000\",\n  // 콘솔에서 가져온 Firebase 구성입니다.\n  // 이것은 민감한 정보가 아님을 주의하세요\n  firebaseConfig: {\n    apiKey: \"\u003cfirebase-api-key\u003e\",\n    authDomain: \"\u003cmy-project-id\u003e.firebaseapp.com\",\n    projectId: \"\u003cmy-project-id\u003e\",\n    storageBucket: \"\u003cmy-project-id\u003e.appspot.com\",\n    messagingSenderId: \"\u003cmy-messaging-sender-id\",\n    appId: \"\u003cmy-app-id\u003e\",\n  },\n};\n```\n\n참고: production용 (environment.ts 파일)으로 가시려면, backendUrl을 배포된 백엔드로, firebaseConfig을 production 구성으로 대체하시면 됩니다. Firebase 프로젝트는 여러 환경을 가질 수 없으므로 환경마다 프로젝트를 생성하는 것이 좋습니다. 지금은 빠른 진행을 위해 더미 값만 사용하셔서 IDE에서 필드 부족으로 에러가 발생하지 않도록 하세요.\n\n```js\n// environment.ts\nexport const environment = {\n  production: true,\n  backendUrl: \"backendUrl\",\n  firebaseConfig: {},\n};\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n앱 모듈(app.module.ts)에 필요한 import 문을 추가하고 애플리케이션을 초기화하세요:\n\n```js\n//app.module.ts\nimport { NgModule } from \"@angular/core\";\nimport { BrowserModule } from \"@angular/platform-browser\";\nimport { AppRoutingModule } from \"./app-routing.module\";\nimport { AppComponent } from \"./app.component\";\nimport { AngularFireModule } from \"@angular/fire/compat\";\nimport { AngularFireAuthModule } from \"@angular/fire/compat/auth\";\nimport { environment } from \"../environments/environment\";\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    AngularFireAuthModule,\n    AngularFireModule.initializeApp(environment.firebaseConfig),\n    BrowserModule,\n    AppRoutingModule,\n  ],\n  providers: [],\n  bootstrap: [AppComponent],\n})\nexport class AppModule {}\n```\n\n## 필요한 컴포넌트와 라우트 생성\n\n첫째로, Google SSO를 위한 컴포넌트를 생성하려면 'ng g c signin'을 사용하고, 랜딩 페이지를 위한 컴포넌트를 생성하려면 'ng g c landing'을 사용하세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래는 Markdown으로 테이블 태그를 변경하세요.\n\n그럼, app-routing.module.ts을 수정하세요:\n\n```typescript\nimport { NgModule } from \"@angular/core\";\nimport { RouterModule, Routes } from \"@angular/router\";\nimport { SigninComponent } from \"./signin/signin.component\";\nimport { LandingComponent } from \"./landing/landing.component\";\n\nconst routes: Routes = [\n  { path: \"\", component: LandingComponent },\n  { path: \"signin\", component: SigninComponent },\n];\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n```\n\n마지막으로, app.component를 수정하세요:\n\n```typescript\n// app.component.ts\n\u003cnav\u003e\n  \u003cul\u003e\n    \u003cli\u003e\n      \u003ca routerLink=\"/\"\u003e랜딩 페이지\u003c/a\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\n      \u003ca routerLink=\"/signin\"\u003e로그인 페이지\u003c/a\u003e\n    \u003c/li\u003e\n  \u003c/ul\u003e\n\u003c/nav\u003e\n\u003crouter-outlet\u003e\u003c/router-outlet\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n지금 ng serve를 실행하고 http://localhost:4200으로 이동하면 아주 아름다운 페이지를 볼 수 있고, 랜딩 페이지와 로그인 페이지 사이를 이동할 수 있습니다.\n\n![이미지](/assets/img/2024-06-23-Firebaseauthenticationinangular_3.png)\n\n## 구글 SSO 추가하기\n\n구글 SSO를 추가하려면 단순히 버튼에 click 이벤트 리스너를 추가하면 됩니다. 저는 재사용 가능하도록 지시어를 사용하는 것을 선호하는데, 아래에 제가 보여주는 구현 방법을 사용하시면 됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n구글 SSO를 실행하여 지시문을 만들고 app.module.ts에 자동으로 추가합니다.\n\n```js\n//google-sso.directive.ts\nimport { Directive, HostListener } from \"@angular/core\";\nimport { AngularFireAuth } from \"@angular/fire/compat/auth\";\nimport { GoogleAuthProvider } from \"@firebase/auth\";\n\n@Directive({\n  selector: \"[googleSso]\",\n})\nexport class GoogleSsoDirective {\n  constructor(private angularFireAuth: AngularFireAuth) {}\n  @HostListener(\"click\")\n  async onClick() {\n    const creds = await this.angularFireAuth.signInWithPopup(\n      new GoogleAuthProvider(),\n    );\n    // 자격 증명으로 할 일을 실행합니다, 예를 들어 Firestore에 추가하기...\n  }\n}\n```\n\napp.module.ts에 지시문을 추가하십시오.\n\n이제 로그인 페이지에서 해당 지시문을 사용할 수 있습니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n\u003c!-- signin.component.html --\u003e\n\u003cbutton googleSso\u003eGoogle 계정으로 로그인\u003c/button\u003e\n```\n\n그게 다에요. 작동하는지 확인하려면 프론트엔드로 이동하여 만든 버튼을 클릭하세요. 로그인한 후에 Firebase 콘솔로 돌아가세요. 인증에서 사용자 탭으로 이동하면 로그인에 사용한 이메일이 나타날 것입니다.\n\n계속 진행하기 전에 로그아웃이 가능하도록 로그인 구성요소를 수정해봅시다.\n\n```js\n// signin.component.ts\nimport { Component } from \"@angular/core\";\nimport { AngularFireAuth } from \"@angular/fire/compat/auth\";\n@Component({\n  selector: \"app-signin\",\n  templateUrl: \"./signin.component.html\",\n  styleUrl: \"./signin.component.scss\",\n})\nexport class SigninComponent {\n  constructor(public angularFireAuth: AngularFireAuth) {}\n  logOut() {\n    this.angularFireAuth.signOut();\n  }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n\u003c!-- signin.component.html --\u003e\n@if (angularFireAuth.authState | async) {\n\u003cbutton (click)=\"logOut()\"\u003eLog out\u003c/button\u003e\n} @else {\n\u003cbutton googleSso\u003eSign in with google\u003c/button\u003e\n}\n\n\n## Adding a route available only for logged in users\n\nLet’s create another component: ng g c require-auth\n\nThen let’s create a guard: ng g g auth then select CanActivate\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n// auth.guard.ts\nimport { CanActivateFn } from \"@angular/router\";\nimport { inject } from \"@angular/core\";\nimport { AngularFireAuth } from \"@angular/fire/compat/auth\";\n\nexport const authGuard: CanActivateFn = async (route, state) =\u003e {\n  const angularFireAuth = inject(AngularFireAuth);\n  const user = await angularFireAuth.currentUser;\n  // coerce to boolean\n  const isLoggedIn = !!user;\n  return isLoggedIn;\n};\n```\n\n그런 다음 app-routing.module.ts의 라우트를 수정합니다.\n\n```js\n// app-routing.module.ts - new lines\n...\nimport { RequireAuthComponent } from './require-auth/require-auth.component';\nimport { authGuard } from './auth.guard';\nconst routes: Routes = [\n  ...\n  {\n    path: 'require-auth',\n    component: RequireAuthComponent,\n    canActivate: [authGuard],\n  },\n];\n...\n```\n\napp.component.html에 추가하세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n\u003cli\u003e\n  \u003ca routerLink=\"/require-auth\"\u003eAuth protected\u003c/a\u003e\n\u003c/li\u003e\n```\n\n이제 로그인한 상태에서만 액세스할 수 있는 경로가 생겼어요.\n\n## 백엔드 경로로 bearer 토큰을 보내는 인터셉터\n\n백엔드에서 요청을 인증하려면 Firebase에서 제공한 토큰을 Authorization 헤더에 추가해야 합니다. 백엔드에서는 토큰을 확인하는 작업을 담당할 것입니다(본 문서의 범위를 벗어남).\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nng g interceptor bearer-token 명령을 사용하여 interceptor를 생성하세요.\n\n```js\n// bearer-token.interceptor.ts\nimport { HttpEvent, HttpHandlerFn, HttpInterceptorFn, HttpRequest } from \"@angular/common/http\";\nimport { inject } from \"@angular/core\";\nimport { AngularFireAuth } from \"@angular/fire/compat/auth\";\nimport { from, lastValueFrom } from \"rxjs\";\nimport { environment } from \"../environments/environment\";\n\n// 토큰을 얻는 작업이 비동기적이므로 이 함수를 추가해야 합니다.\nconst addBearerToken = async (\n  req: HttpRequest\u003cany\u003e,\n  next: HttpHandlerFn,\n): Promise\u003cHttpEvent\u003cany\u003e\u003e =\u003e {\n  const angularFireAuth = inject(AngularFireAuth);\n  const firebaseUser = await angularFireAuth.currentUser;\n  const token = await firebaseUser?.getIdToken();\n  if (token) {\n    req = req.clone({\n      setHeaders: { Authorization: `Bearer ${token}` },\n    });\n  }\n  return lastValueFrom(next(req));\n};\nexport const bearerTokenInterceptor: HttpInterceptorFn = (req, next) =\u003e {\n  // 이 bearer token을 백엔드로 보내는 요청에만 추가합니다.\n  // 특정 요청에만 bearer token을 추가하도록 사용자 정의할 수 있습니다.\n  if (req.url.startsWith(environment.backendUrl)) {\n    return from(addBearerToken(req, next));\n  } else {\n    return next(req);\n  }\n};\n```\n\n그런 다음 app.module.ts에 provider를 추가해야 합니다.\n\n```js\n// app.module.ts\n\n...\nimport { provideHttpClient, withInterceptors } from '@angular/common/http';\nimport { bearerTokenInterceptor } from './bearer-token.interceptor';\n...\n  providers: [provideHttpClient(withInterceptors([bearerTokenInterceptor]))],\n...\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n마지막으로 확인해보기 위해 백엔드를 호출하는 서비스를 생성해봅시다: ng g s api\n\n```js\n// api.service.ts\nimport { HttpClient } from \"@angular/common/http\";\nimport { Injectable } from \"@angular/core\";\nimport { environment } from \"../environments/environment\";\nimport { Observable } from \"rxjs\";\n\n@Injectable({\n  providedIn: \"root\",\n})\nexport class ApiService {\n  // 현재 사용자의 firebase 사용자 ID를 반환하는 백엔드 URL\n  userIdUrl = `${environment.backendUrl}/userid`;\n  constructor(private http: HttpClient) {}\n  getUserId(): Observable\u003cany\u003e {\n    return this.http.get(this.userIdUrl);\n  }\n}\n```\n\n그리고 랜딩 컴포넌트에서:\n\n```js\n\u003cbutton (click)=\"getUserId()\"\u003e사용자 ID 가져오기\u003c/button\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport { Component } from \"@angular/core\";\nimport { ApiService } from \"../api.service\";\n@Component({\n  selector: \"app-landing\",\n  templateUrl: \"./landing.component.html\",\n  styleUrl: \"./landing.component.scss\",\n})\nexport class LandingComponent {\n  constructor(private apiService: ApiService) {}\n  getUserId() {\n    this.apiService.getUserId().subscribe({\n      next: (res) =\u003e console.log(res),\n      error: (err) =\u003e console.log(err),\n    });\n  }\n}\n```\n\n이제 백엔드에 요청을 보내는 버튼이 생겼어요. 개발자 도구의 네트워크 탭에서 인증되어 있다면 토큰이 Authorization 헤더에 추가되는 것을 확인할 수 있어요.\n\n![이미지](/assets/img/2024-06-23-Firebaseauthenticationinangular_4.png)\n\n## 추가 정보: Firebase는 로그인 정보를 어디에 저장하나요?\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저희가 인터셉터를 사용할 때 다음 코드를 사용했습니다:\n\n```js\nconst angularFireAuth = inject(AngularFireAuth);\nconst firebaseUser = await angularFireAuth.currentUser;\nconst token = await firebaseUser?.getIdToken();\n```\n\n하지만 이 코드는 실제로 어떻게 작동할까요? 정보는 어디에 저장되나요?\n\n사실, Google SSO로 인증할 때, 인증 정보가 브라우저에 저장됩니다. 브라우저 개발자 도구를 열고 저장소 탭 (Chrome의 경우 Application)으로 이동하신 다음 Indexed DB로 이동해보세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003ctable\u003e 태그를 Markdown 형식으로 변경해주세요.","ogImage":{"url":"/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png"},"coverImage":"/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png","tag":["Tech"],"readingTime":12},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e이 기사에서는 Angular 프로젝트에 Firebase 인증을 Google Single Sign-On (SSO)과 빠르게 설정하는 방법을 제안합니다. 또한 선택한 백엔드에 인증된 요청을 하는 방법도 포함되어 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-Firebaseauthenticationinangular_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e전체 코드는 여기에서 확인할 수 있습니다: \u003ca href=\"https://github.com/Gabriel2409/demofirebase\" rel=\"nofollow\" target=\"_blank\"\u003ehttps://github.com/Gabriel2409/demofirebase\u003c/a\u003e\u003c/p\u003e\n\u003ch1\u003eFirebase 설정\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eFirebase에 가서 새 프로젝트를 만들어주세요.\u003c/p\u003e\n\u003ch2\u003e앱 설치\u003c/h2\u003e\n\u003cp\u003e프로젝트 개요 페이지에서 Web 아이콘을 클릭하거나 +앱 추가 아이콘을 클릭하여 웹 애플리케이션을 추가하세요.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-Firebaseauthenticationinangular_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e열리는 창에서 앱에 이름을 지정하고, 예를 들어 myangularapp처럼 등록해주세요. Firebase 구성을 어딘가에 저장하세요. 다음과 같이 보여야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e firebaseConfig = {\n  \u003cspan class=\"hljs-attr\"\u003eapiKey\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;firebase-api-key\u003e\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eauthDomain\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e.firebaseapp.com\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eprojectId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003estorageBucket\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e.appspot.com\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003emessagingSenderId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-messaging-sender-id\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eappId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-app-id\u003e\"\u003c/span\u003e,\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e프로젝트 설정의 일반 탭(톱니바퀴 아이콘)로 이동하여 아무 때나 앱의 Firebase 구성에 액세스할 수 있음을 유념하세요.\u003c/p\u003e\n\u003ch2\u003e인증 설정\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e모든 제품으로 이동한 다음 \u003cstrong\u003e인증\u003c/strong\u003e을 선택하세요. \u003cstrong\u003e로그인 방법\u003c/strong\u003e에서 \u003cstrong\u003e새로운 제공자 추가\u003c/strong\u003e를 클릭하고 Google을 선택하세요. Firebase는 Google과 긴밀하게 통합되어 있기 때문에 별도의 설정이 필요하지 않습니다.\u003c/p\u003e\n\u003cp\u003e그게 다에요! 이제 Google SSO를 사용하여 Firebase 사용자를 인증할 준비가 되었습니다.\u003c/p\u003e\n\u003cp\u003e참고: 다른 제공자도 추가할 수 있습니다(예: 이메일/비밀번호, 아래 이미지 참조), 하지만 이 기사에서는 Google SSO에 중점을 두고 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-Firebaseauthenticationinangular_2.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003eAngular 설정\u003c/h1\u003e\n\u003ch2\u003e프로젝트 생성\u003c/h2\u003e\n\u003cp\u003e먼저, npm install -g @angular/cli를 사용하여 Angular을 전역으로 설치하세요. 저는 버전 17.0.1을 사용하고 있어요.\u003c/p\u003e\n\u003cp\u003e그런 다음, demofirebase라는 새 폴더를 만들고 해당 폴더에서 ng new frontend --no-standalone --routing ssr=false을 실행하세요. 이렇게 하면 필요한 파일이 포함된 frontend 폴더가 생성됩니다. 이 단계를 마치면 저장소 구조는 다음과 같아야 합니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edemofirebase\n└── frontend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e하나의 추가 패키지가 필요합니다. frontend 폴더에서 npm i @angular/fire 명령어를 실행해주세요.\u003c/p\u003e\n\u003cp\u003e다음으로, 개발 및 프로덕션을 위한 환경을 생성할 때 ng g environments를 사용합니다.\n이는 src/environments 폴더에 2개의 파일을 생성합니다: environment.development.ts와 environment.ts.\n로컬에서 개발할 때는 environment.ts가 environment.development.ts로 대체되어 environment.ts에서 import를 하면 자동으로 environment.development.ts의 변수들을 사용할 수 있습니다. 이는 angular.json 파일에서 확인할 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-string\"\u003e\"fileReplacements\"\u003c/span\u003e: [\n    {\n        \u003cspan class=\"hljs-string\"\u003e\"replace\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"src/environments/environment.ts\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\"with\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"src/environments/environment.development.ts\"\u003c/span\u003e\n    }\n]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eFirebase 구성을 environment.development.ts에 붙여 넣으세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// environment.development.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e environment = {\n  \u003cspan class=\"hljs-attr\"\u003eproduction\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-comment\"\u003e// 백엔드에 요청을 보낼 수 있는 가정\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ebackendUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"http://127.0.0.1:8000\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-comment\"\u003e// 콘솔에서 가져온 Firebase 구성입니다.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 이것은 민감한 정보가 아님을 주의하세요\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003efirebaseConfig\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eapiKey\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;firebase-api-key\u003e\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eauthDomain\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e.firebaseapp.com\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprojectId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003estorageBucket\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-project-id\u003e.appspot.com\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003emessagingSenderId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-messaging-sender-id\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eappId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\u0026#x3C;my-app-id\u003e\"\u003c/span\u003e,\n  },\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e참고: production용 (environment.ts 파일)으로 가시려면, backendUrl을 배포된 백엔드로, firebaseConfig을 production 구성으로 대체하시면 됩니다. Firebase 프로젝트는 여러 환경을 가질 수 없으므로 환경마다 프로젝트를 생성하는 것이 좋습니다. 지금은 빠른 진행을 위해 더미 값만 사용하셔서 IDE에서 필드 부족으로 에러가 발생하지 않도록 하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// environment.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e environment = {\n  \u003cspan class=\"hljs-attr\"\u003eproduction\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ebackendUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"backendUrl\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003efirebaseConfig\u003c/span\u003e: {},\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e앱 모듈(app.module.ts)에 필요한 import 문을 추가하고 애플리케이션을 초기화하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e//app.module.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eNgModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBrowserModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/platform-browser\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAppRoutingModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./app-routing.module\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAppComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./app.component\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuthModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat/auth\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { environment } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"../environments/environment\"\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title class_\"\u003eNgModule\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003edeclarations\u003c/span\u003e: [\u003cspan class=\"hljs-title class_\"\u003eAppComponent\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\n    \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuthModule\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eAngularFireModule\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003einitializeApp\u003c/span\u003e(environment.\u003cspan class=\"hljs-property\"\u003efirebaseConfig\u003c/span\u003e),\n    \u003cspan class=\"hljs-title class_\"\u003eBrowserModule\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eAppRoutingModule\u003c/span\u003e,\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eproviders\u003c/span\u003e: [],\n  \u003cspan class=\"hljs-attr\"\u003ebootstrap\u003c/span\u003e: [\u003cspan class=\"hljs-title class_\"\u003eAppComponent\u003c/span\u003e],\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAppModule\u003c/span\u003e {}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e필요한 컴포넌트와 라우트 생성\u003c/h2\u003e\n\u003cp\u003e첫째로, Google SSO를 위한 컴포넌트를 생성하려면 'ng g c signin'을 사용하고, 랜딩 페이지를 위한 컴포넌트를 생성하려면 'ng g c landing'을 사용하세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e아래는 Markdown으로 테이블 태그를 변경하세요.\u003c/p\u003e\n\u003cp\u003e그럼, app-routing.module.ts을 수정하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eNgModule\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eRouterModule\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRoutes\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/router\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eSigninComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./signin/signin.component\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eLandingComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"./landing/landing.component\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRoutes\u003c/span\u003e = [\n  { \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eLandingComponent\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"signin\"\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eSigninComponent\u003c/span\u003e },\n];\n\u003cspan class=\"hljs-meta\"\u003e@NgModule\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eimports\u003c/span\u003e: [\u003cspan class=\"hljs-title class_\"\u003eRouterModule\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eforRoot\u003c/span\u003e(routes)],\n  \u003cspan class=\"hljs-attr\"\u003eexports\u003c/span\u003e: [\u003cspan class=\"hljs-title class_\"\u003eRouterModule\u003c/span\u003e],\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAppRoutingModule\u003c/span\u003e {}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e마지막으로, app.component를 수정하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// app.component.ts\u003c/span\u003e\n\u0026#x3C;nav\u003e\n  \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u003e\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouterLink\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e\u003e\u003c/span\u003e랜딩 페이지\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u003e\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouterLink\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/signin\"\u003c/span\u003e\u003e\u003c/span\u003e로그인 페이지\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u003e\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u0026#x3C;/nav\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003erouter-outlet\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003erouter-outlet\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e지금 ng serve를 실행하고 \u003ca href=\"http://localhost:4200%EC%9C%BC%EB%A1%9C\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:4200으로\u003c/a\u003e 이동하면 아주 아름다운 페이지를 볼 수 있고, 랜딩 페이지와 로그인 페이지 사이를 이동할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-Firebaseauthenticationinangular_3.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e구글 SSO 추가하기\u003c/h2\u003e\n\u003cp\u003e구글 SSO를 추가하려면 단순히 버튼에 click 이벤트 리스너를 추가하면 됩니다. 저는 재사용 가능하도록 지시어를 사용하는 것을 선호하는데, 아래에 제가 보여주는 구현 방법을 사용하시면 됩니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e구글 SSO를 실행하여 지시문을 만들고 app.module.ts에 자동으로 추가합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e//google-sso.directive.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eDirective\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHostListener\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat/auth\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eGoogleAuthProvider\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@firebase/auth\"\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title class_\"\u003eDirective\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eselector\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"[googleSso]\"\u003c/span\u003e,\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eGoogleSsoDirective\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprivate angularFireAuth: AngularFireAuth\u003c/span\u003e) {}\n  @\u003cspan class=\"hljs-title class_\"\u003eHostListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"click\"\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonClick\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e creds = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eangularFireAuth\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esignInWithPopup\u003c/span\u003e(\n      \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eGoogleAuthProvider\u003c/span\u003e(),\n    );\n    \u003cspan class=\"hljs-comment\"\u003e// 자격 증명으로 할 일을 실행합니다, 예를 들어 Firestore에 추가하기...\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eapp.module.ts에 지시문을 추가하십시오.\u003c/p\u003e\n\u003cp\u003e이제 로그인 페이지에서 해당 지시문을 사용할 수 있습니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;!-- signin.\u003cspan class=\"hljs-property\"\u003ecomponent\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehtml\u003c/span\u003e --\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003egoogleSso\u003c/span\u003e\u003e\u003c/span\u003eGoogle 계정으로 로그인\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그게 다에요. 작동하는지 확인하려면 프론트엔드로 이동하여 만든 버튼을 클릭하세요. 로그인한 후에 Firebase 콘솔로 돌아가세요. 인증에서 사용자 탭으로 이동하면 로그인에 사용한 이메일이 나타날 것입니다.\u003c/p\u003e\n\u003cp\u003e계속 진행하기 전에 로그아웃이 가능하도록 로그인 구성요소를 수정해봅시다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// signin.component.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat/auth\"\u003c/span\u003e;\n@\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eselector\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"app-signin\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003etemplateUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./signin.component.html\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003estyleUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./signin.component.scss\"\u003c/span\u003e,\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSigninComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003epublic angularFireAuth: AngularFireAuth\u003c/span\u003e) {}\n  \u003cspan class=\"hljs-title function_\"\u003elogOut\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eangularFireAuth\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esignOut\u003c/span\u003e();\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003c!-- signin.component.html --\u003e\n\u003cp\u003e@if (angularFireAuth.authState | async) {\n\u0026#x3C;button (click)=\"logOut()\"\u003eLog out\n} @else {\n\u003cbutton googlesso=\"\"\u003eSign in with google\u003c/button\u003e\n}\u003c/p\u003e\n\u003ch2\u003eAdding a route available only for logged in users\u003c/h2\u003e\n\u003cp\u003eLet’s create another component: ng g c require-auth\u003c/p\u003e\n\u003cp\u003eThen let’s create a guard: ng g g auth then select CanActivate\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// auth.guard.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eCanActivateFn\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/router\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { inject } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat/auth\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eauthGuard\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eCanActivateFn\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (route, state) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e angularFireAuth = \u003cspan class=\"hljs-title function_\"\u003einject\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e angularFireAuth.\u003cspan class=\"hljs-property\"\u003ecurrentUser\u003c/span\u003e;\n  \u003cspan class=\"hljs-comment\"\u003e// coerce to boolean\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isLoggedIn = !!user;\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e isLoggedIn;\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그런 다음 app-routing.module.ts의 라우트를 수정합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// app-routing.module.ts - new lines\u003c/span\u003e\n...\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eRequireAuthComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./require-auth/require-auth.component'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { authGuard } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./auth.guard'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eroutes\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRoutes\u003c/span\u003e = [\n  ...\n  {\n    \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'require-auth'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecomponent\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRequireAuthComponent\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecanActivate\u003c/span\u003e: [authGuard],\n  },\n];\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eapp.component.html에 추가하세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;li\u003e\n  \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003erouterLink\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"/require-auth\"\u003c/span\u003e\u003e\u003c/span\u003eAuth protected\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ea\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u0026#x3C;/li\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 로그인한 상태에서만 액세스할 수 있는 경로가 생겼어요.\u003c/p\u003e\n\u003ch2\u003e백엔드 경로로 bearer 토큰을 보내는 인터셉터\u003c/h2\u003e\n\u003cp\u003e백엔드에서 요청을 인증하려면 Firebase에서 제공한 토큰을 Authorization 헤더에 추가해야 합니다. 백엔드에서는 토큰을 확인하는 작업을 담당할 것입니다(본 문서의 범위를 벗어남).\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eng g interceptor bearer-token 명령을 사용하여 interceptor를 생성하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// bearer-token.interceptor.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eHttpEvent\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpHandlerFn\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpInterceptorFn\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpRequest\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/common/http\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { inject } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/fire/compat/auth\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, lastValueFrom } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rxjs\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { environment } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"../environments/environment\"\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 토큰을 얻는 작업이 비동기적이므로 이 함수를 추가해야 합니다.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e addBearerToken = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (\n  \u003cspan class=\"hljs-attr\"\u003ereq\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHttpRequest\u003c/span\u003e\u0026#x3C;any\u003e,\n  \u003cspan class=\"hljs-attr\"\u003enext\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHttpHandlerFn\u003c/span\u003e,\n): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eHttpEvent\u003c/span\u003e\u0026#x3C;any\u003e\u003e =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e angularFireAuth = \u003cspan class=\"hljs-title function_\"\u003einject\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e firebaseUser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e angularFireAuth.\u003cspan class=\"hljs-property\"\u003ecurrentUser\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e token = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e firebaseUser?.\u003cspan class=\"hljs-title function_\"\u003egetIdToken\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (token) {\n    req = req.\u003cspan class=\"hljs-title function_\"\u003eclone\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003esetHeaders\u003c/span\u003e: { \u003cspan class=\"hljs-title class_\"\u003eAuthorization\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`Bearer \u003cspan class=\"hljs-subst\"\u003e${token}\u003c/span\u003e`\u003c/span\u003e },\n    });\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elastValueFrom\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(req));\n};\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ebearerTokenInterceptor\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHttpInterceptorFn\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, next\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 이 bearer token을 백엔드로 보내는 요청에만 추가합니다.\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 특정 요청에만 bearer token을 추가하도록 사용자 정의할 수 있습니다.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(environment.\u003cspan class=\"hljs-property\"\u003ebackendUrl\u003c/span\u003e)) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efrom\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eaddBearerToken\u003c/span\u003e(req, next));\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(req);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그런 다음 app.module.ts에 provider를 추가해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// app.module.ts\u003c/span\u003e\n\n...\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { provideHttpClient, withInterceptors } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@angular/common/http'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { bearerTokenInterceptor } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./bearer-token.interceptor'\u003c/span\u003e;\n...\n  \u003cspan class=\"hljs-attr\"\u003eproviders\u003c/span\u003e: [\u003cspan class=\"hljs-title function_\"\u003eprovideHttpClient\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ewithInterceptors\u003c/span\u003e([bearerTokenInterceptor]))],\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e마지막으로 확인해보기 위해 백엔드를 호출하는 서비스를 생성해봅시다: ng g s api\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// api.service.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eHttpClient\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/common/http\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eInjectable\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { environment } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"../environments/environment\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eObservable\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"rxjs\"\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title class_\"\u003eInjectable\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eprovidedIn\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"root\"\u003c/span\u003e,\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApiService\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// 현재 사용자의 firebase 사용자 ID를 반환하는 백엔드 URL\u003c/span\u003e\n  userIdUrl = \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${environment.backendUrl}\u003c/span\u003e/userid`\u003c/span\u003e;\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprivate http: HttpClient\u003c/span\u003e) {}\n  \u003cspan class=\"hljs-title function_\"\u003egetUserId\u003c/span\u003e(): \u003cspan class=\"hljs-title class_\"\u003eObservable\u003c/span\u003e\u0026#x3C;any\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehttp\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euserIdUrl\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e그리고 랜딩 컴포넌트에서:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;button (click)=\u003cspan class=\"hljs-string\"\u003e\"getUserId()\"\u003c/span\u003e\u003e사용자 \u003cspan class=\"hljs-variable constant_\"\u003eID\u003c/span\u003e 가져오기\u0026#x3C;/button\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"@angular/core\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eApiService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"../api.service\"\u003c/span\u003e;\n@\u003cspan class=\"hljs-title class_\"\u003eComponent\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eselector\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"app-landing\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003etemplateUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./landing.component.html\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003estyleUrl\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./landing.component.scss\"\u003c/span\u003e,\n})\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eLandingComponent\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprivate apiService: ApiService\u003c/span\u003e) {}\n  \u003cspan class=\"hljs-title function_\"\u003egetUserId\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eapiService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetUserId\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003esubscribe\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003enext\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(res),\n      \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(err),\n    });\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 백엔드에 요청을 보내는 버튼이 생겼어요. 개발자 도구의 네트워크 탭에서 인증되어 있다면 토큰이 Authorization 헤더에 추가되는 것을 확인할 수 있어요.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-Firebaseauthenticationinangular_4.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e추가 정보: Firebase는 로그인 정보를 어디에 저장하나요?\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e저희가 인터셉터를 사용할 때 다음 코드를 사용했습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e angularFireAuth = \u003cspan class=\"hljs-title function_\"\u003einject\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eAngularFireAuth\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e firebaseUser = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e angularFireAuth.\u003cspan class=\"hljs-property\"\u003ecurrentUser\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e token = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e firebaseUser?.\u003cspan class=\"hljs-title function_\"\u003egetIdToken\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e하지만 이 코드는 실제로 어떻게 작동할까요? 정보는 어디에 저장되나요?\u003c/p\u003e\n\u003cp\u003e사실, Google SSO로 인증할 때, 인증 정보가 브라우저에 저장됩니다. 브라우저 개발자 도구를 열고 저장소 탭 (Chrome의 경우 Application)으로 이동하신 다음 Indexed DB로 이동해보세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ctable\u003e\u003c/table\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-Firebaseauthenticationinangular"},"buildId":"Rv-NbbtWUaja2joH5WkO_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>