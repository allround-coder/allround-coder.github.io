<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide" data-gatsby-head="true"/><meta name="twitter:title" content="MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 04:13" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_buildManifest.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">11<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>안녕하세요 개발자 여러분! 이 이야기에서는 서버 및 클라이언트 측을 모두 포함한 인증 시스템을 구축할 것입니다. 그러나 이 부분에서는 서버 측만 구축할 것입니다.</p>
<p>이 프로젝트의 레포지토리 링크는 다음과 같습니다. 미리 확인해보세요.</p>
<h2>목차</h2>
<ul>
<li>소개</li>
<li>프로젝트 설정하기</li>
<li>환경 변수 설정하기</li>
<li>데이터베이스 구성하기</li>
<li>모델 생성하기</li>
<li>컨트롤러 구축하기</li>
<li>미들웨어 구현하기</li>
<li>라우트 설정하기</li>
<li>서버 테스트하기</li>
</ul>
<div class="content-ad"></div>
<h2>1. 소개</h2>
<p>인증은 모든 애플리케이션의 중요한 부분입니다. 사용자가 자신이 주장하는 대로인지 확인하고 그들이 자격이 있는 리소스에 액세스할 수 있도록 보장합니다. 이 안내서에서는 Node.js, Express 및 JWT (JSON Web Tokens)를 사용하여 간단한 토큰 기반 인증 시스템을 구축할 것입니다.</p>
<p>이야기 끝에 프로젝트 폴더 구조는 다음과 같이 보일 것입니다:</p>
<p><img src="/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png" alt="프로젝트 폴더 구조"></p>
<div class="content-ad"></div>
<p>그럼 시작해보겠습니다!</p>
<h2>2: 프로젝트 설정</h2>
<p>먼저, 프로젝트를 설정해보겠습니다. 터미널을 열고 아래 명령어를 실행해주세요:</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">mkdir</span> user-auth-system
<span class="hljs-built_in">cd</span> user-auth-system
<span class="hljs-built_in">mkdir</span> server
<span class="hljs-built_in">mkdir</span> client
<span class="hljs-built_in">cd</span> server
npm init -y
</code></pre>
<div class="content-ad"></div>
<p>프로젝트 폴더를 만들었는데 서버 및 클라이언트 폴더를 모두 포함하고 있어요. 하지만 클라이언트 쪽은 Part 2에서 만들 거에요. 이제 프로젝트의 서버 쪽에 사용할 필수 패키지를 설치해봐요.</p>
<p>다음 패키지들을 사용할 거에요:</p>
<ul>
<li>서버용으로 express</li>
<li>토큰 처리를 위한 jsonwebtoken</li>
<li>패스워드 해싱을 위한 bcryptjs</li>
<li>환경 변수를 관리하는 dotenv</li>
<li>데이터베이스용으로 mongoose</li>
<li>Node.js 서버를 자동으로 재시작하는 nodemon</li>
<li>Cross-Origin Resource Sharing를 활성화하기 위한 cors</li>
</ul>
<p>아래 명령어를 실행하여 이러한 모든 패키지를 설치해주세요:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm install express jsonwebtoken bcryptjs dotenv mongoose nodemon cors
</code></pre>
<h2>3. 환경 변수 설정</h2>
<p>루트 디렉터리에 .env 파일을 만들고 다음 환경 변수를 추가하세요.</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">MONGO_URI</span>=<span class="hljs-string">"mongodb://127.0.0.1/UserAuthSystem"</span> <span class="hljs-comment">// 본인의 정보로 대체해주세요</span>
<span class="hljs-variable constant_">PORT</span>=<span class="hljs-number">5000</span>
<span class="hljs-variable constant_">JWT_SECRET</span>=your_jwt_secret_key
</code></pre>
<div class="content-ad"></div>
<ul>
<li>JWT_SECRET: JWT(JSON Web Token) 비밀 키는 토큰을 서명하고 확인하기 위해 사용되는 문자열입니다. 신뢰할 수 있는 출처에서 발급되었으며 조작되지 않았음을 서버가 확인하여 토큰의 무결성과 신뢰성을 보장합니다. 비밀 키를 문서에 책임을 증명하는 서명이나 봉인과 같다고 생각해보세요.</li>
<li>MONGO_URI: MongoDB URI는 응용 프로그램을 MongoDB 데이터베이스에 연결하는 연결 문자열입니다. 데이터베이스 주소, 포트 번호, 데이터베이스 이름 및 인증 자격 증명과 같은 정보를 포함합니다. 데이터베이스의 소포 주소처럼 생각해보세요. 응용 프로그램이 데이터베이스를 찾고 통신할 수 있도록 하는 것입니다. 사용자는 로컬 및 클라우드 기반 연결 문자열을 모두 사용할 수 있습니다.</li>
</ul>
<p>보안상의 이유로 Node.js 프로젝트의 .env 파일은 민감한 정보가 버전 관리에서 노출되지 않도록 .gitignore 파일에 포함되어야 합니다.</p>
<h2>4. 서버 생성</h2>
<p>server.js라는 파일을 만들어 간단한 Express 서버를 만들어봅시다. 다음 코드를 추가하세요:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-built_in">require</span>(<span class="hljs-string">"dotenv"</span>).<span class="hljs-title function_">config</span>();
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">"cors"</span>);

<span class="hljs-built_in">require</span>(<span class="hljs-string">"./config/db"</span>);

<span class="hljs-comment">//Middlewares</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">5000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SERVER RUNNING ON PORT: <span class="hljs-subst">${PORT}</span>`</span>));
</code></pre>
<p>아래 명령으로 코드를 실행할 수 있습니다:</p>
<pre><code class="hljs language-js">node src/server.<span class="hljs-property">js</span>
</code></pre>
<p>서버를 시작하는 데 nodemon 패키지를 사용할 수도 있습니다. nodemon을 사용하면 파일 변경 후 서버를 다시 시작할 필요가 없습니다.</p>
<div class="content-ad"></div>
<p>저희 package.json 파일의 scripts 섹션을 업데이트해야 합니다:</p>
<pre><code class="hljs language-json"> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node src/server.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nodemon src/server.js"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>이제 다음 명령어를 실행해주세요:</p>
<pre><code class="hljs language-bash">npm run dev
</code></pre>
<div class="content-ad"></div>
<p>터미널에서 포트 5000에서 서버가 실행 중임을 확인해야 해요. 확인되면 좋아요! 우리 서버가 가동 중이에요!</p>
<p><img src="https://miro.medium.com/v2/resize:fit:900/0*0feaPgbIGqHg0vXg.gif" alt="이미지"></p>
<h2>5. 데이터베이스 구성</h2>
<p>데이터베이스로 MongoDB를 사용할 거예요. 데이터베이스 연결을 구성하기 위해 src/config 폴더에 db.js 파일을 생성해주세요.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);
mongoose
  .<span class="hljs-title function_">connect</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGO_URI</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"DATABASE CONNECTED"</span>))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =></span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"DATABASE CONNECTION ERROR"</span>, err);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  });
</code></pre>
<p>URL 'mongodb://127.0.0.1/UserAuthSystem'를 로컬에서 사용할 수 있습니다. 그러나 여기서 온라인 데이터베이스를 생성할 수도 있습니다. 프로젝트를 생성한 다음 클러스터를 만들면 됩니다. 거기서 얻은 URL을 사용하여 자신의 데이터베이스를 사용할 수 있습니다. 양쪽 모두 문제없이 작동합니다.</p>
<h2>6. 모델 생성</h2>
<p>다음으로 src/models/User.js에 User 모델을 생성해보겠습니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);
<span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bcryptjs"</span>);

<span class="hljs-keyword">let</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">username</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span>,
  },
  <span class="hljs-attr">email</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">match</span>: [<span class="hljs-regexp">/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/</span>],
  },
  <span class="hljs-attr">password</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">select</span>: <span class="hljs-literal">false</span>,
  },
  <span class="hljs-attr">created_at</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
  },
});

<span class="hljs-title class_">UserSchema</span>.<span class="hljs-title function_">pre</span>(<span class="hljs-string">"save"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">next</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isModified</span>(<span class="hljs-string">"password"</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();
  }
  <span class="hljs-keyword">const</span> salt = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">genSalt</span>(<span class="hljs-number">10</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span>, salt);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">"user"</span>, <span class="hljs-title class_">UserSchema</span>);
</code></pre>
<ul>
<li>사용자 문서를 저장하기 전에, 사전 저장 후크가 암호가 수정되었는지 확인합니다.</li>
<li>암호가 수정되었으면, bcryptjs를 사용하여 솔트를 생성하고 암호를 해시하여 데이터베이스에 저장합니다.</li>
</ul>
<h2>7. Controllers 만들기</h2>
<p>컨트롤러는 route의 로직을 처리합니다. 이제 src/controllers 폴더에 authController.js를 생성하세요.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bcryptjs"</span>);
<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsonwebtoken"</span>);
<span class="hljs-keyword">const</span> { check, validationResult } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express-validator"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../models/User"</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Login</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">check</span>(<span class="hljs-string">"email"</span>, <span class="hljs-string">"유효한 이메일을 입력해주세요"</span>).<span class="hljs-title function_">isEmail</span>().<span class="hljs-title function_">run</span>(req);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">check</span>(<span class="hljs-string">"password"</span>, <span class="hljs-string">"비밀번호를 입력해주세요"</span>).<span class="hljs-title function_">exists</span>().<span class="hljs-title function_">run</span>(req);

    <span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">validationResult</span>(req);
    <span class="hljs-keyword">if</span> (!errors.<span class="hljs-title function_">isEmpty</span>()) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">errors</span>: errors.<span class="hljs-title function_">array</span>() });
    }

    <span class="hljs-keyword">const</span> { email, password } = req.<span class="hljs-property">body</span>;

    <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>({ email }).<span class="hljs-title function_">select</span>(<span class="hljs-string">"+password"</span>);
    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">msg</span>: <span class="hljs-string">"유효하지 않은 자격 증명"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      });
    }

    <span class="hljs-keyword">const</span> isMatch = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(password, user.<span class="hljs-property">password</span>);
    <span class="hljs-keyword">if</span> (!isMatch) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">msg</span>: <span class="hljs-string">"유효하지 않은 자격 증명"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      });
    }

    jwt.<span class="hljs-title function_">sign</span>(
      { <span class="hljs-attr">id</span>: user.<span class="hljs-property">_id</span> },
      process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span>,
      { <span class="hljs-attr">expiresIn</span>: <span class="hljs-string">"10m"</span> },
      <span class="hljs-function">(<span class="hljs-params">err, token</span>) =></span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
          token,
        });
      }
    );
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span> });
  }
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Register</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">check</span>(<span class="hljs-string">"username"</span>, <span class="hljs-string">"사용자 이름을 입력해주세요"</span>).<span class="hljs-title function_">not</span>().<span class="hljs-title function_">isEmpty</span>().<span class="hljs-title function_">run</span>(req);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">check</span>(<span class="hljs-string">"email"</span>, <span class="hljs-string">"유효한 이메일을 입력해주세요"</span>).<span class="hljs-title function_">isEmail</span>().<span class="hljs-title function_">run</span>(req);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">check</span>(<span class="hljs-string">"password"</span>, <span class="hljs-string">"비밀번호는 6자 이상이어야 합니다"</span>)
      .<span class="hljs-title function_">isLength</span>({ <span class="hljs-attr">min</span>: <span class="hljs-number">6</span> })
      .<span class="hljs-title function_">run</span>(req);

    <span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">validationResult</span>(req);
    <span class="hljs-keyword">if</span> (!errors.<span class="hljs-title function_">isEmpty</span>()) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">errors</span>: errors.<span class="hljs-title function_">array</span>() }); 
    }

    <span class="hljs-keyword">const</span> { username, email, password } = req.<span class="hljs-property">body</span>;

    <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>({ email });
    <span class="hljs-keyword">if</span> (user) { 
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ 
        <span class="hljs-attr">msg</span>: <span class="hljs-string">"이미 등록된 사용자"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      });
    }

    user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>({
      username,
      email,
      password,
    });

    <span class="hljs-keyword">await</span> user.<span class="hljs-title function_">save</span>();

    jwt.<span class="hljs-title function_">sign</span>(
      { <span class="hljs-attr">id</span>: user.<span class="hljs-property">_id</span> },
      process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span>,
      { <span class="hljs-attr">expiresIn</span>: <span class="hljs-number">36000</span> },
      <span class="hljs-function">(<span class="hljs-params">err, token</span>) =></span> {
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
          token,
        });
      }
    );
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span> });
  }
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetUser</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findById</span>(req.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
      user,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    });
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">msg</span>: <span class="hljs-string">"서버 에러"</span> });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-title class_">Login</span>, <span class="hljs-title class_">Register</span>, <span class="hljs-title class_">GetUser</span> };
</code></pre>
<ul>
<li>이 컨트롤러 파일은 로그인, 등록 및 사용자 데이터 가져오기와 같은 핵심 기능을 제공하며, 인증을 위해 JSON Web Token을 활용합니다. 이러한 기능을 라우트에서 사용할 것입니다.</li>
<li>인증 시스템의 로그인 및 등록 부분에서 토큰이 생성됩니다. 이 토큰은 클라이언트로 보내는 응답에 포함됩니다. 인증 검증에 중요한 역할을 합니다. 또한 클라이언트 측에서 토큰은 후속 사용을 위해 쿠키에 저장됩니다.</li>
<li>express-validator npm 패키지를 사용하여 이메일 및 비밀번호가 제공되고 유효한지 확인합니다.</li>
</ul>
<h2>8. 미들웨어 구현</h2>
<p>토큰을 확인하기 위한 미들웨어가 필요합니다. 계속하기 전에 미들웨어가 무엇인지 설명드리겠습니다.</p>
<div class="content-ad"></div>
<ul>
<li>미들웨어는 웹 애플리케이션에서 요청이 최종 라우트 핸들러에 도달하기 전에 처리하는 함수입니다. 인증, 로깅 또는 요청 및 응답 객체 수정과 같은 작업을 처리할 수 있습니다.</li>
<li>미들웨어를 공항의 보안 점검 및 프로세스와 비슷하게 생각해보세요. 비행기를 탑승하기 전에 보안, 세관, 탑승 등 다양한 점검점을 거치는 것처럼 요청도 최종 라우트 핸들러에 도달하기 전에 여러 미들웨어 함수를 거칩니다. 각 미들웨어는 특정 작업을 수행한 다음 요청을 다음 미들웨어로 전달하여 코드를 모듈화하고 재사용 가능하게 만듭니다.</li>
</ul>
<p>우리는 src/middlewares/verifyAuth.js에서 이를 달성합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsonwebtoken"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =></span> {
  <span class="hljs-keyword">const</span> token = req.<span class="hljs-title function_">header</span>(<span class="hljs-string">"x-token"</span>);
  <span class="hljs-keyword">if</span> (!token) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">msg</span>: <span class="hljs-string">"유효한 토큰이 없습니다"</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
    });
  }
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> decoded = jwt.<span class="hljs-title function_">verify</span>(token, process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span>);
    req.<span class="hljs-property">user</span> = decoded;
    <span class="hljs-title function_">next</span>();
  } <span class="hljs-keyword">catch</span> (err) {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">msg</span>: <span class="hljs-string">"유효한 토큰이 없습니다"</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
    });
  }
};
</code></pre>
<ul>
<li>이 코드 스니펫은 x-token으로 할당된 요청 헤더에서 토큰을 확인합니다.</li>
<li>토큰이 유효하면 토큰을 디코드하고 디코딩된 사용자 정보를 req.user에 할당한 다음 next()를 호출하여 제어를 다음 미들웨어 또는 라우트 핸들러로 전달합니다.</li>
</ul>
<div class="content-ad"></div>
<h2>9. 라우트 설정하기</h2>
<p>이제 라우트를 설정해봅시다. src/routes 폴더에 auth.js를 생성하세요.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Login</span>, <span class="hljs-title class_">Register</span>, <span class="hljs-title class_">GetUser</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../controllers/authController"</span>);
<span class="hljs-keyword">const</span> verifyAuth = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../middlewares/verifyAuth"</span>);

<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/login"</span>, <span class="hljs-title class_">Login</span>);

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/register"</span>, <span class="hljs-title class_">Register</span>);

router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/user"</span>, verifyAuth, <span class="hljs-title class_">GetUser</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>또한 server.js 파일을 업데이트하여 라우트를 연결해야 합니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-built_in">require</span>(<span class="hljs-string">"dotenv"</span>).<span class="hljs-title function_">config</span>();
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">"cors"</span>);

<span class="hljs-built_in">require</span>(<span class="hljs-string">"./config/db"</span>);

<span class="hljs-comment">//Middlewares</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// Routes</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">"/"</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">"./routes/auth"</span>));

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =></span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`서버가 포트 <span class="hljs-subst">${PORT}</span>에서 실행 중입니다.`</span>));
</code></pre>
<img src="https://miro.medium.com/v2/resize:fit:960/0*ggZsEOvbfphfI42C.gif">
<h2>10. 서버 테스트하기</h2>
<p>이제 서버를 테스트해보는 시간입니다. 제대로 작동하는지 확인해봅시다.</p>
<div class="content-ad"></div>
<ul>
<li>npm run dev 명령어로 서버를 다시 실행한 후 Postman과 같은 API 플랫폼을 사용하여 /register 및 /login 엔드포인트를 테스트해보세요.</li>
<li>또는 다른 쉬운 방법을 제안할 수도 있어요. VS Code 확장 프로그램인 REST Client를 사용해보세요.</li>
</ul>
<p><img src="/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_1.png" alt="이미지"></p>
<ul>
<li>이 확장 프로그램을 활용하기 위해 .rest 확장자를 가진 파일을 생성해야 해요. 그 파일에 HTTP 메서드를 입력하고 간편하게 요청을 보낼 수 있어요. 이 방법을 사용하여 라우트를 테스트하는 것을 선호한다면 이 방법을 사용할 수도 있어요.</li>
</ul>
<p>다음은 routes.rest 파일 내용입니다.</p>
<div class="content-ad"></div>
<p>POST <a href="http://localhost:3000/login" rel="nofollow" target="_blank">http://localhost:3000/login</a>
Content-Type: application/json</p>
<p>{
"email":"<a href="mailto:test@gmail.com">test@gmail.com</a>",
"password":"123456"
}</p>
<h3></h3>
<p>POST <a href="http://localhost:3000/register" rel="nofollow" target="_blank">http://localhost:3000/register</a>
Content-Type: application/json</p>
<p>{</p>
<pre><code>"email":"test@gmail.com",
"username":"alitalhacoban",
"password":"123456"
</code></pre>
<p>}</p>
<h3></h3>
<p>GET <a href="http://localhost:3000/user" rel="nofollow" target="_blank">http://localhost:3000/user</a>
Content-Type: application/json
x-token:your_access_token</p>
<img src="https://miro.medium.com/v2/resize:fit:990/0*Fl_hEz8V6Z0DRz88.gif">
<p>이 글에서는 간단한 토큰 기반 인증 시스템을 Node.js에서 구축했습니다. 이 설정은 Node.js 애플리케이션에서 안전한 인증을 구현하기 위한 견고한 기반을 제공합니다. Part 2에서는 이 프로젝트의 클라이언트 측을 구축하여 인증용 사용자 인터페이스를 만드는 방법과 서버와의 연결 방법에 대해 살펴볼 것입니다.</p>
<p>이 글이 여러분에게 도움이 되기를 바랍니다. 계속 주시고 이와 같은 내용을 더 원하시면 박수를 치세요! 즐거운 코딩하세요!</p>
<div class="content-ad"></div>
<p>아래 링크를 확인해 보세요.</p>
<ul>
<li><a href="mailto:cobanalitalha@gmail.com">cobanalitalha@gmail.com</a></li>
<li>github.com/carpodok</li>
<li>linkedin.com/alitalhacoban</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"MERN 스택에서 사용자 인증 시스템 이해하기 단계별 안내  파트1 - 서버 사이드","description":"","date":"2024-06-20 04:13","slug":"2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide","content":"\n\n안녕하세요 개발자 여러분! 이 이야기에서는 서버 및 클라이언트 측을 모두 포함한 인증 시스템을 구축할 것입니다. 그러나 이 부분에서는 서버 측만 구축할 것입니다.\n\n이 프로젝트의 레포지토리 링크는 다음과 같습니다. 미리 확인해보세요.\n\n## 목차\n\n- 소개\n- 프로젝트 설정하기\n- 환경 변수 설정하기\n- 데이터베이스 구성하기\n- 모델 생성하기\n- 컨트롤러 구축하기\n- 미들웨어 구현하기\n- 라우트 설정하기\n- 서버 테스트하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 1. 소개\n\n인증은 모든 애플리케이션의 중요한 부분입니다. 사용자가 자신이 주장하는 대로인지 확인하고 그들이 자격이 있는 리소스에 액세스할 수 있도록 보장합니다. 이 안내서에서는 Node.js, Express 및 JWT (JSON Web Tokens)를 사용하여 간단한 토큰 기반 인증 시스템을 구축할 것입니다.\n\n이야기 끝에 프로젝트 폴더 구조는 다음과 같이 보일 것입니다:\n\n![프로젝트 폴더 구조](/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n그럼 시작해보겠습니다!\n\n## 2: 프로젝트 설정\n\n먼저, 프로젝트를 설정해보겠습니다. 터미널을 열고 아래 명령어를 실행해주세요:\n\n```bash\nmkdir user-auth-system\ncd user-auth-system\nmkdir server\nmkdir client\ncd server\nnpm init -y\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n프로젝트 폴더를 만들었는데 서버 및 클라이언트 폴더를 모두 포함하고 있어요. 하지만 클라이언트 쪽은 Part 2에서 만들 거에요. 이제 프로젝트의 서버 쪽에 사용할 필수 패키지를 설치해봐요.\n\n다음 패키지들을 사용할 거에요:\n\n- 서버용으로 express\n- 토큰 처리를 위한 jsonwebtoken\n- 패스워드 해싱을 위한 bcryptjs\n- 환경 변수를 관리하는 dotenv\n- 데이터베이스용으로 mongoose\n- Node.js 서버를 자동으로 재시작하는 nodemon\n- Cross-Origin Resource Sharing를 활성화하기 위한 cors\n\n아래 명령어를 실행하여 이러한 모든 패키지를 설치해주세요:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm install express jsonwebtoken bcryptjs dotenv mongoose nodemon cors\n```\n\n## 3. 환경 변수 설정\n\n루트 디렉터리에 .env 파일을 만들고 다음 환경 변수를 추가하세요.\n\n```js\nMONGO_URI=\"mongodb://127.0.0.1/UserAuthSystem\" // 본인의 정보로 대체해주세요\nPORT=5000\nJWT_SECRET=your_jwt_secret_key\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- JWT_SECRET: JWT(JSON Web Token) 비밀 키는 토큰을 서명하고 확인하기 위해 사용되는 문자열입니다. 신뢰할 수 있는 출처에서 발급되었으며 조작되지 않았음을 서버가 확인하여 토큰의 무결성과 신뢰성을 보장합니다. 비밀 키를 문서에 책임을 증명하는 서명이나 봉인과 같다고 생각해보세요.\n- MONGO_URI: MongoDB URI는 응용 프로그램을 MongoDB 데이터베이스에 연결하는 연결 문자열입니다. 데이터베이스 주소, 포트 번호, 데이터베이스 이름 및 인증 자격 증명과 같은 정보를 포함합니다. 데이터베이스의 소포 주소처럼 생각해보세요. 응용 프로그램이 데이터베이스를 찾고 통신할 수 있도록 하는 것입니다. 사용자는 로컬 및 클라우드 기반 연결 문자열을 모두 사용할 수 있습니다.\n\n보안상의 이유로 Node.js 프로젝트의 .env 파일은 민감한 정보가 버전 관리에서 노출되지 않도록 .gitignore 파일에 포함되어야 합니다.\n\n## 4. 서버 생성\n\nserver.js라는 파일을 만들어 간단한 Express 서버를 만들어봅시다. 다음 코드를 추가하세요:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nrequire(\"dotenv\").config();\nconst express = require(\"express\");\nconst app = express();\nconst cors = require(\"cors\");\n\nrequire(\"./config/db\");\n\n//Middlewares\napp.use(cors());\napp.use(express.json());\n\nconst PORT = process.env.PORT || 5000;\napp.listen(PORT, () =\u003e console.log(`SERVER RUNNING ON PORT: ${PORT}`));\n```\n\n아래 명령으로 코드를 실행할 수 있습니다:\n\n```js\nnode src/server.js\n```\n\n서버를 시작하는 데 nodemon 패키지를 사용할 수도 있습니다. nodemon을 사용하면 파일 변경 후 서버를 다시 시작할 필요가 없습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n저희 package.json 파일의 scripts 섹션을 업데이트해야 합니다:\n\n```json\n \"scripts\": {\n    \"start\": \"node src/server.js\",\n    \"dev\": \"nodemon src/server.js\"\n  },\n```\n\n이제 다음 명령어를 실행해주세요:\n\n```bash\nnpm run dev\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n터미널에서 포트 5000에서 서버가 실행 중임을 확인해야 해요. 확인되면 좋아요! 우리 서버가 가동 중이에요!\n\n![이미지](https://miro.medium.com/v2/resize:fit:900/0*0feaPgbIGqHg0vXg.gif)\n\n## 5. 데이터베이스 구성\n\n데이터베이스로 MongoDB를 사용할 거예요. 데이터베이스 연결을 구성하기 위해 src/config 폴더에 db.js 파일을 생성해주세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nconst mongoose = require(\"mongoose\");\nmongoose\n  .connect(process.env.MONGO_URI)\n  .then(() =\u003e console.log(\"DATABASE CONNECTED\"))\n  .catch((err) =\u003e {\n    console.log(\"DATABASE CONNECTION ERROR\", err);\n    process.exit(1);\n  });\n```\n\nURL 'mongodb://127.0.0.1/UserAuthSystem'를 로컬에서 사용할 수 있습니다. 그러나 여기서 온라인 데이터베이스를 생성할 수도 있습니다. 프로젝트를 생성한 다음 클러스터를 만들면 됩니다. 거기서 얻은 URL을 사용하여 자신의 데이터베이스를 사용할 수 있습니다. 양쪽 모두 문제없이 작동합니다.\n\n## 6. 모델 생성\n\n다음으로 src/models/User.js에 User 모델을 생성해보겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nconst mongoose = require(\"mongoose\");\nconst bcrypt = require(\"bcryptjs\");\n\nlet UserSchema = new mongoose.Schema({\n  username: {\n    type: String,\n    required: true,\n    index: true,\n  },\n  email: {\n    type: String,\n    required: true,\n    unique: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/],\n  },\n  password: {\n    type: String,\n    required: true,\n    select: false,\n  },\n  created_at: {\n    type: String,\n  },\n});\n\nUserSchema.pre(\"save\", async function (next) {\n  if (!this.isModified(\"password\")) {\n    return next();\n  }\n  const salt = await bcrypt.genSalt(10);\n  this.password = await bcrypt.hash(this.password, salt);\n  next();\n});\n\nmodule.exports = mongoose.model(\"user\", UserSchema);\n```\n\n- 사용자 문서를 저장하기 전에, 사전 저장 후크가 암호가 수정되었는지 확인합니다.\n- 암호가 수정되었으면, bcryptjs를 사용하여 솔트를 생성하고 암호를 해시하여 데이터베이스에 저장합니다.\n\n## 7. Controllers 만들기\n\n컨트롤러는 route의 로직을 처리합니다. 이제 src/controllers 폴더에 authController.js를 생성하세요.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nconst bcrypt = require(\"bcryptjs\");\nconst jwt = require(\"jsonwebtoken\");\nconst { check, validationResult } = require(\"express-validator\");\n\nconst User = require(\"../models/User\");\n\nasync function Login(req, res) {\n  try {\n    await check(\"email\", \"유효한 이메일을 입력해주세요\").isEmail().run(req);\n    await check(\"password\", \"비밀번호를 입력해주세요\").exists().run(req);\n\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() });\n    }\n\n    const { email, password } = req.body;\n\n    let user = await User.findOne({ email }).select(\"+password\");\n    if (!user) {\n      return res.status(400).json({\n        msg: \"유효하지 않은 자격 증명\",\n        success: false,\n      });\n    }\n\n    const isMatch = await bcrypt.compare(password, user.password);\n    if (!isMatch) {\n      return res.status(400).json({\n        msg: \"유효하지 않은 자격 증명\",\n        success: false,\n      });\n    }\n\n    jwt.sign(\n      { id: user._id },\n      process.env.JWT_SECRET,\n      { expiresIn: \"10m\" },\n      (err, token) =\u003e {\n        if (err) throw err;\n        res.status(200).json({\n          token,\n        });\n      }\n    );\n  } catch (err) {\n    console.log(err);\n    res.status(400).json({ success: false });\n  }\n}\n\nasync function Register(req, res) {\n  try {\n    await check(\"username\", \"사용자 이름을 입력해주세요\").not().isEmpty().run(req);\n    await check(\"email\", \"유효한 이메일을 입력해주세요\").isEmail().run(req);\n    await check(\"password\", \"비밀번호는 6자 이상이어야 합니다\")\n      .isLength({ min: 6 })\n      .run(req);\n\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({ errors: errors.array() }); \n    }\n\n    const { username, email, password } = req.body;\n\n    let user = await User.findOne({ email });\n    if (user) { \n      return res.status(400).json({ \n        msg: \"이미 등록된 사용자\",\n        success: false,\n      });\n    }\n\n    user = new User({\n      username,\n      email,\n      password,\n    });\n\n    await user.save();\n\n    jwt.sign(\n      { id: user._id },\n      process.env.JWT_SECRET,\n      { expiresIn: 36000 },\n      (err, token) =\u003e {\n        if (err) throw err;\n        res.status(200).json({\n          token,\n        });\n      }\n    );\n  } catch (err) {\n    console.log(err);\n    res.status(400).json({ success: false });\n  }\n}\n\nasync function GetUser(req, res) {\n  try {\n    const user = await User.findById(req.user.id);\n    res.status(200).json({\n      user,\n      success: true,\n    });\n  } catch (err) {\n    console.error(err.message);\n    res.status(500).json({ msg: \"서버 에러\" });\n  }\n}\n\nmodule.exports = { Login, Register, GetUser };\n``` \n\n- 이 컨트롤러 파일은 로그인, 등록 및 사용자 데이터 가져오기와 같은 핵심 기능을 제공하며, 인증을 위해 JSON Web Token을 활용합니다. 이러한 기능을 라우트에서 사용할 것입니다.\n- 인증 시스템의 로그인 및 등록 부분에서 토큰이 생성됩니다. 이 토큰은 클라이언트로 보내는 응답에 포함됩니다. 인증 검증에 중요한 역할을 합니다. 또한 클라이언트 측에서 토큰은 후속 사용을 위해 쿠키에 저장됩니다.\n- express-validator npm 패키지를 사용하여 이메일 및 비밀번호가 제공되고 유효한지 확인합니다.\n\n## 8. 미들웨어 구현\n\n토큰을 확인하기 위한 미들웨어가 필요합니다. 계속하기 전에 미들웨어가 무엇인지 설명드리겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 미들웨어는 웹 애플리케이션에서 요청이 최종 라우트 핸들러에 도달하기 전에 처리하는 함수입니다. 인증, 로깅 또는 요청 및 응답 객체 수정과 같은 작업을 처리할 수 있습니다.\n- 미들웨어를 공항의 보안 점검 및 프로세스와 비슷하게 생각해보세요. 비행기를 탑승하기 전에 보안, 세관, 탑승 등 다양한 점검점을 거치는 것처럼 요청도 최종 라우트 핸들러에 도달하기 전에 여러 미들웨어 함수를 거칩니다. 각 미들웨어는 특정 작업을 수행한 다음 요청을 다음 미들웨어로 전달하여 코드를 모듈화하고 재사용 가능하게 만듭니다.\n\n우리는 src/middlewares/verifyAuth.js에서 이를 달성합니다.\n\n```js\nconst jwt = require(\"jsonwebtoken\");\nmodule.exports = (req, res, next) =\u003e {\n  const token = req.header(\"x-token\");\n  if (!token) {\n    return res.status(401).json({\n      msg: \"유효한 토큰이 없습니다\",\n      success: false,\n    });\n  }\n  try {\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    req.user = decoded;\n    next();\n  } catch (err) {\n    res.status(400).json({\n      msg: \"유효한 토큰이 없습니다\",\n      success: false,\n    });\n  }\n};\n```\n\n- 이 코드 스니펫은 x-token으로 할당된 요청 헤더에서 토큰을 확인합니다.\n- 토큰이 유효하면 토큰을 디코드하고 디코딩된 사용자 정보를 req.user에 할당한 다음 next()를 호출하여 제어를 다음 미들웨어 또는 라우트 핸들러로 전달합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 9. 라우트 설정하기\n\n이제 라우트를 설정해봅시다. src/routes 폴더에 auth.js를 생성하세요.\n\n```js\nconst express = require(\"express\");\nconst { Login, Register, GetUser } = require(\"../controllers/authController\");\nconst verifyAuth = require(\"../middlewares/verifyAuth\");\n\nconst router = express.Router();\n\nrouter.post(\"/login\", Login);\n\nrouter.post(\"/register\", Register);\n\nrouter.get(\"/user\", verifyAuth, GetUser);\n\nmodule.exports = router;\n```\n\n또한 server.js 파일을 업데이트하여 라우트를 연결해야 합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nrequire(\"dotenv\").config();\nconst express = require(\"express\");\nconst app = express();\nconst cors = require(\"cors\");\n\nrequire(\"./config/db\");\n\n//Middlewares\napp.use(cors());\napp.use(express.json());\n\n// Routes\napp.use(\"/\", require(\"./routes/auth\"));\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () =\u003e console.log(`서버가 포트 ${PORT}에서 실행 중입니다.`));\n```\n\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:960/0*ggZsEOvbfphfI42C.gif\" /\u003e\n\n## 10. 서버 테스트하기\n\n이제 서버를 테스트해보는 시간입니다. 제대로 작동하는지 확인해봅시다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- npm run dev 명령어로 서버를 다시 실행한 후 Postman과 같은 API 플랫폼을 사용하여 /register 및 /login 엔드포인트를 테스트해보세요.\n- 또는 다른 쉬운 방법을 제안할 수도 있어요. VS Code 확장 프로그램인 REST Client를 사용해보세요.\n\n![이미지](/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_1.png)\n\n- 이 확장 프로그램을 활용하기 위해 .rest 확장자를 가진 파일을 생성해야 해요. 그 파일에 HTTP 메서드를 입력하고 간편하게 요청을 보낼 수 있어요. 이 방법을 사용하여 라우트를 테스트하는 것을 선호한다면 이 방법을 사용할 수도 있어요.\n\n다음은 routes.rest 파일 내용입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\nPOST http://localhost:3000/login\nContent-Type: application/json\n\n{\n    \"email\":\"test@gmail.com\",\n    \"password\":\"123456\"\n}\n\n###\n\nPOST http://localhost:3000/register\nContent-Type: application/json\n\n{\n    \n    \"email\":\"test@gmail.com\",\n    \"username\":\"alitalhacoban\",\n    \"password\":\"123456\"\n}\n\n###\n\nGET http://localhost:3000/user\nContent-Type: application/json\nx-token:your_access_token\n\n\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:990/0*Fl_hEz8V6Z0DRz88.gif\" /\u003e\n\n이 글에서는 간단한 토큰 기반 인증 시스템을 Node.js에서 구축했습니다. 이 설정은 Node.js 애플리케이션에서 안전한 인증을 구현하기 위한 견고한 기반을 제공합니다. Part 2에서는 이 프로젝트의 클라이언트 측을 구축하여 인증용 사용자 인터페이스를 만드는 방법과 서버와의 연결 방법에 대해 살펴볼 것입니다.\n\n이 글이 여러분에게 도움이 되기를 바랍니다. 계속 주시고 이와 같은 내용을 더 원하시면 박수를 치세요! 즐거운 코딩하세요!\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래 링크를 확인해 보세요.\n\n- cobanalitalha@gmail.com\n- github.com/carpodok\n- linkedin.com/alitalhacoban","ogImage":{"url":"/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png"},"coverImage":"/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png","tag":["Tech"],"readingTime":11},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e안녕하세요 개발자 여러분! 이 이야기에서는 서버 및 클라이언트 측을 모두 포함한 인증 시스템을 구축할 것입니다. 그러나 이 부분에서는 서버 측만 구축할 것입니다.\u003c/p\u003e\n\u003cp\u003e이 프로젝트의 레포지토리 링크는 다음과 같습니다. 미리 확인해보세요.\u003c/p\u003e\n\u003ch2\u003e목차\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e소개\u003c/li\u003e\n\u003cli\u003e프로젝트 설정하기\u003c/li\u003e\n\u003cli\u003e환경 변수 설정하기\u003c/li\u003e\n\u003cli\u003e데이터베이스 구성하기\u003c/li\u003e\n\u003cli\u003e모델 생성하기\u003c/li\u003e\n\u003cli\u003e컨트롤러 구축하기\u003c/li\u003e\n\u003cli\u003e미들웨어 구현하기\u003c/li\u003e\n\u003cli\u003e라우트 설정하기\u003c/li\u003e\n\u003cli\u003e서버 테스트하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e1. 소개\u003c/h2\u003e\n\u003cp\u003e인증은 모든 애플리케이션의 중요한 부분입니다. 사용자가 자신이 주장하는 대로인지 확인하고 그들이 자격이 있는 리소스에 액세스할 수 있도록 보장합니다. 이 안내서에서는 Node.js, Express 및 JWT (JSON Web Tokens)를 사용하여 간단한 토큰 기반 인증 시스템을 구축할 것입니다.\u003c/p\u003e\n\u003cp\u003e이야기 끝에 프로젝트 폴더 구조는 다음과 같이 보일 것입니다:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_0.png\" alt=\"프로젝트 폴더 구조\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e그럼 시작해보겠습니다!\u003c/p\u003e\n\u003ch2\u003e2: 프로젝트 설정\u003c/h2\u003e\n\u003cp\u003e먼저, 프로젝트를 설정해보겠습니다. 터미널을 열고 아래 명령어를 실행해주세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e user-auth-system\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e user-auth-system\n\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e server\n\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e client\n\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e server\nnpm init -y\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e프로젝트 폴더를 만들었는데 서버 및 클라이언트 폴더를 모두 포함하고 있어요. 하지만 클라이언트 쪽은 Part 2에서 만들 거에요. 이제 프로젝트의 서버 쪽에 사용할 필수 패키지를 설치해봐요.\u003c/p\u003e\n\u003cp\u003e다음 패키지들을 사용할 거에요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e서버용으로 express\u003c/li\u003e\n\u003cli\u003e토큰 처리를 위한 jsonwebtoken\u003c/li\u003e\n\u003cli\u003e패스워드 해싱을 위한 bcryptjs\u003c/li\u003e\n\u003cli\u003e환경 변수를 관리하는 dotenv\u003c/li\u003e\n\u003cli\u003e데이터베이스용으로 mongoose\u003c/li\u003e\n\u003cli\u003eNode.js 서버를 자동으로 재시작하는 nodemon\u003c/li\u003e\n\u003cli\u003eCross-Origin Resource Sharing를 활성화하기 위한 cors\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e아래 명령어를 실행하여 이러한 모든 패키지를 설치해주세요:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm install express jsonwebtoken bcryptjs dotenv mongoose nodemon cors\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 환경 변수 설정\u003c/h2\u003e\n\u003cp\u003e루트 디렉터리에 .env 파일을 만들고 다음 환경 변수를 추가하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable constant_\"\u003eMONGO_URI\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"mongodb://127.0.0.1/UserAuthSystem\"\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// 본인의 정보로 대체해주세요\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e\n\u003cspan class=\"hljs-variable constant_\"\u003eJWT_SECRET\u003c/span\u003e=your_jwt_secret_key\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eJWT_SECRET: JWT(JSON Web Token) 비밀 키는 토큰을 서명하고 확인하기 위해 사용되는 문자열입니다. 신뢰할 수 있는 출처에서 발급되었으며 조작되지 않았음을 서버가 확인하여 토큰의 무결성과 신뢰성을 보장합니다. 비밀 키를 문서에 책임을 증명하는 서명이나 봉인과 같다고 생각해보세요.\u003c/li\u003e\n\u003cli\u003eMONGO_URI: MongoDB URI는 응용 프로그램을 MongoDB 데이터베이스에 연결하는 연결 문자열입니다. 데이터베이스 주소, 포트 번호, 데이터베이스 이름 및 인증 자격 증명과 같은 정보를 포함합니다. 데이터베이스의 소포 주소처럼 생각해보세요. 응용 프로그램이 데이터베이스를 찾고 통신할 수 있도록 하는 것입니다. 사용자는 로컬 및 클라우드 기반 연결 문자열을 모두 사용할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e보안상의 이유로 Node.js 프로젝트의 .env 파일은 민감한 정보가 버전 관리에서 노출되지 않도록 .gitignore 파일에 포함되어야 합니다.\u003c/p\u003e\n\u003ch2\u003e4. 서버 생성\u003c/h2\u003e\n\u003cp\u003eserver.js라는 파일을 만들어 간단한 Express 서버를 만들어봅시다. 다음 코드를 추가하세요:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"dotenv\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003econfig\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"express\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cors = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"cors\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"./config/db\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e//Middlewares\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecors\u003c/span\u003e());\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(express.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e());\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ePORT\u003c/span\u003e || \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e;\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`SERVER RUNNING ON PORT: \u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e`\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e아래 명령으로 코드를 실행할 수 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enode src/server.\u003cspan class=\"hljs-property\"\u003ejs\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e서버를 시작하는 데 nodemon 패키지를 사용할 수도 있습니다. nodemon을 사용하면 파일 변경 후 서버를 다시 시작할 필요가 없습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e저희 package.json 파일의 scripts 섹션을 업데이트해야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e \u003cspan class=\"hljs-attr\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"node src/server.js\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003e\"dev\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"nodemon src/server.js\"\u003c/span\u003e\n  \u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 다음 명령어를 실행해주세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm run dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e터미널에서 포트 5000에서 서버가 실행 중임을 확인해야 해요. 확인되면 좋아요! 우리 서버가 가동 중이에요!\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://miro.medium.com/v2/resize:fit:900/0*0feaPgbIGqHg0vXg.gif\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch2\u003e5. 데이터베이스 구성\u003c/h2\u003e\n\u003cp\u003e데이터베이스로 MongoDB를 사용할 거예요. 데이터베이스 연결을 구성하기 위해 src/config 폴더에 db.js 파일을 생성해주세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mongoose = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"mongoose\"\u003c/span\u003e);\nmongoose\n  .\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eMONGO_URI\u003c/span\u003e)\n  .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"DATABASE CONNECTED\"\u003c/span\u003e))\n  .\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"DATABASE CONNECTION ERROR\"\u003c/span\u003e, err);\n    process.\u003cspan class=\"hljs-title function_\"\u003eexit\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  });\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eURL 'mongodb://127.0.0.1/UserAuthSystem'를 로컬에서 사용할 수 있습니다. 그러나 여기서 온라인 데이터베이스를 생성할 수도 있습니다. 프로젝트를 생성한 다음 클러스터를 만들면 됩니다. 거기서 얻은 URL을 사용하여 자신의 데이터베이스를 사용할 수 있습니다. 양쪽 모두 문제없이 작동합니다.\u003c/p\u003e\n\u003ch2\u003e6. 모델 생성\u003c/h2\u003e\n\u003cp\u003e다음으로 src/models/User.js에 User 모델을 생성해보겠습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mongoose = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"mongoose\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bcrypt = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"bcryptjs\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUserSchema\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e mongoose.\u003cspan class=\"hljs-title class_\"\u003eSchema\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003erequired\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eindex\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-attr\"\u003eemail\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003erequired\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eunique\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ematch\u003c/span\u003e: [\u003cspan class=\"hljs-regexp\"\u003e/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/\u003c/span\u003e],\n  },\n  \u003cspan class=\"hljs-attr\"\u003epassword\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003erequired\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eselect\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-attr\"\u003ecreated_at\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n  },\n});\n\n\u003cspan class=\"hljs-title class_\"\u003eUserSchema\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epre\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"save\"\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003enext\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eisModified\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e)) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e();\n  }\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e salt = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e bcrypt.\u003cspan class=\"hljs-title function_\"\u003egenSalt\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e);\n  \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e bcrypt.\u003cspan class=\"hljs-title function_\"\u003ehash\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e, salt);\n  \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e();\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = mongoose.\u003cspan class=\"hljs-title function_\"\u003emodel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"user\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eUserSchema\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e사용자 문서를 저장하기 전에, 사전 저장 후크가 암호가 수정되었는지 확인합니다.\u003c/li\u003e\n\u003cli\u003e암호가 수정되었으면, bcryptjs를 사용하여 솔트를 생성하고 암호를 해시하여 데이터베이스에 저장합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e7. Controllers 만들기\u003c/h2\u003e\n\u003cp\u003e컨트롤러는 route의 로직을 처리합니다. 이제 src/controllers 폴더에 authController.js를 생성하세요.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bcrypt = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"bcryptjs\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e jwt = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"jsonwebtoken\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { check, validationResult } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"express-validator\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"../models/User\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eLogin\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003echeck\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"유효한 이메일을 입력해주세요\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eisEmail\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(req);\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003echeck\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"비밀번호를 입력해주세요\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eexists\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(req);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e errors = \u003cspan class=\"hljs-title function_\"\u003evalidationResult\u003c/span\u003e(req);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!errors.\u003cspan class=\"hljs-title function_\"\u003eisEmpty\u003c/span\u003e()) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eerrors\u003c/span\u003e: errors.\u003cspan class=\"hljs-title function_\"\u003earray\u003c/span\u003e() });\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { email, password } = req.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e({ email }).\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"+password\"\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!user) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"유효하지 않은 자격 증명\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      });\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isMatch = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e bcrypt.\u003cspan class=\"hljs-title function_\"\u003ecompare\u003c/span\u003e(password, user.\u003cspan class=\"hljs-property\"\u003epassword\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!isMatch) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"유효하지 않은 자격 증명\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      });\n    }\n\n    jwt.\u003cspan class=\"hljs-title function_\"\u003esign\u003c/span\u003e(\n      { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003e_id\u003c/span\u003e },\n      process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eJWT_SECRET\u003c/span\u003e,\n      { \u003cspan class=\"hljs-attr\"\u003eexpiresIn\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"10m\"\u003c/span\u003e },\n      \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr, token\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n        res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n          token,\n        });\n      }\n    );\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (err) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(err);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e });\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eRegister\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003echeck\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"username\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"사용자 이름을 입력해주세요\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003enot\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eisEmpty\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(req);\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003echeck\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"email\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"유효한 이메일을 입력해주세요\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eisEmail\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(req);\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003echeck\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"password\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"비밀번호는 6자 이상이어야 합니다\"\u003c/span\u003e)\n      .\u003cspan class=\"hljs-title function_\"\u003eisLength\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e })\n      .\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(req);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e errors = \u003cspan class=\"hljs-title function_\"\u003evalidationResult\u003c/span\u003e(req);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!errors.\u003cspan class=\"hljs-title function_\"\u003eisEmpty\u003c/span\u003e()) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eerrors\u003c/span\u003e: errors.\u003cspan class=\"hljs-title function_\"\u003earray\u003c/span\u003e() }); \n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { username, email, password } = req.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e({ email });\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (user) { \n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \n        \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"이미 등록된 사용자\"\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n      });\n    }\n\n    user = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e({\n      username,\n      email,\n      password,\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e user.\u003cspan class=\"hljs-title function_\"\u003esave\u003c/span\u003e();\n\n    jwt.\u003cspan class=\"hljs-title function_\"\u003esign\u003c/span\u003e(\n      { \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003e_id\u003c/span\u003e },\n      process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eJWT_SECRET\u003c/span\u003e,\n      { \u003cspan class=\"hljs-attr\"\u003eexpiresIn\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e36000\u003c/span\u003e },\n      \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr, token\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n        res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n          token,\n        });\n      }\n    );\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (err) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(err);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e });\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eGetUser\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindById\u003c/span\u003e(req.\u003cspan class=\"hljs-property\"\u003euser\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n      user,\n      \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    });\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (err) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(err.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"서버 에러\"\u003c/span\u003e });\n  }\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = { \u003cspan class=\"hljs-title class_\"\u003eLogin\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRegister\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eGetUser\u003c/span\u003e };\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e이 컨트롤러 파일은 로그인, 등록 및 사용자 데이터 가져오기와 같은 핵심 기능을 제공하며, 인증을 위해 JSON Web Token을 활용합니다. 이러한 기능을 라우트에서 사용할 것입니다.\u003c/li\u003e\n\u003cli\u003e인증 시스템의 로그인 및 등록 부분에서 토큰이 생성됩니다. 이 토큰은 클라이언트로 보내는 응답에 포함됩니다. 인증 검증에 중요한 역할을 합니다. 또한 클라이언트 측에서 토큰은 후속 사용을 위해 쿠키에 저장됩니다.\u003c/li\u003e\n\u003cli\u003eexpress-validator npm 패키지를 사용하여 이메일 및 비밀번호가 제공되고 유효한지 확인합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e8. 미들웨어 구현\u003c/h2\u003e\n\u003cp\u003e토큰을 확인하기 위한 미들웨어가 필요합니다. 계속하기 전에 미들웨어가 무엇인지 설명드리겠습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e미들웨어는 웹 애플리케이션에서 요청이 최종 라우트 핸들러에 도달하기 전에 처리하는 함수입니다. 인증, 로깅 또는 요청 및 응답 객체 수정과 같은 작업을 처리할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e미들웨어를 공항의 보안 점검 및 프로세스와 비슷하게 생각해보세요. 비행기를 탑승하기 전에 보안, 세관, 탑승 등 다양한 점검점을 거치는 것처럼 요청도 최종 라우트 핸들러에 도달하기 전에 여러 미들웨어 함수를 거칩니다. 각 미들웨어는 특정 작업을 수행한 다음 요청을 다음 미들웨어로 전달하여 코드를 모듈화하고 재사용 가능하게 만듭니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e우리는 src/middlewares/verifyAuth.js에서 이를 달성합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e jwt = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"jsonwebtoken\"\u003c/span\u003e);\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res, next\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e token = req.\u003cspan class=\"hljs-title function_\"\u003eheader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"x-token\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!token) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"유효한 토큰이 없습니다\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    });\n  }\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e decoded = jwt.\u003cspan class=\"hljs-title function_\"\u003everify\u003c/span\u003e(token, process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eJWT_SECRET\u003c/span\u003e);\n    req.\u003cspan class=\"hljs-property\"\u003euser\u003c/span\u003e = decoded;\n    \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e();\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (err) {\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003emsg\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"유효한 토큰이 없습니다\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n    });\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e이 코드 스니펫은 x-token으로 할당된 요청 헤더에서 토큰을 확인합니다.\u003c/li\u003e\n\u003cli\u003e토큰이 유효하면 토큰을 디코드하고 디코딩된 사용자 정보를 req.user에 할당한 다음 next()를 호출하여 제어를 다음 미들웨어 또는 라우트 핸들러로 전달합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e9. 라우트 설정하기\u003c/h2\u003e\n\u003cp\u003e이제 라우트를 설정해봅시다. src/routes 폴더에 auth.js를 생성하세요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"express\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eLogin\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRegister\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eGetUser\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"../controllers/authController\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e verifyAuth = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"../middlewares/verifyAuth\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = express.\u003cspan class=\"hljs-title class_\"\u003eRouter\u003c/span\u003e();\n\nrouter.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/login\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eLogin\u003c/span\u003e);\n\nrouter.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/register\"\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRegister\u003c/span\u003e);\n\nrouter.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/user\"\u003c/span\u003e, verifyAuth, \u003cspan class=\"hljs-title class_\"\u003eGetUser\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e또한 server.js 파일을 업데이트하여 라우트를 연결해야 합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"dotenv\"\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003econfig\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"express\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cors = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"cors\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"./config/db\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e//Middlewares\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecors\u003c/span\u003e());\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(express.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e());\n\n\u003cspan class=\"hljs-comment\"\u003e// Routes\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/\"\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"./routes/auth\"\u003c/span\u003e));\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ePORT\u003c/span\u003e || \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`서버가 포트 \u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e에서 실행 중입니다.`\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:960/0*ggZsEOvbfphfI42C.gif\"\u003e\n\u003ch2\u003e10. 서버 테스트하기\u003c/h2\u003e\n\u003cp\u003e이제 서버를 테스트해보는 시간입니다. 제대로 작동하는지 확인해봅시다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003enpm run dev 명령어로 서버를 다시 실행한 후 Postman과 같은 API 플랫폼을 사용하여 /register 및 /login 엔드포인트를 테스트해보세요.\u003c/li\u003e\n\u003cli\u003e또는 다른 쉬운 방법을 제안할 수도 있어요. VS Code 확장 프로그램인 REST Client를 사용해보세요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e이 확장 프로그램을 활용하기 위해 .rest 확장자를 가진 파일을 생성해야 해요. 그 파일에 HTTP 메서드를 입력하고 간편하게 요청을 보낼 수 있어요. 이 방법을 사용하여 라우트를 테스트하는 것을 선호한다면 이 방법을 사용할 수도 있어요.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e다음은 routes.rest 파일 내용입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003ePOST \u003ca href=\"http://localhost:3000/login\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:3000/login\u003c/a\u003e\nContent-Type: application/json\u003c/p\u003e\n\u003cp\u003e{\n\"email\":\"\u003ca href=\"mailto:test@gmail.com\"\u003etest@gmail.com\u003c/a\u003e\",\n\"password\":\"123456\"\n}\u003c/p\u003e\n\u003ch3\u003e\u003c/h3\u003e\n\u003cp\u003ePOST \u003ca href=\"http://localhost:3000/register\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:3000/register\u003c/a\u003e\nContent-Type: application/json\u003c/p\u003e\n\u003cp\u003e{\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"email\":\"test@gmail.com\",\n\"username\":\"alitalhacoban\",\n\"password\":\"123456\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e}\u003c/p\u003e\n\u003ch3\u003e\u003c/h3\u003e\n\u003cp\u003eGET \u003ca href=\"http://localhost:3000/user\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:3000/user\u003c/a\u003e\nContent-Type: application/json\nx-token:your_access_token\u003c/p\u003e\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:990/0*Fl_hEz8V6Z0DRz88.gif\"\u003e\n\u003cp\u003e이 글에서는 간단한 토큰 기반 인증 시스템을 Node.js에서 구축했습니다. 이 설정은 Node.js 애플리케이션에서 안전한 인증을 구현하기 위한 견고한 기반을 제공합니다. Part 2에서는 이 프로젝트의 클라이언트 측을 구축하여 인증용 사용자 인터페이스를 만드는 방법과 서버와의 연결 방법에 대해 살펴볼 것입니다.\u003c/p\u003e\n\u003cp\u003e이 글이 여러분에게 도움이 되기를 바랍니다. 계속 주시고 이와 같은 내용을 더 원하시면 박수를 치세요! 즐거운 코딩하세요!\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e아래 링크를 확인해 보세요.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"mailto:cobanalitalha@gmail.com\"\u003ecobanalitalha@gmail.com\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003egithub.com/carpodok\u003c/li\u003e\n\u003cli\u003elinkedin.com/alitalhacoban\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-UnderstandingUserAuthenticationSystemtheMERNStackAStep-by-StepGuidePart1-ServerSide"},"buildId":"OFpTzInQeZKWBaqJEukNX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>