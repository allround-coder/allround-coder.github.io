<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB" data-gatsby-head="true"/><meta name="twitter:title" content="Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-14 13:33" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_buildManifest.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 14, 2024</span><span class="posts_reading_time__f7YPP">6<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>요즘의 디지털 세계에서는 보안이 매우 중요합니다. 특히 사용자 인증 프로세스에서 보안을 강화하는 일반적인 방법 중 하나는 일회용 비밀번호(OTP) 확인입니다. OTP는 사용자가 자격 증명과 함께 입력해야 하는 고유한 코드를 생성하여 보안의 추가적인 계층을 더합니다. 이 튜토리얼에서는 Node.js와 MongoDB를 사용하여 OTP 확인 시스템을 구축하는 과정을 단계별로 안내하겠습니다.</p>
<p><img src="/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png" alt="이미지"></p>
<h1>저와 소통하기:</h1>
<p>Linkedin: <a href="https://www.linkedin.com/in/suneel-kumar-52164625a/" rel="nofollow" target="_blank">링크</a></p>
<p>사전 준비 사항: 구현에 들어가기 전에 다음을 설치했는지 확인하세요:</p>
<ul>
<li>Node.js: 시스템에 Node.js가 설치되어 있는지 확인하세요. 공식 Node.js 웹사이트에서 다운로드할 수 있습니다.</li>
<li>MongoDB: 사용자 데이터 및 OTP 정보를 저장할 MongoDB를 설치하세요. 공식 MongoDB 웹사이트에서 다운로드할 수 있습니다.</li>
<li>텍스트 편집기: 원하는 텍스트 편집기나 IDE를 선택하세요. VS Code, Sublime Text 또는 Atom이 인기 있는 선택지입니다.</li>
</ul>
<p>프로젝트 설정: 프로젝트 디렉토리를 설정하고 필요한 종속성을 설치하는 것으로 시작해봅시다. 터미널을 열고 다음 단계를 따르세요:</p>
<ul>
<li>프로젝트용 새 디렉토리를 만드세요:</li>
</ul>
<pre><code class="hljs language-js">mkdir otp-verification-system
cd otp-verification-system
</code></pre>
<p>새로운 Node.js 프로젝트를 초기화하세요:</p>
<pre><code class="hljs language-js">npm init -y
</code></pre>
<p>필요한 종속성을 설치하세요:</p>
<pre><code class="hljs language-js">npm install express mongoose twilio dotenv body-parser
</code></pre>
<ul>
<li>express: 웹 서버를 만들기 위해 사용됩니다.</li>
<li>mongoose: MongoDB와 상호 작용하기 위해 사용됩니다.</li>
<li>twilio: SMS를 통해 OTP를 전송하는 데 사용됩니다.</li>
<li>dotenv: 환경 변수를 관리하기 위해 사용됩니다.</li>
<li>body-parser: 들어오는 요청 본문을 구문 분석하기 위한 미들웨어입니다.</li>
</ul>
<p>이제 프로젝트가 설정되었으므로 OTP 인증 시스템을 구축할 차례입니다.</p>
<p>MongoDB 설정: 먼저 MongoDB 데이터베이스를 설정해보겠습니다. 프로젝트 디렉토리에 db.js라는 파일을 생성하고 다음 코드를 추가하세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
    mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">'mongodb://localhost/otp_verification'</span>, {
      <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">useUnifiedTopology</span>: <span class="hljs-literal">true</span>,
    });

    <span class="hljs-keyword">const</span> db = mongoose.<span class="hljs-property">connection</span>;

    db.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-params">error</span> =></span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'MongoDB 연결 오류:'</span>, error);
      <span class="hljs-title function_">reject</span>(error);
    });

    db.<span class="hljs-title function_">once</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">() =></span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MongoDB에 연결되었습니다'</span>);
      <span class="hljs-title function_">resolve</span>();
    });
  });
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { connect };
</code></pre>
<p>이 코드는 로컬 MongoDB 인스턴스에 연결하고 otp_verification이라는 이름의 데이터베이스를 생성합니다.</p>
<p>사용자 모델 생성: 이제 사용자 정보를 저장할 사용자 모델을 만들어 봅시다. models/User.js 파일을 생성하고 다음 코드를 추가하세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">phone</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">otp</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">otpExpiration</span>: <span class="hljs-title class_">Date</span>,
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">'User'</span>, userSchema);
</code></pre>
<p>이 스키마는 MongoDB의 사용자 문서 구조를 정의합니다. 여기에는 사용자 이름, 전화번호, OTP 및 OTP 만료 시간 필드가 포함됩니다.</p>
<p>OTP 생성 및 전송: 이제 SMS를 통해 OTP를 생성하고 전송하는 로직을 만들어 봅시다. 이를 위해 Twilio API를 사용하겠습니다. utils/otp.js라는 파일을 만들고 다음 코드를 추가하세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> twilio = <span class="hljs-built_in">require</span>(<span class="hljs-string">'twilio'</span>);
<span class="hljs-keyword">const</span> dotenv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>);

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> accountSid = process.<span class="hljs-property">env</span>.<span class="hljs-property">TWILIO_ACCOUNT_SID</span>;
<span class="hljs-keyword">const</span> authToken = process.<span class="hljs-property">env</span>.<span class="hljs-property">TWILIO_AUTH_TOKEN</span>;
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title function_">twilio</span>(accountSid, authToken);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendOTP</span>(<span class="hljs-params">phone, otp</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> message = <span class="hljs-keyword">await</span> client.<span class="hljs-property">messages</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">body</span>: <span class="hljs-string">`Your OTP is: <span class="hljs-subst">${otp}</span>`</span>,
      <span class="hljs-attr">from</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TWILIO_PHONE_NUMBER</span>,
      <span class="hljs-attr">to</span>: phone,
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`OTP sent to <span class="hljs-subst">${phone}</span>: <span class="hljs-subst">${message.sid}</span>`</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error sending OTP:'</span>, error);
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { sendOTP };
</code></pre>
<p>Twilio 계정을 설정하고 필요한 자격 증명(Account SID, Auth Token 및 전화번호)을 얻었는지 확인하십시오. 이 정보는 .env 파일에 저장되어야 합니다.</p>
<p>OTP 인증 엔드포인트 구현하기: 이제 OTP 인증을 처리하는 엔드포인트를 만들어 봅시다. routes/auth.js라는 파일을 만들고 아래 코드를 추가해주세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/User'</span>);
<span class="hljs-keyword">const</span> { sendOTP } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils/otp'</span>);
<span class="hljs-keyword">const</span> {randomInt} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>)

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/sendotp'</span>, <span class="hljs-keyword">async</span> (req, res) => {
  <span class="hljs-keyword">const</span> { phone } = req.<span class="hljs-property">body</span>;

  <span class="hljs-comment">// 6자리 OTP 생성</span>
  <span class="hljs-comment">//const otp = Math.floor(100000 + Math.random() * 900000).toString();</span>
  <span class="hljs-keyword">const</span> otp =  <span class="hljs-title function_">randomInt</span>(<span class="hljs-number">100000</span>, <span class="hljs-number">999999</span>);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// OTP 및 만료 시간을 데이터베이스에 저장</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOneAndUpdate</span>(
      { phone },
      { otp, <span class="hljs-attr">otpExpiration</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">600000</span> }, <span class="hljs-comment">// OTP는 10분 후에 만료됨</span>
      { <span class="hljs-attr">upsert</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span> }
    );

    <span class="hljs-comment">// SMS로 OTP 전송</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendOTP</span>(phone, otp);

    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'OTP 전송 성공'</span> });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'OTP 전송 중 오류 발생:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'OTP 전송 실패'</span> });
  }
});

router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/verifyotp'</span>, <span class="hljs-keyword">async</span> (req, res) => {
  <span class="hljs-keyword">const</span> { phone, otp } = req.<span class="hljs-property">body</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 전화번호와 OTP로 사용자 찾기</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>({ phone, otp });

    <span class="hljs-keyword">if</span> (!user || user.<span class="hljs-property">otpExpiration</span> &#x3C; <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()) {
      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'유효하지 않은 OTP'</span> });
    }

    <span class="hljs-comment">// 성공적으로 확인된 후 OTP 및 만료 시간 비우기</span>
    user.<span class="hljs-property">otp</span> = <span class="hljs-literal">undefined</span>;
    user.<span class="hljs-property">otpExpiration</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">await</span> user.<span class="hljs-title function_">save</span>();

    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'OTP 확인 성공'</span> });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'OTP 확인 중 오류 발생:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'OTP 확인 실패'</span> });
  }
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>이 코드는 /sendotp 엔드포인트로 OTP를 생성하고 전송하고, /verifyotp 엔드포인트로 사용자가 입력한 OTP를 확인합니다.</p>
<p>서버 시작하기: 마지막으로 애플리케이션을 시작하기 위한 주 서버 파일을 생성해봅시다. server.js라는 파일을 만들고 아래 코드를 추가해주세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);
<span class="hljs-keyword">const</span> { connect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./db'</span>); <span class="hljs-comment">// db.js에서 connect 함수를 가져옴</span>
<span class="hljs-keyword">const</span> authRoutes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes/auth'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;

<span class="hljs-comment">// 미들웨어</span>
app.<span class="hljs-title function_">use</span>(bodyParser.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// 라우트</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/auth'</span>, authRoutes);

<span class="hljs-comment">// 서버를 시작하기 전에 데이터베이스에 연결</span>
<span class="hljs-title function_">connect</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =></span> {
    <span class="hljs-comment">// 서버 시작</span>
    app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =></span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`서버가 <span class="hljs-subst">${PORT}</span> 포트에서 실행 중입니다.`</span>);
    });
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =></span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'데이터베이스 연결 중 오류 발생:'</span>, error);
  });
</code></pre>
<p>이 코드는 Express 서버를 설정하고, 수신된 JSON 요청을 파싱하며, 인증을 위한 라우트를 정의합니다.</p>
<p>결론: 축하합니다! Node.js와 MongoDB를 사용하여 OTP(일회용 비밀번호) 확인 시스템을 성공적으로 구축했습니다. SMS로 전송된 일회용 비밀번호를 통해 사용자의 신원을 확인함으로써 응용 프로그램에 추가적인 보안층을 추가했습니다. OTP 확인을 기반으로 한 이메일, 요청 속도 제한, 오류 처리 기능을 추가함으로써 이 시스템을 확장하실 수 있습니다.</p>
<p>이 튜토리얼에서 다룬 내용:</p>
<ul>
<li>사용자 데이터 저장을 위해 MongoDB 설정하기</li>
<li>Twilio를 사용하여 SMS를 통해 OTP 생성 및 전송</li>
<li>OTP 인증 엔드포인트 구현하기</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Nodejs와 MongoDB를 사용하여 OTP 인증 시스템 구축하기","description":"","date":"2024-05-14 13:33","slug":"2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB","content":"\n\n요즘의 디지털 세계에서는 보안이 매우 중요합니다. 특히 사용자 인증 프로세스에서 보안을 강화하는 일반적인 방법 중 하나는 일회용 비밀번호(OTP) 확인입니다. OTP는 사용자가 자격 증명과 함께 입력해야 하는 고유한 코드를 생성하여 보안의 추가적인 계층을 더합니다. 이 튜토리얼에서는 Node.js와 MongoDB를 사용하여 OTP 확인 시스템을 구축하는 과정을 단계별로 안내하겠습니다.\n\n![이미지](/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png)\n\n# 저와 소통하기:\n\nLinkedin: [링크](https://www.linkedin.com/in/suneel-kumar-52164625a/)\n\n\n\n사전 준비 사항: 구현에 들어가기 전에 다음을 설치했는지 확인하세요:\n\n- Node.js: 시스템에 Node.js가 설치되어 있는지 확인하세요. 공식 Node.js 웹사이트에서 다운로드할 수 있습니다.\n- MongoDB: 사용자 데이터 및 OTP 정보를 저장할 MongoDB를 설치하세요. 공식 MongoDB 웹사이트에서 다운로드할 수 있습니다.\n- 텍스트 편집기: 원하는 텍스트 편집기나 IDE를 선택하세요. VS Code, Sublime Text 또는 Atom이 인기 있는 선택지입니다.\n\n프로젝트 설정: 프로젝트 디렉토리를 설정하고 필요한 종속성을 설치하는 것으로 시작해봅시다. 터미널을 열고 다음 단계를 따르세요:\n\n- 프로젝트용 새 디렉토리를 만드세요:\n\n\n\n```js\nmkdir otp-verification-system\ncd otp-verification-system\n```\n\n새로운 Node.js 프로젝트를 초기화하세요:\n\n```js\nnpm init -y\n```\n\n필요한 종속성을 설치하세요:\n\n\n\n```js\nnpm install express mongoose twilio dotenv body-parser\n```\n\n- express: 웹 서버를 만들기 위해 사용됩니다.\n- mongoose: MongoDB와 상호 작용하기 위해 사용됩니다.\n- twilio: SMS를 통해 OTP를 전송하는 데 사용됩니다.\n- dotenv: 환경 변수를 관리하기 위해 사용됩니다.\n- body-parser: 들어오는 요청 본문을 구문 분석하기 위한 미들웨어입니다.\n\n이제 프로젝트가 설정되었으므로 OTP 인증 시스템을 구축할 차례입니다.\n\nMongoDB 설정: 먼저 MongoDB 데이터베이스를 설정해보겠습니다. 프로젝트 디렉토리에 db.js라는 파일을 생성하고 다음 코드를 추가하세요:\n\n\n\n\n```js\nconst mongoose = require('mongoose');\n\nfunction connect() {\n  return new Promise((resolve, reject) =\u003e {\n    mongoose.connect('mongodb://localhost/otp_verification', {\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n    });\n\n    const db = mongoose.connection;\n\n    db.on('error', error =\u003e {\n      console.error('MongoDB 연결 오류:', error);\n      reject(error);\n    });\n\n    db.once('open', () =\u003e {\n      console.log('MongoDB에 연결되었습니다');\n      resolve();\n    });\n  });\n}\n\nmodule.exports = { connect };\n```\n\n이 코드는 로컬 MongoDB 인스턴스에 연결하고 otp_verification이라는 이름의 데이터베이스를 생성합니다.\n\n사용자 모델 생성: 이제 사용자 정보를 저장할 사용자 모델을 만들어 봅시다. models/User.js 파일을 생성하고 다음 코드를 추가하세요:\n\n```js\nconst mongoose = require('mongoose');\n\nconst userSchema = new mongoose.Schema({\n  username: String,\n  phone: String,\n  otp: String,\n  otpExpiration: Date,\n});\n\nmodule.exports = mongoose.model('User', userSchema);\n```\n\n\n\n이 스키마는 MongoDB의 사용자 문서 구조를 정의합니다. 여기에는 사용자 이름, 전화번호, OTP 및 OTP 만료 시간 필드가 포함됩니다.\n\nOTP 생성 및 전송: 이제 SMS를 통해 OTP를 생성하고 전송하는 로직을 만들어 봅시다. 이를 위해 Twilio API를 사용하겠습니다. utils/otp.js라는 파일을 만들고 다음 코드를 추가하세요:\n\n```js\nconst twilio = require('twilio');\nconst dotenv = require('dotenv');\n\ndotenv.config();\n\nconst accountSid = process.env.TWILIO_ACCOUNT_SID;\nconst authToken = process.env.TWILIO_AUTH_TOKEN;\nconst client = new twilio(accountSid, authToken);\n\nasync function sendOTP(phone, otp) {\n  try {\n    const message = await client.messages.create({\n      body: `Your OTP is: ${otp}`,\n      from: process.env.TWILIO_PHONE_NUMBER,\n      to: phone,\n    });\n    console.log(`OTP sent to ${phone}: ${message.sid}`);\n  } catch (error) {\n    console.error('Error sending OTP:', error);\n  }\n}\n\nmodule.exports = { sendOTP };\n```\n\nTwilio 계정을 설정하고 필요한 자격 증명(Account SID, Auth Token 및 전화번호)을 얻었는지 확인하십시오. 이 정보는 .env 파일에 저장되어야 합니다.\n\n\n\nOTP 인증 엔드포인트 구현하기: 이제 OTP 인증을 처리하는 엔드포인트를 만들어 봅시다. routes/auth.js라는 파일을 만들고 아래 코드를 추가해주세요:\n\n```js\nconst express = require('express');\nconst router = express.Router();\nconst User = require('../models/User');\nconst { sendOTP } = require('../utils/otp');\nconst {randomInt} = require('crypto')\n\nrouter.post('/sendotp', async (req, res) =\u003e {\n  const { phone } = req.body;\n\n  // 6자리 OTP 생성\n  //const otp = Math.floor(100000 + Math.random() * 900000).toString();\n  const otp =  randomInt(100000, 999999);\n\n  try {\n    // OTP 및 만료 시간을 데이터베이스에 저장\n    const user = await User.findOneAndUpdate(\n      { phone },\n      { otp, otpExpiration: Date.now() + 600000 }, // OTP는 10분 후에 만료됨\n      { upsert: true, new: true }\n    );\n\n    // SMS로 OTP 전송\n    await sendOTP(phone, otp);\n\n    res.status(200).json({ success: true, message: 'OTP 전송 성공' });\n  } catch (error) {\n    console.error('OTP 전송 중 오류 발생:', error);\n    res.status(500).json({ success: false, message: 'OTP 전송 실패' });\n  }\n});\n\nrouter.post('/verifyotp', async (req, res) =\u003e {\n  const { phone, otp } = req.body;\n\n  try {\n    // 전화번호와 OTP로 사용자 찾기\n    const user = await User.findOne({ phone, otp });\n\n    if (!user || user.otpExpiration \u003c Date.now()) {\n      return res.status(400).json({ success: false, message: '유효하지 않은 OTP' });\n    }\n\n    // 성공적으로 확인된 후 OTP 및 만료 시간 비우기\n    user.otp = undefined;\n    user.otpExpiration = undefined;\n    await user.save();\n\n    res.status(200).json({ success: true, message: 'OTP 확인 성공' });\n  } catch (error) {\n    console.error('OTP 확인 중 오류 발생:', error);\n    res.status(500).json({ success: false, message: 'OTP 확인 실패' });\n  }\n});\n\nmodule.exports = router;\n```\n\n이 코드는 /sendotp 엔드포인트로 OTP를 생성하고 전송하고, /verifyotp 엔드포인트로 사용자가 입력한 OTP를 확인합니다.\n\n서버 시작하기: 마지막으로 애플리케이션을 시작하기 위한 주 서버 파일을 생성해봅시다. server.js라는 파일을 만들고 아래 코드를 추가해주세요:\n\n\n\n```js\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst { connect } = require('./db'); // db.js에서 connect 함수를 가져옴\nconst authRoutes = require('./routes/auth');\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// 미들웨어\napp.use(bodyParser.json());\n\n// 라우트\napp.use('/auth', authRoutes);\n\n// 서버를 시작하기 전에 데이터베이스에 연결\nconnect()\n  .then(() =\u003e {\n    // 서버 시작\n    app.listen(PORT, () =\u003e {\n      console.log(`서버가 ${PORT} 포트에서 실행 중입니다.`);\n    });\n  })\n  .catch(error =\u003e {\n    console.error('데이터베이스 연결 중 오류 발생:', error);\n  });\n```\n\n이 코드는 Express 서버를 설정하고, 수신된 JSON 요청을 파싱하며, 인증을 위한 라우트를 정의합니다.\n\n결론: 축하합니다! Node.js와 MongoDB를 사용하여 OTP(일회용 비밀번호) 확인 시스템을 성공적으로 구축했습니다. SMS로 전송된 일회용 비밀번호를 통해 사용자의 신원을 확인함으로써 응용 프로그램에 추가적인 보안층을 추가했습니다. OTP 확인을 기반으로 한 이메일, 요청 속도 제한, 오류 처리 기능을 추가함으로써 이 시스템을 확장하실 수 있습니다.\n\n이 튜토리얼에서 다룬 내용:\n  \n\n\n\n- 사용자 데이터 저장을 위해 MongoDB 설정하기\n- Twilio를 사용하여 SMS를 통해 OTP 생성 및 전송\n- OTP 인증 엔드포인트 구현하기","ogImage":{"url":"/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png"},"coverImage":"/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png","tag":["Tech"],"readingTime":6},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e요즘의 디지털 세계에서는 보안이 매우 중요합니다. 특히 사용자 인증 프로세스에서 보안을 강화하는 일반적인 방법 중 하나는 일회용 비밀번호(OTP) 확인입니다. OTP는 사용자가 자격 증명과 함께 입력해야 하는 고유한 코드를 생성하여 보안의 추가적인 계층을 더합니다. 이 튜토리얼에서는 Node.js와 MongoDB를 사용하여 OTP 확인 시스템을 구축하는 과정을 단계별로 안내하겠습니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003ch1\u003e저와 소통하기:\u003c/h1\u003e\n\u003cp\u003eLinkedin: \u003ca href=\"https://www.linkedin.com/in/suneel-kumar-52164625a/\" rel=\"nofollow\" target=\"_blank\"\u003e링크\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e사전 준비 사항: 구현에 들어가기 전에 다음을 설치했는지 확인하세요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNode.js: 시스템에 Node.js가 설치되어 있는지 확인하세요. 공식 Node.js 웹사이트에서 다운로드할 수 있습니다.\u003c/li\u003e\n\u003cli\u003eMongoDB: 사용자 데이터 및 OTP 정보를 저장할 MongoDB를 설치하세요. 공식 MongoDB 웹사이트에서 다운로드할 수 있습니다.\u003c/li\u003e\n\u003cli\u003e텍스트 편집기: 원하는 텍스트 편집기나 IDE를 선택하세요. VS Code, Sublime Text 또는 Atom이 인기 있는 선택지입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e프로젝트 설정: 프로젝트 디렉토리를 설정하고 필요한 종속성을 설치하는 것으로 시작해봅시다. 터미널을 열고 다음 단계를 따르세요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e프로젝트용 새 디렉토리를 만드세요:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003emkdir otp-verification-system\ncd otp-verification-system\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e새로운 Node.js 프로젝트를 초기화하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm init -y\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e필요한 종속성을 설치하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm install express mongoose twilio dotenv body-parser\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eexpress: 웹 서버를 만들기 위해 사용됩니다.\u003c/li\u003e\n\u003cli\u003emongoose: MongoDB와 상호 작용하기 위해 사용됩니다.\u003c/li\u003e\n\u003cli\u003etwilio: SMS를 통해 OTP를 전송하는 데 사용됩니다.\u003c/li\u003e\n\u003cli\u003edotenv: 환경 변수를 관리하기 위해 사용됩니다.\u003c/li\u003e\n\u003cli\u003ebody-parser: 들어오는 요청 본문을 구문 분석하기 위한 미들웨어입니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이제 프로젝트가 설정되었으므로 OTP 인증 시스템을 구축할 차례입니다.\u003c/p\u003e\n\u003cp\u003eMongoDB 설정: 먼저 MongoDB 데이터베이스를 설정해보겠습니다. 프로젝트 디렉토리에 db.js라는 파일을 생성하고 다음 코드를 추가하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mongoose = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mongoose'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    mongoose.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mongodb://localhost/otp_verification'\u003c/span\u003e, {\n      \u003cspan class=\"hljs-attr\"\u003euseNewUrlParser\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003euseUnifiedTopology\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = mongoose.\u003cspan class=\"hljs-property\"\u003econnection\u003c/span\u003e;\n\n    db.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'error'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'MongoDB 연결 오류:'\u003c/span\u003e, error);\n      \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(error);\n    });\n\n    db.\u003cspan class=\"hljs-title function_\"\u003eonce\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'open'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'MongoDB에 연결되었습니다'\u003c/span\u003e);\n      \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e();\n    });\n  });\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = { connect };\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 코드는 로컬 MongoDB 인스턴스에 연결하고 otp_verification이라는 이름의 데이터베이스를 생성합니다.\u003c/p\u003e\n\u003cp\u003e사용자 모델 생성: 이제 사용자 정보를 저장할 사용자 모델을 만들어 봅시다. models/User.js 파일을 생성하고 다음 코드를 추가하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e mongoose = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mongoose'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userSchema = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e mongoose.\u003cspan class=\"hljs-title class_\"\u003eSchema\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eusername\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ephone\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eotp\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eString\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eotpExpiration\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e,\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = mongoose.\u003cspan class=\"hljs-title function_\"\u003emodel\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'User'\u003c/span\u003e, userSchema);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 스키마는 MongoDB의 사용자 문서 구조를 정의합니다. 여기에는 사용자 이름, 전화번호, OTP 및 OTP 만료 시간 필드가 포함됩니다.\u003c/p\u003e\n\u003cp\u003eOTP 생성 및 전송: 이제 SMS를 통해 OTP를 생성하고 전송하는 로직을 만들어 봅시다. 이를 위해 Twilio API를 사용하겠습니다. utils/otp.js라는 파일을 만들고 다음 코드를 추가하세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e twilio = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'twilio'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dotenv = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'dotenv'\u003c/span\u003e);\n\ndotenv.\u003cspan class=\"hljs-title function_\"\u003econfig\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e accountSid = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eTWILIO_ACCOUNT_SID\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e authToken = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eTWILIO_AUTH_TOKEN\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e client = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003etwilio\u003c/span\u003e(accountSid, authToken);\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendOTP\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ephone, otp\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e message = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e client.\u003cspan class=\"hljs-property\"\u003emessages\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreate\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003ebody\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`Your OTP is: \u003cspan class=\"hljs-subst\"\u003e${otp}\u003c/span\u003e`\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003efrom\u003c/span\u003e: process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eTWILIO_PHONE_NUMBER\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eto\u003c/span\u003e: phone,\n    });\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`OTP sent to \u003cspan class=\"hljs-subst\"\u003e${phone}\u003c/span\u003e: \u003cspan class=\"hljs-subst\"\u003e${message.sid}\u003c/span\u003e`\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Error sending OTP:'\u003c/span\u003e, error);\n  }\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = { sendOTP };\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTwilio 계정을 설정하고 필요한 자격 증명(Account SID, Auth Token 및 전화번호)을 얻었는지 확인하십시오. 이 정보는 .env 파일에 저장되어야 합니다.\u003c/p\u003e\n\u003cp\u003eOTP 인증 엔드포인트 구현하기: 이제 OTP 인증을 처리하는 엔드포인트를 만들어 봅시다. routes/auth.js라는 파일을 만들고 아래 코드를 추가해주세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = express.\u003cspan class=\"hljs-title class_\"\u003eRouter\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../models/User'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { sendOTP } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'../utils/otp'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e {randomInt} = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'crypto'\u003c/span\u003e)\n\nrouter.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/sendotp'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { phone } = req.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e// 6자리 OTP 생성\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e//const otp = Math.floor(100000 + Math.random() * 900000).toString();\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e otp =  \u003cspan class=\"hljs-title function_\"\u003erandomInt\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100000\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e999999\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// OTP 및 만료 시간을 데이터베이스에 저장\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindOneAndUpdate\u003c/span\u003e(\n      { phone },\n      { otp, \u003cspan class=\"hljs-attr\"\u003eotpExpiration\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e() + \u003cspan class=\"hljs-number\"\u003e600000\u003c/span\u003e }, \u003cspan class=\"hljs-comment\"\u003e// OTP는 10분 후에 만료됨\u003c/span\u003e\n      { \u003cspan class=\"hljs-attr\"\u003eupsert\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003enew\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }\n    );\n\n    \u003cspan class=\"hljs-comment\"\u003e// SMS로 OTP 전송\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendOTP\u003c/span\u003e(phone, otp);\n\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'OTP 전송 성공'\u003c/span\u003e });\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'OTP 전송 중 오류 발생:'\u003c/span\u003e, error);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'OTP 전송 실패'\u003c/span\u003e });\n  }\n});\n\nrouter.\u003cspan class=\"hljs-title function_\"\u003epost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/verifyotp'\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { phone, otp } = req.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 전화번호와 OTP로 사용자 찾기\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e({ phone, otp });\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!user || user.\u003cspan class=\"hljs-property\"\u003eotpExpiration\u003c/span\u003e \u0026#x3C; \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e()) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'유효하지 않은 OTP'\u003c/span\u003e });\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// 성공적으로 확인된 후 OTP 및 만료 시간 비우기\u003c/span\u003e\n    user.\u003cspan class=\"hljs-property\"\u003eotp\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n    user.\u003cspan class=\"hljs-property\"\u003eotpExpiration\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e user.\u003cspan class=\"hljs-title function_\"\u003esave\u003c/span\u003e();\n\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'OTP 확인 성공'\u003c/span\u003e });\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'OTP 확인 중 오류 발생:'\u003c/span\u003e, error);\n    res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'OTP 확인 실패'\u003c/span\u003e });\n  }\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 코드는 /sendotp 엔드포인트로 OTP를 생성하고 전송하고, /verifyotp 엔드포인트로 사용자가 입력한 OTP를 확인합니다.\u003c/p\u003e\n\u003cp\u003e서버 시작하기: 마지막으로 애플리케이션을 시작하기 위한 주 서버 파일을 생성해봅시다. server.js라는 파일을 만들고 아래 코드를 추가해주세요:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bodyParser = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'body-parser'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { connect } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./db'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// db.js에서 connect 함수를 가져옴\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e authRoutes = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./routes/auth'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ePORT\u003c/span\u003e || \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 미들웨어\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(bodyParser.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e());\n\n\u003cspan class=\"hljs-comment\"\u003e// 라우트\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/auth'\u003c/span\u003e, authRoutes);\n\n\u003cspan class=\"hljs-comment\"\u003e// 서버를 시작하기 전에 데이터베이스에 연결\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e()\n  .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 서버 시작\u003c/span\u003e\n    app.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003ePORT\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`서버가 \u003cspan class=\"hljs-subst\"\u003e${PORT}\u003c/span\u003e 포트에서 실행 중입니다.`\u003c/span\u003e);\n    });\n  })\n  .\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'데이터베이스 연결 중 오류 발생:'\u003c/span\u003e, error);\n  });\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 코드는 Express 서버를 설정하고, 수신된 JSON 요청을 파싱하며, 인증을 위한 라우트를 정의합니다.\u003c/p\u003e\n\u003cp\u003e결론: 축하합니다! Node.js와 MongoDB를 사용하여 OTP(일회용 비밀번호) 확인 시스템을 성공적으로 구축했습니다. SMS로 전송된 일회용 비밀번호를 통해 사용자의 신원을 확인함으로써 응용 프로그램에 추가적인 보안층을 추가했습니다. OTP 확인을 기반으로 한 이메일, 요청 속도 제한, 오류 처리 기능을 추가함으로써 이 시스템을 확장하실 수 있습니다.\u003c/p\u003e\n\u003cp\u003e이 튜토리얼에서 다룬 내용:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e사용자 데이터 저장을 위해 MongoDB 설정하기\u003c/li\u003e\n\u003cli\u003eTwilio를 사용하여 SMS를 통해 OTP 생성 및 전송\u003c/li\u003e\n\u003cli\u003eOTP 인증 엔드포인트 구현하기\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-14-BuildinganOTPVerificationSystemwithNodejsandMongoDB"},"buildId":"aCCUs-qPrLLLWRnkN0AOd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>