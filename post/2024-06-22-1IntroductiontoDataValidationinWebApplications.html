<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>웹 애플리케이션에서 데이터 검증 소개 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-22-1IntroductiontoDataValidationinWebApplications" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="웹 애플리케이션에서 데이터 검증 소개 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="웹 애플리케이션에서 데이터 검증 소개 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-22-1IntroductiontoDataValidationinWebApplications_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-22-1IntroductiontoDataValidationinWebApplications" data-gatsby-head="true"/><meta name="twitter:title" content="웹 애플리케이션에서 데이터 검증 소개 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-22-1IntroductiontoDataValidationinWebApplications_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-22 02:21" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_buildManifest.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">웹 애플리케이션에서 데이터 검증 소개</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="웹 애플리케이션에서 데이터 검증 소개" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 22, 2024</span><span class="posts_reading_time__f7YPP">7<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-22-1IntroductiontoDataValidationinWebApplications&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<ol>
<li>웹 애플리케이션에서 데이터 유효성 검사 소개.</li>
<li>NestJS를 유효성 검사 용으로 설정하기.</li>
</ol>
<ul>
<li>선행 조건 및 프로젝트 설정.</li>
<li>유효성 검사 스키마 생성 및 사용하기.</li>
</ul>
<ol start="3">
<li>Joi와 함께 pipe를 소개하고 사용하는 방법.</li>
<li>Joi를 사용하여 매개변수 및 쿼리 매개변수의 유효성 검사.</li>
<li>실제 구현: nestjs-joi 및 joi-class-decorators를 활용한 완전한 NestJS 애플리케이션 탐색하기: GitHub의 NestJS Sample App with nestjs-joi.</li>
</ol>
<h1>1. 웹 애플리케이션에서 데이터 유효성 검사 소개.</h1>
<ul>
<li>데이터 유효성 검사는 사용자가 입력한 데이터나 외부 소스에서 가져온 데이터가 지정된 기준과 형식을 충족하는지 확인하는 프로세스입니다. 데이터 유효성 검사는 클라이언트 측, 서버 측 및 데이터베이스 수준을 포함하여 여러 수준에서 수행할 수 있습니다.</li>
</ul>
<h1>2. NestJS를 유효성 검사 용으로 설정하기.</h1>
<div class="content-ad"></div>
<ul>
<li>전제 조건 및 프로젝트 설정:</li>
</ul>
<h2>1. Node 및 npm 설치:</h2>
<p>Nodejs 웹 사이트에 가서 Node를 설치해야 합니다.</p>
<h2>2. NestJs 설치 및 새로운 nestApp 생성:</h2>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm i -g @nestjs/cli
nest <span class="hljs-keyword">new</span> my-nestjs-app
cd ./my-nestjs-app
</code></pre>
<h2>3. 새로운 파이프인 validation을 생성하세요:</h2>
<pre><code class="hljs language-js"><span class="hljs-comment">// --no-spec => spec 파일 생성 비활성화</span>
<span class="hljs-comment">// --flat => 요소를 위한 폴더를 생성하지 않습니다.</span>
nest g pipe validation --no-spec --flat
</code></pre>
<h2>4. 필요한 패키지 설치하기 (nestjs-joi, joi-class-decorators)</h2>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm i <span class="hljs-keyword">class</span>-transformer joi nestjs-joi joi-<span class="hljs-keyword">class</span>-decorators
</code></pre>
<ul>
<li>확인 스키마 생성 및 사용:</li>
</ul>
<h2>1. <code>/testBody</code> 엔드포인트 생성, 메서드 유형: POST, 앱 컨트롤러에서</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Body</span>, <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">HttpCode</span>, <span class="hljs-title class_">HttpStatus</span>, <span class="hljs-title class_">Post</span>, <span class="hljs-title class_">Req</span>, <span class="hljs-title class_">Res</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Request</span>, <span class="hljs-title class_">Response</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> { validationBodyDto } <span class="hljs-keyword">from</span> <span class="hljs-string">'./validate.dto'</span>;

@<span class="hljs-title class_">Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly appService: AppService</span>) {}

  @<span class="hljs-title class_">Post</span>(<span class="hljs-string">'/testBody'</span>)
  @<span class="hljs-title class_">HttpCode</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>)
  <span class="hljs-title function_">testJoiValidation</span>(<span class="hljs-params">@Body() reqBody: validationBodyDto, @Res() res: Response</span>) {
    <span class="hljs-keyword">const</span> data = reqBody;
    res.<span class="hljs-title function_">json</span>(data);
  }
}
</code></pre>
<div class="content-ad"></div>
<h2>2. validate.dto.ts 파일을 만들어서 이 엔드포인트를 검증하고 joi 스키마 클래스(validationBodyDto)를 만드세요:</h2>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Expose</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"class-transformer"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">JoiSchema</span>, <span class="hljs-title class_">JoiSchemaOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"joi-class-decorators"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Joi</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'joi'</span>;

interface reviewInterface {
    <span class="hljs-attr">rating</span>: number;
    <span class="hljs-attr">comment</span>: string;
}
<span class="hljs-comment">// @Expose ==> 시리얼라이제이션 및 디시리얼라이제이션을 위해 전환 프로세스에 포함되어야 하는 속성을 표시하는 데 사용됩니다.</span>
<span class="hljs-comment">// @JoiSchema() ==> 타입(클래스) 속성에 스키마를 정의합니다. 스키마 주석이 달린 속성은 전체 객체 스키마를 구성하는 데 사용됩니다.</span>

<span class="hljs-comment">//명시적으로 정의되지 않은 속성을 허용하지 않아 엄격한 유효성을 보장합니다. </span>
@<span class="hljs-title class_">JoiSchemaOptions</span>({
    <span class="hljs-attr">allowUnknown</span>: <span class="hljs-literal">false</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">validationBodyDto</span> {

   <span class="hljs-comment">//기본 유효성 검사는 문자열 유형 및 필수입니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">trim</span>().required())
    <span class="hljs-attr">fullName</span>: string;

   <span class="hljs-comment">//길이를 확인하고 유효한 이집트 전화 번호인지 확인합니다</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">length</span>(<span class="hljs-number">11</span>).<span class="hljs-title function_">pattern</span>(<span class="hljs-regexp">/^(011|012|015|010)\d{8}$/</span>).required())
    <span class="hljs-attr">phoneNumber</span>: string;


   <span class="hljs-comment">//유효한 이메일인지 확인합니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">email</span>().<span class="hljs-title function_">optional</span>())
    email?: string;

    <span class="hljs-comment">//값이 M 또는 F인 경우에만 유효성을 확인합니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">valid</span>(<span class="hljs-string">'M'</span>, <span class="hljs-string">'F'</span>).required())
    <span class="hljs-attr">gender</span>: string;

    <span class="hljs-comment">//gender가 M이면 militaryStatus는 필수이고 그렇지 않으면 선택사항입니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(
        <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">when</span>(<span class="hljs-string">'gender'</span>, {
            <span class="hljs-attr">is</span>: <span class="hljs-string">'M'</span>,
            <span class="hljs-attr">then</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().required(),
            <span class="hljs-attr">otherwise</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">optional</span>(),
        }),
    )
    <span class="hljs-attr">militaryStatus</span>: string;

    <span class="hljs-comment">//나이가 숫자이고 최소값은 14이고 최대 나이는 100입니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">14</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">message</span>(<span class="hljs-string">'유효하지 않은 나이'</span>))
    <span class="hljs-attr">age</span>: number;


    <span class="hljs-comment">//객체 배열이 유효한지 확인합니다.</span>
    @<span class="hljs-title class_">Expose</span>()
    @<span class="hljs-title class_">JoiSchema</span>(
        <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">array</span>().<span class="hljs-title function_">items</span>(
                <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>({
                        <span class="hljs-attr">rating</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">0.1</span>).required(),
                        <span class="hljs-attr">comment</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">300</span>).required(),
                    }).required(),
            ).required(),
    )
    <span class="hljs-attr">reviews</span>: reviewInterface[];

    <span class="hljs-comment">//빈 문자열을 허용하는 필드입니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">allow</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">optional</span>())
    profilePicture?: string;

    <span class="hljs-comment">//profilePicture에 값이 있을 경우 profileFileName은 필수이고 그렇지 않으면 선택사항입니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(
        <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">when</span>(<span class="hljs-string">'profilePicture'</span>, {
            <span class="hljs-attr">is</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">exist</span>(),
            <span class="hljs-attr">then</span>:  <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().required(),
            <span class="hljs-attr">otherwise</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">allow</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">optional</span>(),
    }))
    <span class="hljs-attr">profileFileName</span>: string;

    <span class="hljs-comment">//isVerified가 부울 값이고 필수인지 확인합니다.</span>
    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">boolean</span>().required())
    <span class="hljs-attr">isVerified</span>: boolean;
}
</code></pre>
<h2>3. pipe 소개 및 Joi와 함께 사용하는 방법:</h2>
<ul>
<li>NestJS에서 "pipe"는 @Injectable() 데코레이터가 붙은 클래스로, PipeTransform 인터페이스를 구현합니다. Pipe는 일반적으로 데이터의 변환 또는 유효성 검사에 사용됩니다. 메소드 수준, 컨트롤러 수준 또는 전역 수준 등 다양한 수준에서 사용할 수 있습니다.</li>
<li>Pipes 소개
변환: Pipes는 입력 데이터를 원하는 형식으로 변환할 수 있습니다.
유효성 검사: Pipes는 데이터를 요청 핸들러에 전달하기 전에 데이터를 유효성 검사할 수 있습니다. 데이터가 유효하지 않으면 Pipe가 예외를 throw할 수 있고, 이는 NestJS에서 처리됩니다.</li>
<li>우리의 경우, 일반 객체를 유형화된 객체로 변환하여 유효성을 적용할 수 있게 합니다.</li>
<li>이제 우리가 이전에 만들었던 유효성 파이프를 사용해 보겠습니다:</li>
</ul>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BadRequestException</span>, <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">PipeTransform</span>, <span class="hljs-title class_">Type</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common’;
import { plainToInstance } from '</span><span class="hljs-keyword">class</span>-transformer’;
<span class="hljs-keyword">import</span> { getClassSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">'joi-class-decorators’;

@Injectable()
export class ValidationPipe implements PipeTransform {
  transform(value: any, metadata: ArgumentMetadata) {
    const { metatype } = metadata;
    const bodyDto = metatype; // Dto Schema
    /*
      우리의 일반 JavaScript 인수 객체를 형식화된 객체로 변환하여 유효성을 적용합니다.
      이 작업을 수행해야 하는 이유는, 네트워크 요청에서 역직렬화된 전송 온 post body 객체에는 어떤 유형 정보도 포함되어 있지 않기 때문입니다. 
    */
    // getClassSchema(bodyDto) ==> 클래스와 연결된 Joi 유효성 스키마를 가져오는 joi-class-decorators의 함수입니다.
    const bodyInput = plainToInstance(bodyDto, value); // 일반 Dto 객체를 인스턴스로 변환하여 수동으로 변환합니다
    const bodySchema = getClassSchema(bodyDto); // Dto에서 Joi 스키마 가져오기
    // 클래스 인스턴스를 Joi 스키마에 대해 유효성 검사합니다. 유효성 검사가 실패하면 error에 유효성 오류가 포함됩니다.
    const error = bodySchema.validate(bodyInput).error;  
    if (error) {
      throw new BadRequestException(`유효성 검사 실패: ${error.details.map((err) => err.message).join('</span>, <span class="hljs-string">')}.`);  
    }
    return value
  }
}
interface ArgumentMetadata {
  type: '</span>body<span class="hljs-string">' | '</span>query<span class="hljs-string">' | '</span>param<span class="hljs-string">' | '</span>custom<span class="hljs-string">';
  metatype?: Type&#x3C;unknown>;
  data?: string;
}
</span></code></pre>
<h2>4. Param 및 Query Params에 대한 Joi 유효성 검사.</h2>
<ul>
<li><code>/testParams/:category’</code> 경로를 만들고, GET 방식으로 작성합니다. category라는 하나의 param을 받고, 두 개의 Query Params인 limit와 page를 받습니다.</li>
</ul>
<pre><code class="hljs language-js">@<span class="hljs-title class_">Get</span>(’/testParams/:category’) 
@<span class="hljs-title class_">HttpCode</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>) 
@<span class="hljs-title class_">UsePipes</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationPipe</span>()) 
<span class="hljs-title function_">testJoiValidationParam</span>(<span class="hljs-params"> 
@Param() category: validationParamDto, 
@Query() limitAndPageSize: validationQueryParamDto, 
@Res() res: Response 
</span>) { 
   res.<span class="hljs-title function_">json</span>({ category, limitAndPageSize }); 
}
</code></pre>
<div class="content-ad"></div>
<ul>
<li>이러한 매개변수를 위해 두 개의 DTO를 생성하세요:</li>
</ul>
<pre><code class="hljs language-js">@<span class="hljs-title class_">JoiSchemaOptions</span>({
    <span class="hljs-attr">allowUnknown</span>: <span class="hljs-literal">false</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">validationParamDto</span> {
     @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">valid</span>(<span class="hljs-string">'Fashions'</span>, <span class="hljs-string">'Electronics'</span>, <span class="hljs-string">'MobilesPhones'</span>, <span class="hljs-string">'Perfumes'</span>).required())
     <span class="hljs-attr">category</span>: string; 
}

@<span class="hljs-title class_">JoiSchemaOptions</span>({
    <span class="hljs-attr">allowUnknown</span>: <span class="hljs-literal">false</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">validationQueryParamDto</span> {

    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">message</span>(<span class="hljs-string">'잘못된 제한입니다'</span>))
    <span class="hljs-attr">limit</span>: string;

    @<span class="hljs-title class_">Expose</span>() @<span class="hljs-title class_">JoiSchema</span>(<span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">message</span>(<span class="hljs-string">'잘못된 페이지 크기입니다'</span>))
    <span class="hljs-attr">page</span>: string;
}
</code></pre>
<p>GitHub에서 NestJS 샘플 앱을 탐색하세요.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"웹 애플리케이션에서 데이터 검증 소개","description":"","date":"2024-06-22 02:21","slug":"2024-06-22-1IntroductiontoDataValidationinWebApplications","content":"\n\n1. 웹 애플리케이션에서 데이터 유효성 검사 소개.\n2. NestJS를 유효성 검사 용으로 설정하기.\n- 선행 조건 및 프로젝트 설정.\n- 유효성 검사 스키마 생성 및 사용하기.\n3. Joi와 함께 pipe를 소개하고 사용하는 방법.\n4. Joi를 사용하여 매개변수 및 쿼리 매개변수의 유효성 검사.\n5. 실제 구현: nestjs-joi 및 joi-class-decorators를 활용한 완전한 NestJS 애플리케이션 탐색하기: GitHub의 NestJS Sample App with nestjs-joi. \n\n# 1. 웹 애플리케이션에서 데이터 유효성 검사 소개.\n\n- 데이터 유효성 검사는 사용자가 입력한 데이터나 외부 소스에서 가져온 데이터가 지정된 기준과 형식을 충족하는지 확인하는 프로세스입니다. 데이터 유효성 검사는 클라이언트 측, 서버 측 및 데이터베이스 수준을 포함하여 여러 수준에서 수행할 수 있습니다. \n\n# 2. NestJS를 유효성 검사 용으로 설정하기.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 전제 조건 및 프로젝트 설정:\n\n## 1. Node 및 npm 설치:\n\nNodejs 웹 사이트에 가서 Node를 설치해야 합니다.\n\n## 2. NestJs 설치 및 새로운 nestApp 생성:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm i -g @nestjs/cli\nnest new my-nestjs-app\ncd ./my-nestjs-app\n```\n\n## 3. 새로운 파이프인 validation을 생성하세요:\n\n```js\n// --no-spec =\u003e spec 파일 생성 비활성화\n// --flat =\u003e 요소를 위한 폴더를 생성하지 않습니다.\nnest g pipe validation --no-spec --flat\n```\n\n## 4. 필요한 패키지 설치하기 (nestjs-joi, joi-class-decorators)\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm i class-transformer joi nestjs-joi joi-class-decorators\n```\n\n- 확인 스키마 생성 및 사용:\n\n## 1. `/testBody` 엔드포인트 생성, 메서드 유형: POST, 앱 컨트롤러에서\n\n```js\nimport { Body, Controller, HttpCode, HttpStatus, Post, Req, Res } from '@nestjs/common';\nimport { AppService } from './app.service';\nimport { Request, Response } from 'express';\nimport { validationBodyDto } from './validate.dto';\n\n@Controller()\nexport class AppController {\n  constructor(private readonly appService: AppService) {}\n\n  @Post('/testBody')\n  @HttpCode(HttpStatus.OK)\n  testJoiValidation(@Body() reqBody: validationBodyDto, @Res() res: Response) {\n    const data = reqBody;\n    res.json(data);\n  }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 2. validate.dto.ts 파일을 만들어서 이 엔드포인트를 검증하고 joi 스키마 클래스(validationBodyDto)를 만드세요:\n\n```js\nimport { Expose } from \"class-transformer\";\nimport { JoiSchema, JoiSchemaOptions } from \"joi-class-decorators\";\nimport * as Joi from 'joi';\n\ninterface reviewInterface {\n    rating: number;\n    comment: string;\n}\n// @Expose ==\u003e 시리얼라이제이션 및 디시리얼라이제이션을 위해 전환 프로세스에 포함되어야 하는 속성을 표시하는 데 사용됩니다.\n// @JoiSchema() ==\u003e 타입(클래스) 속성에 스키마를 정의합니다. 스키마 주석이 달린 속성은 전체 객체 스키마를 구성하는 데 사용됩니다.\n\n//명시적으로 정의되지 않은 속성을 허용하지 않아 엄격한 유효성을 보장합니다. \n@JoiSchemaOptions({\n    allowUnknown: false\n})\n\nexport class validationBodyDto {\n\n   //기본 유효성 검사는 문자열 유형 및 필수입니다.\n    @Expose() @JoiSchema(Joi.string().trim().required())\n    fullName: string;\n\n   //길이를 확인하고 유효한 이집트 전화 번호인지 확인합니다\n    @Expose() @JoiSchema(Joi.string().length(11).pattern(/^(011|012|015|010)\\d{8}$/).required())\n    phoneNumber: string;\n\n\n   //유효한 이메일인지 확인합니다.\n    @Expose() @JoiSchema(Joi.string().email().optional())\n    email?: string;\n\n    //값이 M 또는 F인 경우에만 유효성을 확인합니다.\n    @Expose() @JoiSchema(Joi.string().valid('M', 'F').required())\n    gender: string;\n\n    //gender가 M이면 militaryStatus는 필수이고 그렇지 않으면 선택사항입니다.\n    @Expose() @JoiSchema(\n        Joi.when('gender', {\n            is: 'M',\n            then: Joi.string().required(),\n            otherwise: Joi.string().optional(),\n        }),\n    )\n    militaryStatus: string;\n\n    //나이가 숫자이고 최소값은 14이고 최대 나이는 100입니다.\n    @Expose() @JoiSchema(Joi.number().min(14).max(100).message('유효하지 않은 나이'))\n    age: number;\n\n\n    //객체 배열이 유효한지 확인합니다.\n    @Expose()\n    @JoiSchema(\n        Joi.array().items(\n                Joi.object({\n                        rating: Joi.number().min(0.1).required(),\n                        comment: Joi.string().min(3).max(300).required(),\n                    }).required(),\n            ).required(),\n    )\n    reviews: reviewInterface[];\n\n    //빈 문자열을 허용하는 필드입니다.\n    @Expose() @JoiSchema(Joi.string().allow('').optional())\n    profilePicture?: string;\n\n    //profilePicture에 값이 있을 경우 profileFileName은 필수이고 그렇지 않으면 선택사항입니다.\n    @Expose() @JoiSchema(\n        Joi.when('profilePicture', {\n            is: Joi.string().exist(),\n            then:  Joi.string().required(),\n            otherwise: Joi.string().allow('').optional(),\n    }))\n    profileFileName: string;\n\n    //isVerified가 부울 값이고 필수인지 확인합니다.\n    @Expose() @JoiSchema(Joi.boolean().required())\n    isVerified: boolean;\n}\n```\n\n## 3. pipe 소개 및 Joi와 함께 사용하는 방법:\n\n- NestJS에서 \"pipe\"는 @Injectable() 데코레이터가 붙은 클래스로, PipeTransform 인터페이스를 구현합니다. Pipe는 일반적으로 데이터의 변환 또는 유효성 검사에 사용됩니다. 메소드 수준, 컨트롤러 수준 또는 전역 수준 등 다양한 수준에서 사용할 수 있습니다.\n- Pipes 소개\n변환: Pipes는 입력 데이터를 원하는 형식으로 변환할 수 있습니다.\n유효성 검사: Pipes는 데이터를 요청 핸들러에 전달하기 전에 데이터를 유효성 검사할 수 있습니다. 데이터가 유효하지 않으면 Pipe가 예외를 throw할 수 있고, 이는 NestJS에서 처리됩니다.\n- 우리의 경우, 일반 객체를 유형화된 객체로 변환하여 유효성을 적용할 수 있게 합니다.\n- 이제 우리가 이전에 만들었던 유효성 파이프를 사용해 보겠습니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport { BadRequestException, Injectable, PipeTransform, Type } from '@nestjs/common’;\nimport { plainToInstance } from 'class-transformer’;\nimport { getClassSchema } from 'joi-class-decorators’;\n\n@Injectable()\nexport class ValidationPipe implements PipeTransform {\n  transform(value: any, metadata: ArgumentMetadata) {\n    const { metatype } = metadata;\n    const bodyDto = metatype; // Dto Schema\n    /*\n      우리의 일반 JavaScript 인수 객체를 형식화된 객체로 변환하여 유효성을 적용합니다.\n      이 작업을 수행해야 하는 이유는, 네트워크 요청에서 역직렬화된 전송 온 post body 객체에는 어떤 유형 정보도 포함되어 있지 않기 때문입니다. \n    */\n    // getClassSchema(bodyDto) ==\u003e 클래스와 연결된 Joi 유효성 스키마를 가져오는 joi-class-decorators의 함수입니다.\n    const bodyInput = plainToInstance(bodyDto, value); // 일반 Dto 객체를 인스턴스로 변환하여 수동으로 변환합니다\n    const bodySchema = getClassSchema(bodyDto); // Dto에서 Joi 스키마 가져오기\n    // 클래스 인스턴스를 Joi 스키마에 대해 유효성 검사합니다. 유효성 검사가 실패하면 error에 유효성 오류가 포함됩니다.\n    const error = bodySchema.validate(bodyInput).error;  \n    if (error) {\n      throw new BadRequestException(`유효성 검사 실패: ${error.details.map((err) =\u003e err.message).join(', ')}.`);  \n    }\n    return value\n  }\n}\ninterface ArgumentMetadata {\n  type: 'body' | 'query' | 'param' | 'custom';\n  metatype?: Type\u003cunknown\u003e;\n  data?: string;\n}\n```\n\n## 4. Param 및 Query Params에 대한 Joi 유효성 검사.\n\n- `/testParams/:category’` 경로를 만들고, GET 방식으로 작성합니다. category라는 하나의 param을 받고, 두 개의 Query Params인 limit와 page를 받습니다.\n\n```js\n@Get(’/testParams/:category’) \n@HttpCode(HttpStatus.OK) \n@UsePipes(new ValidationPipe()) \ntestJoiValidationParam( \n@Param() category: validationParamDto, \n@Query() limitAndPageSize: validationQueryParamDto, \n@Res() res: Response \n) { \n   res.json({ category, limitAndPageSize }); \n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 이러한 매개변수를 위해 두 개의 DTO를 생성하세요:\n\n```js\n@JoiSchemaOptions({\n    allowUnknown: false\n})\n\nexport class validationParamDto {\n     @Expose() @JoiSchema(Joi.string().valid('Fashions', 'Electronics', 'MobilesPhones', 'Perfumes').required())\n     category: string; \n}\n\n@JoiSchemaOptions({\n    allowUnknown: false\n})\n\nexport class validationQueryParamDto {\n\n    @Expose() @JoiSchema(Joi.number().min(0).max(100).message('잘못된 제한입니다'))\n    limit: string;\n\n    @Expose() @JoiSchema(Joi.number().min(0).max(100).message('잘못된 페이지 크기입니다'))\n    page: string;\n}\n```\n\nGitHub에서 NestJS 샘플 앱을 탐색하세요.","ogImage":{"url":"/assets/img/2024-06-22-1IntroductiontoDataValidationinWebApplications_0.png"},"coverImage":"/assets/img/2024-06-22-1IntroductiontoDataValidationinWebApplications_0.png","tag":["Tech"],"readingTime":7},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003col\u003e\n\u003cli\u003e웹 애플리케이션에서 데이터 유효성 검사 소개.\u003c/li\u003e\n\u003cli\u003eNestJS를 유효성 검사 용으로 설정하기.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003e선행 조건 및 프로젝트 설정.\u003c/li\u003e\n\u003cli\u003e유효성 검사 스키마 생성 및 사용하기.\u003c/li\u003e\n\u003c/ul\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003eJoi와 함께 pipe를 소개하고 사용하는 방법.\u003c/li\u003e\n\u003cli\u003eJoi를 사용하여 매개변수 및 쿼리 매개변수의 유효성 검사.\u003c/li\u003e\n\u003cli\u003e실제 구현: nestjs-joi 및 joi-class-decorators를 활용한 완전한 NestJS 애플리케이션 탐색하기: GitHub의 NestJS Sample App with nestjs-joi.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1\u003e1. 웹 애플리케이션에서 데이터 유효성 검사 소개.\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e데이터 유효성 검사는 사용자가 입력한 데이터나 외부 소스에서 가져온 데이터가 지정된 기준과 형식을 충족하는지 확인하는 프로세스입니다. 데이터 유효성 검사는 클라이언트 측, 서버 측 및 데이터베이스 수준을 포함하여 여러 수준에서 수행할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e2. NestJS를 유효성 검사 용으로 설정하기.\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e전제 조건 및 프로젝트 설정:\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e1. Node 및 npm 설치:\u003c/h2\u003e\n\u003cp\u003eNodejs 웹 사이트에 가서 Node를 설치해야 합니다.\u003c/p\u003e\n\u003ch2\u003e2. NestJs 설치 및 새로운 nestApp 생성:\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm i -g @nestjs/cli\nnest \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e my-nestjs-app\ncd ./my-nestjs-app\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. 새로운 파이프인 validation을 생성하세요:\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// --no-spec =\u003e spec 파일 생성 비활성화\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// --flat =\u003e 요소를 위한 폴더를 생성하지 않습니다.\u003c/span\u003e\nnest g pipe validation --no-spec --flat\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. 필요한 패키지 설치하기 (nestjs-joi, joi-class-decorators)\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm i \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e-transformer joi nestjs-joi joi-\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e-decorators\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e확인 스키마 생성 및 사용:\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e1. \u003ccode\u003e/testBody\u003c/code\u003e 엔드포인트 생성, 메서드 유형: POST, 앱 컨트롤러에서\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBody\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eController\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpCode\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eHttpStatus\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eReq\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eRes\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/common'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAppService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./app.service'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eRequest\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eResponse\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { validationBodyDto } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./validate.dto'\u003c/span\u003e;\n\n@\u003cspan class=\"hljs-title class_\"\u003eController\u003c/span\u003e()\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAppController\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprivate readonly appService: AppService\u003c/span\u003e) {}\n\n  @\u003cspan class=\"hljs-title class_\"\u003ePost\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/testBody'\u003c/span\u003e)\n  @\u003cspan class=\"hljs-title class_\"\u003eHttpCode\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eHttpStatus\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eOK\u003c/span\u003e)\n  \u003cspan class=\"hljs-title function_\"\u003etestJoiValidation\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e@Body() reqBody: validationBodyDto, @Res() res: Response\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = reqBody;\n    res.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e(data);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e2. validate.dto.ts 파일을 만들어서 이 엔드포인트를 검증하고 joi 스키마 클래스(validationBodyDto)를 만드세요:\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"class-transformer\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eJoiSchemaOptions\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"joi-class-decorators\"\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'joi'\u003c/span\u003e;\n\ninterface reviewInterface {\n    \u003cspan class=\"hljs-attr\"\u003erating\u003c/span\u003e: number;\n    \u003cspan class=\"hljs-attr\"\u003ecomment\u003c/span\u003e: string;\n}\n\u003cspan class=\"hljs-comment\"\u003e// @Expose ==\u003e 시리얼라이제이션 및 디시리얼라이제이션을 위해 전환 프로세스에 포함되어야 하는 속성을 표시하는 데 사용됩니다.\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// @JoiSchema() ==\u003e 타입(클래스) 속성에 스키마를 정의합니다. 스키마 주석이 달린 속성은 전체 객체 스키마를 구성하는 데 사용됩니다.\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e//명시적으로 정의되지 않은 속성을 허용하지 않아 엄격한 유효성을 보장합니다. \u003c/span\u003e\n@\u003cspan class=\"hljs-title class_\"\u003eJoiSchemaOptions\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eallowUnknown\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n})\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003evalidationBodyDto\u003c/span\u003e {\n\n   \u003cspan class=\"hljs-comment\"\u003e//기본 유효성 검사는 문자열 유형 및 필수입니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003etrim\u003c/span\u003e().required())\n    \u003cspan class=\"hljs-attr\"\u003efullName\u003c/span\u003e: string;\n\n   \u003cspan class=\"hljs-comment\"\u003e//길이를 확인하고 유효한 이집트 전화 번호인지 확인합니다\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003elength\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e11\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003epattern\u003c/span\u003e(\u003cspan class=\"hljs-regexp\"\u003e/^(011|012|015|010)\\d{8}$/\u003c/span\u003e).required())\n    \u003cspan class=\"hljs-attr\"\u003ephoneNumber\u003c/span\u003e: string;\n\n\n   \u003cspan class=\"hljs-comment\"\u003e//유효한 이메일인지 확인합니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eemail\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eoptional\u003c/span\u003e())\n    email?: string;\n\n    \u003cspan class=\"hljs-comment\"\u003e//값이 M 또는 F인 경우에만 유효성을 확인합니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003evalid\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'M'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'F'\u003c/span\u003e).required())\n    \u003cspan class=\"hljs-attr\"\u003egender\u003c/span\u003e: string;\n\n    \u003cspan class=\"hljs-comment\"\u003e//gender가 M이면 militaryStatus는 필수이고 그렇지 않으면 선택사항입니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\n        \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ewhen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'gender'\u003c/span\u003e, {\n            \u003cspan class=\"hljs-attr\"\u003eis\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'M'\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ethen\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().required(),\n            \u003cspan class=\"hljs-attr\"\u003eotherwise\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eoptional\u003c/span\u003e(),\n        }),\n    )\n    \u003cspan class=\"hljs-attr\"\u003emilitaryStatus\u003c/span\u003e: string;\n\n    \u003cspan class=\"hljs-comment\"\u003e//나이가 숫자이고 최소값은 14이고 최대 나이는 100입니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enumber\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e14\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'유효하지 않은 나이'\u003c/span\u003e))\n    \u003cspan class=\"hljs-attr\"\u003eage\u003c/span\u003e: number;\n\n\n    \u003cspan class=\"hljs-comment\"\u003e//객체 배열이 유효한지 확인합니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e()\n    @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\n        \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003earray\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eitems\u003c/span\u003e(\n                \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eobject\u003c/span\u003e({\n                        \u003cspan class=\"hljs-attr\"\u003erating\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enumber\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0.1\u003c/span\u003e).required(),\n                        \u003cspan class=\"hljs-attr\"\u003ecomment\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e).required(),\n                    }).required(),\n            ).required(),\n    )\n    \u003cspan class=\"hljs-attr\"\u003ereviews\u003c/span\u003e: reviewInterface[];\n\n    \u003cspan class=\"hljs-comment\"\u003e//빈 문자열을 허용하는 필드입니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eoptional\u003c/span\u003e())\n    profilePicture?: string;\n\n    \u003cspan class=\"hljs-comment\"\u003e//profilePicture에 값이 있을 경우 profileFileName은 필수이고 그렇지 않으면 선택사항입니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\n        \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ewhen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'profilePicture'\u003c/span\u003e, {\n            \u003cspan class=\"hljs-attr\"\u003eis\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eexist\u003c/span\u003e(),\n            \u003cspan class=\"hljs-attr\"\u003ethen\u003c/span\u003e:  \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().required(),\n            \u003cspan class=\"hljs-attr\"\u003eotherwise\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003eallow\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eoptional\u003c/span\u003e(),\n    }))\n    \u003cspan class=\"hljs-attr\"\u003eprofileFileName\u003c/span\u003e: string;\n\n    \u003cspan class=\"hljs-comment\"\u003e//isVerified가 부울 값이고 필수인지 확인합니다.\u003c/span\u003e\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eboolean\u003c/span\u003e().required())\n    \u003cspan class=\"hljs-attr\"\u003eisVerified\u003c/span\u003e: boolean;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e3. pipe 소개 및 Joi와 함께 사용하는 방법:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eNestJS에서 \"pipe\"는 @Injectable() 데코레이터가 붙은 클래스로, PipeTransform 인터페이스를 구현합니다. Pipe는 일반적으로 데이터의 변환 또는 유효성 검사에 사용됩니다. 메소드 수준, 컨트롤러 수준 또는 전역 수준 등 다양한 수준에서 사용할 수 있습니다.\u003c/li\u003e\n\u003cli\u003ePipes 소개\n변환: Pipes는 입력 데이터를 원하는 형식으로 변환할 수 있습니다.\n유효성 검사: Pipes는 데이터를 요청 핸들러에 전달하기 전에 데이터를 유효성 검사할 수 있습니다. 데이터가 유효하지 않으면 Pipe가 예외를 throw할 수 있고, 이는 NestJS에서 처리됩니다.\u003c/li\u003e\n\u003cli\u003e우리의 경우, 일반 객체를 유형화된 객체로 변환하여 유효성을 적용할 수 있게 합니다.\u003c/li\u003e\n\u003cli\u003e이제 우리가 이전에 만들었던 유효성 파이프를 사용해 보겠습니다:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eBadRequestException\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eInjectable\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003ePipeTransform\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eType\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/common’;\nimport { plainToInstance } from '\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e-transformer’;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { getClassSchema } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'joi-class-decorators’;\n\n@Injectable()\nexport class ValidationPipe implements PipeTransform {\n  transform(value: any, metadata: ArgumentMetadata) {\n    const { metatype } = metadata;\n    const bodyDto = metatype; // Dto Schema\n    /*\n      우리의 일반 JavaScript 인수 객체를 형식화된 객체로 변환하여 유효성을 적용합니다.\n      이 작업을 수행해야 하는 이유는, 네트워크 요청에서 역직렬화된 전송 온 post body 객체에는 어떤 유형 정보도 포함되어 있지 않기 때문입니다. \n    */\n    // getClassSchema(bodyDto) ==\u003e 클래스와 연결된 Joi 유효성 스키마를 가져오는 joi-class-decorators의 함수입니다.\n    const bodyInput = plainToInstance(bodyDto, value); // 일반 Dto 객체를 인스턴스로 변환하여 수동으로 변환합니다\n    const bodySchema = getClassSchema(bodyDto); // Dto에서 Joi 스키마 가져오기\n    // 클래스 인스턴스를 Joi 스키마에 대해 유효성 검사합니다. 유효성 검사가 실패하면 error에 유효성 오류가 포함됩니다.\n    const error = bodySchema.validate(bodyInput).error;  \n    if (error) {\n      throw new BadRequestException(`유효성 검사 실패: ${error.details.map((err) =\u003e err.message).join('\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e')}.`);  \n    }\n    return value\n  }\n}\ninterface ArgumentMetadata {\n  type: '\u003c/span\u003ebody\u003cspan class=\"hljs-string\"\u003e' | '\u003c/span\u003equery\u003cspan class=\"hljs-string\"\u003e' | '\u003c/span\u003eparam\u003cspan class=\"hljs-string\"\u003e' | '\u003c/span\u003ecustom\u003cspan class=\"hljs-string\"\u003e';\n  metatype?: Type\u0026#x3C;unknown\u003e;\n  data?: string;\n}\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e4. Param 및 Query Params에 대한 Joi 유효성 검사.\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e/testParams/:category’\u003c/code\u003e 경로를 만들고, GET 방식으로 작성합니다. category라는 하나의 param을 받고, 두 개의 Query Params인 limit와 page를 받습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e@\u003cspan class=\"hljs-title class_\"\u003eGet\u003c/span\u003e(’/testParams/:category’) \n@\u003cspan class=\"hljs-title class_\"\u003eHttpCode\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eHttpStatus\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eOK\u003c/span\u003e) \n@\u003cspan class=\"hljs-title class_\"\u003eUsePipes\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eValidationPipe\u003c/span\u003e()) \n\u003cspan class=\"hljs-title function_\"\u003etestJoiValidationParam\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e \n@Param() category: validationParamDto, \n@Query() limitAndPageSize: validationQueryParamDto, \n@Res() res: Response \n\u003c/span\u003e) { \n   res.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({ category, limitAndPageSize }); \n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e이러한 매개변수를 위해 두 개의 DTO를 생성하세요:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e@\u003cspan class=\"hljs-title class_\"\u003eJoiSchemaOptions\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eallowUnknown\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n})\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003evalidationParamDto\u003c/span\u003e {\n     @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estring\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003evalid\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Fashions'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Electronics'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'MobilesPhones'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'Perfumes'\u003c/span\u003e).required())\n     \u003cspan class=\"hljs-attr\"\u003ecategory\u003c/span\u003e: string; \n}\n\n@\u003cspan class=\"hljs-title class_\"\u003eJoiSchemaOptions\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eallowUnknown\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n})\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003evalidationQueryParamDto\u003c/span\u003e {\n\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enumber\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'잘못된 제한입니다'\u003c/span\u003e))\n    \u003cspan class=\"hljs-attr\"\u003elimit\u003c/span\u003e: string;\n\n    @\u003cspan class=\"hljs-title class_\"\u003eExpose\u003c/span\u003e() @\u003cspan class=\"hljs-title class_\"\u003eJoiSchema\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJoi\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enumber\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003emessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'잘못된 페이지 크기입니다'\u003c/span\u003e))\n    \u003cspan class=\"hljs-attr\"\u003epage\u003c/span\u003e: string;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eGitHub에서 NestJS 샘플 앱을 탐색하세요.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-22-1IntroductiontoDataValidationinWebApplications"},"buildId":"aCCUs-qPrLLLWRnkN0AOd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>