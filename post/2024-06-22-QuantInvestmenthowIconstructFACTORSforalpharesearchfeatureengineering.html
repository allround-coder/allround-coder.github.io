<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering" data-gatsby-head="true"/><meta name="twitter:title" content="퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-22 14:12" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_buildManifest.js" defer=""></script><script src="/_next/static/OFpTzInQeZKWBaqJEukNX/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 22, 2024</span><span class="posts_reading_time__f7YPP">7<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png">
<p>어린 계량 연구자를 위해, 판매 측면이든 매입 측면이든 교모명지의 목표는 언제나 모델을 적용하기 전에 어디서 시작하고 다양한 데이터 소스를 어떻게 모아야 하는지입니다. 제가 비슷한 어려움을 겪었고, 때때로 아직도 겪지만 이제는 데이터를 보완하는 가장 적합한 방법에 대해 고민하게 됩니다. 이로서 이전 버전보다 조금 더 정확성을 향상시킬 수 있는지 알아보고 있죠.</p>
<p>그래서 이 기사를 작성하고 있는데, 여러분을 도와 처음 시작하도록 하는 것을 목표로 하고 있습니다. 아래와 같은 Factor를 구축하는 방법을 가르쳐 드리겠습니다:</p>
<ul>
<li>지연 수익 및 모멘텀 요인</li>
<li>Fama 요인</li>
<li>산업 별과 같은 재량적 요인들</li>
</ul>
<div class="content-ad"></div>
<p>이것들만으로 알파를 생성하기에는 충분하지 않지만, 같은 마음가짐과 방법론을 갖고 있으면 직접 기능을 개발할 수 있을 거에요.</p>
<p>단계 1: 원시 데이터 가져오기</p>
<p>제가 좋아하는 몇 가지 이름을 사용하여 매일의 티커 가격을 야후 파이낸스 패키지를 통해 가져오고 있어요.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-comment"># 필수 패키지 가져오기</span>
<span class="hljs-keyword">import</span> yfinance <span class="hljs-keyword">as</span> yf

<span class="hljs-comment"># 티커 데이터를 검색하려는 시간 범위 설정</span>
PeriodStart = <span class="hljs-string">"2000-01-01"</span>
PeriodEnd  = <span class="hljs-string">"2024-05-24"</span>
<span class="hljs-comment"># 티커 목록을 리스트에 넣기</span>
tickerlist = [<span class="hljs-string">"NVDA"</span>, <span class="hljs-string">"AMZN"</span>, <span class="hljs-string">"AAPL"</span>]

<span class="hljs-comment"># 여기서는 조정 종가만 가져오고 있습니다(주식 분할/배당금 등이 반영된 가격입니다).</span>
df = yf.download(tickerlist, start = PeriodStart, end = PeriodEnd)[<span class="hljs-string">'Adj Close'</span>]
df.head()
</code></pre>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_1.png">
<p>만약 이 패키지에 대해 아직 익숙하지 않거나 이 패키지를 통해 사용 가능한 다른 유용한 데이터 포인트에 대해 상기시키려면 다른 기사를 추천드릴게요. 지금까지 시장 데이터에 대한 최고의 무료 자료입니다.</p>
<p>단계 2.1: 모멘텀 팩터 구성</p>
<p>일반적으로 월간 리밸런스 전략을 사용합니다 (또한 파마 팩터는 월간 기준으로 업데이트됩니다). 그래서 제가 일별 티커를 월별로 리샘플링할 겁니다. 그리고 당신도 원하는 주기로 이 빈도를 변경할 수도 있습니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">df_monthly = df.<span class="hljs-title function_">resample</span>(<span class="hljs-string">'M'</span>).<span class="hljs-title function_">last</span>()

<span class="hljs-title function_">print</span>(<span class="hljs-title function_">len</span>(df), <span class="hljs-title function_">len</span>(df_monthly))
df_monthly.<span class="hljs-title function_">tail</span>()
</code></pre>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_2.png" alt="Image 2"></p>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_3.png" alt="Image 3"></p>
<p>We then transform the data following these steps:</p>
<div class="content-ad"></div>
<ul>
<li>각 티커에 대해 1개월, 2개월, 3개월 등 기간별 수익률을 계산합니다.</li>
<li>이상값을 제거하기 위해 수익률을 winsorize합니다. 여기서는 상위 5%와 하위 5%를 정의합니다.</li>
<li>한 달 이상의 수익률의 경우, 이를 월 단위로 복리화합니다.</li>
</ul>
<pre><code class="hljs language-js">lags = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">12</span>,<span class="hljs-number">24</span>]
df_momentum = pd.<span class="hljs-title class_">DataFrame</span>()
outlier_cutoff = <span class="hljs-number">0.05</span>

<span class="hljs-keyword">for</span> lag <span class="hljs-keyword">in</span> <span class="hljs-attr">lags</span>:
    df_momentum[f<span class="hljs-string">'return_{lag}m'</span>] = (df_monthly
                           .<span class="hljs-title function_">pct_change</span>(lag)
                           .<span class="hljs-title function_">stack</span>()
                           .<span class="hljs-title function_">pipe</span>(lambda <span class="hljs-attr">x</span>: x.<span class="hljs-title function_">clip</span>(lower=x.<span class="hljs-title function_">quantile</span>(outlier_cutoff),
                                                  upper=x.<span class="hljs-title function_">quantile</span>(<span class="hljs-number">1</span>-outlier_cutoff)))
                           .<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>)  
                           .<span class="hljs-title function_">pow</span>(<span class="hljs-number">1</span>/lag)
                           .<span class="hljs-title function_">sub</span>(<span class="hljs-number">1</span>)
                           )


df_momentum = df_momentum.<span class="hljs-title function_">swaplevel</span>().<span class="hljs-title function_">sort_index</span>()

df_momentum
</code></pre>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_4.png" alt="이미지"></p>
<p>말씀드린대로, 이 모든 숫자는 서로 다른 기간의 월간 비복리 수익률입니다. 월간 수익률 시리즈 상관 관계를 보여주는 간단한 플롯을 사용합니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns
sns.<span class="hljs-title function_">clustermap</span>(df_momentum.<span class="hljs-title function_">corr</span>(<span class="hljs-string">'spearman'</span>), annot=<span class="hljs-title class_">True</span>, center=<span class="hljs-number">0</span>, cmap=<span class="hljs-string">'vlag'</span>, figsize=(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>))
</code></pre>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_5.png" alt="Image"></p>
<p>현재 월에 대한 금월 수익률의 차이를 계산하여 모멘텀을 얻습니다.</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># 더 긴 기간 수익률에서 지난달 수익률을 뺌으로써 모멘텀 팩터를 얻습니다</span>
<span class="hljs-keyword">for</span> lag <span class="hljs-keyword">in</span> [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">24</span>]:
    df_momentum[<span class="hljs-string">f'return_<span class="hljs-subst">{lag}</span>m_1m'</span>] = df_momentum[<span class="hljs-string">f'return_<span class="hljs-subst">{lag}</span>m'</span>] - df_momentum[<span class="hljs-string">'return_1m'</span>]
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_6.png" alt="이미지"></p>
<p>단계 2.2: 파마 요인 구축하기</p>
<p>파마 개념은 요인 모델의 기초를 구축합니다. 파마 요인 구축에 관한 다른 전체 기사가 있습니다. 그래서 여기에서는 자세한 내용을 생략하겠습니다. 다만, 파마 결과는 YYYYMM 형식으로 반환되며, 이러한 요인들을 위쪽의 모멘텀과 함께 결합하려면 이를 월말 날짜로 변환해야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> warnings
warnings.<span class="hljs-title function_">filterwarnings</span>(<span class="hljs-string">'ignore'</span>)

<span class="hljs-keyword">import</span> pandas_datareader.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> web
<span class="hljs-keyword">from</span> statsmodels.<span class="hljs-property">regression</span>.<span class="hljs-property">rolling</span> <span class="hljs-keyword">import</span> <span class="hljs-title class_">RollingOLS</span>
<span class="hljs-keyword">import</span> statsmodels.<span class="hljs-property">api</span> <span class="hljs-keyword">as</span> sm

# 파마 요인 받아오기
fama_factors = web.<span class="hljs-title class_">DataReader</span>(<span class="hljs-string">'F-F_Research_Data_5_Factors_2x3'</span>, <span class="hljs-string">'famafrench'</span>, start=<span class="hljs-string">'2000'</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">drop</span>(<span class="hljs-string">'RF'</span>, axis=<span class="hljs-number">1</span>)
fama_factors.<span class="hljs-property">index</span> = fama_factors.<span class="hljs-property">index</span>.<span class="hljs-title function_">to_timestamp</span>()
fama_factors = fama_factors.<span class="hljs-title function_">resample</span>(<span class="hljs-string">'M'</span>).<span class="hljs-title function_">last</span>()

# 실제 월 별 수익과 요인 결합
fama_factors = fama_factors.<span class="hljs-title function_">join</span>(df_momentum[<span class="hljs-string">'return_1m'</span>])
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_7.png" alt="image"></p>
<p>그런 다음 각 요소의 베타를 롤링 12개월 회귀분석을 통해 계산합니다.</p>
<pre><code class="hljs language-js">T = <span class="hljs-number">12</span>
betas = (fama_factors.<span class="hljs-title function_">groupby</span>(level=<span class="hljs-string">'Ticker'</span>,
                             group_keys=<span class="hljs-title class_">False</span>)
         .<span class="hljs-title function_">apply</span>(lambda <span class="hljs-attr">x</span>: <span class="hljs-title class_">RollingOLS</span>(endog=x.<span class="hljs-property">return_1m</span>,
                                     exog=sm.<span class="hljs-title function_">add_constant</span>(x.<span class="hljs-title function_">drop</span>(<span class="hljs-string">'return_1m'</span>, axis=<span class="hljs-number">1</span>)),
                                     <span class="hljs-variable language_">window</span>=<span class="hljs-title function_">min</span>(T, x.<span class="hljs-property">shape</span>[<span class="hljs-number">0</span>]-<span class="hljs-number">1</span>))
                .<span class="hljs-title function_">fit</span>(params_only=<span class="hljs-title class_">True</span>)
                .<span class="hljs-property">params</span>
                .<span class="hljs-title function_">drop</span>(<span class="hljs-string">'const'</span>, axis=<span class="hljs-number">1</span>)))
betas.<span class="hljs-title function_">describe</span>()

sns.<span class="hljs-title function_">clustermap</span>(betas.<span class="hljs-title function_">dropna</span>().<span class="hljs-title function_">corr</span>(), annot=<span class="hljs-title class_">True</span>, center=<span class="hljs-number">0</span>, cmap=<span class="hljs-string">'vlag'</span>)
</code></pre>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_8.png" alt="image"></p>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_9.png" alt="image"></p>
<pre><code class="hljs language-js">df_momentum = df_momentum.<span class="hljs-title function_">join</span>(betas.<span class="hljs-title function_">groupby</span>(level=<span class="hljs-string">'Ticker'</span>).<span class="hljs-title function_">shift</span>()).<span class="hljs-title function_">dropna</span>()

df_momentum.<span class="hljs-title function_">info</span>()
df_momentum[[<span class="hljs-string">'Mkt-RF'</span>, <span class="hljs-string">'SMB'</span>, <span class="hljs-string">'HML'</span>, <span class="hljs-string">'RMW'</span>, <span class="hljs-string">'CMA'</span>]].<span class="hljs-title function_">describe</span>()
</code></pre>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_10.png" alt="image"></p>
<p><strong>단계 2.3:</strong> 판단 데이터에 대한 더미 요인 생성하기</p>
<div class="content-ad"></div>
<p>야후쿼리 패키지를 이 yahoo에도 적용하였습니다. 이 패키지를 이용하면 기업 수준의 모든 참조 데이터를 제공합니다. 여기서는 단순히 기업 섹터를 보조 데이터로 추가 기능으로 데이터 프레임에 추가하는 방법을 보여드리겠습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> yahooquery <span class="hljs-keyword">as</span> yq
tickers = yq.<span class="hljs-title class_">Ticker</span>(tickerlist)
df_ref = pd.<span class="hljs-title class_">DataFrame</span>(tickers.<span class="hljs-property">asset_profile</span>)

df_sector = df_ref.<span class="hljs-property">loc</span>[<span class="hljs-string">'sector'</span>, :].<span class="hljs-title function_">to_frame</span>()  #.<span class="hljs-property">index</span>.<span class="hljs-title function_">rename</span>(<span class="hljs-string">'Ticker'</span>)
df_sector.<span class="hljs-property">index</span> = df_sector.<span class="hljs-property">index</span>.<span class="hljs-title function_">rename</span>(<span class="hljs-string">'Ticker'</span>)
df_sector
</code></pre>
<img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_11.png">
<pre><code class="hljs language-js">df_momentum = df_momentum.<span class="hljs-title function_">join</span>(df_sector)

# 더미 데이터 생성
df_dummy = pd.<span class="hljs-title function_">get_dummies</span>(df_momentum, 
                          columns = [<span class="hljs-string">'sector'</span>])

# 이 방법으로 여러 열 이름을 체계적으로 변경하는 방법을 배웠습니다. 매우 효율적이에요!
df_dummy = df_dummy.<span class="hljs-title function_">rename</span>(columns = lambda <span class="hljs-attr">x</span>: x.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'sector_'</span>, <span class="hljs-string">''</span>))
df_dummy.<span class="hljs-title function_">info</span>()
</code></pre>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_12.png" alt="Feature Engineering"></p>
<p>이제 머신 러닝 알고리즘을 적용하기 전에 효과적으로 feature를 구성하는 방법을 보았습니다. 일반적인 주제는 dataframe에 일치하는 ticker 및 날짜의 일관된 인덱스 이름과 합병 전에 일관된 날짜를 보장하는 것입니다. 동일한 마인드셋으로 판매, 인적 자본 데이터와 같은 대체 데이터를 동일한 테이블에 결합할 수 있습니다.</p>
<p>이 기사가 도움이 되었기를 바랍니다. 공감이나 댓글을 남기고 생각을 알려주세요!</p>
<p>즐거운 코딩과 유익한 투자되세요 :)</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"퀀트 투자  알파 리서치를 위한 요소 구성 방법 피처 엔지니어링","description":"","date":"2024-06-22 14:12","slug":"2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering","content":"\n\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png\" /\u003e\n\n어린 계량 연구자를 위해, 판매 측면이든 매입 측면이든 교모명지의 목표는 언제나 모델을 적용하기 전에 어디서 시작하고 다양한 데이터 소스를 어떻게 모아야 하는지입니다. 제가 비슷한 어려움을 겪었고, 때때로 아직도 겪지만 이제는 데이터를 보완하는 가장 적합한 방법에 대해 고민하게 됩니다. 이로서 이전 버전보다 조금 더 정확성을 향상시킬 수 있는지 알아보고 있죠.\n\n그래서 이 기사를 작성하고 있는데, 여러분을 도와 처음 시작하도록 하는 것을 목표로 하고 있습니다. 아래와 같은 Factor를 구축하는 방법을 가르쳐 드리겠습니다:\n\n- 지연 수익 및 모멘텀 요인\n- Fama 요인\n- 산업 별과 같은 재량적 요인들\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n이것들만으로 알파를 생성하기에는 충분하지 않지만, 같은 마음가짐과 방법론을 갖고 있으면 직접 기능을 개발할 수 있을 거에요.\n\n단계 1: 원시 데이터 가져오기\n\n제가 좋아하는 몇 가지 이름을 사용하여 매일의 티커 가격을 야후 파이낸스 패키지를 통해 가져오고 있어요.\n\n```python\nimport pandas as pd\nimport numpy as np\n# 필수 패키지 가져오기\nimport yfinance as yf\n\n# 티커 데이터를 검색하려는 시간 범위 설정\nPeriodStart = \"2000-01-01\"\nPeriodEnd  = \"2024-05-24\"\n# 티커 목록을 리스트에 넣기\ntickerlist = [\"NVDA\", \"AMZN\", \"AAPL\"]\n\n# 여기서는 조정 종가만 가져오고 있습니다(주식 분할/배당금 등이 반영된 가격입니다).\ndf = yf.download(tickerlist, start = PeriodStart, end = PeriodEnd)['Adj Close']\ndf.head()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_1.png\" /\u003e\n\n만약 이 패키지에 대해 아직 익숙하지 않거나 이 패키지를 통해 사용 가능한 다른 유용한 데이터 포인트에 대해 상기시키려면 다른 기사를 추천드릴게요. 지금까지 시장 데이터에 대한 최고의 무료 자료입니다.\n\n단계 2.1: 모멘텀 팩터 구성\n\n일반적으로 월간 리밸런스 전략을 사용합니다 (또한 파마 팩터는 월간 기준으로 업데이트됩니다). 그래서 제가 일별 티커를 월별로 리샘플링할 겁니다. 그리고 당신도 원하는 주기로 이 빈도를 변경할 수도 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ndf_monthly = df.resample('M').last()\n\nprint(len(df), len(df_monthly))\ndf_monthly.tail()\n```\n\n![Image 2](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_2.png)\n\n![Image 3](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_3.png)\n\nWe then transform the data following these steps:\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- 각 티커에 대해 1개월, 2개월, 3개월 등 기간별 수익률을 계산합니다.\n- 이상값을 제거하기 위해 수익률을 winsorize합니다. 여기서는 상위 5%와 하위 5%를 정의합니다.\n- 한 달 이상의 수익률의 경우, 이를 월 단위로 복리화합니다.\n\n```js\nlags = [1,2,3,6,9,12,24]\ndf_momentum = pd.DataFrame()\noutlier_cutoff = 0.05\n\nfor lag in lags:\n    df_momentum[f'return_{lag}m'] = (df_monthly\n                           .pct_change(lag)\n                           .stack()\n                           .pipe(lambda x: x.clip(lower=x.quantile(outlier_cutoff),\n                                                  upper=x.quantile(1-outlier_cutoff)))\n                           .add(1)  \n                           .pow(1/lag)\n                           .sub(1)\n                           )\n\n\ndf_momentum = df_momentum.swaplevel().sort_index()\n\ndf_momentum\n```\n\n![이미지](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_4.png)\n\n말씀드린대로, 이 모든 숫자는 서로 다른 기간의 월간 비복리 수익률입니다. 월간 수익률 시리즈 상관 관계를 보여주는 간단한 플롯을 사용합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport seaborn as sns\nsns.clustermap(df_momentum.corr('spearman'), annot=True, center=0, cmap='vlag', figsize=(6, 6))\n```\n\n![Image](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_5.png)\n\n현재 월에 대한 금월 수익률의 차이를 계산하여 모멘텀을 얻습니다.\n\n```python\n# 더 긴 기간 수익률에서 지난달 수익률을 뺌으로써 모멘텀 팩터를 얻습니다\nfor lag in [2, 3, 6, 9, 12, 24]:\n    df_momentum[f'return_{lag}m_1m'] = df_momentum[f'return_{lag}m'] - df_momentum['return_1m']\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![이미지](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_6.png)\n\n단계 2.2: 파마 요인 구축하기\n\n파마 개념은 요인 모델의 기초를 구축합니다. 파마 요인 구축에 관한 다른 전체 기사가 있습니다. 그래서 여기에서는 자세한 내용을 생략하겠습니다. 다만, 파마 결과는 YYYYMM 형식으로 반환되며, 이러한 요인들을 위쪽의 모멘텀과 함께 결합하려면 이를 월말 날짜로 변환해야 합니다.\n\n```js\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport pandas_datareader.data as web\nfrom statsmodels.regression.rolling import RollingOLS\nimport statsmodels.api as sm\n\n# 파마 요인 받아오기\nfama_factors = web.DataReader('F-F_Research_Data_5_Factors_2x3', 'famafrench', start='2000')[0].drop('RF', axis=1)\nfama_factors.index = fama_factors.index.to_timestamp()\nfama_factors = fama_factors.resample('M').last()\n\n# 실제 월 별 수익과 요인 결합\nfama_factors = fama_factors.join(df_momentum['return_1m'])\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![image](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_7.png)\n\n그런 다음 각 요소의 베타를 롤링 12개월 회귀분석을 통해 계산합니다.\n\n```js\nT = 12\nbetas = (fama_factors.groupby(level='Ticker',\n                             group_keys=False)\n         .apply(lambda x: RollingOLS(endog=x.return_1m,\n                                     exog=sm.add_constant(x.drop('return_1m', axis=1)),\n                                     window=min(T, x.shape[0]-1))\n                .fit(params_only=True)\n                .params\n                .drop('const', axis=1)))\nbetas.describe()\n\nsns.clustermap(betas.dropna().corr(), annot=True, center=0, cmap='vlag')\n```\n\n![image](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_8.png)\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![image](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_9.png)\n\n```js\ndf_momentum = df_momentum.join(betas.groupby(level='Ticker').shift()).dropna()\n\ndf_momentum.info()\ndf_momentum[['Mkt-RF', 'SMB', 'HML', 'RMW', 'CMA']].describe()\n```\n\n![image](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_10.png)\n\n**단계 2.3:** 판단 데이터에 대한 더미 요인 생성하기\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n야후쿼리 패키지를 이 yahoo에도 적용하였습니다. 이 패키지를 이용하면 기업 수준의 모든 참조 데이터를 제공합니다. 여기서는 단순히 기업 섹터를 보조 데이터로 추가 기능으로 데이터 프레임에 추가하는 방법을 보여드리겠습니다.\n\n```js\nimport yahooquery as yq\ntickers = yq.Ticker(tickerlist)\ndf_ref = pd.DataFrame(tickers.asset_profile)\n\ndf_sector = df_ref.loc['sector', :].to_frame()  #.index.rename('Ticker')\ndf_sector.index = df_sector.index.rename('Ticker')\ndf_sector\n```\n\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_11.png\" /\u003e\n\n```js\ndf_momentum = df_momentum.join(df_sector)\n\n# 더미 데이터 생성\ndf_dummy = pd.get_dummies(df_momentum, \n                          columns = ['sector'])\n\n# 이 방법으로 여러 열 이름을 체계적으로 변경하는 방법을 배웠습니다. 매우 효율적이에요!\ndf_dummy = df_dummy.rename(columns = lambda x: x.replace('sector_', ''))\ndf_dummy.info()\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n![Feature Engineering](/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_12.png)\n\n이제 머신 러닝 알고리즘을 적용하기 전에 효과적으로 feature를 구성하는 방법을 보았습니다. 일반적인 주제는 dataframe에 일치하는 ticker 및 날짜의 일관된 인덱스 이름과 합병 전에 일관된 날짜를 보장하는 것입니다. 동일한 마인드셋으로 판매, 인적 자본 데이터와 같은 대체 데이터를 동일한 테이블에 결합할 수 있습니다.\n\n이 기사가 도움이 되었기를 바랍니다. 공감이나 댓글을 남기고 생각을 알려주세요!\n\n즐거운 코딩과 유익한 투자되세요 :)\n","ogImage":{"url":"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png"},"coverImage":"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png","tag":["Tech"],"readingTime":7},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_0.png\"\u003e\n\u003cp\u003e어린 계량 연구자를 위해, 판매 측면이든 매입 측면이든 교모명지의 목표는 언제나 모델을 적용하기 전에 어디서 시작하고 다양한 데이터 소스를 어떻게 모아야 하는지입니다. 제가 비슷한 어려움을 겪었고, 때때로 아직도 겪지만 이제는 데이터를 보완하는 가장 적합한 방법에 대해 고민하게 됩니다. 이로서 이전 버전보다 조금 더 정확성을 향상시킬 수 있는지 알아보고 있죠.\u003c/p\u003e\n\u003cp\u003e그래서 이 기사를 작성하고 있는데, 여러분을 도와 처음 시작하도록 하는 것을 목표로 하고 있습니다. 아래와 같은 Factor를 구축하는 방법을 가르쳐 드리겠습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e지연 수익 및 모멘텀 요인\u003c/li\u003e\n\u003cli\u003eFama 요인\u003c/li\u003e\n\u003cli\u003e산업 별과 같은 재량적 요인들\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e이것들만으로 알파를 생성하기에는 충분하지 않지만, 같은 마음가짐과 방법론을 갖고 있으면 직접 기능을 개발할 수 있을 거에요.\u003c/p\u003e\n\u003cp\u003e단계 1: 원시 데이터 가져오기\u003c/p\u003e\n\u003cp\u003e제가 좋아하는 몇 가지 이름을 사용하여 매일의 티커 가격을 야후 파이낸스 패키지를 통해 가져오고 있어요.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e pd\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e np\n\u003cspan class=\"hljs-comment\"\u003e# 필수 패키지 가져오기\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e yfinance \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e yf\n\n\u003cspan class=\"hljs-comment\"\u003e# 티커 데이터를 검색하려는 시간 범위 설정\u003c/span\u003e\nPeriodStart = \u003cspan class=\"hljs-string\"\u003e\"2000-01-01\"\u003c/span\u003e\nPeriodEnd  = \u003cspan class=\"hljs-string\"\u003e\"2024-05-24\"\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# 티커 목록을 리스트에 넣기\u003c/span\u003e\ntickerlist = [\u003cspan class=\"hljs-string\"\u003e\"NVDA\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"AMZN\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"AAPL\"\u003c/span\u003e]\n\n\u003cspan class=\"hljs-comment\"\u003e# 여기서는 조정 종가만 가져오고 있습니다(주식 분할/배당금 등이 반영된 가격입니다).\u003c/span\u003e\ndf = yf.download(tickerlist, start = PeriodStart, end = PeriodEnd)[\u003cspan class=\"hljs-string\"\u003e'Adj Close'\u003c/span\u003e]\ndf.head()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_1.png\"\u003e\n\u003cp\u003e만약 이 패키지에 대해 아직 익숙하지 않거나 이 패키지를 통해 사용 가능한 다른 유용한 데이터 포인트에 대해 상기시키려면 다른 기사를 추천드릴게요. 지금까지 시장 데이터에 대한 최고의 무료 자료입니다.\u003c/p\u003e\n\u003cp\u003e단계 2.1: 모멘텀 팩터 구성\u003c/p\u003e\n\u003cp\u003e일반적으로 월간 리밸런스 전략을 사용합니다 (또한 파마 팩터는 월간 기준으로 업데이트됩니다). 그래서 제가 일별 티커를 월별로 리샘플링할 겁니다. 그리고 당신도 원하는 주기로 이 빈도를 변경할 수도 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf_monthly = df.\u003cspan class=\"hljs-title function_\"\u003eresample\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'M'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003elast\u003c/span\u003e()\n\n\u003cspan class=\"hljs-title function_\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df), \u003cspan class=\"hljs-title function_\"\u003elen\u003c/span\u003e(df_monthly))\ndf_monthly.\u003cspan class=\"hljs-title function_\"\u003etail\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_2.png\" alt=\"Image 2\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_3.png\" alt=\"Image 3\"\u003e\u003c/p\u003e\n\u003cp\u003eWe then transform the data following these steps:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e각 티커에 대해 1개월, 2개월, 3개월 등 기간별 수익률을 계산합니다.\u003c/li\u003e\n\u003cli\u003e이상값을 제거하기 위해 수익률을 winsorize합니다. 여기서는 상위 5%와 하위 5%를 정의합니다.\u003c/li\u003e\n\u003cli\u003e한 달 이상의 수익률의 경우, 이를 월 단위로 복리화합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003elags = [\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e]\ndf_momentum = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e()\noutlier_cutoff = \u003cspan class=\"hljs-number\"\u003e0.05\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e lag \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elags\u003c/span\u003e:\n    df_momentum[f\u003cspan class=\"hljs-string\"\u003e'return_{lag}m'\u003c/span\u003e] = (df_monthly\n                           .\u003cspan class=\"hljs-title function_\"\u003epct_change\u003c/span\u003e(lag)\n                           .\u003cspan class=\"hljs-title function_\"\u003estack\u003c/span\u003e()\n                           .\u003cspan class=\"hljs-title function_\"\u003epipe\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: x.\u003cspan class=\"hljs-title function_\"\u003eclip\u003c/span\u003e(lower=x.\u003cspan class=\"hljs-title function_\"\u003equantile\u003c/span\u003e(outlier_cutoff),\n                                                  upper=x.\u003cspan class=\"hljs-title function_\"\u003equantile\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e-outlier_cutoff)))\n                           .\u003cspan class=\"hljs-title function_\"\u003eadd\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)  \n                           .\u003cspan class=\"hljs-title function_\"\u003epow\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e/lag)\n                           .\u003cspan class=\"hljs-title function_\"\u003esub\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n                           )\n\n\ndf_momentum = df_momentum.\u003cspan class=\"hljs-title function_\"\u003eswaplevel\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003esort_index\u003c/span\u003e()\n\ndf_momentum\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_4.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e말씀드린대로, 이 모든 숫자는 서로 다른 기간의 월간 비복리 수익률입니다. 월간 수익률 시리즈 상관 관계를 보여주는 간단한 플롯을 사용합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e seaborn \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e sns\nsns.\u003cspan class=\"hljs-title function_\"\u003eclustermap\u003c/span\u003e(df_momentum.\u003cspan class=\"hljs-title function_\"\u003ecorr\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'spearman'\u003c/span\u003e), annot=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, center=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, cmap=\u003cspan class=\"hljs-string\"\u003e'vlag'\u003c/span\u003e, figsize=(\u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_5.png\" alt=\"Image\"\u003e\u003c/p\u003e\n\u003cp\u003e현재 월에 대한 금월 수익률의 차이를 계산하여 모멘텀을 얻습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# 더 긴 기간 수익률에서 지난달 수익률을 뺌으로써 모멘텀 팩터를 얻습니다\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e lag \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e [\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e9\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e]:\n    df_momentum[\u003cspan class=\"hljs-string\"\u003ef'return_\u003cspan class=\"hljs-subst\"\u003e{lag}\u003c/span\u003em_1m'\u003c/span\u003e] = df_momentum[\u003cspan class=\"hljs-string\"\u003ef'return_\u003cspan class=\"hljs-subst\"\u003e{lag}\u003c/span\u003em'\u003c/span\u003e] - df_momentum[\u003cspan class=\"hljs-string\"\u003e'return_1m'\u003c/span\u003e]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_6.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e단계 2.2: 파마 요인 구축하기\u003c/p\u003e\n\u003cp\u003e파마 개념은 요인 모델의 기초를 구축합니다. 파마 요인 구축에 관한 다른 전체 기사가 있습니다. 그래서 여기에서는 자세한 내용을 생략하겠습니다. 다만, 파마 결과는 YYYYMM 형식으로 반환되며, 이러한 요인들을 위쪽의 모멘텀과 함께 결합하려면 이를 월말 날짜로 변환해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e warnings\nwarnings.\u003cspan class=\"hljs-title function_\"\u003efilterwarnings\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'ignore'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e pandas_datareader.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e web\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e statsmodels.\u003cspan class=\"hljs-property\"\u003eregression\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003erolling\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRollingOLS\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e statsmodels.\u003cspan class=\"hljs-property\"\u003eapi\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e sm\n\n# 파마 요인 받아오기\nfama_factors = web.\u003cspan class=\"hljs-title class_\"\u003eDataReader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'F-F_Research_Data_5_Factors_2x3'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'famafrench'\u003c/span\u003e, start=\u003cspan class=\"hljs-string\"\u003e'2000'\u003c/span\u003e)[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'RF'\u003c/span\u003e, axis=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\nfama_factors.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e = fama_factors.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eto_timestamp\u003c/span\u003e()\nfama_factors = fama_factors.\u003cspan class=\"hljs-title function_\"\u003eresample\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'M'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003elast\u003c/span\u003e()\n\n# 실제 월 별 수익과 요인 결합\nfama_factors = fama_factors.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(df_momentum[\u003cspan class=\"hljs-string\"\u003e'return_1m'\u003c/span\u003e])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_7.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e그런 다음 각 요소의 베타를 롤링 12개월 회귀분석을 통해 계산합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eT = \u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e\nbetas = (fama_factors.\u003cspan class=\"hljs-title function_\"\u003egroupby\u003c/span\u003e(level=\u003cspan class=\"hljs-string\"\u003e'Ticker'\u003c/span\u003e,\n                             group_keys=\u003cspan class=\"hljs-title class_\"\u003eFalse\u003c/span\u003e)\n         .\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eRollingOLS\u003c/span\u003e(endog=x.\u003cspan class=\"hljs-property\"\u003ereturn_1m\u003c/span\u003e,\n                                     exog=sm.\u003cspan class=\"hljs-title function_\"\u003eadd_constant\u003c/span\u003e(x.\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'return_1m'\u003c/span\u003e, axis=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)),\n                                     \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e=\u003cspan class=\"hljs-title function_\"\u003emin\u003c/span\u003e(T, x.\u003cspan class=\"hljs-property\"\u003eshape\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n                .\u003cspan class=\"hljs-title function_\"\u003efit\u003c/span\u003e(params_only=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e)\n                .\u003cspan class=\"hljs-property\"\u003eparams\u003c/span\u003e\n                .\u003cspan class=\"hljs-title function_\"\u003edrop\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'const'\u003c/span\u003e, axis=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\nbetas.\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e()\n\nsns.\u003cspan class=\"hljs-title function_\"\u003eclustermap\u003c/span\u003e(betas.\u003cspan class=\"hljs-title function_\"\u003edropna\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ecorr\u003c/span\u003e(), annot=\u003cspan class=\"hljs-title class_\"\u003eTrue\u003c/span\u003e, center=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, cmap=\u003cspan class=\"hljs-string\"\u003e'vlag'\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_8.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_9.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf_momentum = df_momentum.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(betas.\u003cspan class=\"hljs-title function_\"\u003egroupby\u003c/span\u003e(level=\u003cspan class=\"hljs-string\"\u003e'Ticker'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eshift\u003c/span\u003e()).\u003cspan class=\"hljs-title function_\"\u003edropna\u003c/span\u003e()\n\ndf_momentum.\u003cspan class=\"hljs-title function_\"\u003einfo\u003c/span\u003e()\ndf_momentum[[\u003cspan class=\"hljs-string\"\u003e'Mkt-RF'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'SMB'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'HML'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'RMW'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'CMA'\u003c/span\u003e]].\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_10.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e단계 2.3:\u003c/strong\u003e 판단 데이터에 대한 더미 요인 생성하기\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e야후쿼리 패키지를 이 yahoo에도 적용하였습니다. 이 패키지를 이용하면 기업 수준의 모든 참조 데이터를 제공합니다. 여기서는 단순히 기업 섹터를 보조 데이터로 추가 기능으로 데이터 프레임에 추가하는 방법을 보여드리겠습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e yahooquery \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e yq\ntickers = yq.\u003cspan class=\"hljs-title class_\"\u003eTicker\u003c/span\u003e(tickerlist)\ndf_ref = pd.\u003cspan class=\"hljs-title class_\"\u003eDataFrame\u003c/span\u003e(tickers.\u003cspan class=\"hljs-property\"\u003easset_profile\u003c/span\u003e)\n\ndf_sector = df_ref.\u003cspan class=\"hljs-property\"\u003eloc\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e'sector'\u003c/span\u003e, :].\u003cspan class=\"hljs-title function_\"\u003eto_frame\u003c/span\u003e()  #.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Ticker'\u003c/span\u003e)\ndf_sector.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e = df_sector.\u003cspan class=\"hljs-property\"\u003eindex\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Ticker'\u003c/span\u003e)\ndf_sector\n\u003c/code\u003e\u003c/pre\u003e\n\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_11.png\"\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003edf_momentum = df_momentum.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(df_sector)\n\n# 더미 데이터 생성\ndf_dummy = pd.\u003cspan class=\"hljs-title function_\"\u003eget_dummies\u003c/span\u003e(df_momentum, \n                          columns = [\u003cspan class=\"hljs-string\"\u003e'sector'\u003c/span\u003e])\n\n# 이 방법으로 여러 열 이름을 체계적으로 변경하는 방법을 배웠습니다. 매우 효율적이에요!\ndf_dummy = df_dummy.\u003cspan class=\"hljs-title function_\"\u003erename\u003c/span\u003e(columns = lambda \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e: x.\u003cspan class=\"hljs-title function_\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'sector_'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e))\ndf_dummy.\u003cspan class=\"hljs-title function_\"\u003einfo\u003c/span\u003e()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering_12.png\" alt=\"Feature Engineering\"\u003e\u003c/p\u003e\n\u003cp\u003e이제 머신 러닝 알고리즘을 적용하기 전에 효과적으로 feature를 구성하는 방법을 보았습니다. 일반적인 주제는 dataframe에 일치하는 ticker 및 날짜의 일관된 인덱스 이름과 합병 전에 일관된 날짜를 보장하는 것입니다. 동일한 마인드셋으로 판매, 인적 자본 데이터와 같은 대체 데이터를 동일한 테이블에 결합할 수 있습니다.\u003c/p\u003e\n\u003cp\u003e이 기사가 도움이 되었기를 바랍니다. 공감이나 댓글을 남기고 생각을 알려주세요!\u003c/p\u003e\n\u003cp\u003e즐거운 코딩과 유익한 투자되세요 :)\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-22-QuantInvestmenthowIconstructFACTORSforalpharesearchfeatureengineering"},"buildId":"OFpTzInQeZKWBaqJEukNX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>