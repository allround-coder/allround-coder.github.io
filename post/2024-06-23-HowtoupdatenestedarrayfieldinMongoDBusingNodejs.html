<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs" data-gatsby-head="true"/><meta name="twitter:title" content="Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 13:20" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/QH5Mz7n7Y6w0r4_gCGFQf/_buildManifest.js" defer=""></script><script src="/_next/static/QH5Mz7n7Y6w0r4_gCGFQf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">8<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>몽고디비에서 문서 내 배열 업데이트하기.</p>
<p><img src="/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png" alt="이미지"></p>
<p>Node.js와 몽고디비를 이용하여 애플리케이션 배열 내 특정 applicationId의 활성 상태를 업데이트하려면 $set 연산자를 사용해야 합니다. $ 연산자는 쿼리 조건과 일치하는 첫 번째 배열 요소를 업데이트할 수 있도록 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// applications 배열에서 지정된 applicationId를 포함하는 문서를 찾는 쿼리.</span>
<span class="hljs-keyword">const</span> filter = { <span class="hljs-attr">_id</span>: userId, <span class="hljs-string">'applications.applicationId'</span>: applicationId };

<span class="hljs-comment">// 활성 상태를 설정하는 업데이트.</span>
<span class="hljs-keyword">const</span> updateDoc = {
  <span class="hljs-comment">// $set 및 $ 연산자 활용: 일치하는 applicationId의 active 필드를 업데이트.</span>
  <span class="hljs-attr">$set</span>: { <span class="hljs-string">'applications.$.active'</span>: newStatus }
};

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">updateOne</span>(filter, updateDoc);
</code></pre>
<div class="content-ad"></div>
<h2>설명:</h2>
<ul>
<li>필터: 필터 객체는 특정 userId(또는 문서의 다른 고유 식별자)와 applications 배열 내의 applicationId를 가진 문서를 찾고 있는지를 나타냅니다.</li>
<li>업데이트: $set 연산자는 일치하는 배열 요소의 active 필드를 업데이트하기 위해 위치 $ 연산자와 함께 사용됩니다.</li>
</ul>
<h2>이제 중첩된 배열에서 여러 applicationId의 활성 상태를 업데이트하는 방법:</h2>
<p>한 번의 작업에서 applications 배열 내의 여러 applicationId 항목의 활성 상태를 업데이트하려면 $set 연산자를 $[<code>identifier</code>] 배열 필터와 함께 사용할 수 있습니다. 이를 통해 배열 내의 요소를 일치시키고 이에 따라 업데이트할 수 있는 여러 조건을 지정할 수 있습니다.</p>
<div class="content-ad"></div>
<h1>여러 applicationId 항목을 업데이트하는 단계:</h1>
<ul>
<li>MongoDB에 연결: MongoDB 클라이언트를 사용하여 데이터베이스에 연결합니다.</li>
<li>쿼리 정의: 업데이트할 문서를 지정합니다.</li>
<li>Array Filters와 $set 사용: 배열 필터를 사용하여 여러 applicationId 항목을 일치시키고 업데이트합니다.</li>
<li>업데이트 처리: 업데이트 명령을 실행하고 응답을 처리합니다.</li>
</ul>
<h1>예시 코드</h1>
<p>다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 방법입니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>);

<span class="hljs-comment">// 귀하의 MongoDB 연결 문자열과 데이터베이스 이름으로 대체합니다.</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">'mongodb://localhost:27017'</span>;
<span class="hljs-keyword">const</span> dbName = <span class="hljs-string">'귀하의데이터베이스이름'</span>;
<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">'귀하의컬렉션이름'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateApplicationStatu</span>(<span class="hljs-params">userId, updates</span>) {
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(uri, { <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">useUnifiedTopology</span>: <span class="hljs-literal">true</span> });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MongoDB에 연결됨'</span>);

    <span class="hljs-keyword">const</span> database = client.<span class="hljs-title function_">db</span>(dbName);
    <span class="hljs-keyword">const</span> collection = database.<span class="hljs-title function_">collection</span>(collectionName);

    <span class="hljs-comment">// 사용자 문서 가져오기</span>
    <span class="hljs-keyword">const</span> userDoc = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">_id</span>: userId });

    <span class="hljs-keyword">if</span> (!userDoc) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'사용자 문서를 찾을 수 없음'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// applications 배열을 초기화</span>
    <span class="hljs-keyword">if</span> (!userDoc.<span class="hljs-property">applications</span>) {
      userDoc.<span class="hljs-property">applications</span> = [];
    }

    <span class="hljs-keyword">const</span> updateOperations = [];
    <span class="hljs-keyword">const</span> applicationIds = userDoc.<span class="hljs-property">applications</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">app</span> =></span> app.<span class="hljs-property">applicationId</span>);

    <span class="hljs-comment">// 중첩 배열 내 여러 applicationId의 활성 상태를 업데이트</span>
    updates.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">update</span> =></span> {
      <span class="hljs-keyword">if</span> (applicationIds.<span class="hljs-title function_">includes</span>(update.<span class="hljs-property">applicationId</span>)) {
        <span class="hljs-comment">// 기존 애플리케이션 상태를 업데이트</span>
        updateOperations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">updateOne</span>: {
            <span class="hljs-attr">filter</span>: { <span class="hljs-attr">_id</span>: userId, <span class="hljs-string">'applications.applicationId'</span>: update.<span class="hljs-property">applicationId</span> },
            <span class="hljs-attr">update</span>: { 
              <span class="hljs-attr">$set</span>: { <span class="hljs-string">'applications.$.active'</span>: update.<span class="hljs-property">active</span> },
              <span class="hljs-attr">$addToSet</span>: { <span class="hljs-attr">updatedBy</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span> }
            }
          }
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 존재하지 않는 경우 새로운 애플리케이션 추가</span>
        updateOperations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">updateOne</span>: {
            <span class="hljs-attr">filter</span>: { <span class="hljs-attr">_id</span>: userId },
            <span class="hljs-attr">update</span>: {
              <span class="hljs-attr">$push</span>: {
                <span class="hljs-attr">applications</span>: { <span class="hljs-attr">applicationId</span>: update.<span class="hljs-property">applicationId</span>, <span class="hljs-attr">active</span>: update.<span class="hljs-property">active</span> }
              }
            },
            <span class="hljs-attr">$addToSet</span>: { <span class="hljs-attr">updatedBy</span>: req.<span class="hljs-property">session</span>.<span class="hljs-property">userId</span> }
          }
        });
      }
    });

    <span class="hljs-comment">// 대량 쓰기 작업 수행</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">bulkWrite</span>(updateOperations);

    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">modifiedCount</span> > <span class="hljs-number">0</span> || result.<span class="hljs-property">insertedCount</span> > <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'애플리케이션 상태가 성공적으로 업데이트됨.'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'일치하는 애플리케이션이 없거나 변경된 내용이 없습니다.'</span>);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'애플리케이션 상태 업데이트 오류:'</span>, error);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
  }
}

<span class="hljs-comment">// 사용 예시: 여러 애플리케이션 업데이트</span>
<span class="hljs-title function_">updateApplicationStatuses</span>(<span class="hljs-string">'userId123'</span>, [
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Apple'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Mango'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Orange'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> }
]);
</code></pre>
<h1>설명</h1>
<ul>
<li>MongoDB 연결: MongoDB 인스턴스에 연결을 설정합니다.</li>
<li>데이터베이스 및 컬렉션: 작업할 데이터베이스 및 컬렉션을 지정합니다.</li>
<li>필터: 필터 객체는 userId 또는 문서의 다른 고유 식별자를 기반으로 문서를 식별합니다.</li>
<li>업데이트 오브젝트: updateDoc은 $set 연산자를 사용하여 지정된 applicationId 엔트리의 활성 상태를 업데이트합니다. 필드 경로는 배열 필터를 동적으로 사용하기 위해 구성됩니다.</li>
<li>배열 필터: arrayFilters 옵션을 사용하여 어떤 요소를 업데이트해야 하는지를 정의하는 조건을 정의합니다. 각 필터는 업데이트해야 할 applicationId에 해당합니다.</li>
<li>updatedBy 필드: updatedBy는 applications 배열의 일부가 아닌 문서의 별도 필드입니다. 요구 사항에 따라서 applications 배열에서 수정이나 추가가 있을 때마다 updatedBy 필드를 업데이트해야 합니다.</li>
<li>결과 처리: 업데이트 작업이 문서를 수정했는지 확인하고 결과를 로그에 남깁니다.</li>
</ul>
<p>만약 applicationId가 존재하지 않는 경우 해당 활성 상태와 함께 추가되어야 합니다. 이를 위해 쿼리와 업데이트 작업을 혼합해 사용합니다.</p>
<div class="content-ad"></div>
<h1>단계:</h1>
<ul>
<li>문서 가져오기 및 확인: _id별로 문서를 가져와서 applications 배열의 각 applicationId를 확인합니다.</li>
<li>업데이트 수행: applicationId가 있는지 여부에 따라 기존 객체를 업데이트하거나 새로운 객체를 추가합니다.</li>
</ul>
<h1>예시 코드</h1>
<p>다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 전체 예시 코드입니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>);

<span class="hljs-comment">// 귀하의 MongoDB 연결 문자열 및 데이터베이스 이름으로 대체합니다.</span>
<span class="hljs-keyword">const</span> uri = <span class="hljs-string">'mongodb://localhost:27017'</span>;
<span class="hljs-keyword">const</span> dbName = <span class="hljs-string">'당신의데이터베이스이름'</span>;
<span class="hljs-keyword">const</span> collectionName = <span class="hljs-string">'당신의컬렉션이름'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateApplicationStatuses</span>(<span class="hljs-params">userId, updates</span>) {
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(uri, { <span class="hljs-attr">useNewUrlParser</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">useUnifiedTopology</span>: <span class="hljs-literal">true</span> });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MongoDB에 연결되었습니다.'</span>);

    <span class="hljs-keyword">const</span> database = client.<span class="hljs-title function_">db</span>(dbName);
    <span class="hljs-keyword">const</span> collection = database.<span class="hljs-title function_">collection</span>(collectionName);

    <span class="hljs-comment">// 사용자 문서 검색</span>
    <span class="hljs-keyword">const</span> userDoc = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">_id</span>: userId });

    <span class="hljs-keyword">if</span> (!userDoc) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'사용자 문서를 찾을 수 없습니다.'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// applications 배열을 초기화합니다.</span>
    <span class="hljs-keyword">if</span> (!userDoc.<span class="hljs-property">applications</span>) {
      userDoc.<span class="hljs-property">applications</span> = [];
    }

    <span class="hljs-keyword">const</span> updateOperations = [];
    <span class="hljs-keyword">const</span> applicationIds = userDoc.<span class="hljs-property">applications</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">app</span> =></span> app.<span class="hljs-property">applicationId</span>);

    updates.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">update</span> =></span> {
      <span class="hljs-keyword">if</span> (applicationIds.<span class="hljs-title function_">includes</span>(update.<span class="hljs-property">applicationId</span>)) {
        <span class="hljs-comment">// 기존 애플리케이션 상태 업데이트</span>
        updateOperations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">updateOne</span>: {
            <span class="hljs-attr">filter</span>: { <span class="hljs-attr">_id</span>: userId, <span class="hljs-string">'applications.applicationId'</span>: update.<span class="hljs-property">applicationId</span> },
            <span class="hljs-attr">update</span>: { <span class="hljs-attr">$set</span>: { <span class="hljs-string">'applications.$.active'</span>: update.<span class="hljs-property">active</span> } }
          }
        });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 새로운 애플리케이션 추가</span>
        updateOperations.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">updateOne</span>: {
            <span class="hljs-attr">filter</span>: { <span class="hljs-attr">_id</span>: userId },
            <span class="hljs-attr">update</span>: {
              <span class="hljs-attr">$push</span>: {
                <span class="hljs-attr">applications</span>: { <span class="hljs-attr">applicationId</span>: update.<span class="hljs-property">applicationId</span>, <span class="hljs-attr">active</span>: update.<span class="hljs-property">active</span> }
              }
            }
          }
        });
      }
    });

    <span class="hljs-comment">// 일괄 작성 작업 수행</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">bulkWrite</span>(updateOperations);

    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">modifiedCount</span> > <span class="hljs-number">0</span> || result.<span class="hljs-property">insertedCount</span> > <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'애플리케이션 상태를 성공적으로 업데이트했습니다.'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'일치하는 애플리케이션이 없거나 변경 사항이 없습니다.'</span>);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'애플리케이션 상태를 업데이트하는 중 오류 발생:'</span>, error);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
  }
}

<span class="hljs-comment">// 예제 사용법: 여러 애플리케이션을 업데이트</span>
<span class="hljs-title function_">updateApplicationStatuses</span>(<span class="hljs-string">'userId123'</span>, [
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Apple'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Mango'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">applicationId</span>: <span class="hljs-string">'Orange'</span>, <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> }
]);
</code></pre>
<p>만약 도움이 되었다면 👏 👏 를 좀 받아도 괜찮으세요? 다른 사람들에게도 도움이 될 수 있도록 글을 공유해주시면 정말 감사하겠습니다 :)</p>
<p>언제나 환호해 주세요...</p>
<img src="https://miro.medium.com/v2/resize:fit:156/0*9zGASKmAOha2Ov3S.gif">
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Nodejs를 사용하여 MongoDB에서 중첩된 배열 필드를 업데이트하는 방법","description":"","date":"2024-06-23 13:20","slug":"2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs","content":"\n\n몽고디비에서 문서 내 배열 업데이트하기.\n\n![이미지](/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png)\n\nNode.js와 몽고디비를 이용하여 애플리케이션 배열 내 특정 applicationId의 활성 상태를 업데이트하려면 $set 연산자를 사용해야 합니다. $ 연산자는 쿼리 조건과 일치하는 첫 번째 배열 요소를 업데이트할 수 있도록 합니다.\n\n```js\n// applications 배열에서 지정된 applicationId를 포함하는 문서를 찾는 쿼리.\nconst filter = { _id: userId, 'applications.applicationId': applicationId };\n\n// 활성 상태를 설정하는 업데이트.\nconst updateDoc = {\n  // $set 및 $ 연산자 활용: 일치하는 applicationId의 active 필드를 업데이트.\n  $set: { 'applications.$.active': newStatus }\n};\n\nconst result = await collection.updateOne(filter, updateDoc);\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## 설명:\n\n- 필터: 필터 객체는 특정 userId(또는 문서의 다른 고유 식별자)와 applications 배열 내의 applicationId를 가진 문서를 찾고 있는지를 나타냅니다.\n- 업데이트: $set 연산자는 일치하는 배열 요소의 active 필드를 업데이트하기 위해 위치 $ 연산자와 함께 사용됩니다.\n\n## 이제 중첩된 배열에서 여러 applicationId의 활성 상태를 업데이트하는 방법:\n\n한 번의 작업에서 applications 배열 내의 여러 applicationId 항목의 활성 상태를 업데이트하려면 $set 연산자를 $[`identifier`] 배열 필터와 함께 사용할 수 있습니다. 이를 통해 배열 내의 요소를 일치시키고 이에 따라 업데이트할 수 있는 여러 조건을 지정할 수 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 여러 applicationId 항목을 업데이트하는 단계:\n\n- MongoDB에 연결: MongoDB 클라이언트를 사용하여 데이터베이스에 연결합니다.\n- 쿼리 정의: 업데이트할 문서를 지정합니다.\n- Array Filters와 $set 사용: 배열 필터를 사용하여 여러 applicationId 항목을 일치시키고 업데이트합니다.\n- 업데이트 처리: 업데이트 명령을 실행하고 응답을 처리합니다.\n\n# 예시 코드\n\n다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 방법입니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\r\nconst { MongoClient } = require('mongodb');\r\n\r\n// 귀하의 MongoDB 연결 문자열과 데이터베이스 이름으로 대체합니다.\r\nconst uri = 'mongodb://localhost:27017';\r\nconst dbName = '귀하의데이터베이스이름';\r\nconst collectionName = '귀하의컬렉션이름';\r\n\r\nasync function updateApplicationStatu(userId, updates) {\r\n  const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log('MongoDB에 연결됨');\r\n\r\n    const database = client.db(dbName);\r\n    const collection = database.collection(collectionName);\r\n\r\n    // 사용자 문서 가져오기\r\n    const userDoc = await collection.findOne({ _id: userId });\r\n\r\n    if (!userDoc) {\r\n      console.log('사용자 문서를 찾을 수 없음');\r\n      return;\r\n    }\r\n\r\n    // applications 배열을 초기화\r\n    if (!userDoc.applications) {\r\n      userDoc.applications = [];\r\n    }\r\n\r\n    const updateOperations = [];\r\n    const applicationIds = userDoc.applications.map(app =\u003e app.applicationId);\r\n\r\n    // 중첩 배열 내 여러 applicationId의 활성 상태를 업데이트\r\n    updates.forEach(update =\u003e {\r\n      if (applicationIds.includes(update.applicationId)) {\r\n        // 기존 애플리케이션 상태를 업데이트\r\n        updateOperations.push({\r\n          updateOne: {\r\n            filter: { _id: userId, 'applications.applicationId': update.applicationId },\r\n            update: { \r\n              $set: { 'applications.$.active': update.active },\r\n              $addToSet: { updatedBy: req.session.userId }\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        // 존재하지 않는 경우 새로운 애플리케이션 추가\r\n        updateOperations.push({\r\n          updateOne: {\r\n            filter: { _id: userId },\r\n            update: {\r\n              $push: {\r\n                applications: { applicationId: update.applicationId, active: update.active }\r\n              }\r\n            },\r\n            $addToSet: { updatedBy: req.session.userId }\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    // 대량 쓰기 작업 수행\r\n    const result = await collection.bulkWrite(updateOperations);\r\n\r\n    if (result.modifiedCount \u003e 0 || result.insertedCount \u003e 0) {\r\n      console.log('애플리케이션 상태가 성공적으로 업데이트됨.');\r\n    } else {\r\n      console.log('일치하는 애플리케이션이 없거나 변경된 내용이 없습니다.');\r\n    }\r\n  } catch (error) {\r\n    console.error('애플리케이션 상태 업데이트 오류:', error);\r\n  } finally {\r\n    await client.close();\r\n  }\r\n}\r\n\r\n// 사용 예시: 여러 애플리케이션 업데이트\r\nupdateApplicationStatuses('userId123', [\r\n  { applicationId: 'Apple', active: true },\r\n  { applicationId: 'Mango', active: false },\r\n  { applicationId: 'Orange', active: true }\r\n]);\r\n```\r\n\r\n# 설명\r\n\r\n- MongoDB 연결: MongoDB 인스턴스에 연결을 설정합니다.\r\n- 데이터베이스 및 컬렉션: 작업할 데이터베이스 및 컬렉션을 지정합니다.\r\n- 필터: 필터 객체는 userId 또는 문서의 다른 고유 식별자를 기반으로 문서를 식별합니다.\r\n- 업데이트 오브젝트: updateDoc은 $set 연산자를 사용하여 지정된 applicationId 엔트리의 활성 상태를 업데이트합니다. 필드 경로는 배열 필터를 동적으로 사용하기 위해 구성됩니다.\r\n- 배열 필터: arrayFilters 옵션을 사용하여 어떤 요소를 업데이트해야 하는지를 정의하는 조건을 정의합니다. 각 필터는 업데이트해야 할 applicationId에 해당합니다.\r\n- updatedBy 필드: updatedBy는 applications 배열의 일부가 아닌 문서의 별도 필드입니다. 요구 사항에 따라서 applications 배열에서 수정이나 추가가 있을 때마다 updatedBy 필드를 업데이트해야 합니다.\r\n- 결과 처리: 업데이트 작업이 문서를 수정했는지 확인하고 결과를 로그에 남깁니다.\r\n\r\n만약 applicationId가 존재하지 않는 경우 해당 활성 상태와 함께 추가되어야 합니다. 이를 위해 쿼리와 업데이트 작업을 혼합해 사용합니다.\r\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 단계:\n\n- 문서 가져오기 및 확인: _id별로 문서를 가져와서 applications 배열의 각 applicationId를 확인합니다.\n- 업데이트 수행: applicationId가 있는지 여부에 따라 기존 객체를 업데이트하거나 새로운 객체를 추가합니다.\n\n# 예시 코드\n\n다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 전체 예시 코드입니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nconst { MongoClient } = require('mongodb');\n\n// 귀하의 MongoDB 연결 문자열 및 데이터베이스 이름으로 대체합니다.\nconst uri = 'mongodb://localhost:27017';\nconst dbName = '당신의데이터베이스이름';\nconst collectionName = '당신의컬렉션이름';\n\nasync function updateApplicationStatuses(userId, updates) {\n  const client = new MongoClient(uri, { useNewUrlParser: true, useUnifiedTopology: true });\n\n  try {\n    await client.connect();\n    console.log('MongoDB에 연결되었습니다.');\n\n    const database = client.db(dbName);\n    const collection = database.collection(collectionName);\n\n    // 사용자 문서 검색\n    const userDoc = await collection.findOne({ _id: userId });\n\n    if (!userDoc) {\n      console.log('사용자 문서를 찾을 수 없습니다.');\n      return;\n    }\n\n    // applications 배열을 초기화합니다.\n    if (!userDoc.applications) {\n      userDoc.applications = [];\n    }\n\n    const updateOperations = [];\n    const applicationIds = userDoc.applications.map(app =\u003e app.applicationId);\n\n    updates.forEach(update =\u003e {\n      if (applicationIds.includes(update.applicationId)) {\n        // 기존 애플리케이션 상태 업데이트\n        updateOperations.push({\n          updateOne: {\n            filter: { _id: userId, 'applications.applicationId': update.applicationId },\n            update: { $set: { 'applications.$.active': update.active } }\n          }\n        });\n      } else {\n        // 새로운 애플리케이션 추가\n        updateOperations.push({\n          updateOne: {\n            filter: { _id: userId },\n            update: {\n              $push: {\n                applications: { applicationId: update.applicationId, active: update.active }\n              }\n            }\n          }\n        });\n      }\n    });\n\n    // 일괄 작성 작업 수행\n    const result = await collection.bulkWrite(updateOperations);\n\n    if (result.modifiedCount \u003e 0 || result.insertedCount \u003e 0) {\n      console.log('애플리케이션 상태를 성공적으로 업데이트했습니다.');\n    } else {\n      console.log('일치하는 애플리케이션이 없거나 변경 사항이 없습니다.');\n    }\n  } catch (error) {\n    console.error('애플리케이션 상태를 업데이트하는 중 오류 발생:', error);\n  } finally {\n    await client.close();\n  }\n}\n\n// 예제 사용법: 여러 애플리케이션을 업데이트\nupdateApplicationStatuses('userId123', [\n  { applicationId: 'Apple', active: true },\n  { applicationId: 'Mango', active: false },\n  { applicationId: 'Orange', active: true }\n]);\n```\n\n만약 도움이 되었다면 👏 👏 를 좀 받아도 괜찮으세요? 다른 사람들에게도 도움이 될 수 있도록 글을 공유해주시면 정말 감사하겠습니다 :)\n\n언제나 환호해 주세요...\n\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:156/0*9zGASKmAOha2Ov3S.gif\" /\u003e\n","ogImage":{"url":"/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png"},"coverImage":"/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png","tag":["Tech"],"readingTime":8},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e몽고디비에서 문서 내 배열 업데이트하기.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003eNode.js와 몽고디비를 이용하여 애플리케이션 배열 내 특정 applicationId의 활성 상태를 업데이트하려면 $set 연산자를 사용해야 합니다. $ 연산자는 쿼리 조건과 일치하는 첫 번째 배열 요소를 업데이트할 수 있도록 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// applications 배열에서 지정된 applicationId를 포함하는 문서를 찾는 쿼리.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e filter = { \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId, \u003cspan class=\"hljs-string\"\u003e'applications.applicationId'\u003c/span\u003e: applicationId };\n\n\u003cspan class=\"hljs-comment\"\u003e// 활성 상태를 설정하는 업데이트.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e updateDoc = {\n  \u003cspan class=\"hljs-comment\"\u003e// $set 및 $ 연산자 활용: 일치하는 applicationId의 active 필드를 업데이트.\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e$set\u003c/span\u003e: { \u003cspan class=\"hljs-string\"\u003e'applications.$.active'\u003c/span\u003e: newStatus }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003eupdateOne\u003c/span\u003e(filter, updateDoc);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003e설명:\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e필터: 필터 객체는 특정 userId(또는 문서의 다른 고유 식별자)와 applications 배열 내의 applicationId를 가진 문서를 찾고 있는지를 나타냅니다.\u003c/li\u003e\n\u003cli\u003e업데이트: $set 연산자는 일치하는 배열 요소의 active 필드를 업데이트하기 위해 위치 $ 연산자와 함께 사용됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e이제 중첩된 배열에서 여러 applicationId의 활성 상태를 업데이트하는 방법:\u003c/h2\u003e\n\u003cp\u003e한 번의 작업에서 applications 배열 내의 여러 applicationId 항목의 활성 상태를 업데이트하려면 $set 연산자를 $[\u003ccode\u003eidentifier\u003c/code\u003e] 배열 필터와 함께 사용할 수 있습니다. 이를 통해 배열 내의 요소를 일치시키고 이에 따라 업데이트할 수 있는 여러 조건을 지정할 수 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e여러 applicationId 항목을 업데이트하는 단계:\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eMongoDB에 연결: MongoDB 클라이언트를 사용하여 데이터베이스에 연결합니다.\u003c/li\u003e\n\u003cli\u003e쿼리 정의: 업데이트할 문서를 지정합니다.\u003c/li\u003e\n\u003cli\u003eArray Filters와 $set 사용: 배열 필터를 사용하여 여러 applicationId 항목을 일치시키고 업데이트합니다.\u003c/li\u003e\n\u003cli\u003e업데이트 처리: 업데이트 명령을 실행하고 응답을 처리합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e예시 코드\u003c/h1\u003e\n\u003cp\u003e다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 방법입니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mongodb'\u003c/span\u003e);\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e// 귀하의 MongoDB 연결 문자열과 데이터베이스 이름으로 대체합니다.\u003c/span\u003e\r\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e uri = \u003cspan class=\"hljs-string\"\u003e'mongodb://localhost:27017'\u003c/span\u003e;\r\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dbName = \u003cspan class=\"hljs-string\"\u003e'귀하의데이터베이스이름'\u003c/span\u003e;\r\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collectionName = \u003cspan class=\"hljs-string\"\u003e'귀하의컬렉션이름'\u003c/span\u003e;\r\n\r\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdateApplicationStatu\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003euserId, updates\u003c/span\u003e) {\r\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e client = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e(uri, { \u003cspan class=\"hljs-attr\"\u003euseNewUrlParser\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003euseUnifiedTopology\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\r\n\r\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\r\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e client.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e();\r\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'MongoDB에 연결됨'\u003c/span\u003e);\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e database = client.\u003cspan class=\"hljs-title function_\"\u003edb\u003c/span\u003e(dbName);\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collection = database.\u003cspan class=\"hljs-title function_\"\u003ecollection\u003c/span\u003e(collectionName);\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// 사용자 문서 가져오기\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userDoc = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId });\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!userDoc) {\r\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'사용자 문서를 찾을 수 없음'\u003c/span\u003e);\r\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\r\n    }\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// applications 배열을 초기화\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e) {\r\n      userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e = [];\r\n    }\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e updateOperations = [];\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e applicationIds = userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eapp\u003c/span\u003e =\u003e\u003c/span\u003e app.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e);\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// 중첩 배열 내 여러 applicationId의 활성 상태를 업데이트\u003c/span\u003e\r\n    updates.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eupdate\u003c/span\u003e =\u003e\u003c/span\u003e {\r\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (applicationIds.\u003cspan class=\"hljs-title function_\"\u003eincludes\u003c/span\u003e(update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e)) {\r\n        \u003cspan class=\"hljs-comment\"\u003e// 기존 애플리케이션 상태를 업데이트\u003c/span\u003e\r\n        updateOperations.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({\r\n          \u003cspan class=\"hljs-attr\"\u003eupdateOne\u003c/span\u003e: {\r\n            \u003cspan class=\"hljs-attr\"\u003efilter\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId, \u003cspan class=\"hljs-string\"\u003e'applications.applicationId'\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e },\r\n            \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: { \r\n              \u003cspan class=\"hljs-attr\"\u003e$set\u003c/span\u003e: { \u003cspan class=\"hljs-string\"\u003e'applications.$.active'\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e },\r\n              \u003cspan class=\"hljs-attr\"\u003e$addToSet\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eupdatedBy\u003c/span\u003e: req.\u003cspan class=\"hljs-property\"\u003esession\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euserId\u003c/span\u003e }\r\n            }\r\n          }\r\n        });\r\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\r\n        \u003cspan class=\"hljs-comment\"\u003e// 존재하지 않는 경우 새로운 애플리케이션 추가\u003c/span\u003e\r\n        updateOperations.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({\r\n          \u003cspan class=\"hljs-attr\"\u003eupdateOne\u003c/span\u003e: {\r\n            \u003cspan class=\"hljs-attr\"\u003efilter\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId },\r\n            \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: {\r\n              \u003cspan class=\"hljs-attr\"\u003e$push\u003c/span\u003e: {\r\n                \u003cspan class=\"hljs-attr\"\u003eapplications\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e }\r\n              }\r\n            },\r\n            \u003cspan class=\"hljs-attr\"\u003e$addToSet\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eupdatedBy\u003c/span\u003e: req.\u003cspan class=\"hljs-property\"\u003esession\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euserId\u003c/span\u003e }\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    \u003cspan class=\"hljs-comment\"\u003e// 대량 쓰기 작업 수행\u003c/span\u003e\r\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003ebulkWrite\u003c/span\u003e(updateOperations);\r\n\r\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.\u003cspan class=\"hljs-property\"\u003emodifiedCount\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e || result.\u003cspan class=\"hljs-property\"\u003einsertedCount\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\r\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'애플리케이션 상태가 성공적으로 업데이트됨.'\u003c/span\u003e);\r\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\r\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'일치하는 애플리케이션이 없거나 변경된 내용이 없습니다.'\u003c/span\u003e);\r\n    }\r\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\r\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'애플리케이션 상태 업데이트 오류:'\u003c/span\u003e, error);\r\n  } \u003cspan class=\"hljs-keyword\"\u003efinally\u003c/span\u003e {\r\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e client.\u003cspan class=\"hljs-title function_\"\u003eclose\u003c/span\u003e();\r\n  }\r\n}\r\n\r\n\u003cspan class=\"hljs-comment\"\u003e// 사용 예시: 여러 애플리케이션 업데이트\u003c/span\u003e\r\n\u003cspan class=\"hljs-title function_\"\u003eupdateApplicationStatuses\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'userId123'\u003c/span\u003e, [\r\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Apple'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e },\r\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Mango'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e },\r\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Orange'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }\r\n]);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e설명\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eMongoDB 연결: MongoDB 인스턴스에 연결을 설정합니다.\u003c/li\u003e\n\u003cli\u003e데이터베이스 및 컬렉션: 작업할 데이터베이스 및 컬렉션을 지정합니다.\u003c/li\u003e\n\u003cli\u003e필터: 필터 객체는 userId 또는 문서의 다른 고유 식별자를 기반으로 문서를 식별합니다.\u003c/li\u003e\n\u003cli\u003e업데이트 오브젝트: updateDoc은 $set 연산자를 사용하여 지정된 applicationId 엔트리의 활성 상태를 업데이트합니다. 필드 경로는 배열 필터를 동적으로 사용하기 위해 구성됩니다.\u003c/li\u003e\n\u003cli\u003e배열 필터: arrayFilters 옵션을 사용하여 어떤 요소를 업데이트해야 하는지를 정의하는 조건을 정의합니다. 각 필터는 업데이트해야 할 applicationId에 해당합니다.\u003c/li\u003e\n\u003cli\u003eupdatedBy 필드: updatedBy는 applications 배열의 일부가 아닌 문서의 별도 필드입니다. 요구 사항에 따라서 applications 배열에서 수정이나 추가가 있을 때마다 updatedBy 필드를 업데이트해야 합니다.\u003c/li\u003e\n\u003cli\u003e결과 처리: 업데이트 작업이 문서를 수정했는지 확인하고 결과를 로그에 남깁니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e만약 applicationId가 존재하지 않는 경우 해당 활성 상태와 함께 추가되어야 합니다. 이를 위해 쿼리와 업데이트 작업을 혼합해 사용합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e단계:\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e문서 가져오기 및 확인: _id별로 문서를 가져와서 applications 배열의 각 applicationId를 확인합니다.\u003c/li\u003e\n\u003cli\u003e업데이트 수행: applicationId가 있는지 여부에 따라 기존 객체를 업데이트하거나 새로운 객체를 추가합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e예시 코드\u003c/h1\u003e\n\u003cp\u003e다음은 Node.js와 MongoDB를 사용하여 이 작업을 수행하는 전체 예시 코드입니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'mongodb'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// 귀하의 MongoDB 연결 문자열 및 데이터베이스 이름으로 대체합니다.\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e uri = \u003cspan class=\"hljs-string\"\u003e'mongodb://localhost:27017'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dbName = \u003cspan class=\"hljs-string\"\u003e'당신의데이터베이스이름'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collectionName = \u003cspan class=\"hljs-string\"\u003e'당신의컬렉션이름'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupdateApplicationStatuses\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003euserId, updates\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e client = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eMongoClient\u003c/span\u003e(uri, { \u003cspan class=\"hljs-attr\"\u003euseNewUrlParser\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003euseUnifiedTopology\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e });\n\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e client.\u003cspan class=\"hljs-title function_\"\u003econnect\u003c/span\u003e();\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'MongoDB에 연결되었습니다.'\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e database = client.\u003cspan class=\"hljs-title function_\"\u003edb\u003c/span\u003e(dbName);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e collection = database.\u003cspan class=\"hljs-title function_\"\u003ecollection\u003c/span\u003e(collectionName);\n\n    \u003cspan class=\"hljs-comment\"\u003e// 사용자 문서 검색\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e userDoc = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003efindOne\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId });\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!userDoc) {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'사용자 문서를 찾을 수 없습니다.'\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// applications 배열을 초기화합니다.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e) {\n      userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e = [];\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e updateOperations = [];\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e applicationIds = userDoc.\u003cspan class=\"hljs-property\"\u003eapplications\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eapp\u003c/span\u003e =\u003e\u003c/span\u003e app.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e);\n\n    updates.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eupdate\u003c/span\u003e =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (applicationIds.\u003cspan class=\"hljs-title function_\"\u003eincludes\u003c/span\u003e(update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-comment\"\u003e// 기존 애플리케이션 상태 업데이트\u003c/span\u003e\n        updateOperations.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({\n          \u003cspan class=\"hljs-attr\"\u003eupdateOne\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003efilter\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId, \u003cspan class=\"hljs-string\"\u003e'applications.applicationId'\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e },\n            \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003e$set\u003c/span\u003e: { \u003cspan class=\"hljs-string\"\u003e'applications.$.active'\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e } }\n          }\n        });\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// 새로운 애플리케이션 추가\u003c/span\u003e\n        updateOperations.\u003cspan class=\"hljs-title function_\"\u003epush\u003c/span\u003e({\n          \u003cspan class=\"hljs-attr\"\u003eupdateOne\u003c/span\u003e: {\n            \u003cspan class=\"hljs-attr\"\u003efilter\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003e_id\u003c/span\u003e: userId },\n            \u003cspan class=\"hljs-attr\"\u003eupdate\u003c/span\u003e: {\n              \u003cspan class=\"hljs-attr\"\u003e$push\u003c/span\u003e: {\n                \u003cspan class=\"hljs-attr\"\u003eapplications\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eapplicationId\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: update.\u003cspan class=\"hljs-property\"\u003eactive\u003c/span\u003e }\n              }\n            }\n          }\n        });\n      }\n    });\n\n    \u003cspan class=\"hljs-comment\"\u003e// 일괄 작성 작업 수행\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e collection.\u003cspan class=\"hljs-title function_\"\u003ebulkWrite\u003c/span\u003e(updateOperations);\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (result.\u003cspan class=\"hljs-property\"\u003emodifiedCount\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e || result.\u003cspan class=\"hljs-property\"\u003einsertedCount\u003c/span\u003e \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'애플리케이션 상태를 성공적으로 업데이트했습니다.'\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'일치하는 애플리케이션이 없거나 변경 사항이 없습니다.'\u003c/span\u003e);\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'애플리케이션 상태를 업데이트하는 중 오류 발생:'\u003c/span\u003e, error);\n  } \u003cspan class=\"hljs-keyword\"\u003efinally\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e client.\u003cspan class=\"hljs-title function_\"\u003eclose\u003c/span\u003e();\n  }\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 예제 사용법: 여러 애플리케이션을 업데이트\u003c/span\u003e\n\u003cspan class=\"hljs-title function_\"\u003eupdateApplicationStatuses\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'userId123'\u003c/span\u003e, [\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Apple'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Mango'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e },\n  { \u003cspan class=\"hljs-attr\"\u003eapplicationId\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Orange'\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eactive\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e }\n]);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e만약 도움이 되었다면 👏 👏 를 좀 받아도 괜찮으세요? 다른 사람들에게도 도움이 될 수 있도록 글을 공유해주시면 정말 감사하겠습니다 :)\u003c/p\u003e\n\u003cp\u003e언제나 환호해 주세요...\u003c/p\u003e\n\u003cimg src=\"https://miro.medium.com/v2/resize:fit:156/0*9zGASKmAOha2Ov3S.gif\"\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-HowtoupdatenestedarrayfieldinMongoDBusingNodejs"},"buildId":"QH5Mz7n7Y6w0r4_gCGFQf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>