<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload" data-gatsby-head="true"/><meta name="twitter:title" content="Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-20 02:53" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_buildManifest.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 20, 2024</span><span class="posts_reading_time__f7YPP">7<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>이 이야기는 몇 년 전에 썼던 것과 매우 비슷한 내용입니다. 그 이야기는 여러 파일을 업로드하는 진행 막대를 구현하는 것과 관련이 있었습니다. 각 파일의 업로드를 추적하는 데 사용되는 진행 막대가 1개 있었습니다.</p>
<p>이 이야기에서는 Node Express 서버에서 5000개의 객체를 포함하는 photos.json 파일을 다운로드합니다.</p>
<p><img src="/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png" alt="이미지"></p>
<p>아래는 애플리케이션의 간단한 데모입니다. Chrome 개발 도구를 사용하여 느린 3G 연결을 시뮬레이션하여 파일 다운로드가 천천히 진행되는 것을 볼 수 있습니다. 나중에는 추가적인 npm 모듈을 설치하지 않고 시스템에 파일을 다운로드하는 코드 작성 방법을 안내하겠습니다.</p>
<div class="content-ad"></div>
<p>Node Server 프로젝트</p>
<p><img src="/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_1.png" alt="이미지"></p>
<p>index.js</p>
<p>위 파일에 설정된 "Content-Length" 응답 헤더에 유의해주세요. 이 헤더는 프로그레스 바를 구현하는 중요한 단계입니다. 이 헤더는 Angular 애플리케이션에게 받을 데이터의 총 크기를 알려줌으로써 프로그레스 바를 구현하는 데 도움이 됩니다.</p>
<div class="content-ad"></div>
<p>"Content-Disposition" 응답 헤더는 콘텐츠가 브라우저에서 인라인으로 표시되는지(Web 페이지 또는 웹 페이지의 일부로) 아니면 첨부 파일로 다운로드되어 로컬에 저장되는지를 나타내는 헤더입니다.</p>
<p>우리는 콘텐츠가 "photos.json"이라는 파일로 다운로드되기를 원합니다.</p>
<p>Angular 프로젝트</p>
<p>Angular 프로젝트에는 AppComponent와 ProgressComponent 두 개의 컴포넌트가 있습니다.</p>
<div class="content-ad"></div>
<p>우리는 데이터를 가져오기 위해 노드 서버와 연결하는 FileDownloadService라는 단일 서비스를 가지고 있습니다.</p>
<p>AppComponent 템플릿</p>
<p><code>app-progress</code>는 ProgressComponent를 위한 셀렉터입니다. 이미지 업로드 진행률을 @Input('ratio')로 ProgressComponent에 전달하고 있습니다. 업로드 진행률은 downloadprogressRatio$ observable을 구독하여 async 파이프를 통해 @Input('ratio')로 전달됩니다.</p>
<pre><code class="hljs language-js">&#x3C;h4><span class="hljs-title class_">Downloading</span>&#x3C;/h4>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">app-progress</span> [<span class="hljs-attr">ratio</span>]=<span class="hljs-string">”downloadprogressRatio$|async”</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">app-progress</span>></span></span>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">”download()”</span>></span>Download JSON<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span></span>
</code></pre>
<div class="content-ad"></div>
<p>“Download JSON” 버튼을 클릭하면, 해당 클래스에서 download()을 호출하게 됩니다.</p>
<p>AppComponent 클래스</p>
<ul>
<li>downloadProgressRatio$는 observable입니다. 우리는 FileDownloadService에서 반환된 getDownloadingProgress()의 observable을 downloadProgressRatio$ observable에 할당합니다. 이 observable은 템플릿에서 async 파이프를 통해 구독됩니다.</li>
</ul>
<pre><code class="hljs language-js">&#x3C;app-progress [ratio]=”downloadprogressRatio$|<span class="hljs-keyword">async</span>”>&#x3C;/app-progress>
</code></pre>
<div class="content-ad"></div>
<ol start="2">
<li>템플릿의 "다운로드" 버튼을 클릭하면, 해당 클래스의 download()이 호출되며, 이 메서드는 FileDownloadService의 downloadJson()을 호출합니다.</li>
</ol>
<p>FileDownloadService</p>
<ul>
<li>downloadingProgressSub는 각 파일의 다운로드 진행 상황을 컴포넌트에 실시간 업데이트해 주는 중요한 역할을 하는 Subject입니다.</li>
<li>이미 클래스의 ngOnInit()에서 getDownloadingProgress()가 호출되었음을 확인했습니다. 이 메서드는 해당 Subject에 대한 Observable을 반환하는 역할을 합니다.</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-title function_">getDownloadingProgress</span>(<span class="hljs-params"></span>){
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadingProgressSub</span>.<span class="hljs-title function_">asObservable</span>();
}
</code></pre>
<div class="content-ad"></div>
<ol start="3">
<li>"Download JSON" 버튼을 클릭하면 downloadJson() 함수가 호출됩니다. 우리는 Node 서버에서 photos.json을 가져오기 위해 GET 요청을 보냅니다.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-title function_">downloadJson</span>(<span class="hljs-params"></span>)
{
<span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${environment.baseUrl}</span>photos`</span>,{<span class="hljs-attr">reportProgress</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">observe</span>:<span class="hljs-string">'events'</span>}).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params">response:any</span>)=></span>{
    <span class="hljs-keyword">if</span>(response.<span class="hljs-property">type</span>==<span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">DownloadProgress</span>){ <span class="hljs-comment">//3</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setDownloadingProgress</span>(response.<span class="hljs-property">loaded</span>/response.<span class="hljs-property">total</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.<span class="hljs-property">type</span> === <span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">Response</span>){
      <span class="hljs-keyword">let</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">body</span>)]);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">downloadBlob</span>(response,blob);
    }
  }),
  <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span>=></span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(err)
  })
)
}
</code></pre>
<ol start="4">
<li>HTTP GET 요청에 전달되는 추가 옵션을 관찰해주세요.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${environment.baseUrl}</span>photos`</span>,{<span class="hljs-attr">reportProgress</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">observe</span>:’events’})
</code></pre>
<div class="content-ad"></div>
<p>파일 다운로드 진행 상황에 대한 피드백을 제공하여 사용자들에게 더 나은 경험을 제공하고 있습니다. 우리는 진행 상황 추적을 가능하게 하기 위해 reportProgress를 true로 설정했습니다.</p>
<p>observe 값은 관찰하고자 하는 내용에 따라 반환 유형을 결정합니다. "events"의 observe 값은 기본적으로 진행 상황 이벤트를 포함한 HttpEvent 스트림의 observable을 반환합니다.</p>
<ol start="5">
<li>서버로부터 데이터를 받기 때문에, HttpEvent의 유형은 DownloadProgress(UploadProgress가 아님)일 것입니다.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-keyword">if</span>(event.<span class="hljs-property">type</span>==<span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">DownloadProgress</span>){ <span class="hljs-comment">//3</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setDownloadingProgress</span>(event.<span class="hljs-property">loaded</span>/event.<span class="hljs-property">total</span>);
}
</code></pre>
<div class="content-ad"></div>
<p>event.load은 로드된 파일의 바이트 수입니다.</p>
<p>event.total은 로드해야하는 전체 바이트 수입니다.</p>
<p>event.load/event.total은 업로드 중인 파일의 진행률을 나타냅니다.</p>
<p>저희는 setDownloadingProgress()를 호출하여 진행률을 인수로 전달합니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-title function_">setDownloadingProgress</span>(<span class="hljs-params">data: any</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadingProgressSub</span>.<span class="hljs-title function_">next</span>(data);
}
</code></pre>
<p>setDownloadingProgress() 메서드에서는 진행률 비율을 downloadingProgressSub Subject로 전달하고 있습니다.</p>
<p>AppComponent 템플릿에서 이 Subject에 async pipe를 통해 구독하고 있다는 것을 기억하시나요?</p>
<ol start="6">
<li>Node 서버로부터 본문을 포함한 전체 응답을 받으면, HttpEvent는 Response 유형이 됩니다. 그런 다음 응답 본문에서 Blob 객체를 생성하고 이 blob 객체 및 HttpResponse를 downloadBlob() 메서드에 인수로 전달합니다.</li>
</ol>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(response.<span class="hljs-property">type</span> === <span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">Response</span>){
<span class="hljs-keyword">let</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">body</span>)]);
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">downloadBlob</span>(response, blob);
}
</code></pre>
<ol start="7">
<li>Inside the <code>downloadBlob()</code>, we have written a common logic to perform automatic download of file received.</li>
</ol>
<pre><code class="hljs language-js"><span class="hljs-title function_">downloadBlob</span>(<span class="hljs-params">response: any, blob: Blob</span>){

<span class="hljs-keyword">let</span> substringA = response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-disposition'</span>).<span class="hljs-title function_">substring</span>(response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-disposition'</span>).<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">";"</span>) + <span class="hljs-number">1</span>);
<span class="hljs-keyword">let</span> filename = substringA.<span class="hljs-title function_">substring</span>(substringA.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"="</span>) + <span class="hljs-number">1</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[""]/g</span>, <span class="hljs-string">""</span>);
<span class="hljs-keyword">let</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
link.<span class="hljs-property">download</span> = filename;
link.<span class="hljs-property">href</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
link.<span class="hljs-title function_">click</span>();
}
</code></pre>
<p>We are first extracting the filename from the Content-Disposition response header.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> substringA=response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-disposition'</span>).<span class="hljs-title function_">substring</span>(response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-disposition'</span>).<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">";"</span>)+<span class="hljs-number">1</span>);
<span class="hljs-keyword">let</span> filename= substringA.<span class="hljs-title function_">substring</span>(substringA.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"="</span>)+<span class="hljs-number">1</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[“”]+/g</span>,<span class="hljs-string">""</span>);
</code></pre>
<p>이것이 Content-Disposition 헤더가 보이는 모습입니다.</p>
<p>다음으로 앵커 요소인 <code>a</code>를 생성하고 요소의 다운로드 및 href 속성을 설정합니다. 다운로드 속성은 파일 이름으로 설정됩니다. href 속성은 Blob 객체에 대해 생성된 객체 URL로 설정됩니다. Blob는 createObjectURL()을 사용하여 내용을 보여주기 위해 <code>a</code>, <code>img</code> 또는 다른 태그를 사용할 수 있습니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
link.<span class="hljs-property">download</span> = filename;
link.<span class="hljs-property">href</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
</code></pre>
<div class="content-ad"></div>
<p>마지막으로 앵커 요소를 프로그래밍 방식으로 클릭하여 다운로드가 자동으로 시작되도록 합니다. 우리는 앵커 요소를 DOM에 첨부하고 싶지 않습니다.</p>
<pre><code class="hljs language-js">link.<span class="hljs-title function_">click</span>();
</code></pre>
<p>ProgressComponent 템플릿</p>
<pre><code class="hljs language-js">&#x3C;div <span class="hljs-keyword">class</span>=”container pending”>
<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">”progress-container”</span> [<span class="hljs-attr">ngClass</span>]=<span class="hljs-string">”ratio</span> === <span class="hljs-string">1</span> ? ‘<span class="hljs-attr">complete</span>’ <span class="hljs-attr">:</span> ‘<span class="hljs-attr">pending</span>’”></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> [<span class="hljs-attr">ngStyle</span>]=<span class="hljs-string">”{width:progress}”</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">”progress-message”</span>></span>{progress}<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
&#x3C;/div>
</code></pre>
<div class="content-ad"></div>
<p>"complete" 및 "pending" CSS 클래스는 아래와 같이 정의되어 있습니다:</p>
<pre><code class="hljs language-js">.<span class="hljs-property">complete</span> {
  background-<span class="hljs-attr">color</span>: lightgreen;
}
.<span class="hljs-property">pending</span> {
  background-<span class="hljs-attr">color</span>: <span class="hljs-title function_">rgb</span>(<span class="hljs-number">243</span>, <span class="hljs-number">111</span>, <span class="hljs-number">111</span>);
}
</code></pre>
<p>ProgressComponent 클래스</p>
<p>이 클래스는 AppComponent로부터 속성 바인딩을 통해 @Input('ratio')를 수신합니다. 우리는 이 비율에 100을 곱하여 백분율을 얻은 다음 가장 가까운 정수로 반올림합니다. 이 백분율을 사용하여 진행 막대의 너비를 조정합니다.</p>
<div class="content-ad"></div>
<p>아래는 앵귤러 및 노드 프로젝트의 git 저장소입니다.</p>
<h1>Stackademic 🎓</h1>
<p>끝까지 읽어주셔서 감사합니다. 떠나기 전에:</p>
<ul>
<li>작가를 클릭하고 팔로우해주시면 감사하겠습니다! 👏</li>
<li>우리를 팔로우하세요 X | LinkedIn | YouTube | Discord</li>
<li>다른 플랫폼에서도 방문해주세요: In Plain English | CoFeed | Differ</li>
<li>Stackademic.com에서 더 많은 콘텐츠를 확인할 수 있습니다.</li>
</ul>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Angular 파일 다운로드 및 다운로드 추적을 위한 프로그레스 바 구현하기","description":"","date":"2024-06-20 02:53","slug":"2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload","content":"\n\n이 이야기는 몇 년 전에 썼던 것과 매우 비슷한 내용입니다. 그 이야기는 여러 파일을 업로드하는 진행 막대를 구현하는 것과 관련이 있었습니다. 각 파일의 업로드를 추적하는 데 사용되는 진행 막대가 1개 있었습니다.\n\n이 이야기에서는 Node Express 서버에서 5000개의 객체를 포함하는 photos.json 파일을 다운로드합니다.\n\n![이미지](/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png)\n\n아래는 애플리케이션의 간단한 데모입니다. Chrome 개발 도구를 사용하여 느린 3G 연결을 시뮬레이션하여 파일 다운로드가 천천히 진행되는 것을 볼 수 있습니다. 나중에는 추가적인 npm 모듈을 설치하지 않고 시스템에 파일을 다운로드하는 코드 작성 방법을 안내하겠습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nNode Server 프로젝트\n\n![이미지](/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_1.png)\n\nindex.js\n\n위 파일에 설정된 \"Content-Length\" 응답 헤더에 유의해주세요. 이 헤더는 프로그레스 바를 구현하는 중요한 단계입니다. 이 헤더는 Angular 애플리케이션에게 받을 데이터의 총 크기를 알려줌으로써 프로그레스 바를 구현하는 데 도움이 됩니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\"Content-Disposition\" 응답 헤더는 콘텐츠가 브라우저에서 인라인으로 표시되는지(Web 페이지 또는 웹 페이지의 일부로) 아니면 첨부 파일로 다운로드되어 로컬에 저장되는지를 나타내는 헤더입니다.\n\n우리는 콘텐츠가 \"photos.json\"이라는 파일로 다운로드되기를 원합니다.\n\nAngular 프로젝트\n\nAngular 프로젝트에는 AppComponent와 ProgressComponent 두 개의 컴포넌트가 있습니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n우리는 데이터를 가져오기 위해 노드 서버와 연결하는 FileDownloadService라는 단일 서비스를 가지고 있습니다.\n\nAppComponent 템플릿\n\n`app-progress`는 ProgressComponent를 위한 셀렉터입니다. 이미지 업로드 진행률을 @Input('ratio')로 ProgressComponent에 전달하고 있습니다. 업로드 진행률은 downloadprogressRatio$ observable을 구독하여 async 파이프를 통해 @Input('ratio')로 전달됩니다.\n\n```js\n\u003ch4\u003eDownloading\u003c/h4\u003e\n\u003capp-progress [ratio]=”downloadprogressRatio$|async”\u003e\u003c/app-progress\u003e\n\u003cbutton (click)=”download()”\u003eDownload JSON\u003c/button\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n“Download JSON” 버튼을 클릭하면, 해당 클래스에서 download()을 호출하게 됩니다.\n\nAppComponent 클래스\n\n- downloadProgressRatio$는 observable입니다. 우리는 FileDownloadService에서 반환된 getDownloadingProgress()의 observable을 downloadProgressRatio$ observable에 할당합니다. 이 observable은 템플릿에서 async 파이프를 통해 구독됩니다.\n\n```js\n\u003capp-progress [ratio]=”downloadprogressRatio$|async”\u003e\u003c/app-progress\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n2. 템플릿의 \"다운로드\" 버튼을 클릭하면, 해당 클래스의 download()이 호출되며, 이 메서드는 FileDownloadService의 downloadJson()을 호출합니다.\n\nFileDownloadService\n\n- downloadingProgressSub는 각 파일의 다운로드 진행 상황을 컴포넌트에 실시간 업데이트해 주는 중요한 역할을 하는 Subject입니다.\n- 이미 클래스의 ngOnInit()에서 getDownloadingProgress()가 호출되었음을 확인했습니다. 이 메서드는 해당 Subject에 대한 Observable을 반환하는 역할을 합니다.\n\n```js\ngetDownloadingProgress(){\n    return this.downloadingProgressSub.asObservable();\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n3. \"Download JSON\" 버튼을 클릭하면 downloadJson() 함수가 호출됩니다. 우리는 Node 서버에서 photos.json을 가져오기 위해 GET 요청을 보냅니다.\n\n```js\ndownloadJson()\n{\nreturn this.http.get(`${environment.baseUrl}photos`,{reportProgress:true,observe:'events'}).pipe(\n  tap((response:any)=\u003e{\n    if(response.type==HttpEventType.DownloadProgress){ //3\n      this.setDownloadingProgress(response.loaded/response.total);\n    }\n    else if(response.type === HttpEventType.Response){\n      let blob = new Blob([JSON.stringify(response.body)]);\n      this.downloadBlob(response,blob);\n    }\n  }),\n  catchError(err=\u003e{\n    return throwError(err)\n  })\n)\n}\n```\n\n4. HTTP GET 요청에 전달되는 추가 옵션을 관찰해주세요.\n\n```js\nthis.http.get(`${environment.baseUrl}photos`,{reportProgress:true,observe:’events’})\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n파일 다운로드 진행 상황에 대한 피드백을 제공하여 사용자들에게 더 나은 경험을 제공하고 있습니다. 우리는 진행 상황 추적을 가능하게 하기 위해 reportProgress를 true로 설정했습니다.\n\nobserve 값은 관찰하고자 하는 내용에 따라 반환 유형을 결정합니다. \"events\"의 observe 값은 기본적으로 진행 상황 이벤트를 포함한 HttpEvent 스트림의 observable을 반환합니다.\n\n5. 서버로부터 데이터를 받기 때문에, HttpEvent의 유형은 DownloadProgress(UploadProgress가 아님)일 것입니다.\n\n```js\nif(event.type==HttpEventType.DownloadProgress){ //3\nthis.setDownloadingProgress(event.loaded/event.total);\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nevent.load은 로드된 파일의 바이트 수입니다.\n\nevent.total은 로드해야하는 전체 바이트 수입니다.\n\nevent.load/event.total은 업로드 중인 파일의 진행률을 나타냅니다.\n\n저희는 setDownloadingProgress()를 호출하여 진행률을 인수로 전달합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nsetDownloadingProgress(data: any) {\n    this.downloadingProgressSub.next(data);\n}\n```\n\nsetDownloadingProgress() 메서드에서는 진행률 비율을 downloadingProgressSub Subject로 전달하고 있습니다.\n\nAppComponent 템플릿에서 이 Subject에 async pipe를 통해 구독하고 있다는 것을 기억하시나요?\n\n6. Node 서버로부터 본문을 포함한 전체 응답을 받으면, HttpEvent는 Response 유형이 됩니다. 그런 다음 응답 본문에서 Blob 객체를 생성하고 이 blob 객체 및 HttpResponse를 downloadBlob() 메서드에 인수로 전달합니다.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nelse if(response.type === HttpEventType.Response){\nlet blob = new Blob([JSON.stringify(response.body)]);\nthis.downloadBlob(response, blob);\n}\n```\n\n7. Inside the `downloadBlob()`, we have written a common logic to perform automatic download of file received.\n\n```js\ndownloadBlob(response: any, blob: Blob){\n\nlet substringA = response.headers.get('content-disposition').substring(response.headers.get('content-disposition').indexOf(\";\") + 1);\nlet filename = substringA.substring(substringA.indexOf(\"=\") + 1).replace(/[\"\"]/g, \"\");\nlet link = document.createElement('a');\nlink.download = filename;\nlink.href = URL.createObjectURL(blob);\nlink.click();\n}\n```\n\nWe are first extracting the filename from the Content-Disposition response header.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nlet substringA=response.headers.get('content-disposition').substring(response.headers.get('content-disposition').indexOf(\";\")+1);\nlet filename= substringA.substring(substringA.indexOf(\"=\")+1).replace(/[“”]+/g,\"\");\n```\n\n이것이 Content-Disposition 헤더가 보이는 모습입니다.\n\n다음으로 앵커 요소인 `a`를 생성하고 요소의 다운로드 및 href 속성을 설정합니다. 다운로드 속성은 파일 이름으로 설정됩니다. href 속성은 Blob 객체에 대해 생성된 객체 URL로 설정됩니다. Blob는 createObjectURL()을 사용하여 내용을 보여주기 위해 `a`, `img` 또는 다른 태그를 사용할 수 있습니다.\n\n```js\nlet link = document.createElement('a');\nlink.download = filename;\nlink.href = URL.createObjectURL(blob);\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n마지막으로 앵커 요소를 프로그래밍 방식으로 클릭하여 다운로드가 자동으로 시작되도록 합니다. 우리는 앵커 요소를 DOM에 첨부하고 싶지 않습니다.\n\n```js\nlink.click();\n```\n\nProgressComponent 템플릿\n\n```js\n\u003cdiv class=”container pending”\u003e\n\u003cdiv class=”progress-container” [ngClass]=”ratio === 1 ? ‘complete’ : ‘pending’”\u003e\n\u003cdiv [ngStyle]=”{width:progress}”\u003e\n\u003c/div\u003e\n\u003cdiv class=”progress-message”\u003e{progress}\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\"complete\" 및 \"pending\" CSS 클래스는 아래와 같이 정의되어 있습니다:\n\n```js\n.complete {\n  background-color: lightgreen;\n}\n.pending {\n  background-color: rgb(243, 111, 111);\n}\n```\n\nProgressComponent 클래스\n\n이 클래스는 AppComponent로부터 속성 바인딩을 통해 @Input('ratio')를 수신합니다. 우리는 이 비율에 100을 곱하여 백분율을 얻은 다음 가장 가까운 정수로 반올림합니다. 이 백분율을 사용하여 진행 막대의 너비를 조정합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n아래는 앵귤러 및 노드 프로젝트의 git 저장소입니다.\n\n# Stackademic 🎓\n\n끝까지 읽어주셔서 감사합니다. 떠나기 전에:\n\n- 작가를 클릭하고 팔로우해주시면 감사하겠습니다! 👏\n- 우리를 팔로우하세요 X | LinkedIn | YouTube | Discord\n- 다른 플랫폼에서도 방문해주세요: In Plain English | CoFeed | Differ\n- Stackademic.com에서 더 많은 콘텐츠를 확인할 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png"},"coverImage":"/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png","tag":["Tech"],"readingTime":7},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003e이 이야기는 몇 년 전에 썼던 것과 매우 비슷한 내용입니다. 그 이야기는 여러 파일을 업로드하는 진행 막대를 구현하는 것과 관련이 있었습니다. 각 파일의 업로드를 추적하는 데 사용되는 진행 막대가 1개 있었습니다.\u003c/p\u003e\n\u003cp\u003e이 이야기에서는 Node Express 서버에서 5000개의 객체를 포함하는 photos.json 파일을 다운로드합니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_0.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003e아래는 애플리케이션의 간단한 데모입니다. Chrome 개발 도구를 사용하여 느린 3G 연결을 시뮬레이션하여 파일 다운로드가 천천히 진행되는 것을 볼 수 있습니다. 나중에는 추가적인 npm 모듈을 설치하지 않고 시스템에 파일을 다운로드하는 코드 작성 방법을 안내하겠습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eNode Server 프로젝트\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload_1.png\" alt=\"이미지\"\u003e\u003c/p\u003e\n\u003cp\u003eindex.js\u003c/p\u003e\n\u003cp\u003e위 파일에 설정된 \"Content-Length\" 응답 헤더에 유의해주세요. 이 헤더는 프로그레스 바를 구현하는 중요한 단계입니다. 이 헤더는 Angular 애플리케이션에게 받을 데이터의 총 크기를 알려줌으로써 프로그레스 바를 구현하는 데 도움이 됩니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\"Content-Disposition\" 응답 헤더는 콘텐츠가 브라우저에서 인라인으로 표시되는지(Web 페이지 또는 웹 페이지의 일부로) 아니면 첨부 파일로 다운로드되어 로컬에 저장되는지를 나타내는 헤더입니다.\u003c/p\u003e\n\u003cp\u003e우리는 콘텐츠가 \"photos.json\"이라는 파일로 다운로드되기를 원합니다.\u003c/p\u003e\n\u003cp\u003eAngular 프로젝트\u003c/p\u003e\n\u003cp\u003eAngular 프로젝트에는 AppComponent와 ProgressComponent 두 개의 컴포넌트가 있습니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e우리는 데이터를 가져오기 위해 노드 서버와 연결하는 FileDownloadService라는 단일 서비스를 가지고 있습니다.\u003c/p\u003e\n\u003cp\u003eAppComponent 템플릿\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eapp-progress\u003c/code\u003e는 ProgressComponent를 위한 셀렉터입니다. 이미지 업로드 진행률을 @Input('ratio')로 ProgressComponent에 전달하고 있습니다. 업로드 진행률은 downloadprogressRatio$ observable을 구독하여 async 파이프를 통해 @Input('ratio')로 전달됩니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;h4\u003e\u003cspan class=\"hljs-title class_\"\u003eDownloading\u003c/span\u003e\u0026#x3C;/h4\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eapp-progress\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003eratio\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e”downloadprogressRatio$|async”\u003c/span\u003e\u003e\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003eapp-progress\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e (\u003cspan class=\"hljs-attr\"\u003eclick\u003c/span\u003e)=\u003cspan class=\"hljs-string\"\u003e”download()”\u003c/span\u003e\u003e\u003c/span\u003eDownload JSON\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e“Download JSON” 버튼을 클릭하면, 해당 클래스에서 download()을 호출하게 됩니다.\u003c/p\u003e\n\u003cp\u003eAppComponent 클래스\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edownloadProgressRatio$는 observable입니다. 우리는 FileDownloadService에서 반환된 getDownloadingProgress()의 observable을 downloadProgressRatio$ observable에 할당합니다. 이 observable은 템플릿에서 async 파이프를 통해 구독됩니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;app-progress [ratio]=”downloadprogressRatio$|\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e”\u003e\u0026#x3C;/app-progress\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e템플릿의 \"다운로드\" 버튼을 클릭하면, 해당 클래스의 download()이 호출되며, 이 메서드는 FileDownloadService의 downloadJson()을 호출합니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eFileDownloadService\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edownloadingProgressSub는 각 파일의 다운로드 진행 상황을 컴포넌트에 실시간 업데이트해 주는 중요한 역할을 하는 Subject입니다.\u003c/li\u003e\n\u003cli\u003e이미 클래스의 ngOnInit()에서 getDownloadingProgress()가 호출되었음을 확인했습니다. 이 메서드는 해당 Subject에 대한 Observable을 반환하는 역할을 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003egetDownloadingProgress\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e){\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edownloadingProgressSub\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003easObservable\u003c/span\u003e();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\"Download JSON\" 버튼을 클릭하면 downloadJson() 함수가 호출됩니다. 우리는 Node 서버에서 photos.json을 가져오기 위해 GET 요청을 보냅니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003edownloadJson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\n{\n\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehttp\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${environment.baseUrl}\u003c/span\u003ephotos`\u003c/span\u003e,{\u003cspan class=\"hljs-attr\"\u003ereportProgress\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003eobserve\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e'events'\u003c/span\u003e}).\u003cspan class=\"hljs-title function_\"\u003epipe\u003c/span\u003e(\n  \u003cspan class=\"hljs-title function_\"\u003etap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresponse:any\u003c/span\u003e)=\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e==\u003cspan class=\"hljs-title class_\"\u003eHttpEventType\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eDownloadProgress\u003c/span\u003e){ \u003cspan class=\"hljs-comment\"\u003e//3\u003c/span\u003e\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetDownloadingProgress\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003eloaded\u003c/span\u003e/response.\u003cspan class=\"hljs-property\"\u003etotal\u003c/span\u003e);\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-title class_\"\u003eHttpEventType\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eResponse\u003c/span\u003e){\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e blob = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBlob\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e)]);\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edownloadBlob\u003c/span\u003e(response,blob);\n    }\n  }),\n  \u003cspan class=\"hljs-title function_\"\u003ecatchError\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e=\u003e\u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ethrowError\u003c/span\u003e(err)\n  })\n)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003eHTTP GET 요청에 전달되는 추가 옵션을 관찰해주세요.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehttp\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${environment.baseUrl}\u003c/span\u003ephotos`\u003c/span\u003e,{\u003cspan class=\"hljs-attr\"\u003ereportProgress\u003c/span\u003e:\u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\u003cspan class=\"hljs-attr\"\u003eobserve\u003c/span\u003e:’events’})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e파일 다운로드 진행 상황에 대한 피드백을 제공하여 사용자들에게 더 나은 경험을 제공하고 있습니다. 우리는 진행 상황 추적을 가능하게 하기 위해 reportProgress를 true로 설정했습니다.\u003c/p\u003e\n\u003cp\u003eobserve 값은 관찰하고자 하는 내용에 따라 반환 유형을 결정합니다. \"events\"의 observe 값은 기본적으로 진행 상황 이벤트를 포함한 HttpEvent 스트림의 observable을 반환합니다.\u003c/p\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003e서버로부터 데이터를 받기 때문에, HttpEvent의 유형은 DownloadProgress(UploadProgress가 아님)일 것입니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e==\u003cspan class=\"hljs-title class_\"\u003eHttpEventType\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eDownloadProgress\u003c/span\u003e){ \u003cspan class=\"hljs-comment\"\u003e//3\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetDownloadingProgress\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003eloaded\u003c/span\u003e/event.\u003cspan class=\"hljs-property\"\u003etotal\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eevent.load은 로드된 파일의 바이트 수입니다.\u003c/p\u003e\n\u003cp\u003eevent.total은 로드해야하는 전체 바이트 수입니다.\u003c/p\u003e\n\u003cp\u003eevent.load/event.total은 업로드 중인 파일의 진행률을 나타냅니다.\u003c/p\u003e\n\u003cp\u003e저희는 setDownloadingProgress()를 호출하여 진행률을 인수로 전달합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003esetDownloadingProgress\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003edata: any\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edownloadingProgressSub\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(data);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003esetDownloadingProgress() 메서드에서는 진행률 비율을 downloadingProgressSub Subject로 전달하고 있습니다.\u003c/p\u003e\n\u003cp\u003eAppComponent 템플릿에서 이 Subject에 async pipe를 통해 구독하고 있다는 것을 기억하시나요?\u003c/p\u003e\n\u003col start=\"6\"\u003e\n\u003cli\u003eNode 서버로부터 본문을 포함한 전체 응답을 받으면, HttpEvent는 Response 유형이 됩니다. 그런 다음 응답 본문에서 Blob 객체를 생성하고 이 blob 객체 및 HttpResponse를 downloadBlob() 메서드에 인수로 전달합니다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-title class_\"\u003eHttpEventType\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eResponse\u003c/span\u003e){\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e blob = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBlob\u003c/span\u003e([\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e)]);\n\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edownloadBlob\u003c/span\u003e(response, blob);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"7\"\u003e\n\u003cli\u003eInside the \u003ccode\u003edownloadBlob()\u003c/code\u003e, we have written a common logic to perform automatic download of file received.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003edownloadBlob\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse: any, blob: Blob\u003c/span\u003e){\n\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e substringA = response.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'content-disposition'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003esubstring\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'content-disposition'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\";\"\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e filename = substringA.\u003cspan class=\"hljs-title function_\"\u003esubstring\u003c/span\u003e(substringA.\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"=\"\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp\"\u003e/[\"\"]/g\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e link = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e);\nlink.\u003cspan class=\"hljs-property\"\u003edownload\u003c/span\u003e = filename;\nlink.\u003cspan class=\"hljs-property\"\u003ehref\u003c/span\u003e = \u003cspan class=\"hljs-variable constant_\"\u003eURL\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateObjectURL\u003c/span\u003e(blob);\nlink.\u003cspan class=\"hljs-title function_\"\u003eclick\u003c/span\u003e();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe are first extracting the filename from the Content-Disposition response header.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e substringA=response.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'content-disposition'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003esubstring\u003c/span\u003e(response.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'content-disposition'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\";\"\u003c/span\u003e)+\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e filename= substringA.\u003cspan class=\"hljs-title function_\"\u003esubstring\u003c/span\u003e(substringA.\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"=\"\u003c/span\u003e)+\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp\"\u003e/[“”]+/g\u003c/span\u003e,\u003cspan class=\"hljs-string\"\u003e\"\"\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이것이 Content-Disposition 헤더가 보이는 모습입니다.\u003c/p\u003e\n\u003cp\u003e다음으로 앵커 요소인 \u003ccode\u003ea\u003c/code\u003e를 생성하고 요소의 다운로드 및 href 속성을 설정합니다. 다운로드 속성은 파일 이름으로 설정됩니다. href 속성은 Blob 객체에 대해 생성된 객체 URL로 설정됩니다. Blob는 createObjectURL()을 사용하여 내용을 보여주기 위해 \u003ccode\u003ea\u003c/code\u003e, \u003ccode\u003eimg\u003c/code\u003e 또는 다른 태그를 사용할 수 있습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e link = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'a'\u003c/span\u003e);\nlink.\u003cspan class=\"hljs-property\"\u003edownload\u003c/span\u003e = filename;\nlink.\u003cspan class=\"hljs-property\"\u003ehref\u003c/span\u003e = \u003cspan class=\"hljs-variable constant_\"\u003eURL\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateObjectURL\u003c/span\u003e(blob);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e마지막으로 앵커 요소를 프로그래밍 방식으로 클릭하여 다운로드가 자동으로 시작되도록 합니다. 우리는 앵커 요소를 DOM에 첨부하고 싶지 않습니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003elink.\u003cspan class=\"hljs-title function_\"\u003eclick\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eProgressComponent 템플릿\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026#x3C;div \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e=”container pending”\u003e\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e”progress-container”\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003engClass\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e”ratio\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e1\u003c/span\u003e ? ‘\u003cspan class=\"hljs-attr\"\u003ecomplete\u003c/span\u003e’ \u003cspan class=\"hljs-attr\"\u003e:\u003c/span\u003e ‘\u003cspan class=\"hljs-attr\"\u003epending\u003c/span\u003e’”\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e [\u003cspan class=\"hljs-attr\"\u003engStyle\u003c/span\u003e]=\u003cspan class=\"hljs-string\"\u003e”{width:progress}”\u003c/span\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e”progress-message”\u003c/span\u003e\u003e\u003c/span\u003e{progress}\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u0026#x3C;/div\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\"complete\" 및 \"pending\" CSS 클래스는 아래와 같이 정의되어 있습니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e.\u003cspan class=\"hljs-property\"\u003ecomplete\u003c/span\u003e {\n  background-\u003cspan class=\"hljs-attr\"\u003ecolor\u003c/span\u003e: lightgreen;\n}\n.\u003cspan class=\"hljs-property\"\u003epending\u003c/span\u003e {\n  background-\u003cspan class=\"hljs-attr\"\u003ecolor\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003ergb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e243\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e111\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e111\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eProgressComponent 클래스\u003c/p\u003e\n\u003cp\u003e이 클래스는 AppComponent로부터 속성 바인딩을 통해 @Input('ratio')를 수신합니다. 우리는 이 비율에 100을 곱하여 백분율을 얻은 다음 가장 가까운 정수로 반올림합니다. 이 백분율을 사용하여 진행 막대의 너비를 조정합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e아래는 앵귤러 및 노드 프로젝트의 git 저장소입니다.\u003c/p\u003e\n\u003ch1\u003eStackademic 🎓\u003c/h1\u003e\n\u003cp\u003e끝까지 읽어주셔서 감사합니다. 떠나기 전에:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e작가를 클릭하고 팔로우해주시면 감사하겠습니다! 👏\u003c/li\u003e\n\u003cli\u003e우리를 팔로우하세요 X | LinkedIn | YouTube | Discord\u003c/li\u003e\n\u003cli\u003e다른 플랫폼에서도 방문해주세요: In Plain English | CoFeed | Differ\u003c/li\u003e\n\u003cli\u003eStackademic.com에서 더 많은 콘텐츠를 확인할 수 있습니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-20-AngularDownloadingfilesandimplementingaprogressbarfortrackingthedownload"},"buildId":"aCCUs-qPrLLLWRnkN0AOd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>