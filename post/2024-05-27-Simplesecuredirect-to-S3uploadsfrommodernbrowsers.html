<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²• | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers" data-gatsby-head="true"/><meta name="twitter:title" content="ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-27 18:48" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_buildManifest.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²•</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²•" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 27, 2024</span><span class="posts_reading_time__f7YPP">7<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>ì•ˆë…•í•˜ì„¸ìš”, ì œ ì´ë¦„ì€ Taylor Hughesì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. ì €ëŠ” í˜ì´ìŠ¤ë¶, êµ¬ê¸€, í´ëŸ½í•˜ìš°ìŠ¤ ë° ì¤‘ê°„ì˜ ì—¬ëŸ¬ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ì•±ì„ ì¶œì‹œí•˜ê³  íŒ€ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.</p>
<p>ì‚¬ìš©ìê°€ S3 ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¬¸ì œëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜¬ë°”ë¥¸ JavaScript êµ¬ì„± ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ëª¨ë“  ê²ƒì„ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤.</p>
<p>AWS ë¬¸ì„œì— ë”°ë¥´ë©´ ì¶”ê°€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì „ì²´ AWS JS SDKë¥¼ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ê°€ì ¸ì™€ì•¼í•˜ì§€ë§Œ ì‹¤ì œë¡œ ê·¸ëŸ´ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤!</p>
<p>ëŒ€ì‹  ì‚¬ì „ ì„œëª…ëœ URL ë° í˜„ëŒ€ì ì¸ ì›¹ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì†ì‰½ê²Œ S3ë¡œ ì§ì ‘ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ëª‡ ì¤„ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì˜ ê´€ì ì—ì„œ ì „ì²´ ì†”ë£¨ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
<ul>
<li>ì‚¬ìš©ìê°€ "íŒŒì¼ ì—…ë¡œë“œ"ë¥¼ í´ë¦­í•˜ê³  íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.</li>
<li>í•´ë‹¹ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ ì¸¡ APIì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ S3 PutObject URLì„ ìš”ì²­í•©ë‹ˆë‹¤.</li>
<li>ë¯¸ë¦¬ ì„œëª…ëœ S3 URLì„ ì œê³µë°›ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ PUTí•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ìƒˆ í‚¤ë¥¼ ë‹¤ì‹œ APIë¡œ ë°˜í™˜í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ëŒ€í•´ APIê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.</li>
<li>ì´ìœ¤ ì°½ì¶œ!</li>
</ul>
<p>ë§Œì•½ ì™„ì„±ëœ ì½”ë“œë¡œ ë°”ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤ë©´, TypeScript í”„ë¡ íŠ¸ì—”ë“œ ë° Python API í•¸ë“¤ëŸ¬ ì˜ˆì‹œê°€ í¬í•¨ëœ gistë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
<p>ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<h2>AWS êµ¬ì„±</h2>
<p>ë¨¼ì €, ê³µê°œ ì•¡ì„¸ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•¡ì„¸ìŠ¤ ì •ì±…ì´ ì—†ëŠ” ìƒˆ ë²„í‚· yourproject-uploadì„ ë§Œë“­ë‹ˆë‹¤. (ë˜í•œ ì´ ë²„í‚·ì— ëŒ€í•´ ëª¨ë“  ê²ƒì„ 24ì‹œê°„ í›„ì— ë§Œë£Œë˜ë„ë¡ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤ â€” ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬ ê³µê°œì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)</p>
<p>ë‘˜ì§¸, web-upload-onlyë¼ëŠ” ìƒˆ IAM ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒˆ ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ì„ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ë°±ì—”ë“œ ì›¹ ì„œë²„ì— ì¶”ê°€í•˜ì„¸ìš”. (ì´ ìê²© ì¦ëª…ì€ ì£¼ AWS ìê²© ì¦ëª…ê³¼ ë³„ë„ì—¬ì•¼ í•©ë‹ˆë‹¤.)</p>
<p>ì…‹ì§¸, web-upload-onlyì—ê²Œ ìƒˆ ë²„í‚· yourproject-upload/*ì˜ ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ s3:PutObject ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìš°ë¦¬ëŠ” ì‚¬ì „ ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•  ë•Œ ì“°ê¸° í‚¤ë¥¼ ì œí•œí•  ê²ƒì…ë‹ˆë‹¤.)</p>
<div class="content-ad"></div>
<img src="/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png">
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ AWS ì—­í•  ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ yourproject-upload/* ë²„í‚·ì— s3:GetObject ì•¡ì„¸ìŠ¤ë„ ë¶€ì—¬í•˜ì„¸ìš”. ì—…ë¡œë“œ ë²„í‚·ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ main/public ì„œë¹™ ë²„í‚·ìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
<h2>ì›¹ ì„œë²„: "ì—…ë¡œë“œ ìƒì„±" API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€</h2>
<p>ìƒˆ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ì„ ì–»ì—ˆë‹¤ë©´ ì´ì œ S3ì— íŠ¹ì • í‚¤ë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ì‚¬ì „ ì„œëª…ëœ URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
<ul>
<li>content_type â€” ë¸Œë¼ìš°ì €ì˜ PUT ìš”ì²­ì˜ ì»¨í…ì¸  ìœ í˜•ìœ¼ë¡œ ì„¤ì •ë  íŒŒì¼ì˜ MIME ìœ í˜•ì´ë©°, ì„œëª…ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
<li>filename â€” íŒŒì¼ì˜ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ, ì—¬ê¸°ì„œ í™•ì¥ìë¥¼ ê°€ì ¸ì™€ì„œ S3 í‚¤ì— ì¢‹ì€ í™•ì¥ìë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<p>ì´ëŸ¬í•œ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AWS S3 í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„œëª…ëœ PutObject URLì„ ìƒì„±í•˜ì„¸ìš”. Pythonì—ì„œ boto3ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_s3_client</span>() -> S3Client:
    <span class="hljs-keyword">return</span> boto3.client(
        <span class="hljs-string">"s3"</span>,
        aws_access_key_id=settings.UPLOAD_AWS_ACCESS_KEY_ID,
        aws_secret_access_key=settings.UPLOAD_AWS_SECRET_ACCESS_KEY,
        region_name=AWS_REGION,
    )

<span class="hljs-meta">@api_view(<span class="hljs-params"><span class="hljs-string">"/upload/create"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_upload</span>(<span class="hljs-params">request: Request</span>) -> Response:
    ext = request.validated_data[<span class="hljs-string">"original_filename"</span>].split(<span class="hljs-string">"."</span>)[-<span class="hljs-number">1</span>].lower()
    <span class="hljs-comment"># ìƒì„±ëœ S3 ê²½ë¡œì— ì‚¬ìš©ì IDì™€ ë‚ ì§œ í¬í•¨í•˜ê¸°:</span>
    date = datetime.now().strftime(<span class="hljs-string">"%Y%m%d"</span>)
    key = <span class="hljs-string">f"uploads/<span class="hljs-subst">{request.user.<span class="hljs-built_in">id</span>}</span>/<span class="hljs-subst">{date}</span>-<span class="hljs-subst">{uuid.uuid4()}</span>.<span class="hljs-subst">{ext}</span>"</span>
    <span class="hljs-comment"># ì„œëª…ëœ URL ìƒì„±:</span>
    presigned_upload_url = upload_s3_client().generate_presigned_url(
        <span class="hljs-string">"put_object"</span>,
        Params={
            <span class="hljs-string">"Bucket"</span>: <span class="hljs-string">"yourproject-upload"</span>,
            <span class="hljs-string">"Key"</span>: key,
            <span class="hljs-string">"ContentType"</span>: request.validated_data[<span class="hljs-string">"content_type"</span>],
        },
        ExpiresIn=<span class="hljs-number">60</span> * <span class="hljs-number">60</span>,
    )
    <span class="hljs-comment"># í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‚¤ ë° ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•©ë‹ˆë‹¤:</span>
    <span class="hljs-keyword">return</span> success_response(
        {<span class="hljs-string">"key"</span>: key, <span class="hljs-string">"presigned_upload_url"</span>: presigned_upload_url}
    )
</code></pre>
<div class="content-ad"></div>
<h2>í´ë¼ì´ì–¸íŠ¸ ì¸¡: ëª¨ë‘ ì—°ê²°í•˜ê¸°</h2>
<p>ì´ì œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” íŒŒì¼ ì…ë ¥ë€ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì•¼í•©ë‹ˆë‹¤. í•œ ë²ˆ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë©´ ìƒˆ API ë°±ì—”ë“œì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ URLì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API ìš”ì²­ì„ ë³´í†µ ì–´ë–»ê²Œ ë§Œë“¤ë“ ì§€ ìƒê´€ì—†ìŠµë‹ˆë‹¤:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPresignedUrl</span>(<span class="hljs-params">file: File</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">makeAPIRequest</span>(
    <span class="hljs-string">"POST"</span>,
    <span class="hljs-string">"upload/create"</span>,
    {
      <span class="hljs-attr">original_filename</span>: file.<span class="hljs-property">name</span>,
      <span class="hljs-attr">content_type</span>: file.<span class="hljs-property">type</span>,
    },
    <span class="hljs-function">(<span class="hljs-params">response</span>) =></span> response <span class="hljs-keyword">as</span> {
      <span class="hljs-attr">key</span>: string;
      <span class="hljs-attr">presigned_upload_url</span>: string;
    },
  );
}
</code></pre>
<p>ê·¸ëŸ° ë‹¤ìŒ, XmlHttpRequestë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ì§ì ‘ S3ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">
  file: File,
  presignedUploadUrl: string,
  onProgress: (pct: number) => <span class="hljs-keyword">void</span>,
</span>): <span class="hljs-title class_">Promise</span>&#x3C;<span class="hljs-keyword">void</span>> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&#x3C;<span class="hljs-keyword">void</span>>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
    xhr.<span class="hljs-property">upload</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"progress"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">lengthComputable</span>) {
        <span class="hljs-keyword">const</span> pct = e.<span class="hljs-property">loaded</span> / e.<span class="hljs-property">total</span>;
        <span class="hljs-title function_">onProgress</span>(pct * <span class="hljs-number">100</span>);
      }
    });
    xhr.<span class="hljs-property">upload</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Upload failed: "</span> + e.<span class="hljs-title function_">toString</span>()));
    });
    xhr.<span class="hljs-property">upload</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"abort"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Upload aborted: "</span> + e.<span class="hljs-title function_">toString</span>()));
    });
    xhr.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"load"</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> {
      <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-title function_">resolve</span>();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Upload failed "</span> + xhr.<span class="hljs-property">status</span>));
      }
    });
    xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">"PUT"</span>, presignedUploadUrl, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">try</span> {
      xhr.<span class="hljs-title function_">send</span>(file);
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Upload failed: "</span> + e.<span class="hljs-title function_">toString</span>()));
    }
  });
}
</code></pre>
<p>React Hooksë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUpload</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [uploadState, setUploadState] = useState&#x3C;
    <span class="hljs-string">"idle"</span> | <span class="hljs-string">"starting"</span> | <span class="hljs-string">"uploading"</span> | <span class="hljs-string">"finishing"</span> | <span class="hljs-string">"done"</span> | <span class="hljs-string">"error"</span>
  >(<span class="hljs-string">"idle"</span>);
  <span class="hljs-keyword">const</span> [uploadProgress, setUploadProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [uploadError, setUploadError] = useState&#x3C;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>>(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">return</span> {
    uploadState,
    uploadProgress,
    uploadError,
    <span class="hljs-attr">upload</span>: <span class="hljs-keyword">async</span> (
      <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>,
      <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">(<span class="hljs-params">uploadKey: string</span>) =></span> <span class="hljs-title class_">Promise</span>&#x3C;<span class="hljs-keyword">void</span>>,
    ) => {
      <span class="hljs-title function_">setUploadState</span>(<span class="hljs-string">"starting"</span>);

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ë°±ì—”ë“œ APIì—ì„œ ì‚¬ì „ ì„œëª…ëœ URL ê°€ì ¸ì˜¤ê¸°:</span>
        <span class="hljs-keyword">const</span> { key, presigned_upload_url } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPresignedUrl</span>(
          file,
        );
        <span class="hljs-title function_">setUploadState</span>(<span class="hljs-string">"uploading"</span>);
        <span class="hljs-comment">// XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì—…ë¡œë“œ:</span>
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadFile</span>(file, presigned_upload_url, <span class="hljs-function">(<span class="hljs-params">pct</span>) =></span> {
          <span class="hljs-title function_">setUploadProgress</span>(pct);
        });
        <span class="hljs-title function_">setUploadState</span>(<span class="hljs-string">"finishing"</span>);
        <span class="hljs-comment">// ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ ìœ ìš©í•˜ê²Œ í™œìš©í•˜ê¸°; ì•„ë§ˆë„ ì´ í‚¤ë¥¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤!</span>
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">onSuccess</span>(key);
        <span class="hljs-title function_">setUploadState</span>(<span class="hljs-string">"done"</span>);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-title function_">setUploadState</span>(<span class="hljs-string">"error"</span>);
        <span class="hljs-title function_">setUploadError</span>(e);
      }
    },
  };
}
</code></pre>
<h2>ë§ˆì§€ë§‰ìœ¼ë¡œ: ìƒˆë¡œ ì—…ë¡œë“œëœ íŒŒì¼ ì‚¬ìš©í•˜ê¸°</h2>
<div class="content-ad"></div>
<p>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì—…ë¡œë“œí•œ S3 í‚¤ë¥¼ APIë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•˜ê±°ë‚˜ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì† ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì—…ë¡œë“œ ì „ìš© S3 ë²„í‚· ë‚´ì˜ ê²½ë¡œì¸ ì—…ë¡œë“œ í‚¤ë¥¼ ë°›ëŠ” ë˜ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ë¥¸ ë²„í‚·ìœ¼ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>(ì €ëŠ” ì—…ë¡œë“œ í‚¤ì— ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ë„£ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ ë‚´ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¡œë¶€í„° ì—…ë¡œë“œëœ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>
<p>ë‹¤ìŒì€ Pythonì—ì„œ ë²„í‚·ì„ ê³µê°œ ì„œë¹™ ë²„í‚·ì— ë³µì‚¬í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">upload_key = request.<span class="hljs-property">validated_data</span>[<span class="hljs-string">"upload_key"</span>]
ext = upload_key.<span class="hljs-title function_">split</span>(<span class="hljs-string">"."</span>)[-<span class="hljs-number">1</span>]
slug = <span class="hljs-title function_">slugify</span>(request.<span class="hljs-property">validated_data</span>[<span class="hljs-string">"filename"</span>])
date = datetime.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">strftime</span>(r<span class="hljs-string">"%Y%m%d_%H%M%S"</span>)
public_key = f<span class="hljs-string">"media/{request.user.id}/{date}-{slug}.{ext}"</span>

<span class="hljs-attr">try</span>:
  <span class="hljs-title function_">public_content_s3_client</span>().<span class="hljs-title function_">copy</span>(
    <span class="hljs-title class_">CopySource</span>={
      <span class="hljs-string">"Bucket"</span>: <span class="hljs-string">"yourproject-upload"</span>,
      <span class="hljs-string">"Key"</span>: upload_key,
    },
    <span class="hljs-title class_">Bucket</span>=<span class="hljs-string">"yourproject-public"</span>,
    <span class="hljs-title class_">Key</span>=public_key,
  )
except <span class="hljs-title class_">Exception</span>:
  logging.<span class="hljs-title function_">exception</span>(f<span class="hljs-string">"Failed to copy file for user={request.user.id}"</span>)
</code></pre>
<p>ìš”ë ‡ê²Œ í•´ìš”. ëˆ„êµ°ê°€ì—ê² ë„ì›€ì´ ë˜ê¸¸ ë°”ë˜ìš”! í˜¹ì‹œ ë‹¤ì‹œ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ê¸° ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë‹´ê¸´ gist ë§í¬ë„ ë“œë¦´ê²Œìš”. ğŸ¥°</p>
<p>ì˜ê²¬ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì•Œë ¤ì£¼ì„¸ìš”! @taylorhughes</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ëª¨ë˜ ë¸Œë¼ìš°ì €ì—ì„œ AWS S3 ì§ì ‘ ì—…ë¡œë“œí•˜ëŠ” ë°©ë²•","description":"","date":"2024-05-27 18:48","slug":"2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers","content":"\n\nì•ˆë…•í•˜ì„¸ìš”, ì œ ì´ë¦„ì€ Taylor Hughesì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. ì €ëŠ” í˜ì´ìŠ¤ë¶, êµ¬ê¸€, í´ëŸ½í•˜ìš°ìŠ¤ ë° ì¤‘ê°„ì˜ ì—¬ëŸ¬ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ì•±ì„ ì¶œì‹œí•˜ê³  íŒ€ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.\n\nì‚¬ìš©ìê°€ S3 ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¬¸ì œëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜¬ë°”ë¥¸ JavaScript êµ¬ì„± ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ëª¨ë“  ê²ƒì„ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤.\n\nAWS ë¬¸ì„œì— ë”°ë¥´ë©´ ì¶”ê°€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì „ì²´ AWS JS SDKë¥¼ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ê°€ì ¸ì™€ì•¼í•˜ì§€ë§Œ ì‹¤ì œë¡œ ê·¸ëŸ´ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤!\n\nëŒ€ì‹  ì‚¬ì „ ì„œëª…ëœ URL ë° í˜„ëŒ€ì ì¸ ì›¹ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì†ì‰½ê²Œ S3ë¡œ ì§ì ‘ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ëª‡ ì¤„ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì‚¬ìš©ì ë¸Œë¼ìš°ì €ì˜ ê´€ì ì—ì„œ ì „ì²´ ì†”ë£¨ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n- ì‚¬ìš©ìê°€ \"íŒŒì¼ ì—…ë¡œë“œ\"ë¥¼ í´ë¦­í•˜ê³  íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.\n- í•´ë‹¹ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ ì¸¡ APIì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ S3 PutObject URLì„ ìš”ì²­í•©ë‹ˆë‹¤.\n- ë¯¸ë¦¬ ì„œëª…ëœ S3 URLì„ ì œê³µë°›ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ PUTí•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n- ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ìƒˆ í‚¤ë¥¼ ë‹¤ì‹œ APIë¡œ ë°˜í™˜í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ëŒ€í•´ APIê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\n- ì´ìœ¤ ì°½ì¶œ!\n\në§Œì•½ ì™„ì„±ëœ ì½”ë“œë¡œ ë°”ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤ë©´, TypeScript í”„ë¡ íŠ¸ì—”ë“œ ë° Python API í•¸ë“¤ëŸ¬ ì˜ˆì‹œê°€ í¬í•¨ëœ gistë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.\n\nì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## AWS êµ¬ì„±\n\në¨¼ì €, ê³µê°œ ì•¡ì„¸ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•¡ì„¸ìŠ¤ ì •ì±…ì´ ì—†ëŠ” ìƒˆ ë²„í‚· yourproject-uploadì„ ë§Œë“­ë‹ˆë‹¤. (ë˜í•œ ì´ ë²„í‚·ì— ëŒ€í•´ ëª¨ë“  ê²ƒì„ 24ì‹œê°„ í›„ì— ë§Œë£Œë˜ë„ë¡ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤ â€” ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬ ê³µê°œì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)\n\në‘˜ì§¸, web-upload-onlyë¼ëŠ” ìƒˆ IAM ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒˆ ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ì„ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ë°±ì—”ë“œ ì›¹ ì„œë²„ì— ì¶”ê°€í•˜ì„¸ìš”. (ì´ ìê²© ì¦ëª…ì€ ì£¼ AWS ìê²© ì¦ëª…ê³¼ ë³„ë„ì—¬ì•¼ í•©ë‹ˆë‹¤.)\n\nì…‹ì§¸, web-upload-onlyì—ê²Œ ìƒˆ ë²„í‚· yourproject-upload/*ì˜ ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ s3:PutObject ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìš°ë¦¬ëŠ” ì‚¬ì „ ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•  ë•Œ ì“°ê¸° í‚¤ë¥¼ ì œí•œí•  ê²ƒì…ë‹ˆë‹¤.)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\u003cimg src=\"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png\" /\u003e\n\në§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ AWS ì—­í•  ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ yourproject-upload/* ë²„í‚·ì— s3:GetObject ì•¡ì„¸ìŠ¤ë„ ë¶€ì—¬í•˜ì„¸ìš”. ì—…ë¡œë“œ ë²„í‚·ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ main/public ì„œë¹™ ë²„í‚·ìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n## ì›¹ ì„œë²„: \"ì—…ë¡œë“œ ìƒì„±\" API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€\n\nìƒˆ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ì„ ì–»ì—ˆë‹¤ë©´ ì´ì œ S3ì— íŠ¹ì • í‚¤ë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ì‚¬ì „ ì„œëª…ëœ URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\n\n- content_type â€” ë¸Œë¼ìš°ì €ì˜ PUT ìš”ì²­ì˜ ì»¨í…ì¸  ìœ í˜•ìœ¼ë¡œ ì„¤ì •ë  íŒŒì¼ì˜ MIME ìœ í˜•ì´ë©°, ì„œëª…ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\n- filename â€” íŒŒì¼ì˜ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ, ì—¬ê¸°ì„œ í™•ì¥ìë¥¼ ê°€ì ¸ì™€ì„œ S3 í‚¤ì— ì¢‹ì€ í™•ì¥ìë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì´ëŸ¬í•œ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AWS S3 í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„œëª…ëœ PutObject URLì„ ìƒì„±í•˜ì„¸ìš”. Pythonì—ì„œ boto3ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:\n\n```python\ndef upload_s3_client() -\u003e S3Client:\n    return boto3.client(\n        \"s3\",\n        aws_access_key_id=settings.UPLOAD_AWS_ACCESS_KEY_ID,\n        aws_secret_access_key=settings.UPLOAD_AWS_SECRET_ACCESS_KEY,\n        region_name=AWS_REGION,\n    )\n\n@api_view(\"/upload/create\")\ndef create_upload(request: Request) -\u003e Response:\n    ext = request.validated_data[\"original_filename\"].split(\".\")[-1].lower()\n    # ìƒì„±ëœ S3 ê²½ë¡œì— ì‚¬ìš©ì IDì™€ ë‚ ì§œ í¬í•¨í•˜ê¸°:\n    date = datetime.now().strftime(\"%Y%m%d\")\n    key = f\"uploads/{request.user.id}/{date}-{uuid.uuid4()}.{ext}\"\n    # ì„œëª…ëœ URL ìƒì„±:\n    presigned_upload_url = upload_s3_client().generate_presigned_url(\n        \"put_object\",\n        Params={\n            \"Bucket\": \"yourproject-upload\",\n            \"Key\": key,\n            \"ContentType\": request.validated_data[\"content_type\"],\n        },\n        ExpiresIn=60 * 60,\n    )\n    # í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‚¤ ë° ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•©ë‹ˆë‹¤:\n    return success_response(\n        {\"key\": key, \"presigned_upload_url\": presigned_upload_url}\n    )\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## í´ë¼ì´ì–¸íŠ¸ ì¸¡: ëª¨ë‘ ì—°ê²°í•˜ê¸°\n\nì´ì œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” íŒŒì¼ ì…ë ¥ë€ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì•¼í•©ë‹ˆë‹¤. í•œ ë²ˆ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë©´ ìƒˆ API ë°±ì—”ë“œì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ URLì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API ìš”ì²­ì„ ë³´í†µ ì–´ë–»ê²Œ ë§Œë“¤ë“ ì§€ ìƒê´€ì—†ìŠµë‹ˆë‹¤:\n\n```js\nfunction getPresignedUrl(file: File) {\n  return makeAPIRequest(\n    \"POST\",\n    \"upload/create\",\n    {\n      original_filename: file.name,\n      content_type: file.type,\n    },\n    (response) =\u003e response as {\n      key: string;\n      presigned_upload_url: string;\n    },\n  );\n}\n```\n\nê·¸ëŸ° ë‹¤ìŒ, XmlHttpRequestë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ì§ì ‘ S3ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nfunction uploadFile(\n  file: File,\n  presignedUploadUrl: string,\n  onProgress: (pct: number) =\u003e void,\n): Promise\u003cvoid\u003e {\n  return new Promise\u003cvoid\u003e((resolve, reject) =\u003e {\n    const xhr = new XMLHttpRequest();\n    xhr.upload.addEventListener(\"progress\", (e) =\u003e {\n      if (e.lengthComputable) {\n        const pct = e.loaded / e.total;\n        onProgress(pct * 100);\n      }\n    });\n    xhr.upload.addEventListener(\"error\", (e) =\u003e {\n      reject(new Error(\"Upload failed: \" + e.toString()));\n    });\n    xhr.upload.addEventListener(\"abort\", (e) =\u003e {\n      reject(new Error(\"Upload aborted: \" + e.toString()));\n    });\n    xhr.addEventListener(\"load\", (e) =\u003e {\n      if (xhr.status === 200) {\n        resolve();\n      } else {\n        reject(new Error(\"Upload failed \" + xhr.status));\n      }\n    });\n    xhr.open(\"PUT\", presignedUploadUrl, true);\n    try {\n      xhr.send(file);\n    } catch (e) {\n      reject(new Error(\"Upload failed: \" + e.toString()));\n    }\n  });\n}\n```\n\nReact Hooksë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\n\n```js\nexport function useUpload() {\n  const [uploadState, setUploadState] = useState\u003c\n    \"idle\" | \"starting\" | \"uploading\" | \"finishing\" | \"done\" | \"error\"\n  \u003e(\"idle\");\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [uploadError, setUploadError] = useState\u003cError | null\u003e(null);\n\n  return {\n    uploadState,\n    uploadProgress,\n    uploadError,\n    upload: async (\n      file: File,\n      onSuccess: (uploadKey: string) =\u003e Promise\u003cvoid\u003e,\n    ) =\u003e {\n      setUploadState(\"starting\");\n\n      try {\n        // ë°±ì—”ë“œ APIì—ì„œ ì‚¬ì „ ì„œëª…ëœ URL ê°€ì ¸ì˜¤ê¸°:\n        const { key, presigned_upload_url } = await getPresignedUrl(\n          file,\n        );\n        setUploadState(\"uploading\");\n        // XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì—…ë¡œë“œ:\n        await uploadFile(file, presigned_upload_url, (pct) =\u003e {\n          setUploadProgress(pct);\n        });\n        setUploadState(\"finishing\");\n        // ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ ìœ ìš©í•˜ê²Œ í™œìš©í•˜ê¸°; ì•„ë§ˆë„ ì´ í‚¤ë¥¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤!\n        await onSuccess(key);\n        setUploadState(\"done\");\n      } catch (e) {\n        setUploadState(\"error\");\n        setUploadError(e);\n      }\n    },\n  };\n}\n```\n\n## ë§ˆì§€ë§‰ìœ¼ë¡œ: ìƒˆë¡œ ì—…ë¡œë“œëœ íŒŒì¼ ì‚¬ìš©í•˜ê¸°\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì—…ë¡œë“œí•œ S3 í‚¤ë¥¼ APIë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•˜ê±°ë‚˜ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì† ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì—…ë¡œë“œ ì „ìš© S3 ë²„í‚· ë‚´ì˜ ê²½ë¡œì¸ ì—…ë¡œë“œ í‚¤ë¥¼ ë°›ëŠ” ë˜ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ë¥¸ ë²„í‚·ìœ¼ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n(ì €ëŠ” ì—…ë¡œë“œ í‚¤ì— ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ë„£ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ ë‚´ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¡œë¶€í„° ì—…ë¡œë“œëœ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)\n\në‹¤ìŒì€ Pythonì—ì„œ ë²„í‚·ì„ ê³µê°œ ì„œë¹™ ë²„í‚·ì— ë³µì‚¬í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nupload_key = request.validated_data[\"upload_key\"]\next = upload_key.split(\".\")[-1]\nslug = slugify(request.validated_data[\"filename\"])\ndate = datetime.now().strftime(r\"%Y%m%d_%H%M%S\")\npublic_key = f\"media/{request.user.id}/{date}-{slug}.{ext}\"\n\ntry:\n  public_content_s3_client().copy(\n    CopySource={\n      \"Bucket\": \"yourproject-upload\",\n      \"Key\": upload_key,\n    },\n    Bucket=\"yourproject-public\",\n    Key=public_key,\n  )\nexcept Exception:\n  logging.exception(f\"Failed to copy file for user={request.user.id}\")\n```\n\nìš”ë ‡ê²Œ í•´ìš”. ëˆ„êµ°ê°€ì—ê² ë„ì›€ì´ ë˜ê¸¸ ë°”ë˜ìš”! í˜¹ì‹œ ë‹¤ì‹œ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ê¸° ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë‹´ê¸´ gist ë§í¬ë„ ë“œë¦´ê²Œìš”. ğŸ¥°\n\nì˜ê²¬ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì•Œë ¤ì£¼ì„¸ìš”! @taylorhughes\n","ogImage":{"url":"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png"},"coverImage":"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png","tag":["Tech"],"readingTime":7},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003eì•ˆë…•í•˜ì„¸ìš”, ì œ ì´ë¦„ì€ Taylor Hughesì…ë‹ˆë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. ì €ëŠ” í˜ì´ìŠ¤ë¶, êµ¬ê¸€, í´ëŸ½í•˜ìš°ìŠ¤ ë° ì¤‘ê°„ì˜ ì—¬ëŸ¬ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ì•±ì„ ì¶œì‹œí•˜ê³  íŒ€ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì‚¬ìš©ìê°€ S3 ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¬¸ì œëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì˜¬ë°”ë¥¸ JavaScript êµ¬ì„± ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ëª¨ë“  ê²ƒì„ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ ì„¤ì •í•˜ì—¬ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì§‘ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eAWS ë¬¸ì„œì— ë”°ë¥´ë©´ ì¶”ê°€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì „ì²´ AWS JS SDKë¥¼ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¡œ ê°€ì ¸ì™€ì•¼í•˜ì§€ë§Œ ì‹¤ì œë¡œ ê·¸ëŸ´ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤!\u003c/p\u003e\n\u003cp\u003eëŒ€ì‹  ì‚¬ì „ ì„œëª…ëœ URL ë° í˜„ëŒ€ì ì¸ ì›¹ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ì†ì‰½ê²Œ S3ë¡œ ì§ì ‘ ì—…ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œ ëª‡ ì¤„ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì‚¬ìš©ì ë¸Œë¼ìš°ì €ì˜ ê´€ì ì—ì„œ ì „ì²´ ì†”ë£¨ì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eì‚¬ìš©ìê°€ \"íŒŒì¼ ì—…ë¡œë“œ\"ë¥¼ í´ë¦­í•˜ê³  íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eí•´ë‹¹ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ ì¸¡ APIì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ S3 PutObject URLì„ ìš”ì²­í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eë¯¸ë¦¬ ì„œëª…ëœ S3 URLì„ ì œê³µë°›ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ PUTí•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” ìƒˆ í‚¤ë¥¼ ë‹¤ì‹œ APIë¡œ ë°˜í™˜í•˜ì—¬ ì—…ë¡œë“œëœ íŒŒì¼ì— ëŒ€í•´ APIê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003eì´ìœ¤ ì°½ì¶œ!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eë§Œì•½ ì™„ì„±ëœ ì½”ë“œë¡œ ë°”ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤ë©´, TypeScript í”„ë¡ íŠ¸ì—”ë“œ ë° Python API í•¸ë“¤ëŸ¬ ì˜ˆì‹œê°€ í¬í•¨ëœ gistë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003eì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eAWS êµ¬ì„±\u003c/h2\u003e\n\u003cp\u003eë¨¼ì €, ê³µê°œ ì•¡ì„¸ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆê³  ì•¡ì„¸ìŠ¤ ì •ì±…ì´ ì—†ëŠ” ìƒˆ ë²„í‚· yourproject-uploadì„ ë§Œë“­ë‹ˆë‹¤. (ë˜í•œ ì´ ë²„í‚·ì— ëŒ€í•´ ëª¨ë“  ê²ƒì„ 24ì‹œê°„ í›„ì— ë§Œë£Œë˜ë„ë¡ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ê·œì¹™ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤ â€” ì—…ë¡œë“œëœ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì—¬ ê³µê°œì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)\u003c/p\u003e\n\u003cp\u003eë‘˜ì§¸, web-upload-onlyë¼ëŠ” ìƒˆ IAM ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ìƒˆ ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ë¹„ë°€ì„ ê°€ì ¸ì™€ì„œ ì´ë¥¼ ë°±ì—”ë“œ ì›¹ ì„œë²„ì— ì¶”ê°€í•˜ì„¸ìš”. (ì´ ìê²© ì¦ëª…ì€ ì£¼ AWS ìê²© ì¦ëª…ê³¼ ë³„ë„ì—¬ì•¼ í•©ë‹ˆë‹¤.)\u003c/p\u003e\n\u003cp\u003eì…‹ì§¸, web-upload-onlyì—ê²Œ ìƒˆ ë²„í‚· yourproject-upload/*ì˜ ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ s3:PutObject ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. (ìš°ë¦¬ëŠ” ì‚¬ì „ ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•  ë•Œ ì“°ê¸° í‚¤ë¥¼ ì œí•œí•  ê²ƒì…ë‹ˆë‹¤.)\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers_0.png\"\u003e\n\u003cp\u003eë§ˆì§€ë§‰ìœ¼ë¡œ, ì¼ë°˜ AWS ì—­í•  ë˜ëŠ” ì‚¬ìš©ìì—ê²Œ yourproject-upload/* ë²„í‚·ì— s3:GetObject ì•¡ì„¸ìŠ¤ë„ ë¶€ì—¬í•˜ì„¸ìš”. ì—…ë¡œë“œ ë²„í‚·ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ main/public ì„œë¹™ ë²„í‚·ìœ¼ë¡œ ì˜®ê¸°ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eì›¹ ì„œë²„: \"ì—…ë¡œë“œ ìƒì„±\" API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€\u003c/h2\u003e\n\u003cp\u003eìƒˆ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ì„ ì–»ì—ˆë‹¤ë©´ ì´ì œ S3ì— íŠ¹ì • í‚¤ë¥¼ ì“¸ ìˆ˜ ìˆëŠ” ì‚¬ì „ ì„œëª…ëœ URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ì†¡ë˜ëŠ” ì…ë ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003econtent_type â€” ë¸Œë¼ìš°ì €ì˜ PUT ìš”ì²­ì˜ ì»¨í…ì¸  ìœ í˜•ìœ¼ë¡œ ì„¤ì •ë  íŒŒì¼ì˜ MIME ìœ í˜•ì´ë©°, ì„œëª…ì— í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\u003c/li\u003e\n\u003cli\u003efilename â€” íŒŒì¼ì˜ ì›ë³¸ íŒŒì¼ëª…ìœ¼ë¡œ, ì—¬ê¸°ì„œ í™•ì¥ìë¥¼ ê°€ì ¸ì™€ì„œ S3 í‚¤ì— ì¢‹ì€ í™•ì¥ìë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eì´ëŸ¬í•œ ì…ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ AWS S3 í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì„œëª…ëœ PutObject URLì„ ìƒì„±í•˜ì„¸ìš”. Pythonì—ì„œ boto3ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eupload_s3_client\u003c/span\u003e() -\u003e S3Client:\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e boto3.client(\n        \u003cspan class=\"hljs-string\"\u003e\"s3\"\u003c/span\u003e,\n        aws_access_key_id=settings.UPLOAD_AWS_ACCESS_KEY_ID,\n        aws_secret_access_key=settings.UPLOAD_AWS_SECRET_ACCESS_KEY,\n        region_name=AWS_REGION,\n    )\n\n\u003cspan class=\"hljs-meta\"\u003e@api_view(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-string\"\u003e\"/upload/create\"\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreate_upload\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erequest: Request\u003c/span\u003e) -\u003e Response:\n    ext = request.validated_data[\u003cspan class=\"hljs-string\"\u003e\"original_filename\"\u003c/span\u003e].split(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e)[-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e].lower()\n    \u003cspan class=\"hljs-comment\"\u003e# ìƒì„±ëœ S3 ê²½ë¡œì— ì‚¬ìš©ì IDì™€ ë‚ ì§œ í¬í•¨í•˜ê¸°:\u003c/span\u003e\n    date = datetime.now().strftime(\u003cspan class=\"hljs-string\"\u003e\"%Y%m%d\"\u003c/span\u003e)\n    key = \u003cspan class=\"hljs-string\"\u003ef\"uploads/\u003cspan class=\"hljs-subst\"\u003e{request.user.\u003cspan class=\"hljs-built_in\"\u003eid\u003c/span\u003e}\u003c/span\u003e/\u003cspan class=\"hljs-subst\"\u003e{date}\u003c/span\u003e-\u003cspan class=\"hljs-subst\"\u003e{uuid.uuid4()}\u003c/span\u003e.\u003cspan class=\"hljs-subst\"\u003e{ext}\u003c/span\u003e\"\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# ì„œëª…ëœ URL ìƒì„±:\u003c/span\u003e\n    presigned_upload_url = upload_s3_client().generate_presigned_url(\n        \u003cspan class=\"hljs-string\"\u003e\"put_object\"\u003c/span\u003e,\n        Params={\n            \u003cspan class=\"hljs-string\"\u003e\"Bucket\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"yourproject-upload\"\u003c/span\u003e,\n            \u003cspan class=\"hljs-string\"\u003e\"Key\"\u003c/span\u003e: key,\n            \u003cspan class=\"hljs-string\"\u003e\"ContentType\"\u003c/span\u003e: request.validated_data[\u003cspan class=\"hljs-string\"\u003e\"content_type\"\u003c/span\u003e],\n        },\n        ExpiresIn=\u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e * \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e,\n    )\n    \u003cspan class=\"hljs-comment\"\u003e# í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í‚¤ ë° ì„œëª…ëœ PutObject URLì„ ë°˜í™˜í•©ë‹ˆë‹¤:\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e success_response(\n        {\u003cspan class=\"hljs-string\"\u003e\"key\"\u003c/span\u003e: key, \u003cspan class=\"hljs-string\"\u003e\"presigned_upload_url\"\u003c/span\u003e: presigned_upload_url}\n    )\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eí´ë¼ì´ì–¸íŠ¸ ì¸¡: ëª¨ë‘ ì—°ê²°í•˜ê¸°\u003c/h2\u003e\n\u003cp\u003eì´ì œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” íŒŒì¼ ì…ë ¥ë€ì„ ì¶”ê°€í•˜ì—¬ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì•¼í•©ë‹ˆë‹¤. í•œ ë²ˆ íŒŒì¼ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë©´ ìƒˆ API ë°±ì—”ë“œì—ì„œ ë¯¸ë¦¬ ì„œëª…ëœ URLì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API ìš”ì²­ì„ ë³´í†µ ì–´ë–»ê²Œ ë§Œë“¤ë“ ì§€ ìƒê´€ì—†ìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPresignedUrl\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003efile: File\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003emakeAPIRequest\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\"POST\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"upload/create\"\u003c/span\u003e,\n    {\n      \u003cspan class=\"hljs-attr\"\u003eoriginal_filename\u003c/span\u003e: file.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003econtent_type\u003c/span\u003e: file.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e,\n    },\n    \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) =\u003e\u003c/span\u003e response \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e {\n      \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e: string;\n      \u003cspan class=\"hljs-attr\"\u003epresigned_upload_url\u003c/span\u003e: string;\n    },\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eê·¸ëŸ° ë‹¤ìŒ, XmlHttpRequestë¥¼ ë§Œë“¤ì–´ íŒŒì¼ì„ ì§ì ‘ S3ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euploadFile\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  file: File,\n  presignedUploadUrl: string,\n  onProgress: (pct: number) =\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e,\n\u003c/span\u003e): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e xhr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eXMLHttpRequest\u003c/span\u003e();\n    xhr.\u003cspan class=\"hljs-property\"\u003eupload\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"progress\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (e.\u003cspan class=\"hljs-property\"\u003elengthComputable\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e pct = e.\u003cspan class=\"hljs-property\"\u003eloaded\u003c/span\u003e / e.\u003cspan class=\"hljs-property\"\u003etotal\u003c/span\u003e;\n        \u003cspan class=\"hljs-title function_\"\u003eonProgress\u003c/span\u003e(pct * \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n      }\n    });\n    xhr.\u003cspan class=\"hljs-property\"\u003eupload\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Upload failed: \"\u003c/span\u003e + e.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e()));\n    });\n    xhr.\u003cspan class=\"hljs-property\"\u003eupload\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"abort\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Upload aborted: \"\u003c/span\u003e + e.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e()));\n    });\n    xhr.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"load\"\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (xhr.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e === \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e();\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Upload failed \"\u003c/span\u003e + xhr.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e));\n      }\n    });\n    xhr.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"PUT\"\u003c/span\u003e, presignedUploadUrl, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n      xhr.\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e(file);\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n      \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"Upload failed: \"\u003c/span\u003e + e.\u003cspan class=\"hljs-title function_\"\u003etoString\u003c/span\u003e()));\n    }\n  });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eReact Hooksë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseUpload\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [uploadState, setUploadState] = useState\u0026#x3C;\n    \u003cspan class=\"hljs-string\"\u003e\"idle\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"starting\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"uploading\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"finishing\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"done\"\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e\n  \u003e(\u003cspan class=\"hljs-string\"\u003e\"idle\"\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [uploadProgress, setUploadProgress] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [uploadError, setUploadError] = useState\u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e | \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e\u003e(\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    uploadState,\n    uploadProgress,\n    uploadError,\n    \u003cspan class=\"hljs-attr\"\u003eupload\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (\n      \u003cspan class=\"hljs-attr\"\u003efile\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eFile\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eonSuccess\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003euploadKey: string\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e\u003e,\n    ) =\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003esetUploadState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"starting\"\u003c/span\u003e);\n\n      \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// ë°±ì—”ë“œ APIì—ì„œ ì‚¬ì „ ì„œëª…ëœ URL ê°€ì ¸ì˜¤ê¸°:\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { key, presigned_upload_url } = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetPresignedUrl\u003c/span\u003e(\n          file,\n        );\n        \u003cspan class=\"hljs-title function_\"\u003esetUploadState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"uploading\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-comment\"\u003e// XmlHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì—…ë¡œë“œ:\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euploadFile\u003c/span\u003e(file, presigned_upload_url, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epct\u003c/span\u003e) =\u003e\u003c/span\u003e {\n          \u003cspan class=\"hljs-title function_\"\u003esetUploadProgress\u003c/span\u003e(pct);\n        });\n        \u003cspan class=\"hljs-title function_\"\u003esetUploadState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"finishing\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-comment\"\u003e// ì´ ì—…ë¡œë“œëœ íŒŒì¼ì„ ìœ ìš©í•˜ê²Œ í™œìš©í•˜ê¸°; ì•„ë§ˆë„ ì´ í‚¤ë¥¼ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤!\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonSuccess\u003c/span\u003e(key);\n        \u003cspan class=\"hljs-title function_\"\u003esetUploadState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"done\"\u003c/span\u003e);\n      } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n        \u003cspan class=\"hljs-title function_\"\u003esetUploadState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"error\"\u003c/span\u003e);\n        \u003cspan class=\"hljs-title function_\"\u003esetUploadError\u003c/span\u003e(e);\n      }\n    },\n  };\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eë§ˆì§€ë§‰ìœ¼ë¡œ: ìƒˆë¡œ ì—…ë¡œë“œëœ íŒŒì¼ ì‚¬ìš©í•˜ê¸°\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì—…ë¡œë“œí•œ S3 í‚¤ë¥¼ APIë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ê³³ì— ì €ì¥í•˜ê±°ë‚˜ ì›í•˜ëŠ” ëŒ€ë¡œ í›„ì† ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì—…ë¡œë“œ ì „ìš© S3 ë²„í‚· ë‚´ì˜ ê²½ë¡œì¸ ì—…ë¡œë“œ í‚¤ë¥¼ ë°›ëŠ” ë˜ ë‹¤ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ë¥¸ ë²„í‚·ìœ¼ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003e(ì €ëŠ” ì—…ë¡œë“œ í‚¤ì— ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ë„£ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ ë‚´ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¡œë¶€í„° ì—…ë¡œë“œëœ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)\u003c/p\u003e\n\u003cp\u003eë‹¤ìŒì€ Pythonì—ì„œ ë²„í‚·ì„ ê³µê°œ ì„œë¹™ ë²„í‚·ì— ë³µì‚¬í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eupload_key = request.\u003cspan class=\"hljs-property\"\u003evalidated_data\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"upload_key\"\u003c/span\u003e]\next = upload_key.\u003cspan class=\"hljs-title function_\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\".\"\u003c/span\u003e)[-\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]\nslug = \u003cspan class=\"hljs-title function_\"\u003eslugify\u003c/span\u003e(request.\u003cspan class=\"hljs-property\"\u003evalidated_data\u003c/span\u003e[\u003cspan class=\"hljs-string\"\u003e\"filename\"\u003c/span\u003e])\ndate = datetime.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003estrftime\u003c/span\u003e(r\u003cspan class=\"hljs-string\"\u003e\"%Y%m%d_%H%M%S\"\u003c/span\u003e)\npublic_key = f\u003cspan class=\"hljs-string\"\u003e\"media/{request.user.id}/{date}-{slug}.{ext}\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003etry\u003c/span\u003e:\n  \u003cspan class=\"hljs-title function_\"\u003epublic_content_s3_client\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ecopy\u003c/span\u003e(\n    \u003cspan class=\"hljs-title class_\"\u003eCopySource\u003c/span\u003e={\n      \u003cspan class=\"hljs-string\"\u003e\"Bucket\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"yourproject-upload\"\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Key\"\u003c/span\u003e: upload_key,\n    },\n    \u003cspan class=\"hljs-title class_\"\u003eBucket\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"yourproject-public\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eKey\u003c/span\u003e=public_key,\n  )\nexcept \u003cspan class=\"hljs-title class_\"\u003eException\u003c/span\u003e:\n  logging.\u003cspan class=\"hljs-title function_\"\u003eexception\u003c/span\u003e(f\u003cspan class=\"hljs-string\"\u003e\"Failed to copy file for user={request.user.id}\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eìš”ë ‡ê²Œ í•´ìš”. ëˆ„êµ°ê°€ì—ê² ë„ì›€ì´ ë˜ê¸¸ ë°”ë˜ìš”! í˜¹ì‹œ ë‹¤ì‹œ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ê¸° ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ì´ ë‹´ê¸´ gist ë§í¬ë„ ë“œë¦´ê²Œìš”. ğŸ¥°\u003c/p\u003e\n\u003cp\u003eì˜ê²¬ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì•Œë ¤ì£¼ì„¸ìš”! @taylorhughes\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-27-Simplesecuredirect-to-S3uploadsfrommodernbrowsers"},"buildId":"Y-fCAg8BUV7y2HNFwX9AA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>