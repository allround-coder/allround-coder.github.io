<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Nestjs 오류 처리 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-19-NestjsErrorHandling" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Nestjs 오류 처리 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Nestjs 오류 처리 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-19-NestjsErrorHandling_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-19-NestjsErrorHandling" data-gatsby-head="true"/><meta name="twitter:title" content="Nestjs 오류 처리 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-19-NestjsErrorHandling_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-19 23:16" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_buildManifest.js" defer=""></script><script src="/_next/static/aCCUs-qPrLLLWRnkN0AOd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Nestjs 오류 처리</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Nestjs 오류 처리" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 19, 2024</span><span class="posts_reading_time__f7YPP">7<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-19-NestjsErrorHandling&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<img src="/assets/img/2024-06-19-NestjsErrorHandling_0.png">
<h1>1. 소개</h1>
<p>NestJs는 백엔드 시스템을 개발하는 데 사용되는 프레임워크입니다. 이 프레임워크는 컨트롤러 레이어에서 오류 처리에 대한 규칙을 정의했지만, 이는 대규모 프로젝트에는 충분하지 않을 수 있습니다. 본 문서에서는 오류를 우아하게 처리하고 신중하게 대우하는 더 효과적이고 구조화된 접근 방식을 소개합니다.</p>
<h1>2. 오류 처리 전략</h1>
<div class="content-ad"></div>
<h1>에러 유형</h1>
<p>코드에서 발생할 수 있는 에러 유형을 정의해보겠습니다:</p>
<ul>
<li>유효성 검사 에러</li>
<li>제삼자 에러</li>
<li>데이터베이스 에러</li>
<li>일반(예기치 않은) 에러</li>
</ul>
<p>언급된 모든 종류의 에러에 특히 주의해야 합니다.</p>
<div class="content-ad"></div>
<p>특정 오류, 예를 들어 유효성 검사 오류와 같은 경우 적절한 응답이나 상태 코드로 처리할 수 있습니다. 그러나 일반 오류와 같은 다른 종류의 오류의 경우, 유지보수자에게 알리거나 높은 우선순위로 티켓을 생성하는 등의 추가 조치가 필요할 수 있습니다. 또 다른 오류 유형인 데이터베이스 오류는 복구와 복원 논리가 필요할 수 있습니다.</p>
<h1>3. 다른 계층에서의 오류 처리</h1>
<p>저는 우리의 응용프로그램 계층을 다음과 같이 분류하는 것을 선호합니다:</p>
<ul>
<li>요청 계층</li>
<li>인터셉터</li>
<li>가드</li>
<li>컨트롤러 계층(*)</li>
<li>서비스 계층</li>
<li>모델</li>
<li>데이터베이스</li>
<li>예외 처리 계층</li>
</ul>
<div class="content-ad"></div>
<p>컨트롤러 레이어 아래의 모든 레이어에서 오류가 발생하면 상위 레이어로 throw해야 합니다. 예를 들어:</p>
<ul>
<li>데이터베이스 CRUD 함수(ORM 함수 등)에서 오류가 발생하면 Database Error 유형을 throw해야 합니다.</li>
<li>서드파티 호출(Stripe 등)에서 오류가 발생하면 Third-party 에러 유형을 throw해야 합니다.</li>
<li>예기치 않은 오류가 발생하면 Generic 에러 유형으로 간주해야 합니다.</li>
<li>등등</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">sampleFucntion</span>(<span class="hljs-params">@AuthenticatedUser() jwtPayload: JwtDto</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">utilsService</span>.<span class="hljs-title function_">apiResponse</span>(<span class="hljs-number">200</span>, <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">sampleService</span>.<span class="hljs-title function_">sampleServiceFucntion</span>(jwtPayload.<span class="hljs-property">id</span>))
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">utilsService</span>.<span class="hljs-title function_">handleError</span>(error, jwtPayload, {}, <span class="hljs-string">'description'</span>)
        }
    }
</code></pre>
<p>언급한 모든 오류는 상위 레이어로 throw되어야 하며, throw된 오류를 받은 해당 레이어도 Controller 레이어가 <code>try-catch</code> 블록에서 오류를 받게 될 때까지 throw해야 합니다. 그런 다음 Controller 레이어는 잡힌 오류를 utils 모듈이나 errors 모듈에 포함된 <code>ErrorHandler</code> 함수로 전달해야 합니다.</p>
<div class="content-ad"></div>
<h1>오류 처리기 함수</h1>
<p>이 함수는 받은 오류 유형을 Switch-case 또는 if-else 방식으로 감지하여 처리해야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">handleError</span>(error, <span class="hljs-attr">jwt</span>: <span class="hljs-title class_">JwtDto</span>, <span class="hljs-attr">additionalInfo</span>: any, <span class="hljs-attr">description</span>: string): <span class="hljs-keyword">void</span> {
        <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">CheckingException</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CheckingException</span>(error.<span class="hljs-property">message</span>, error.<span class="hljs-property">statusCode</span>,error.<span class="hljs-property">messageData</span>)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">DatabaseException</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseException</span>(error.<span class="hljs-property">message</span>, error, error.<span class="hljs-property">queryParams</span>, description)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">StripeErrorException</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StripeErrorException</span>(error <span class="hljs-keyword">as</span> <span class="hljs-title class_">Stripe</span>.<span class="hljs-property">errors</span>.<span class="hljs-property">StripeError</span>, error.<span class="hljs-property">stack</span>, description)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HttpException</span>){
                <span class="hljs-keyword">throw</span> error
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericException</span>(error.<span class="hljs-property">message</span>, error, jwt, additionalInfo, description)
        }
    }
</code></pre>
<p>유형을 감지한 후, 각 오류 유형에 적합한 매개변수로 오류 유형을 생성하고 해당 오류를 throw해야 합니다.</p>
<div class="content-ad"></div>
<p>샘플 Exception 클래스:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Error</span> {
    <span class="hljs-attr">queryParams</span>: any
    <span class="hljs-attr">description</span>: any
    <span class="hljs-attr">stack</span>:any
    message : string
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: string,error: <span class="hljs-built_in">Error</span>, q: any, description?: string</span>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">`데이터베이스 오류가 발생했습니다: <span class="hljs-subst">${message}</span>`</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">queryParams</span> = q
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">description</span> = description
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span> = error.<span class="hljs-property">stack</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = error.<span class="hljs-property">message</span>
    }
}
</code></pre>
<p>특정 APP_FILTER를 정의하고 app.module에서 등록해야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-attr">providers</span>: [
    {
        <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">APP_FILTER</span>,
        <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">GenericExceptionFilter</span>,
    },
    {
        <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">APP_FILTER</span>,
        <span class="hljs-attr">useClass</span>: checkingExceptionFilter,
    },
    {
        <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">APP_FILTER</span>,
        <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">DatabaseExceptionFilter</span>,
    },
    {
        <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">APP_FILTER</span>,
        <span class="hljs-attr">useClass</span>: <span class="hljs-title class_">StripeExceptionFilter</span>,
    },
    <span class="hljs-title class_">AppService</span>,
    <span class="hljs-title class_">UtilsService</span>,
    <span class="hljs-title class_">JwtService</span>,
    <span class="hljs-title class_">LoggerService</span>,
]
</code></pre>
<div class="content-ad"></div>
<p>예외 필터에서는 이제 이러한 오류 중 하나에 완벽하게 대응해야 합니다:
다음 조건을 고려해 주세요:</p>
<ul>
<li>데이터베이스 및 일반적인 오류는 유지보수자에게 알리고 처리된 오류에 대한 사용자 응답이 있어야 합니다.</li>
<li>Stripe 및 Checking(유효성) 오류는 사용자에게만 응답해야 합니다.</li>
</ul>
<p>데이터베이스 및 일반적인 오류에 대한 샘플 예외 필터:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// database.filter.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ArgumentsHost</span>, <span class="hljs-title class_">Catch</span>, <span class="hljs-title class_">ExceptionFilter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LoggerService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../logger/logger.service'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GenericException</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./generic.exception'</span>
</code></pre>
<div class="content-ad"></div>
<pre><code class="hljs language-js">@<span class="hljs-title class_">Catch</span>(<span class="hljs-title class_">GenericException</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericExceptionFilter</span> implements <span class="hljs-title class_">ExceptionFilter</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly loggerService: LoggerService</span>) {}
    <span class="hljs-keyword">catch</span>(<span class="hljs-attr">exception</span>: <span class="hljs-title class_">GenericException</span>, <span class="hljs-attr">host</span>: <span class="hljs-title class_">ArgumentsHost</span>) {
        <span class="hljs-keyword">const</span> ctx = host.<span class="hljs-title function_">switchToHttp</span>()
        <span class="hljs-keyword">const</span> response = ctx.<span class="hljs-title function_">getResponse</span>()
        <span class="hljs-keyword">const</span> errorData = {
            <span class="hljs-attr">description</span>: exception.<span class="hljs-property">description</span>,
            <span class="hljs-attr">stack</span>: exception.<span class="hljs-property">stack</span>,
            <span class="hljs-attr">jwtPayload</span>: exception.<span class="hljs-property">jwtPayload</span>,
            <span class="hljs-attr">additionalInfo</span>: exception.<span class="hljs-property">additionalInfo</span>,
            <span class="hljs-attr">message</span>: exception.<span class="hljs-property">message</span>,
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loggerService</span>.<span class="hljs-title function_">error</span>(exception.<span class="hljs-property">message</span>, errorData)
        response.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">statusCode</span>: <span class="hljs-number">500</span>,
            <span class="hljs-attr">message</span>: exception.<span class="hljs-property">message</span>,
            <span class="hljs-attr">error</span>: <span class="hljs-string">'Error'</span>,
        })
    }
}
</code></pre>
<p>Winston 로거를 사용하여 오류 수준 로그를 송신 및 티켓 생성을 위해 로그 전송기를 정의했습니다:</p>
<p>this.loggerService.error(exception.message, errorData)</p>
<p>일반적인 오류(외부 라이브러리 또는 유효성 검사 오류)에 대한 것입니다:</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ArgumentsHost</span>, <span class="hljs-title class_">Catch</span>, <span class="hljs-title class_">ExceptionFilter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CheckingException</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./checking.exception'</span>
</code></pre>
<pre><code class="hljs language-js">@<span class="hljs-title class_">Catch</span>(<span class="hljs-title class_">CheckingException</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">checkingExceptionFilter</span> implements <span class="hljs-title class_">ExceptionFilter</span> {
    <span class="hljs-keyword">catch</span>(<span class="hljs-attr">exception</span>: <span class="hljs-title class_">CheckingException</span>, <span class="hljs-attr">host</span>: <span class="hljs-title class_">ArgumentsHost</span>) {
        <span class="hljs-keyword">const</span> ctx = host.<span class="hljs-title function_">switchToHttp</span>()
        <span class="hljs-keyword">const</span> response = ctx.<span class="hljs-title function_">getResponse</span>()
        response.<span class="hljs-title function_">status</span>(exception.<span class="hljs-property">statusCode</span>).<span class="hljs-title function_">json</span>({
            <span class="hljs-attr">statusCode</span>: exception.<span class="hljs-property">statusCode</span>,
            <span class="hljs-attr">message</span>: exception.<span class="hljs-property">messageData</span>,
            <span class="hljs-attr">error</span>: exception.<span class="hljs-property">message</span>,
        })
    }
}
</code></pre>
<h1>모니터링 도구</h1>
<p>더 나은 오류 처리를 위해 몇 가지 도구를 사용할 수 있습니다:</p>
<div class="content-ad"></div>
<ul>
<li>Sentry</li>
<li>Raygun</li>
<li>Winston</li>
<li>등</li>
</ul>
<p>이 프로젝트에서는 Raygun을 사용하여 오류 모니터링 및 보고를 합니다.</p>
<h2>Raygun</h2>
<p>Raygun은 개발자가 애플리케이션에서 문제를 식별하고 전체 소프트웨어 품질을 향상시키는 종합 오류, 충돌 및 성능 모니터링 솔루션입니다.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-attr">createUserDto</span>: <span class="hljs-title class_">CreateUserDto</span>): <span class="hljs-title class_">Promise</span>&#x3C;<span class="hljs-title class_">User</span>> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 사용자 생성을 위한 비즈니스 로직</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">raygunLoggerService</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'사용자 생성 실패'</span>, error.<span class="hljs-property">stack</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'사용자 생성 실패'</span>);
    }
</code></pre>
<p>성능 모니터링</p>
<ul>
<li>Raygun은 성능 메트릭을 추적하고 응용 프로그램의 병목 현상을 식별하는 실제 사용자 모니터링 (RUM) 및 응용 프로그램 성능 모니터링 (APM)도 제공합니다.</li>
</ul>
<p>Raygun 대시보드</p>
<div class="content-ad"></div>
<p>Raygun 대시 보드에 액세스하여 자세한 오류 보고서를 확인하고 응용 프로그램 성능을 추적하며 중요한 문제에 대한 경보 및 알림을 설정할 수 있습니다.</p>
<p>Raygun을 NestJS 애플리케이션에 통합하면 오류 및 성능 문제에 대한 강력한 통찰력을 얻어 문제를 선제적으로 해결하고 소프트웨어의 전반적인 안정성과 신뢰성을 향상시킬 수 있습니다.</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Nestjs 오류 처리","description":"","date":"2024-06-19 23:16","slug":"2024-06-19-NestjsErrorHandling","content":"\n\n\u003cimg src=\"/assets/img/2024-06-19-NestjsErrorHandling_0.png\" /\u003e\n\n# 1. 소개\n\nNestJs는 백엔드 시스템을 개발하는 데 사용되는 프레임워크입니다. 이 프레임워크는 컨트롤러 레이어에서 오류 처리에 대한 규칙을 정의했지만, 이는 대규모 프로젝트에는 충분하지 않을 수 있습니다. 본 문서에서는 오류를 우아하게 처리하고 신중하게 대우하는 더 효과적이고 구조화된 접근 방식을 소개합니다.\n\n# 2. 오류 처리 전략\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 에러 유형\n\n코드에서 발생할 수 있는 에러 유형을 정의해보겠습니다:\n\n- 유효성 검사 에러\n- 제삼자 에러\n- 데이터베이스 에러\n- 일반(예기치 않은) 에러\n\n언급된 모든 종류의 에러에 특히 주의해야 합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n특정 오류, 예를 들어 유효성 검사 오류와 같은 경우 적절한 응답이나 상태 코드로 처리할 수 있습니다. 그러나 일반 오류와 같은 다른 종류의 오류의 경우, 유지보수자에게 알리거나 높은 우선순위로 티켓을 생성하는 등의 추가 조치가 필요할 수 있습니다. 또 다른 오류 유형인 데이터베이스 오류는 복구와 복원 논리가 필요할 수 있습니다.\n\n# 3. 다른 계층에서의 오류 처리\n\n저는 우리의 응용프로그램 계층을 다음과 같이 분류하는 것을 선호합니다:\n\n- 요청 계층\n- 인터셉터\n- 가드\n- 컨트롤러 계층(*)\n- 서비스 계층\n- 모델\n- 데이터베이스\n- 예외 처리 계층\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n컨트롤러 레이어 아래의 모든 레이어에서 오류가 발생하면 상위 레이어로 throw해야 합니다. 예를 들어:\n\n- 데이터베이스 CRUD 함수(ORM 함수 등)에서 오류가 발생하면 Database Error 유형을 throw해야 합니다.\n- 서드파티 호출(Stripe 등)에서 오류가 발생하면 Third-party 에러 유형을 throw해야 합니다.\n- 예기치 않은 오류가 발생하면 Generic 에러 유형으로 간주해야 합니다.\n- 등등\n\n```js\nasync sampleFucntion(@AuthenticatedUser() jwtPayload: JwtDto) {\n        try {\n            return this.utilsService.apiResponse(200, await this.sampleService.sampleServiceFucntion(jwtPayload.id))\n        } catch (error) {\n            this.utilsService.handleError(error, jwtPayload, {}, 'description')\n        }\n    }\n```\n\n언급한 모든 오류는 상위 레이어로 throw되어야 하며, throw된 오류를 받은 해당 레이어도 Controller 레이어가 `try-catch` 블록에서 오류를 받게 될 때까지 throw해야 합니다. 그런 다음 Controller 레이어는 잡힌 오류를 utils 모듈이나 errors 모듈에 포함된 `ErrorHandler` 함수로 전달해야 합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n# 오류 처리기 함수\n\n이 함수는 받은 오류 유형을 Switch-case 또는 if-else 방식으로 감지하여 처리해야 합니다.\n\n```js\nhandleError(error, jwt: JwtDto, additionalInfo: any, description: string): void {\n        if (error instanceof CheckingException) {\n            throw new CheckingException(error.message, error.statusCode,error.messageData)\n        } else if (error instanceof DatabaseException) {\n            throw new DatabaseException(error.message, error, error.queryParams, description)\n        } else if (error instanceof StripeErrorException) {\n            throw new StripeErrorException(error as Stripe.errors.StripeError, error.stack, description)\n        } else if (error instanceof HttpException){\n                throw error\n        } else {\n            throw new GenericException(error.message, error, jwt, additionalInfo, description)\n        }\n    }\n```\n\n유형을 감지한 후, 각 오류 유형에 적합한 매개변수로 오류 유형을 생성하고 해당 오류를 throw해야 합니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n샘플 Exception 클래스:\n\n```js\nexport class DatabaseException extends Error {\n    queryParams: any\n    description: any\n    stack:any\n    message : string\n    constructor(message: string,error: Error, q: any, description?: string) {\n        super(`데이터베이스 오류가 발생했습니다: ${message}`)\n        this.queryParams = q\n        this.description = description\n        this.stack = error.stack\n        this.message = error.message\n    }\n}\n```\n\n특정 APP_FILTER를 정의하고 app.module에서 등록해야 합니다:\n\n```js\nproviders: [\n    {\n        provide: APP_FILTER,\n        useClass: GenericExceptionFilter,\n    },\n    {\n        provide: APP_FILTER,\n        useClass: checkingExceptionFilter,\n    },\n    {\n        provide: APP_FILTER,\n        useClass: DatabaseExceptionFilter,\n    },\n    {\n        provide: APP_FILTER,\n        useClass: StripeExceptionFilter,\n    },\n    AppService,\n    UtilsService,\n    JwtService,\n    LoggerService,\n]\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n예외 필터에서는 이제 이러한 오류 중 하나에 완벽하게 대응해야 합니다:\n다음 조건을 고려해 주세요:\n\n- 데이터베이스 및 일반적인 오류는 유지보수자에게 알리고 처리된 오류에 대한 사용자 응답이 있어야 합니다.\n- Stripe 및 Checking(유효성) 오류는 사용자에게만 응답해야 합니다.\n\n데이터베이스 및 일반적인 오류에 대한 샘플 예외 필터:\n\n```js\n// database.filter.ts\nimport { ArgumentsHost, Catch, ExceptionFilter } from '@nestjs/common'\nimport { LoggerService } from '../../../../logger/logger.service'\nimport { GenericException } from './generic.exception'\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n@Catch(GenericException)\nexport class GenericExceptionFilter implements ExceptionFilter {\n    constructor(private readonly loggerService: LoggerService) {}\n    catch(exception: GenericException, host: ArgumentsHost) {\n        const ctx = host.switchToHttp()\n        const response = ctx.getResponse()\n        const errorData = {\n            description: exception.description,\n            stack: exception.stack,\n            jwtPayload: exception.jwtPayload,\n            additionalInfo: exception.additionalInfo,\n            message: exception.message,\n        }\n        this.loggerService.error(exception.message, errorData)\n        response.status(500).json({\n            statusCode: 500,\n            message: exception.message,\n            error: 'Error',\n        })\n    }\n}\n```\n\nWinston 로거를 사용하여 오류 수준 로그를 송신 및 티켓 생성을 위해 로그 전송기를 정의했습니다:\n\nthis.loggerService.error(exception.message, errorData)\n\n일반적인 오류(외부 라이브러리 또는 유효성 검사 오류)에 대한 것입니다:\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nimport { ArgumentsHost, Catch, ExceptionFilter } from '@nestjs/common'\nimport { CheckingException } from './checking.exception'\n```\n\n```js\n@Catch(CheckingException)\nexport class checkingExceptionFilter implements ExceptionFilter {\n    catch(exception: CheckingException, host: ArgumentsHost) {\n        const ctx = host.switchToHttp()\n        const response = ctx.getResponse()\n        response.status(exception.statusCode).json({\n            statusCode: exception.statusCode,\n            message: exception.messageData,\n            error: exception.message,\n        })\n    }\n}\n```\n\n# 모니터링 도구\n\n더 나은 오류 처리를 위해 몇 가지 도구를 사용할 수 있습니다:\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n- Sentry\n- Raygun\n- Winston\n- 등\n\n이 프로젝트에서는 Raygun을 사용하여 오류 모니터링 및 보고를 합니다.\n\n## Raygun\n\nRaygun은 개발자가 애플리케이션에서 문제를 식별하고 전체 소프트웨어 품질을 향상시키는 종합 오류, 충돌 및 성능 모니터링 솔루션입니다.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```typescript\nasync createUser(createUserDto: CreateUserDto): Promise\u003cUser\u003e {\n    try {\n      // 사용자 생성을 위한 비즈니스 로직\n    } catch (error) {\n      this.raygunLoggerService.error('사용자 생성 실패', error.stack);\n      throw new Error('사용자 생성 실패');\n    }\n```\n\n성능 모니터링\n\n- Raygun은 성능 메트릭을 추적하고 응용 프로그램의 병목 현상을 식별하는 실제 사용자 모니터링 (RUM) 및 응용 프로그램 성능 모니터링 (APM)도 제공합니다.\n\nRaygun 대시보드\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nRaygun 대시 보드에 액세스하여 자세한 오류 보고서를 확인하고 응용 프로그램 성능을 추적하며 중요한 문제에 대한 경보 및 알림을 설정할 수 있습니다.\n\nRaygun을 NestJS 애플리케이션에 통합하면 오류 및 성능 문제에 대한 강력한 통찰력을 얻어 문제를 선제적으로 해결하고 소프트웨어의 전반적인 안정성과 신뢰성을 향상시킬 수 있습니다.","ogImage":{"url":"/assets/img/2024-06-19-NestjsErrorHandling_0.png"},"coverImage":"/assets/img/2024-06-19-NestjsErrorHandling_0.png","tag":["Tech"],"readingTime":7},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cimg src=\"/assets/img/2024-06-19-NestjsErrorHandling_0.png\"\u003e\n\u003ch1\u003e1. 소개\u003c/h1\u003e\n\u003cp\u003eNestJs는 백엔드 시스템을 개발하는 데 사용되는 프레임워크입니다. 이 프레임워크는 컨트롤러 레이어에서 오류 처리에 대한 규칙을 정의했지만, 이는 대규모 프로젝트에는 충분하지 않을 수 있습니다. 본 문서에서는 오류를 우아하게 처리하고 신중하게 대우하는 더 효과적이고 구조화된 접근 방식을 소개합니다.\u003c/p\u003e\n\u003ch1\u003e2. 오류 처리 전략\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e에러 유형\u003c/h1\u003e\n\u003cp\u003e코드에서 발생할 수 있는 에러 유형을 정의해보겠습니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e유효성 검사 에러\u003c/li\u003e\n\u003cli\u003e제삼자 에러\u003c/li\u003e\n\u003cli\u003e데이터베이스 에러\u003c/li\u003e\n\u003cli\u003e일반(예기치 않은) 에러\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e언급된 모든 종류의 에러에 특히 주의해야 합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e특정 오류, 예를 들어 유효성 검사 오류와 같은 경우 적절한 응답이나 상태 코드로 처리할 수 있습니다. 그러나 일반 오류와 같은 다른 종류의 오류의 경우, 유지보수자에게 알리거나 높은 우선순위로 티켓을 생성하는 등의 추가 조치가 필요할 수 있습니다. 또 다른 오류 유형인 데이터베이스 오류는 복구와 복원 논리가 필요할 수 있습니다.\u003c/p\u003e\n\u003ch1\u003e3. 다른 계층에서의 오류 처리\u003c/h1\u003e\n\u003cp\u003e저는 우리의 응용프로그램 계층을 다음과 같이 분류하는 것을 선호합니다:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e요청 계층\u003c/li\u003e\n\u003cli\u003e인터셉터\u003c/li\u003e\n\u003cli\u003e가드\u003c/li\u003e\n\u003cli\u003e컨트롤러 계층(*)\u003c/li\u003e\n\u003cli\u003e서비스 계층\u003c/li\u003e\n\u003cli\u003e모델\u003c/li\u003e\n\u003cli\u003e데이터베이스\u003c/li\u003e\n\u003cli\u003e예외 처리 계층\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e컨트롤러 레이어 아래의 모든 레이어에서 오류가 발생하면 상위 레이어로 throw해야 합니다. 예를 들어:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e데이터베이스 CRUD 함수(ORM 함수 등)에서 오류가 발생하면 Database Error 유형을 throw해야 합니다.\u003c/li\u003e\n\u003cli\u003e서드파티 호출(Stripe 등)에서 오류가 발생하면 Third-party 에러 유형을 throw해야 합니다.\u003c/li\u003e\n\u003cli\u003e예기치 않은 오류가 발생하면 Generic 에러 유형으로 간주해야 합니다.\u003c/li\u003e\n\u003cli\u003e등등\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esampleFucntion\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e@AuthenticatedUser() jwtPayload: JwtDto\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eutilsService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eapiResponse\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esampleService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esampleServiceFucntion\u003c/span\u003e(jwtPayload.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e))\n        } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n            \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eutilsService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ehandleError\u003c/span\u003e(error, jwtPayload, {}, \u003cspan class=\"hljs-string\"\u003e'description'\u003c/span\u003e)\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e언급한 모든 오류는 상위 레이어로 throw되어야 하며, throw된 오류를 받은 해당 레이어도 Controller 레이어가 \u003ccode\u003etry-catch\u003c/code\u003e 블록에서 오류를 받게 될 때까지 throw해야 합니다. 그런 다음 Controller 레이어는 잡힌 오류를 utils 모듈이나 errors 모듈에 포함된 \u003ccode\u003eErrorHandler\u003c/code\u003e 함수로 전달해야 합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch1\u003e오류 처리기 함수\u003c/h1\u003e\n\u003cp\u003e이 함수는 받은 오류 유형을 Switch-case 또는 if-else 방식으로 감지하여 처리해야 합니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003ehandleError\u003c/span\u003e(error, \u003cspan class=\"hljs-attr\"\u003ejwt\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eJwtDto\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003eadditionalInfo\u003c/span\u003e: any, \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e: string): \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCheckingException\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCheckingException\u003c/span\u003e(error.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e, error.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e,error.\u003cspan class=\"hljs-property\"\u003emessageData\u003c/span\u003e)\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDatabaseException\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDatabaseException\u003c/span\u003e(error.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e, error, error.\u003cspan class=\"hljs-property\"\u003equeryParams\u003c/span\u003e, description)\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStripeErrorException\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStripeErrorException\u003c/span\u003e(error \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStripe\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eerrors\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eStripeError\u003c/span\u003e, error.\u003cspan class=\"hljs-property\"\u003estack\u003c/span\u003e, description)\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (error \u003cspan class=\"hljs-keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHttpException\u003c/span\u003e){\n                \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e error\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eGenericException\u003c/span\u003e(error.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e, error, jwt, additionalInfo, description)\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e유형을 감지한 후, 각 오류 유형에 적합한 매개변수로 오류 유형을 생성하고 해당 오류를 throw해야 합니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e샘플 Exception 클래스:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDatabaseException\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title class_ inherited__\"\u003eError\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr\"\u003equeryParams\u003c/span\u003e: any\n    \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e: any\n    \u003cspan class=\"hljs-attr\"\u003estack\u003c/span\u003e:any\n    message : string\n    \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emessage: string,error: \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e, q: any, description?: string\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_\"\u003esuper\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`데이터베이스 오류가 발생했습니다: \u003cspan class=\"hljs-subst\"\u003e${message}\u003c/span\u003e`\u003c/span\u003e)\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003equeryParams\u003c/span\u003e = q\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edescription\u003c/span\u003e = description\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003estack\u003c/span\u003e = error.\u003cspan class=\"hljs-property\"\u003estack\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e = error.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e특정 APP_FILTER를 정의하고 app.module에서 등록해야 합니다:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-attr\"\u003eproviders\u003c/span\u003e: [\n    {\n        \u003cspan class=\"hljs-attr\"\u003eprovide\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eAPP_FILTER\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euseClass\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eGenericExceptionFilter\u003c/span\u003e,\n    },\n    {\n        \u003cspan class=\"hljs-attr\"\u003eprovide\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eAPP_FILTER\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euseClass\u003c/span\u003e: checkingExceptionFilter,\n    },\n    {\n        \u003cspan class=\"hljs-attr\"\u003eprovide\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eAPP_FILTER\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euseClass\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDatabaseExceptionFilter\u003c/span\u003e,\n    },\n    {\n        \u003cspan class=\"hljs-attr\"\u003eprovide\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eAPP_FILTER\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003euseClass\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eStripeExceptionFilter\u003c/span\u003e,\n    },\n    \u003cspan class=\"hljs-title class_\"\u003eAppService\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eUtilsService\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eJwtService\u003c/span\u003e,\n    \u003cspan class=\"hljs-title class_\"\u003eLoggerService\u003c/span\u003e,\n]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e예외 필터에서는 이제 이러한 오류 중 하나에 완벽하게 대응해야 합니다:\n다음 조건을 고려해 주세요:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e데이터베이스 및 일반적인 오류는 유지보수자에게 알리고 처리된 오류에 대한 사용자 응답이 있어야 합니다.\u003c/li\u003e\n\u003cli\u003eStripe 및 Checking(유효성) 오류는 사용자에게만 응답해야 합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e데이터베이스 및 일반적인 오류에 대한 샘플 예외 필터:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// database.filter.ts\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eArgumentsHost\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCatch\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eExceptionFilter\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/common'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eLoggerService\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'../../../../logger/logger.service'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eGenericException\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./generic.exception'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e@\u003cspan class=\"hljs-title class_\"\u003eCatch\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eGenericException\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eGenericExceptionFilter\u003c/span\u003e implements \u003cspan class=\"hljs-title class_\"\u003eExceptionFilter\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprivate readonly loggerService: LoggerService\u003c/span\u003e) {}\n    \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eexception\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eGenericException\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ehost\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eArgumentsHost\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ctx = host.\u003cspan class=\"hljs-title function_\"\u003eswitchToHttp\u003c/span\u003e()\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = ctx.\u003cspan class=\"hljs-title function_\"\u003egetResponse\u003c/span\u003e()\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e errorData = {\n            \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003edescription\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003estack\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003estack\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ejwtPayload\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003ejwtPayload\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eadditionalInfo\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003eadditionalInfo\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e,\n        }\n        \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eloggerService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(exception.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e, errorData)\n        response.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n            \u003cspan class=\"hljs-attr\"\u003estatusCode\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e500\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Error'\u003c/span\u003e,\n        })\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWinston 로거를 사용하여 오류 수준 로그를 송신 및 티켓 생성을 위해 로그 전송기를 정의했습니다:\u003c/p\u003e\n\u003cp\u003ethis.loggerService.error(exception.message, errorData)\u003c/p\u003e\n\u003cp\u003e일반적인 오류(외부 라이브러리 또는 유효성 검사 오류)에 대한 것입니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eArgumentsHost\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eCatch\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eExceptionFilter\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@nestjs/common'\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eCheckingException\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./checking.exception'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e@\u003cspan class=\"hljs-title class_\"\u003eCatch\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eCheckingException\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003echeckingExceptionFilter\u003c/span\u003e implements \u003cspan class=\"hljs-title class_\"\u003eExceptionFilter\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003eexception\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eCheckingException\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ehost\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eArgumentsHost\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ctx = host.\u003cspan class=\"hljs-title function_\"\u003eswitchToHttp\u003c/span\u003e()\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = ctx.\u003cspan class=\"hljs-title function_\"\u003egetResponse\u003c/span\u003e()\n        response.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(exception.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n            \u003cspan class=\"hljs-attr\"\u003estatusCode\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003emessageData\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eerror\u003c/span\u003e: exception.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e,\n        })\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1\u003e모니터링 도구\u003c/h1\u003e\n\u003cp\u003e더 나은 오류 처리를 위해 몇 가지 도구를 사용할 수 있습니다:\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eSentry\u003c/li\u003e\n\u003cli\u003eRaygun\u003c/li\u003e\n\u003cli\u003eWinston\u003c/li\u003e\n\u003cli\u003e등\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e이 프로젝트에서는 Raygun을 사용하여 오류 모니터링 및 보고를 합니다.\u003c/p\u003e\n\u003ch2\u003eRaygun\u003c/h2\u003e\n\u003cp\u003eRaygun은 개발자가 애플리케이션에서 문제를 식별하고 전체 소프트웨어 품질을 향상시키는 종합 오류, 충돌 및 성능 모니터링 솔루션입니다.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreateUser\u003c/span\u003e(\u003cspan class=\"hljs-attr\"\u003ecreateUserDto\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eCreateUserDto\u003c/span\u003e): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-title class_\"\u003eUser\u003c/span\u003e\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 사용자 생성을 위한 비즈니스 로직\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eraygunLoggerService\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'사용자 생성 실패'\u003c/span\u003e, error.\u003cspan class=\"hljs-property\"\u003estack\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'사용자 생성 실패'\u003c/span\u003e);\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e성능 모니터링\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRaygun은 성능 메트릭을 추적하고 응용 프로그램의 병목 현상을 식별하는 실제 사용자 모니터링 (RUM) 및 응용 프로그램 성능 모니터링 (APM)도 제공합니다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eRaygun 대시보드\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eRaygun 대시 보드에 액세스하여 자세한 오류 보고서를 확인하고 응용 프로그램 성능을 추적하며 중요한 문제에 대한 경보 및 알림을 설정할 수 있습니다.\u003c/p\u003e\n\u003cp\u003eRaygun을 NestJS 애플리케이션에 통합하면 오류 및 성능 문제에 대한 강력한 통찰력을 얻어 문제를 선제적으로 해결하고 소프트웨어의 전반적인 안정성과 신뢰성을 향상시킬 수 있습니다.\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-19-NestjsErrorHandling"},"buildId":"aCCUs-qPrLLLWRnkN0AOd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>