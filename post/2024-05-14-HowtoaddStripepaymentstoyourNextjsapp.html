<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Nextjs 앱에 Stripe 결제 추가하는 방법 | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Nextjs 앱에 Stripe 결제 추가하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Nextjs 앱에 Stripe 결제 추가하는 방법 | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp" data-gatsby-head="true"/><meta name="twitter:title" content="Nextjs 앱에 Stripe 결제 추가하는 방법 | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-05-14 16:09" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd012fc8787133d0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd012fc8787133d0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-4a646156c659a948.js" defer=""></script><script src="/_next/static/chunks/348-d11c34b645b13f5b.js" defer=""></script><script src="/_next/static/chunks/551-3069cf29fe274aab.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-a8eda6c93e0b14fe.js" defer=""></script><script src="/_next/static/7rKODeu6chWTLgXf6auoL/_buildManifest.js" defer=""></script><script src="/_next/static/7rKODeu6chWTLgXf6auoL/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Nextjs 앱에 Stripe 결제 추가하는 방법</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Nextjs 앱에 Stripe 결제 추가하는 방법" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/assets/profile.jpg"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On May 14, 2024</span><span class="posts_reading_time__f7YPP">10<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><img src="/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png"/>
<p>와! 내 매체 암호를 찾았어요!</p>
<p>이제, 내 첫 번째 기사에서 Stripe를 Next.js 앱에 통합하는 방법에 대해 이야기하려고 해요.</p>
<p>이 프로젝트에서는 너무 복잡한 것을 만드는 데 주의를 기울이지 않을 거에요. 대신에 우리는 간편한 Next.js 13.4 앱을 개발하여 일회성 Stripe 결제를 가능하게 할 거에요.</p>
<h2>설정하기</h2>
<p>터미널을 열고 나의 경우에는 Workspace 안에서 다음 명령을 실행해 주세요.</p>
<pre><code class="hljs language-js">npx create-next-app@latest
</code></pre>
<p>위 명령을 실행하면 &quot;create-next-app@13.4.1&quot;을 설치하라는 메시지가 표시되며 몇 가지 질문이 있을 겁니다.</p>
<ul>
<li>프로젝트 이름은 무엇인가요? stripe-nextjs</li>
<li>TypeScript를 사용하고 싶나요? 네</li>
<li>ESLint를 사용하고 싶나요? 네</li>
<li>이 프로젝트에 Tailwind CSS를 사용하고 싶나요? 아니요, 스타일 작업을 하지 않을 예정이기 때문에</li>
<li><code>src/</code> 디렉토리를 사용하고 싶나요? 네</li>
<li>App Router를 사용하시겠습니까? 네</li>
<li>기본 import 별칭을 사용자 정의하시겠습니까? 아니요</li>
</ul>
<p>질문에 모두 답했다면, 설치가 시작됩니다!</p>
<p>이제 설치가 완료되었습니다! 이제 실제로 Next.js 앱을 보려면 터미널에서 다음 명령을 실행하세요. Next.js 앱 내부에 있는지 확인하세요.</p>
<pre><code class="hljs language-js">yarn run dev
</code></pre>
<p>더 나아가기 전에, Stripe 계정을 생성하고 API 키를 받아봐요.</p>
<p>Stripe 계정을 만든 후에, dashboard.stripe.com/test/apikeys로 이동해서 API 키를 받아요.</p>
<h2>환경 파일 설정하기</h2>
<p>루트 디렉토리 안에, .env.local이라는 파일을 만들어주세요.</p>
<p>.env.local 파일 안에 다음을 추가해주세요:</p>
<pre><code class="hljs language-js"><span class="hljs-variable constant_">NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY</span>=<span class="hljs-string">&quot;&quot;</span>
<span class="hljs-variable constant_">STRIPE_SECRET_KEY</span>=<span class="hljs-string">&quot;&quot;</span>
</code></pre>
<p>여기서 기억해야 할 중요한 점이 몇 가지 있어요. 먼저, &quot;&quot;&quot;를 Stripe 키로 대체해야 합니다. 둘째로, 두 변수 간의 차이를 이해하는 것이 중요합니다. 하나는 &quot;NEXT_PUBLIC&quot;을 포함하고 다른 하나는 포함하지 않습니다. 간단히 말해서, &quot;NEXT_PUBLIC&quot;을 사용하여 STRIPE_PUBLISHABLE_KEY를 노출시키는 것은 괜찮지만 시크릿 키는 절대로 클라이언트 측에 노출되어서는 안 됩니다.</p>
<p>알았어요, 이해했어요? 그럼 다음 단계로 넘어갑시다!</p>
<h2>필요한 패키지 설치하기</h2>
<p>당신의 Next.js 앱 내부에 다음 패키지를 설치해보세요:</p>
<pre><code class="hljs language-js">@stripe/react-stripe-js @stripe/stripe-js stripe axios
</code></pre>
<h2>백엔드 작업을 시작해봅시다</h2>
<p>우리 앱 폴더 안에 api라는 새 폴더를 만들어주세요. 이곳에 모든 백엔드 코드가 위치하게 됩니다.</p>
<p>api 폴더 안에 create-payment-intent라는 새 폴더를 만들고, 그 안에 route.ts 라는 파일을 생성해주세요.</p>
<p><img src="/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_1.png" alt="이미지"/></p>
<p>&quot;create-payment-intent&quot; 폴더 안에 &quot;route&quot;라는 파일을 만드는 이유는 Next.js에 API 요청을 다루고 있다는 것을 알리는 것입니다. 공식 문서에 따르면, route는 라우팅의 가장 기본적인 수준으로, 페이지가 하는 것처럼 레이아웃이나 클라이언트 측 탐색에 영향을주지 않습니다. &quot;route.ts&quot; 파일이 &quot;page.ts&quot; 파일이 있는 곳에 존재할 수 없다는 점을 명심해야 합니다. 자세한 내용은 문서를 참고하는 것을 강력히 권장합니다.</p>
<p>여기는 route.ts 파일의 코드입니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span>, <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/server&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Stripe</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;stripe&quot;</span>;

<span class="hljs-keyword">const</span> stripe = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stripe</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">STRIPE_SECRET_KEY</span>!, {
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">apiVersion</span>: <span class="hljs-string">&quot;2022-11-15&quot;</span>,
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">req: NextRequest</span>) {
  <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">const</span> { amount } = data;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> paymentIntent = <span class="hljs-keyword">await</span> stripe.<span class="hljs-property">paymentIntents</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">amount</span>: <span class="hljs-title class_">Number</span>(amount) * <span class="hljs-number">100</span>,
      <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NextResponse</span>(paymentIntent.<span class="hljs-property">client_secret</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">200</span> });
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NextResponse</span>(error, {
      <span class="hljs-attr">status</span>: <span class="hljs-number">400</span>,
    });
  }
}
</code></pre>
<p>이것을 자세히 살펴보고 무슨 일이 일어나고 있는지 이해해 봅시다.</p>
<p>첫째로, 우리는 타입과 stripe를 import 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span>, <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/server&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Stripe</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;stripe&quot;</span>;
</code></pre>
<p>다음으로 stripe 인스턴스를 만듭니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> stripe = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stripe</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">STRIPE_SECRET_KEY</span>!, {
  <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">apiVersion</span>: <span class="hljs-string">&quot;2022-11-15&quot;</span>,
});
</code></pre>
<p>우리의 Stripe 인스턴스는 env.local 파일에서 Stripe 비밀키가 필요합니다. 더 나아가, 우리는 Stripe 인스턴스에 TypeScript를 활성화하고 인스턴스용 Stripe API 버전을 지정했습니다.</p>
<p>계속 진행하기 전에 Next.js 13.4에서 API 경로를 다루는 방법에 대해 이야기해 봅시다.</p>
<p>아마 이미 주목했을 것이지만, 함수의 제목이 &quot;POST&quot;와 같이 모두 대문자로 되어 있습니다. 이 네이밍 규칙은 Next.js가 실행할 해당 HTTP 메소드를 결정하기 위해 필요합니다. 예를 들어, GET 요청을 수행하려면 함수의 제목을 &quot;GET&quot;으로 지정해야 하며, 수행하려는 다른 작업에 대해서도 유사하게 지정해야 합니다.</p>
<p>알겠습니다, 이해했습니다, 좋아요! 계속 진행합시다!</p>
<p>우리 함수 내에서는 요청에서 데이터를 비구조화하는 방식으로 진행합니다. 그 후에는 데이터 객체에서 금액을 더욱 세분화합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">json</span>();
<span class="hljs-keyword">const</span> { amount } = data;
</code></pre>
<p>이제 모든 흥미로운 로직이 발생하는 trycatch 블록을 살펴보겠습니다!</p>
<p>파고들어 봅시다.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> paymentIntent = <span class="hljs-keyword">await</span> stripe.<span class="hljs-property">paymentIntents</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">amount</span>: <span class="hljs-title class_">Number</span>(price) * <span class="hljs-number">100</span>,
      <span class="hljs-attr">currency</span>: <span class="hljs-string">&quot;USD&quot;</span>,
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NextResponse</span>(paymentIntent.<span class="hljs-property">client_secret</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">200</span> });
</code></pre>
<p>우리의 try 블록 안에서, 결제 인텐트를 생성할 것입니다. 결제 인텐트에 대해 잘 모르신다면 걱정하지 마세요. 거래에 관한 중요한 정보를 담고 있죠. 지원되는 결제 방법, 징수할 금액, 그리고 희망하는 통화를 포함하고 있습니다.</p>
<p>마지막으로, Stripe로부터 얻은 클라이언트 시크릿을 포함한 응답을 반환할 것입니다. 이 단계는 매우 중요합니다. 왜냐하면 우리는 클라이언트 측에서 Stripe가 결제를 확인하는 데 도움을 주기 위해 클라이언트 시크릿을 활용할 것이기 때문이죠.</p>
<pre><code class="hljs language-js">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NextResponse</span>(error, {
      <span class="hljs-attr">status</span>: <span class="hljs-number">400</span>,
    });
</code></pre>
<p>우리의 catch 블록 안에서는 간단히 오류를 포함한 응답을 반환합니다.</p>
<p>이 시점에서 백엔드 개발은 완료되었습니다. 이제 새로 만든 엔드포인트와 상호 작용할 클라이언트 측으로 이동해 봅시다.</p>
<h2>프론트엔드</h2>
<p>마법을 시작하기 전에 정리해 봅시다!</p>
<p>layout.tsx 파일에서 global.css를 불러오는 줄을 삭제하세요. 스타일에 대해서는 다루지 않을 거에요.</p>
<p>앱.tsx 파일에서 <code>main</code> 태그 내부의 모든 내용을 삭제하고, Image 컴포넌트 import 구문을 삭제해주세요.</p>
<p>좋아요, 이 시점에서 layout.tsx 파일은 다음과 같아야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Inter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;next/font/google&quot;</span>;

<span class="hljs-keyword">const</span> inter = <span class="hljs-title class_">Inter</span>({ <span class="hljs-attr">subsets</span>: [<span class="hljs-string">&quot;latin&quot;</span>] });

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> metadata = {
  <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Create Next App&quot;</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;Generated by create next app&quot;</span>,
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  children,
}: {
  children: React.ReactNode;
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{inter.className}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  );
}
</code></pre>
<p>그리고 app.tsx 파일은 다음과 같아야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>여기 멋진 곳에요, 결제 양식을 설정해 봅시다!</p>
<p>&quot;src&quot; 폴더에서 &quot;components&quot;라는 새 폴더를 만들어 주세요. &quot;components&quot; 폴더 안에 &quot;PaymentForm&quot;이라는 또 다른 폴더를 만들어 주세요. &quot;PaymentForm&quot; 폴더 안에 &quot;PaymentForm.tsx&quot;라는 파일을 만들어 주세요. 거기에 우리의 결제 양식이 위치하고 대부분의 로직이 여기서 실행될 거에요.</p>
<p>시작해 봅시다!</p>
<p>우리가 컴포넌트 작성을 시작하기 전에, Next.js에게 서버 컴포넌트가 아닌 클라이언트 컴포넌트를 다루고 있다는 것을 알려주어야 해요.</p>
<p>PaymentForm.tsx 파일의 맨 위에 다음을 추가해주세요:</p>
<pre><code class="hljs language-js"><span class="hljs-string">&quot;use client&quot;</span>;
</code></pre>
<p>그 다음에 다음과 같은 import 문을 추가해주세요:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardElement</span>, useElements, useStripe } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/react-stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
</code></pre>
<p>이제 빈 컴포넌트를 생성해봅시다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PaymentForm</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<p>지금까지의 파일은 이렇게 보여야 합니다:</p>
<pre><code class="hljs language-js"><span class="hljs-string">&quot;사용자용&quot;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardElement</span>, useElements, useStripe } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/react-stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PaymentForm</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span><span class="hljs-tag">&lt;/&gt;</span></span>;
}
</code></pre>
<p>우리 컴포넌트 안에서 처음으로 해야 할 일은 Stripe 훅을 사용하는 것인데, 우리가 사용할 훅은 useStripe와 useElements 입니다.</p>
<pre><code class="hljs language-js">  <span class="hljs-keyword">const</span> stripe = <span class="hljs-title function_">useStripe</span>();
  <span class="hljs-keyword">const</span> elements = <span class="hljs-title function_">useElements</span>();
</code></pre>
<p>from을 제출할 수 있는 onSubmit이라는 함수를 만들어봅시다.```</p>
<pre><code class="hljs language-js">  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.FormEvent&lt;HTMLFormElement&gt;</span>) =&gt; {}
</code></pre>
<p>onSubmit 함수 안에서 e.preventDefault(); 를 사용하여 기본 동작을 막아줍시다.</p>
<p>다음으로, stripe 카드 엘리먼트에 다음 스니펫을 사용하여 접근해야 합니다:</p>
<pre><code class="hljs language-js">    <span class="hljs-keyword">const</span> cardElement = elements?.<span class="hljs-title function_">getElement</span>(<span class="hljs-string">&quot;card&quot;</span>);
</code></pre>
<p>지금부터 실제 마법을 시도해 봅시다!</p>
<p>try-catch 블록을 만들어 봅시다. try 블록 안에는 stripe와 cardElement의 존재 여부를 확인하는 조건문을 만들 것입니다. 둘 중 하나라도 누락된 경우, onSubmit 함수를 효과적으로 중단시키고 더 이상의 작업을 방지하기 위해 null을 반환할 것입니다.</p>
<p>catch 블록에서는 단순히 error를 console.log 하면 됩니다.</p>
<p>다음은 코드 조각입니다:</p>
<pre><code class="hljs language-js">    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!stripe || !cardElement) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
    }
</code></pre>
<p>안녕하세요 여러분, 지금 좋은 위치에 있어요. 계속 진행하죠.</p>
<p>Stripe와 cardElement가 모두 존재하는지 확인한 후에, 이전에 백엔드에서 설정한 API를 사용하여 결제 의도를 생성할 수 있습니다. API에 전달할 데이터는 금액이 포함되며, 저의 경우에는 89로 설정되어 있어요.</p>
<pre><code class="hljs language-js">    <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/create-payment-intent&quot;</span>, {
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">amount</span>: <span class="hljs-number">89</span> },
      });
</code></pre>
<p>응답을 clientSecret라는 변수에 할당해보세요.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> clientSecret = data;
</code></pre>
<p>마지막으로 우리가 해야 할 일은 stripe에서 제공하는 confirmCardPayment 메서드를 사용하여 결제를 확인하는 것입니다. 아래는 예시 코드 조각입니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">await</span> stripe?.<span class="hljs-title function_">confirmCardPayment</span>(clientSecret, {
  <span class="hljs-attr">payment_method</span>: { <span class="hljs-attr">card</span>: cardElement },
});
</code></pre>
<p>지금까지 onSubmit 함수를 완료했습니다.</p>
<p>우리의 컴포넌트가 stripe에서 제공하는 CardElement 컴포넌트를 사용하는 폼을 반환하도록 만들어보겠습니다.</p>
<pre><code class="hljs language-js">    &lt;form onSubmit={onSubmit}&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CardElement</span> /&gt;</span></span>
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>제출하기<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
    &lt;/form&gt;
</code></pre>
<p>최종 결과:</p>
<pre><code class="hljs language-js"><span class="hljs-string">&quot;사용자 사용&quot;</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CardElement</span>, useElements, useStripe } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/react-stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PaymentForm</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> stripe = <span class="hljs-title function_">useStripe</span>();
  <span class="hljs-keyword">const</span> elements = <span class="hljs-title function_">useElements</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: React.FormEvent&lt;HTMLFormElement&gt;</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-keyword">const</span> cardElement = elements?.<span class="hljs-title function_">getElement</span>(<span class="hljs-string">&quot;card&quot;</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!stripe || !cardElement) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/api/create-payment-intent&quot;</span>, {
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">amount</span>: <span class="hljs-number">89</span> },
      });
      <span class="hljs-keyword">const</span> clientSecret = data;

      <span class="hljs-keyword">await</span> stripe?.<span class="hljs-title function_">confirmCardPayment</span>(clientSecret, {
        <span class="hljs-attr">payment_method</span>: { <span class="hljs-attr">card</span>: cardElement },
      });
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{onSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardElement</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>제출<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>좋은 소식입니다! 우리의 PaymentForm 컴포넌트가 이제 완성되었습니다. 만세! 이제 마지막 단계로 넘어가서, 새롭게 생성된 PaymentForm 컴포넌트를 사용하도록 앱의 app.tsx 파일을 업데이트하는 것을 진행해보겠습니다.</p>
<p>PaymentForm 컴포넌트가 app.tsx 안에서 사용되기 전에, 몇 가지를 import하고 stripe를 로드해야 합니다.</p>
<pre><code class="hljs language-js"><span class="hljs-string">&quot;사용자 사용&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Elements</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/react-stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> { loadStripe } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PaymentForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/PaymentForm/PaymentForm&quot;</span>;
</code></pre>
<p>stripe를 불러와보겠습니다:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> stripePromise = <span class="hljs-title function_">loadStripe</span>(
  process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY</span>!
);
</code></pre>
<p>stripe를 컴포넌트 외부에서 로드하는 것을 확인해주세요. 그렇지 않으면 stripe가 매번 렌더링되어 원하지 않는 결과가 발생할 수 있습니다.</p>
<p>마지막으로, return 문 안에서 우리에게 제공된 Element 공급자를 활용해봅시다. PaymentForm 컴포넌트를 해당 공급자로 감싸겠습니다. 다음과 같이 보여야 합니다:</p>
<p>여기 완성된 결과입니다:</p>
<pre><code class="hljs language-js"><span class="hljs-string">&quot;use client&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Elements</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/react-stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> { loadStripe } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@stripe/stripe-js&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PaymentForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/components/PaymentForm/PaymentForm&quot;</span>;
<span class="hljs-comment">// 컴포넌트 렌더링 시에 `Stripe` 객체를 다시 생성하는 것을 피하기 위해</span>
<span class="hljs-comment">// `loadStripe`를 컴포넌트 밖에서 호출하는 것을 확인해주세요.</span>
<span class="hljs-keyword">const</span> stripePromise = <span class="hljs-title function_">loadStripe</span>(
  process.<span class="hljs-property">env</span>.<span class="hljs-property">NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY</span>!
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Elements</span> <span class="hljs-attr">stripe</span>=<span class="hljs-string">{stripePromise}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">PaymentForm</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Elements</span>&gt;</span></span>
  );
}
</code></pre>
<p>와! Stripe를 사용하여 결제 폼을 만들었네요. 잘 했어요!</p>
<p>이 글이 도움이 되었으면 좋겠어요! 앞으로 여기서 더 활발하게 활동할 거에요. 기대돼요 🤔</p>
<p>여기 git 레포지토리 링크에요. 즐겨보세요!</p></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Nextjs 앱에 Stripe 결제 추가하는 방법","description":"","date":"2024-05-14 16:09","slug":"2024-05-14-HowtoaddStripepaymentstoyourNextjsapp","content":"\n\n\u003cimg src=\"/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png\" /\u003e\n\n와! 내 매체 암호를 찾았어요!\n\n이제, 내 첫 번째 기사에서 Stripe를 Next.js 앱에 통합하는 방법에 대해 이야기하려고 해요.\n\n이 프로젝트에서는 너무 복잡한 것을 만드는 데 주의를 기울이지 않을 거에요. 대신에 우리는 간편한 Next.js 13.4 앱을 개발하여 일회성 Stripe 결제를 가능하게 할 거에요.\n\n\n\n## 설정하기\n\n터미널을 열고 나의 경우에는 Workspace 안에서 다음 명령을 실행해 주세요.\n\n```js\nnpx create-next-app@latest\n```\n\n위 명령을 실행하면 \"create-next-app@13.4.1\"을 설치하라는 메시지가 표시되며 몇 가지 질문이 있을 겁니다.\n\n\n\n- 프로젝트 이름은 무엇인가요? stripe-nextjs\n- TypeScript를 사용하고 싶나요? 네\n- ESLint를 사용하고 싶나요? 네\n- 이 프로젝트에 Tailwind CSS를 사용하고 싶나요? 아니요, 스타일 작업을 하지 않을 예정이기 때문에\n- `src/` 디렉토리를 사용하고 싶나요? 네\n- App Router를 사용하시겠습니까? 네\n- 기본 import 별칭을 사용자 정의하시겠습니까? 아니요\n\n질문에 모두 답했다면, 설치가 시작됩니다!\n\n이제 설치가 완료되었습니다! 이제 실제로 Next.js 앱을 보려면 터미널에서 다음 명령을 실행하세요. Next.js 앱 내부에 있는지 확인하세요.\n\n```js\nyarn run dev\n```\n\n\n\n더 나아가기 전에, Stripe 계정을 생성하고 API 키를 받아봐요.\n\nStripe 계정을 만든 후에, dashboard.stripe.com/test/apikeys로 이동해서 API 키를 받아요.\n\n## 환경 파일 설정하기\n\n루트 디렉토리 안에, .env.local이라는 파일을 만들어주세요.\n\n\n\n.env.local 파일 안에 다음을 추가해주세요:\n\n```js\nNEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=\"\"\nSTRIPE_SECRET_KEY=\"\"\n```\n\n여기서 기억해야 할 중요한 점이 몇 가지 있어요. 먼저, \"\"\"를 Stripe 키로 대체해야 합니다. 둘째로, 두 변수 간의 차이를 이해하는 것이 중요합니다. 하나는 \"NEXT_PUBLIC\"을 포함하고 다른 하나는 포함하지 않습니다. 간단히 말해서, \"NEXT_PUBLIC\"을 사용하여 STRIPE_PUBLISHABLE_KEY를 노출시키는 것은 괜찮지만 시크릿 키는 절대로 클라이언트 측에 노출되어서는 안 됩니다.\n\n알았어요, 이해했어요? 그럼 다음 단계로 넘어갑시다!\n\n\n\n## 필요한 패키지 설치하기\n\n당신의 Next.js 앱 내부에 다음 패키지를 설치해보세요:\n\n```js\n@stripe/react-stripe-js @stripe/stripe-js stripe axios\n```\n\n## 백엔드 작업을 시작해봅시다\n\n\n\n우리 앱 폴더 안에 api라는 새 폴더를 만들어주세요. 이곳에 모든 백엔드 코드가 위치하게 됩니다.\n\napi 폴더 안에 create-payment-intent라는 새 폴더를 만들고, 그 안에 route.ts 라는 파일을 생성해주세요.\n\n![이미지](/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_1.png)\n\n\"create-payment-intent\" 폴더 안에 \"route\"라는 파일을 만드는 이유는 Next.js에 API 요청을 다루고 있다는 것을 알리는 것입니다. 공식 문서에 따르면, route는 라우팅의 가장 기본적인 수준으로, 페이지가 하는 것처럼 레이아웃이나 클라이언트 측 탐색에 영향을주지 않습니다. \"route.ts\" 파일이 \"page.ts\" 파일이 있는 곳에 존재할 수 없다는 점을 명심해야 합니다. 자세한 내용은 문서를 참고하는 것을 강력히 권장합니다.\n\n\n\n여기는 route.ts 파일의 코드입니다:\n\n```js\nimport { NextResponse, NextRequest } from \"next/server\";\nimport Stripe from \"stripe\";\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\n  typescript: true,\n  apiVersion: \"2022-11-15\",\n});\n\nexport async function POST(req: NextRequest) {\n  const { data } = await req.json();\n  const { amount } = data;\n  try {\n    const paymentIntent = await stripe.paymentIntents.create({\n      amount: Number(amount) * 100,\n      currency: \"USD\",\n    });\n\n    return new NextResponse(paymentIntent.client_secret, { status: 200 });\n  } catch (error: any) {\n    return new NextResponse(error, {\n      status: 400,\n    });\n  }\n}\n```\n\n이것을 자세히 살펴보고 무슨 일이 일어나고 있는지 이해해 봅시다.\n\n첫째로, 우리는 타입과 stripe를 import 합니다:\n\n\n\n```js\nimport { NextResponse, NextRequest } from \"next/server\";\nimport Stripe from \"stripe\";\n```\n\n다음으로 stripe 인스턴스를 만듭니다:\n\n```js\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\n  typescript: true,\n  apiVersion: \"2022-11-15\",\n});\n```\n\n우리의 Stripe 인스턴스는 env.local 파일에서 Stripe 비밀키가 필요합니다. 더 나아가, 우리는 Stripe 인스턴스에 TypeScript를 활성화하고 인스턴스용 Stripe API 버전을 지정했습니다.\n\n\n\n계속 진행하기 전에 Next.js 13.4에서 API 경로를 다루는 방법에 대해 이야기해 봅시다.\n\n아마 이미 주목했을 것이지만, 함수의 제목이 \"POST\"와 같이 모두 대문자로 되어 있습니다. 이 네이밍 규칙은 Next.js가 실행할 해당 HTTP 메소드를 결정하기 위해 필요합니다. 예를 들어, GET 요청을 수행하려면 함수의 제목을 \"GET\"으로 지정해야 하며, 수행하려는 다른 작업에 대해서도 유사하게 지정해야 합니다.\n\n알겠습니다, 이해했습니다, 좋아요! 계속 진행합시다!\n\n우리 함수 내에서는 요청에서 데이터를 비구조화하는 방식으로 진행합니다. 그 후에는 데이터 객체에서 금액을 더욱 세분화합니다.\n\n\n\n```js\nconst { data } = await req.json();\nconst { amount } = data;\n```\n\n이제 모든 흥미로운 로직이 발생하는 trycatch 블록을 살펴보겠습니다!\n\n파고들어 봅시다.\n\n```js\nconst paymentIntent = await stripe.paymentIntents.create({\n      amount: Number(price) * 100,\n      currency: \"USD\",\n    });\n\n    return new NextResponse(paymentIntent.client_secret, { status: 200 });\n```\n\n\n\n우리의 try 블록 안에서, 결제 인텐트를 생성할 것입니다. 결제 인텐트에 대해 잘 모르신다면 걱정하지 마세요. 거래에 관한 중요한 정보를 담고 있죠. 지원되는 결제 방법, 징수할 금액, 그리고 희망하는 통화를 포함하고 있습니다.\n\n마지막으로, Stripe로부터 얻은 클라이언트 시크릿을 포함한 응답을 반환할 것입니다. 이 단계는 매우 중요합니다. 왜냐하면 우리는 클라이언트 측에서 Stripe가 결제를 확인하는 데 도움을 주기 위해 클라이언트 시크릿을 활용할 것이기 때문이죠.\n\n```js\n    return new NextResponse(error, {\n      status: 400,\n    });\n```\n\n우리의 catch 블록 안에서는 간단히 오류를 포함한 응답을 반환합니다.\n\n\n\n이 시점에서 백엔드 개발은 완료되었습니다. 이제 새로 만든 엔드포인트와 상호 작용할 클라이언트 측으로 이동해 봅시다.\n\n## 프론트엔드\n\n마법을 시작하기 전에 정리해 봅시다!\n\nlayout.tsx 파일에서 global.css를 불러오는 줄을 삭제하세요. 스타일에 대해서는 다루지 않을 거에요.\n\n\n\n앱.tsx 파일에서 `main` 태그 내부의 모든 내용을 삭제하고, Image 컴포넌트 import 구문을 삭제해주세요.\n\n좋아요, 이 시점에서 layout.tsx 파일은 다음과 같아야 합니다:\n\n```js\nimport { Inter } from \"next/font/google\";\n\nconst inter = Inter({ subsets: [\"latin\"] });\n\nexport const metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    \u003chtml lang=\"en\"\u003e\n      \u003cbody className={inter.className}\u003e{children}\u003c/body\u003e\n    \u003c/html\u003e\n  );\n}\n```\n\n그리고 app.tsx 파일은 다음과 같아야 합니다:\n\n\n\n```js\nexport default function Home() {\n  return (\n    \u003c\u003e\u003c/\u003e\n  );\n}\n```\n\n여기 멋진 곳에요, 결제 양식을 설정해 봅시다!\n\n\"src\" 폴더에서 \"components\"라는 새 폴더를 만들어 주세요. \"components\" 폴더 안에 \"PaymentForm\"이라는 또 다른 폴더를 만들어 주세요. \"PaymentForm\" 폴더 안에 \"PaymentForm.tsx\"라는 파일을 만들어 주세요. 거기에 우리의 결제 양식이 위치하고 대부분의 로직이 여기서 실행될 거에요.\n\n시작해 봅시다!\n\n\n\n우리가 컴포넌트 작성을 시작하기 전에, Next.js에게 서버 컴포넌트가 아닌 클라이언트 컴포넌트를 다루고 있다는 것을 알려주어야 해요.\n\nPaymentForm.tsx 파일의 맨 위에 다음을 추가해주세요:\n\n```js\n\"use client\";\n```\n\n그 다음에 다음과 같은 import 문을 추가해주세요:\n\n\n\n```js\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport React from \"react\";\n```\n\n이제 빈 컴포넌트를 생성해봅시다:\n\n```js\nexport default function PaymentForm() {\n  return \u003c\u003e\u003c/\u003e;\n}\n```\n\n지금까지의 파일은 이렇게 보여야 합니다:\n\n\n\n```js\n\"사용자용\";\n\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport React from \"react\";\n\nexport default function PaymentForm() {\n  return \u003c\u003e\u003c/\u003e;\n}\n```\n\n우리 컴포넌트 안에서 처음으로 해야 할 일은 Stripe 훅을 사용하는 것인데, 우리가 사용할 훅은 useStripe와 useElements 입니다.\n\n```js\n  const stripe = useStripe();\n  const elements = useElements();\n```\n\nfrom을 제출할 수 있는 onSubmit이라는 함수를 만들어봅시다.```\n\n\n\n```js\n  const onSubmit = async (e: React.FormEvent\u003cHTMLFormElement\u003e) =\u003e {}\n```\n\nonSubmit 함수 안에서 e.preventDefault(); 를 사용하여 기본 동작을 막아줍시다.\n\n다음으로, stripe 카드 엘리먼트에 다음 스니펫을 사용하여 접근해야 합니다:\n\n```js\n    const cardElement = elements?.getElement(\"card\");\n```\n\n\n\n지금부터 실제 마법을 시도해 봅시다!\n\ntry-catch 블록을 만들어 봅시다. try 블록 안에는 stripe와 cardElement의 존재 여부를 확인하는 조건문을 만들 것입니다. 둘 중 하나라도 누락된 경우, onSubmit 함수를 효과적으로 중단시키고 더 이상의 작업을 방지하기 위해 null을 반환할 것입니다.\n\ncatch 블록에서는 단순히 error를 console.log 하면 됩니다.\n\n다음은 코드 조각입니다:\n\n\n\n```js\n    try {\n      if (!stripe || !cardElement) return null;\n    } catch (error) {\n      console.log(error);\n    }\n```\n\n안녕하세요 여러분, 지금 좋은 위치에 있어요. 계속 진행하죠.\n\nStripe와 cardElement가 모두 존재하는지 확인한 후에, 이전에 백엔드에서 설정한 API를 사용하여 결제 의도를 생성할 수 있습니다. API에 전달할 데이터는 금액이 포함되며, 저의 경우에는 89로 설정되어 있어요.\n\n```js\n    const { data } = await axios.post(\"/api/create-payment-intent\", {\n        data: { amount: 89 },\n      });\n```\n\n\n\n응답을 clientSecret라는 변수에 할당해보세요.\n\n```js\nconst clientSecret = data;\n```\n\n마지막으로 우리가 해야 할 일은 stripe에서 제공하는 confirmCardPayment 메서드를 사용하여 결제를 확인하는 것입니다. 아래는 예시 코드 조각입니다:\n\n```js\nawait stripe?.confirmCardPayment(clientSecret, {\n  payment_method: { card: cardElement },\n});\n```\n\n\n\n지금까지 onSubmit 함수를 완료했습니다.\n\n우리의 컴포넌트가 stripe에서 제공하는 CardElement 컴포넌트를 사용하는 폼을 반환하도록 만들어보겠습니다.\n\n```js\n    \u003cform onSubmit={onSubmit}\u003e\n      \u003cCardElement /\u003e\n      \u003cbutton type=\"submit\"\u003e제출하기\u003c/button\u003e\n    \u003c/form\u003e\n```\n\n최종 결과:\n\n\n\n```js\n\"사용자 사용\";\n\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport axios from \"axios\";\nimport React from \"react\";\n\nexport default function PaymentForm() {\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const onSubmit = async (e: React.FormEvent\u003cHTMLFormElement\u003e) =\u003e {\n    e.preventDefault();\n    const cardElement = elements?.getElement(\"card\");\n\n    try {\n      if (!stripe || !cardElement) return null;\n      const { data } = await axios.post(\"/api/create-payment-intent\", {\n        data: { amount: 89 },\n      });\n      const clientSecret = data;\n\n      await stripe?.confirmCardPayment(clientSecret, {\n        payment_method: { card: cardElement },\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return (\n    \u003cform onSubmit={onSubmit}\u003e\n      \u003cCardElement /\u003e\n      \u003cbutton type=\"submit\"\u003e제출\u003c/button\u003e\n    \u003c/form\u003e\n  );\n}\n```\n\n좋은 소식입니다! 우리의 PaymentForm 컴포넌트가 이제 완성되었습니다. 만세! 이제 마지막 단계로 넘어가서, 새롭게 생성된 PaymentForm 컴포넌트를 사용하도록 앱의 app.tsx 파일을 업데이트하는 것을 진행해보겠습니다.\n\nPaymentForm 컴포넌트가 app.tsx 안에서 사용되기 전에, 몇 가지를 import하고 stripe를 로드해야 합니다.\n\n```js\n\"사용자 사용\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport PaymentForm from \"@/components/PaymentForm/PaymentForm\";\n```\n\n\n\nstripe를 불러와보겠습니다:\n\n```js\nconst stripePromise = loadStripe(\n  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!\n);\n```\n\nstripe를 컴포넌트 외부에서 로드하는 것을 확인해주세요. 그렇지 않으면 stripe가 매번 렌더링되어 원하지 않는 결과가 발생할 수 있습니다.\n\n마지막으로, return 문 안에서 우리에게 제공된 Element 공급자를 활용해봅시다. PaymentForm 컴포넌트를 해당 공급자로 감싸겠습니다. 다음과 같이 보여야 합니다:\n\n\n\n여기 완성된 결과입니다:\n\n```js\n\"use client\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport PaymentForm from \"@/components/PaymentForm/PaymentForm\";\n// 컴포넌트 렌더링 시에 `Stripe` 객체를 다시 생성하는 것을 피하기 위해\n// `loadStripe`를 컴포넌트 밖에서 호출하는 것을 확인해주세요.\nconst stripePromise = loadStripe(\n  process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!\n);\n\nexport default function Home() {\n  return (\n    \u003cElements stripe={stripePromise}\u003e\n      \u003cPaymentForm /\u003e\n    \u003c/Elements\u003e\n  );\n}\n```\n\n와! Stripe를 사용하여 결제 폼을 만들었네요. 잘 했어요!\n\n\n\n이 글이 도움이 되었으면 좋겠어요! 앞으로 여기서 더 활발하게 활동할 거에요. 기대돼요 🤔\n\n여기 git 레포지토리 링크에요. 즐겨보세요!","ogImage":{"url":"/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png"},"coverImage":"/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png","tag":["Tech"],"readingTime":10},"content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    pre: \"pre\",\n    code: \"code\",\n    ul: \"ul\",\n    li: \"li\",\n    span: \"span\",\n    img: \"img\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(\"img\", {\n      src: \"/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_0.png\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"와! 내 매체 암호를 찾았어요!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제, 내 첫 번째 기사에서 Stripe를 Next.js 앱에 통합하는 방법에 대해 이야기하려고 해요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 프로젝트에서는 너무 복잡한 것을 만드는 데 주의를 기울이지 않을 거에요. 대신에 우리는 간편한 Next.js 13.4 앱을 개발하여 일회성 Stripe 결제를 가능하게 할 거에요.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"설정하기\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"터미널을 열고 나의 경우에는 Workspace 안에서 다음 명령을 실행해 주세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"npx create-next-app@latest\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"위 명령을 실행하면 \\\"create-next-app@13.4.1\\\"을 설치하라는 메시지가 표시되며 몇 가지 질문이 있을 겁니다.\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"프로젝트 이름은 무엇인가요? stripe-nextjs\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"TypeScript를 사용하고 싶나요? 네\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"ESLint를 사용하고 싶나요? 네\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"이 프로젝트에 Tailwind CSS를 사용하고 싶나요? 아니요, 스타일 작업을 하지 않을 예정이기 때문에\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.code, {\n          children: \"src/\"\n        }), \" 디렉토리를 사용하고 싶나요? 네\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"App Router를 사용하시겠습니까? 네\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"기본 import 별칭을 사용자 정의하시겠습니까? 아니요\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"질문에 모두 답했다면, 설치가 시작됩니다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 설치가 완료되었습니다! 이제 실제로 Next.js 앱을 보려면 터미널에서 다음 명령을 실행하세요. Next.js 앱 내부에 있는지 확인하세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"yarn run dev\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"더 나아가기 전에, Stripe 계정을 생성하고 API 키를 받아봐요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Stripe 계정을 만든 후에, dashboard.stripe.com/test/apikeys로 이동해서 API 키를 받아요.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"환경 파일 설정하기\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"루트 디렉토리 안에, .env.local이라는 파일을 만들어주세요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \".env.local 파일 안에 다음을 추가해주세요:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY\"\n        }), \"=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-variable constant_\",\n          children: \"STRIPE_SECRET_KEY\"\n        }), \"=\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"\\\"\"\n        }), \"\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"여기서 기억해야 할 중요한 점이 몇 가지 있어요. 먼저, \\\"\\\"\\\"를 Stripe 키로 대체해야 합니다. 둘째로, 두 변수 간의 차이를 이해하는 것이 중요합니다. 하나는 \\\"NEXT_PUBLIC\\\"을 포함하고 다른 하나는 포함하지 않습니다. 간단히 말해서, \\\"NEXT_PUBLIC\\\"을 사용하여 STRIPE_PUBLISHABLE_KEY를 노출시키는 것은 괜찮지만 시크릿 키는 절대로 클라이언트 측에 노출되어서는 안 됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"알았어요, 이해했어요? 그럼 다음 단계로 넘어갑시다!\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"필요한 패키지 설치하기\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"당신의 Next.js 앱 내부에 다음 패키지를 설치해보세요:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"hljs language-js\",\n        children: \"@stripe/react-stripe-js @stripe/stripe-js stripe axios\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"백엔드 작업을 시작해봅시다\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리 앱 폴더 안에 api라는 새 폴더를 만들어주세요. 이곳에 모든 백엔드 코드가 위치하게 됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"api 폴더 안에 create-payment-intent라는 새 폴더를 만들고, 그 안에 route.ts 라는 파일을 생성해주세요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/assets/img/2024-05-14-HowtoaddStripepaymentstoyourNextjsapp_1.png\",\n        alt: \"이미지\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"\\\"create-payment-intent\\\" 폴더 안에 \\\"route\\\"라는 파일을 만드는 이유는 Next.js에 API 요청을 다루고 있다는 것을 알리는 것입니다. 공식 문서에 따르면, route는 라우팅의 가장 기본적인 수준으로, 페이지가 하는 것처럼 레이아웃이나 클라이언트 측 탐색에 영향을주지 않습니다. \\\"route.ts\\\" 파일이 \\\"page.ts\\\" 파일이 있는 곳에 존재할 수 없다는 점을 명심해야 합니다. 자세한 내용은 문서를 참고하는 것을 강력히 권장합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"여기는 route.ts 파일의 코드입니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextRequest\"\n        }), \" } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"next/server\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Stripe\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"stripe\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripe = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Stripe\"\n        }), \"(process.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"env\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"STRIPE_SECRET_KEY\"\n        }), \"!, {\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"typescript\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \",\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"apiVersion\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"2022-11-15\\\"\"\n        }), \",\\n});\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"async\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"POST\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"req: NextRequest\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { data } = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" req.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"json\"\n        }), \"();\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { amount } = data;\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"try\"\n        }), \" {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" paymentIntent = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" stripe.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"paymentIntents\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"create\"\n        }), \"({\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"amount\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Number\"\n        }), \"(amount) * \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"currency\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"USD\\\"\"\n        }), \",\\n    });\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \"(paymentIntent.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"client_secret\"\n        }), \", { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"status\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"200\"\n        }), \" });\\n  } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"catch\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"error\"\n        }), \": any) {\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \"(error, {\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"status\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"400\"\n        }), \",\\n    });\\n  }\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이것을 자세히 살펴보고 무슨 일이 일어나고 있는지 이해해 봅시다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"첫째로, 우리는 타입과 stripe를 import 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \", \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextRequest\"\n        }), \" } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"next/server\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Stripe\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"stripe\\\"\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음으로 stripe 인스턴스를 만듭니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripe = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Stripe\"\n        }), \"(process.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"env\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"STRIPE_SECRET_KEY\"\n        }), \"!, {\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"typescript\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"true\"\n        }), \",\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"apiVersion\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"2022-11-15\\\"\"\n        }), \",\\n});\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리의 Stripe 인스턴스는 env.local 파일에서 Stripe 비밀키가 필요합니다. 더 나아가, 우리는 Stripe 인스턴스에 TypeScript를 활성화하고 인스턴스용 Stripe API 버전을 지정했습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"계속 진행하기 전에 Next.js 13.4에서 API 경로를 다루는 방법에 대해 이야기해 봅시다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"아마 이미 주목했을 것이지만, 함수의 제목이 \\\"POST\\\"와 같이 모두 대문자로 되어 있습니다. 이 네이밍 규칙은 Next.js가 실행할 해당 HTTP 메소드를 결정하기 위해 필요합니다. 예를 들어, GET 요청을 수행하려면 함수의 제목을 \\\"GET\\\"으로 지정해야 하며, 수행하려는 다른 작업에 대해서도 유사하게 지정해야 합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"알겠습니다, 이해했습니다, 좋아요! 계속 진행합시다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리 함수 내에서는 요청에서 데이터를 비구조화하는 방식으로 진행합니다. 그 후에는 데이터 객체에서 금액을 더욱 세분화합니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { data } = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" req.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"json\"\n        }), \"();\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { amount } = data;\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 모든 흥미로운 로직이 발생하는 trycatch 블록을 살펴보겠습니다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"파고들어 봅시다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" paymentIntent = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" stripe.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"paymentIntents\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"create\"\n        }), \"({\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"amount\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Number\"\n        }), \"(price) * \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"100\"\n        }), \",\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"currency\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"USD\\\"\"\n        }), \",\\n    });\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \"(paymentIntent.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"client_secret\"\n        }), \", { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"status\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"200\"\n        }), \" });\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리의 try 블록 안에서, 결제 인텐트를 생성할 것입니다. 결제 인텐트에 대해 잘 모르신다면 걱정하지 마세요. 거래에 관한 중요한 정보를 담고 있죠. 지원되는 결제 방법, 징수할 금액, 그리고 희망하는 통화를 포함하고 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"마지막으로, Stripe로부터 얻은 클라이언트 시크릿을 포함한 응답을 반환할 것입니다. 이 단계는 매우 중요합니다. 왜냐하면 우리는 클라이언트 측에서 Stripe가 결제를 확인하는 데 도움을 주기 위해 클라이언트 시크릿을 활용할 것이기 때문이죠.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"NextResponse\"\n        }), \"(error, {\\n      \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"status\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"400\"\n        }), \",\\n    });\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리의 catch 블록 안에서는 간단히 오류를 포함한 응답을 반환합니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 시점에서 백엔드 개발은 완료되었습니다. 이제 새로 만든 엔드포인트와 상호 작용할 클라이언트 측으로 이동해 봅시다.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"프론트엔드\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"마법을 시작하기 전에 정리해 봅시다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"layout.tsx 파일에서 global.css를 불러오는 줄을 삭제하세요. 스타일에 대해서는 다루지 않을 거에요.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"앱.tsx 파일에서 \", _jsx(_components.code, {\n        children: \"main\"\n      }), \" 태그 내부의 모든 내용을 삭제하고, Image 컴포넌트 import 구문을 삭제해주세요.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"좋아요, 이 시점에서 layout.tsx 파일은 다음과 같아야 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Inter\"\n        }), \" } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"next/font/google\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" inter = \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Inter\"\n        }), \"({ \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"subsets\"\n        }), \": [\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"latin\\\"\"\n        }), \"] });\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" metadata = {\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"title\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Create Next App\\\"\"\n        }), \",\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"description\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"Generated by create next app\\\"\"\n        }), \",\\n};\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"RootLayout\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"{\\n  children,\\n}: {\\n  children: React.ReactNode;\\n}\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" (\\n    \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"html\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"lang\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"\\\"en\\\"\"\n            }), \"\u003e\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"body\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"className\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"{inter.className}\"\n            }), \"\u003e\"]\n          }), \"{children}\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"body\"\n            }), \"\u003e\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"html\"\n            }), \"\u003e\"]\n          })]\n        }), \"\\n  );\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그리고 app.tsx 파일은 다음과 같아야 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"Home\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" (\\n    \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c\u003e\"\n          }), _jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c/\u003e\"\n          })]\n        }), \"\\n  );\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"여기 멋진 곳에요, 결제 양식을 설정해 봅시다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"\\\"src\\\" 폴더에서 \\\"components\\\"라는 새 폴더를 만들어 주세요. \\\"components\\\" 폴더 안에 \\\"PaymentForm\\\"이라는 또 다른 폴더를 만들어 주세요. \\\"PaymentForm\\\" 폴더 안에 \\\"PaymentForm.tsx\\\"라는 파일을 만들어 주세요. 거기에 우리의 결제 양식이 위치하고 대부분의 로직이 여기서 실행될 거에요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"시작해 봅시다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리가 컴포넌트 작성을 시작하기 전에, Next.js에게 서버 컴포넌트가 아닌 클라이언트 컴포넌트를 다루고 있다는 것을 알려주어야 해요.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"PaymentForm.tsx 파일의 맨 위에 다음을 추가해주세요:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"use client\\\"\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"그 다음에 다음과 같은 import 문을 추가해주세요:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"CardElement\"\n        }), \", useElements, useStripe } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/react-stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" axios \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"axios\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"React\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"react\\\"\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이제 빈 컴포넌트를 생성해봅시다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"PaymentForm\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c\u003e\"\n          }), _jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c/\u003e\"\n          })]\n        }), \";\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"지금까지의 파일은 이렇게 보여야 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"사용자용\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"CardElement\"\n        }), \", useElements, useStripe } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/react-stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" axios \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"axios\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"React\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"react\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"PaymentForm\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c\u003e\"\n          }), _jsx(_components.span, {\n            className: \"hljs-tag\",\n            children: \"\u003c/\u003e\"\n          })]\n        }), \";\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리 컴포넌트 안에서 처음으로 해야 할 일은 Stripe 훅을 사용하는 것인데, 우리가 사용할 훅은 useStripe와 useElements 입니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripe = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"useStripe\"\n        }), \"();\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" elements = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"useElements\"\n        }), \"();\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"from을 제출할 수 있는 onSubmit이라는 함수를 만들어봅시다.```\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"onSubmit\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"async\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"e: React.FormEvent\u003cHTMLFormElement\u003e\"\n        }), \") =\u003e {}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"onSubmit 함수 안에서 e.preventDefault(); 를 사용하여 기본 동작을 막아줍시다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음으로, stripe 카드 엘리먼트에 다음 스니펫을 사용하여 접근해야 합니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" cardElement = elements?.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getElement\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"card\\\"\"\n        }), \");\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"지금부터 실제 마법을 시도해 봅시다!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"try-catch 블록을 만들어 봅시다. try 블록 안에는 stripe와 cardElement의 존재 여부를 확인하는 조건문을 만들 것입니다. 둘 중 하나라도 누락된 경우, onSubmit 함수를 효과적으로 중단시키고 더 이상의 작업을 방지하기 위해 null을 반환할 것입니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"catch 블록에서는 단순히 error를 console.log 하면 됩니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"다음은 코드 조각입니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"try\"\n        }), \" {\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" (!stripe || !cardElement) \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"null\"\n        }), \";\\n    } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"catch\"\n        }), \" (error) {\\n      \", _jsx(_components.span, {\n          className: \"hljs-variable language_\",\n          children: \"console\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"log\"\n        }), \"(error);\\n    }\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"안녕하세요 여러분, 지금 좋은 위치에 있어요. 계속 진행하죠.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Stripe와 cardElement가 모두 존재하는지 확인한 후에, 이전에 백엔드에서 설정한 API를 사용하여 결제 의도를 생성할 수 있습니다. API에 전달할 데이터는 금액이 포함되며, 저의 경우에는 89로 설정되어 있어요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { data } = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" axios.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"post\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/api/create-payment-intent\\\"\"\n        }), \", {\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"data\"\n        }), \": { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"amount\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"89\"\n        }), \" },\\n      });\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"응답을 clientSecret라는 변수에 할당해보세요.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" clientSecret = data;\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"마지막으로 우리가 해야 할 일은 stripe에서 제공하는 confirmCardPayment 메서드를 사용하여 결제를 확인하는 것입니다. 아래는 예시 코드 조각입니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" stripe?.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"confirmCardPayment\"\n        }), \"(clientSecret, {\\n  \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"payment_method\"\n        }), \": { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"card\"\n        }), \": cardElement },\\n});\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"지금까지 onSubmit 함수를 완료했습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"우리의 컴포넌트가 stripe에서 제공하는 CardElement 컴포넌트를 사용하는 폼을 반환하도록 만들어보겠습니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [\"    \u003cform onSubmit={onSubmit}\u003e\\n      \", _jsx(_components.span, {\n          className: \"xml\",\n          children: _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"CardElement\"\n            }), \" /\u003e\"]\n          })\n        }), \"\\n      \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"button\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"type\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"\\\"submit\\\"\"\n            }), \"\u003e\"]\n          }), \"제출하기\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"button\"\n            }), \"\u003e\"]\n          })]\n        }), \"\\n    \u003c/form\u003e\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"최종 결과:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"사용자 사용\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"CardElement\"\n        }), \", useElements, useStripe } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/react-stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" axios \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"axios\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"React\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"react\\\"\"\n        }), \";\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"PaymentForm\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripe = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"useStripe\"\n        }), \"();\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" elements = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"useElements\"\n        }), \"();\\n\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"onSubmit\"\n        }), \" = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"async\"\n        }), \" (\", _jsx(_components.span, {\n          className: \"hljs-params\",\n          children: \"e: React.FormEvent\u003cHTMLFormElement\u003e\"\n        }), \") =\u003e {\\n    e.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"preventDefault\"\n        }), \"();\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" cardElement = elements?.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"getElement\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"card\\\"\"\n        }), \");\\n\\n    \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"try\"\n        }), \" {\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"if\"\n        }), \" (!stripe || !cardElement) \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-literal\",\n          children: \"null\"\n        }), \";\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" { data } = \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" axios.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"post\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"/api/create-payment-intent\\\"\"\n        }), \", {\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"data\"\n        }), \": { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"amount\"\n        }), \": \", _jsx(_components.span, {\n          className: \"hljs-number\",\n          children: \"89\"\n        }), \" },\\n      });\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" clientSecret = data;\\n\\n      \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"await\"\n        }), \" stripe?.\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"confirmCardPayment\"\n        }), \"(clientSecret, {\\n        \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"payment_method\"\n        }), \": { \", _jsx(_components.span, {\n          className: \"hljs-attr\",\n          children: \"card\"\n        }), \": cardElement },\\n      });\\n    } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"catch\"\n        }), \" (error) {\\n      \", _jsx(_components.span, {\n          className: \"hljs-variable language_\",\n          children: \"console\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"log\"\n        }), \"(error);\\n    }\\n  };\\n\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" (\\n    \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"form\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"onSubmit\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"{onSubmit}\"\n            }), \"\u003e\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"CardElement\"\n            }), \" /\u003e\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"button\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"type\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"\\\"submit\\\"\"\n            }), \"\u003e\"]\n          }), \"제출\", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"button\"\n            }), \"\u003e\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"form\"\n            }), \"\u003e\"]\n          })]\n        }), \"\\n  );\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"좋은 소식입니다! 우리의 PaymentForm 컴포넌트가 이제 완성되었습니다. 만세! 이제 마지막 단계로 넘어가서, 새롭게 생성된 PaymentForm 컴포넌트를 사용하도록 앱의 app.tsx 파일을 업데이트하는 것을 진행해보겠습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"PaymentForm 컴포넌트가 app.tsx 안에서 사용되기 전에, 몇 가지를 import하고 stripe를 로드해야 합니다.\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"사용자 사용\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Elements\"\n        }), \" } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/react-stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { loadStripe } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PaymentForm\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@/components/PaymentForm/PaymentForm\\\"\"\n        }), \";\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"stripe를 불러와보겠습니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripePromise = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"loadStripe\"\n        }), \"(\\n  process.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"env\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY\"\n        }), \"!\\n);\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"stripe를 컴포넌트 외부에서 로드하는 것을 확인해주세요. 그렇지 않으면 stripe가 매번 렌더링되어 원하지 않는 결과가 발생할 수 있습니다.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"마지막으로, return 문 안에서 우리에게 제공된 Element 공급자를 활용해봅시다. PaymentForm 컴포넌트를 해당 공급자로 감싸겠습니다. 다음과 같이 보여야 합니다:\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"여기 완성된 결과입니다:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsxs(_components.code, {\n        className: \"hljs language-js\",\n        children: [_jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"use client\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"Elements\"\n        }), \" } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/react-stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" { loadStripe } \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@stripe/stripe-js\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title class_\",\n          children: \"PaymentForm\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-string\",\n          children: \"\\\"@/components/PaymentForm/PaymentForm\\\"\"\n        }), \";\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// 컴포넌트 렌더링 시에 `Stripe` 객체를 다시 생성하는 것을 피하기 위해\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-comment\",\n          children: \"// `loadStripe`를 컴포넌트 밖에서 호출하는 것을 확인해주세요.\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"const\"\n        }), \" stripePromise = \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"loadStripe\"\n        }), \"(\\n  process.\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"env\"\n        }), \".\", _jsx(_components.span, {\n          className: \"hljs-property\",\n          children: \"NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY\"\n        }), \"!\\n);\\n\\n\", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"default\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"function\"\n        }), \" \", _jsx(_components.span, {\n          className: \"hljs-title function_\",\n          children: \"Home\"\n        }), \"(\", _jsx(_components.span, {\n          className: \"hljs-params\"\n        }), \") {\\n  \", _jsx(_components.span, {\n          className: \"hljs-keyword\",\n          children: \"return\"\n        }), \" (\\n    \", _jsxs(_components.span, {\n          className: \"xml\",\n          children: [_jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"Elements\"\n            }), \" \", _jsx(_components.span, {\n              className: \"hljs-attr\",\n              children: \"stripe\"\n            }), \"=\", _jsx(_components.span, {\n              className: \"hljs-string\",\n              children: \"{stripePromise}\"\n            }), \"\u003e\"]\n          }), \"\\n      \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"PaymentForm\"\n            }), \" /\u003e\"]\n          }), \"\\n    \", _jsxs(_components.span, {\n            className: \"hljs-tag\",\n            children: [\"\u003c/\", _jsx(_components.span, {\n              className: \"hljs-name\",\n              children: \"Elements\"\n            }), \"\u003e\"]\n          })]\n        }), \"\\n  );\\n}\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"와! Stripe를 사용하여 결제 폼을 만들었네요. 잘 했어요!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"이 글이 도움이 되었으면 좋겠어요! 앞으로 여기서 더 활발하게 활동할 거에요. 기대돼요 🤔\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"여기 git 레포지토리 링크에요. 즐겨보세요!\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-05-14-HowtoaddStripepaymentstoyourNextjsapp"},"buildId":"7rKODeu6chWTLgXf6auoL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>