<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><title>Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²• | allround-coder</title><meta name="description" content=""/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:url" content="https://allround-coder.github.io///post/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta property="og:site_name" content="Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta property="og:title" content="Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta property="og:description" content="" data-gatsby-head="true"/><meta property="og:image" content="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_0.png" data-gatsby-head="true"/><meta property="og:locale" content="en_US" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta property="twitter:domain" content="https://allround-coder.github.io/" data-gatsby-head="true"/><meta property="twitter:url" content="https://allround-coder.github.io///post/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs" data-gatsby-head="true"/><meta name="twitter:title" content="Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²• | allround-coder" data-gatsby-head="true"/><meta name="twitter:description" content="" data-gatsby-head="true"/><meta name="twitter:image" content="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_0.png" data-gatsby-head="true"/><meta name="twitter:data1" content="Dev | allround-coder" data-gatsby-head="true"/><meta name="article:published_time" content="2024-06-23 13:24" data-gatsby-head="true"/><meta name="next-head-count" content="19"/><meta name="google-site-verification" content="a-yehRo3k3xv7fg6LqRaE8jlE42e5wP2bDE_2F849O4"/><link rel="stylesheet" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png"/><link rel="icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-icon" href="/favicons/apple-icon-180x180.png"/><link rel="apple-touch-startup-image" href="/startup.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZFDEQ947R4"></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
  
            gtag('config', 'G-ZFDEQ947R4');</script><link rel="preload" href="/_next/static/css/6e57edcf9f2ce551.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6e57edcf9f2ce551.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8ef307c9aee1e34.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8ef307c9aee1e34.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee6df16fdc6dae4d.js" defer=""></script><script src="/_next/static/chunks/framework-46611630e39cfdeb.js" defer=""></script><script src="/_next/static/chunks/main-cf4a52eec9a970a0.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6fae11262ee5c69b.js" defer=""></script><script src="/_next/static/chunks/75fc9c18-ac4aa08aae62f90e.js" defer=""></script><script src="/_next/static/chunks/463-0429087d4c0b0335.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-b088bc509ff5c497.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_buildManifest.js" defer=""></script><script src="/_next/static/Y-fCAg8BUV7y2HNFwX9AA/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="Header_header__Z8PUO"><div class="Header_inner__tfr0u"><strong class="Header_title__Otn70"><a href="/">Allround Coder</a></strong><nav class="Header_nav_area__6KVpk"><a class="nav_item" href="/posts/1">Posts</a></nav></div></header><main class="posts_container__NyRU3"><div class="posts_inner__i3n_i"><h1 class="posts_post_title__EbxNx">Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²•</h1><div class="posts_meta__cR7lu"><div class="posts_profile_wrap__mslMl"><div class="posts_profile_image_wrap__kPikV"><img alt="Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²•" loading="lazy" width="44" height="44" decoding="async" data-nimg="1" class="profile" style="color:transparent" src="/favicons/apple-icon-114x114.png"/></div><div class="posts_textarea__w_iKT"><span class="writer">Allround Coder</span><span class="posts_info__5KJdN"><span class="posts_date__ctqHI">Posted On Jun 23, 2024</span><span class="posts_reading_time__f7YPP">9<!-- --> min read</span></span></div></div><img alt="" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" class="posts_view_badge__tcbfm" style="color:transparent" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fallround-coder.github.io/post/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=views&amp;edge_flat=false"/></div><article class="posts_post_content__n_L6j"><div><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
</head>
<body>
<p>ì•ˆë…•í•˜ì„¸ìš”!</p>
<p>ì˜¤ëŠ˜ì€ Node.js ë° Express.js APIì— ëŒ€í•œ ê°„ë‹¨í•œ ì—­í•  ê¸°ë°˜ ì•¡ì„¸ìŠ¤ ì œì–´ (RBAC)ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¼ ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¸ì¦ì„ ìœ„í•´ Keycloakì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.</p>
<p>Keycloak ì¸ì¦ì„ í†µí•´ Node + Express APIë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ëŠ” í•´ê²°ì±…ì„ ì°¾ë˜ ì¤‘ Keycloak Node.js ì–´ëŒ‘í„°ì¸ keycloak-connectë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ ì–´ëŒ‘í„°ëŠ” ëª¨ë“  ìš”ì²­ê³¼ í•¨ê»˜ ì œê³µëœ Bearer í† í°ì„ í™•ì¸í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•´ì£¼ì§€ë§Œ, íŠ¹ì • ì—­í• ì´ ìˆëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ê²½ë¡œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì€ ì¡°ê¸ˆ ë” ë³µì¡í•´ì¡ŒìŠµë‹ˆë‹¤.</p>
<p>ì¡°ì‚¬í•œ ê²°ê³¼, Keycloakì—ì„œ í° ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•ŠëŠ” í•´ê²°ì±…ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•¨ê»˜ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<h2>ì¤€ë¹„ ì‚¬í•­</h2>
<p>ì•ˆë‚´ì„œë¥¼ ë”°ë¼ ê°€ê¸° ì „ì— ì´ë¯¸ ë…ë¦½ì ì¸ Keycloak ì„¤ì •ì´ ì™„ë£Œë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ë¡œì»¬ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì´ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒì„ ê¸°ëŒ€í•©ë‹ˆë‹¤. (ì´ì „ ê¸€ì—ì„œ êµ¬ì„±í•œ í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>
<h1>ìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</h1>
<p>ë¨¼ì €, ë¡œì»¬ì—ì„œ ìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm init
</code></pre>
<p>êµ¬ì„±ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”. ì£¼ë¡œ ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©í•´ìš”.</p>
<h2>npm íŒ¨í‚¤ì§€ ì„¤ì¹˜</h2>
<p>ì´ í”„ë¡œì íŠ¸ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ë´ìš”.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm i cors dotenv express jsonwebtoken keycloak-connect nodemon
</code></pre>
<p>ê° íŒ¨í‚¤ì§€ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ í•´ë‹¹ ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
<p>jwtë¥¼ ì‚¬ìš©í•˜ì—¬ API ìš”ì²­ì„ í†µí•´ ì „ë‹¬ëœ Bearer í† í°ì„ ì½ê³ , keycloak-connectë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì„ í™•ì¸í•  ê±°ì—ìš”.</p>
<p>ë¡œì»¬ì—ì„œ API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ package.json íŒŒì¼ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ í•´ìš”. "scripts" ì•„ë˜ì— ì´ ì¤„ì„ ê°ì²´ì— ì¶”ê°€í•˜ì„¸ìš”.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: package.json</span>

...

<span class="hljs-string">"start"</span>: <span class="hljs-string">"nodemon index.js"</span>,

...
</code></pre>
<p>ì‚¬ìš© í¸ì˜ë¥¼ ìœ„í•´ package.json íŒŒì¼ì— ë£¨íŠ¸ ë° ë¯¸ë“¤ì›¨ì–´ ë””ë ‰í† ë¦¬ì˜ ê²½ë¡œ ë³„ì¹­ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: package.json</span>

...

<span class="hljs-string">"imports"</span>: {
  <span class="hljs-string">"#routes/*"</span>: <span class="hljs-string">"./routes/*.js"</span>,
  <span class="hljs-string">"#middlewares/*"</span>: <span class="hljs-string">"./middlewares/*.js"</span>
}

...
</code></pre>
<h2>ê¸°ë³¸ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°</h2>
<div class="content-ad"></div>
<p>APIê°€ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ê°„ë‹¨í•œ ê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. ë£¨íŠ¸ í´ë”ì— index.js íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: index.js</span>

<span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).<span class="hljs-title function_">config</span>();
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);

<span class="hljs-keyword">const</span> port = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span>;

<span class="hljs-comment">// ë¼ìš°í„°</span>
<span class="hljs-keyword">const</span> testRoutes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'#routes/test'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">error, req, res, next</span>) => {
  <span class="hljs-keyword">const</span> status = error.<span class="hljs-property">status</span> || <span class="hljs-number">422</span>;
  res.<span class="hljs-title function_">status</span>(status).<span class="hljs-title function_">send</span>(error.<span class="hljs-property">message</span>);
}

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-comment">// ë¼ìš°íŠ¸ ë“±ë¡</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api'</span>, testRoutes);
app.<span class="hljs-title function_">use</span>(errorHandler);

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =></span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ì„œë²„ê°€ <span class="hljs-subst">${port}</span> í¬íŠ¸ì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`</span>);
});
</code></pre>
<p>ì—¬ê¸°ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì£¼ëª©í–ˆë‚˜ìš”?</p>
<p>í”„ë¡œì íŠ¸ìš© .env íŒŒì¼ì„ ë§Œë“¤ê³ , ì´ë¯¸ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤ë©´ APIì— ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ í• ë‹¹í•´ì£¼ì„¸ìš”.</p>
<div class="content-ad"></div>
<p>ìš°ë¦¬ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ê·¸ê²ƒì„ ìƒì„±í•´ ë´…ì‹œë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: routes/test.js</span>

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();

<span class="hljs-comment">// í…ŒìŠ¤íŠ¸ ë¼ìš°íŠ¸</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/test'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =></span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">message</span>: <span class="hljs-string">"API ì—°ê²°ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤."</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-string">"ì„±ê³µ"</span>
  })
  .<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>);
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<h2>ê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ê°€ë™í•´ ë´…ì‹œë‹¤</h2>
<p>ë¡œì»¬ì—ì„œ APIë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•˜ì„¸ìš” :</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">npm start
</code></pre>
<p>í„°ë¯¸ë„ì—ì„œ 'Server Started at <code>port</code>'ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë  ê²ƒì…ë‹ˆë‹¤.</p>
<p>ëª¨ë“  ê²ƒì´ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë¸Œë¼ìš°ì €ì—ì„œ <a href="http://localhost:%60port%60/api/test%EC%9D%84" rel="nofollow" target="_blank">http://localhost:`port`/api/testì„</a> ì—´ì–´ë³´ì„¸ìš”. ì—¬ê¸°ì—ì„œëŠ” test.js ë¼ìš°íŠ¸ íŒŒì¼ì—ì„œ ë§Œë“  ì‘ë‹µ ê°ì²´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ê¸°ë³¸ í”„ë¡œì íŠ¸ê°€ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘ ì¤‘ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
<h1>ì‚¬ìš©ì„ ìœ„í•œ Keycloak êµ¬ì„±í•˜ê¸°</h1>
<div class="content-ad"></div>
<p>ì„¤ì •í•œ Keycloakìœ¼ë¡œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ Realmì„ ìƒì„±í•´ë³´ì„¸ìš”. ì €ëŠ” ê°„ë‹¨í•˜ê²Œ "rbacDemo"ë¼ê³  ì§€ì—ˆìŠµë‹ˆë‹¤.</p>
<p>ë§Œë“¤ì–´ì§„ Realmìœ¼ë¡œ ì´ë™í•œ í›„, ì¢Œì¸¡ì˜ "Clients"ë¥¼ ì„ íƒí•˜ê³  "Client ëª©ë¡" íƒ­ì—ì„œ "Client ë§Œë“¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”. "Client ë§Œë“¤ê¸°" ì–‘ì‹ì—ì„œ "ì¼ë°˜ ì„¤ì •" ì•„ë˜ì— ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.</p>
<p>"Realm ì—­í• "ë¡œ ì´ë™í•˜ì—¬ ì¢Œì¸¡ì— ìˆëŠ” "ì—­í•  ë§Œë“¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”. ìš°ë¦¬ëŠ” ì´ Realmì„ ìœ„í•œ ê´€ë¦¬ì ì—­í• ì„ ë§Œë“¤ ì˜ˆì •ì…ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p><img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_1.png" alt="ì´ë¯¸ì§€1"></p>
<p>ì´ì œ "Realm roles"ë¡œ ëŒì•„ê°€ë©´ ë°©ê¸ˆ ë§Œë“  ê´€ë¦¬ì ì—­í• ì„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>ì´ì œ ìš°ë¦¬ì˜ realm ë° í´ë¼ì´ì–¸íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤. 2ëª…ë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” ê´€ë¦¬ì ì‚¬ìš©ìì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì¼ë°˜ ì‚¬ìš©ìì…ë‹ˆë‹¤. "ì‚¬ìš©ì"ë¡œ ì´ë™í•˜ê³  "ì‚¬ìš©ì ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
<p><img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_2.png" alt="ì´ë¯¸ì§€2"></p>
<div class="content-ad"></div>
<p>ê´€ë¦¬ì ì‚¬ìš©ìê°€ ìƒì„±ë˜ë©´ ì‚¬ìš©ìì˜ "ì‚¬ìš©ì ì„¸ë¶€ì •ë³´" í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ "ìê²© ì¦ëª…" íƒ­ì—ì„œ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
<p><img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_3.png" alt="ì´ë¯¸ì§€"></p>
<p>í•œ ë²ˆ ë” "ì‚¬ìš©ì" í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
<p><img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_4.png" alt="ì´ë¯¸ì§€"></p>
<div class="content-ad"></div>
<p>ì¹´ë Œì„ ìœ„í•´ë„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§Œë“¤ì§€ ì•Šë„ë¡í•˜ì„¸ìš”.
"ì‚¬ìš©ì"ë¡œ ëŒì•„ê°€ì„œ ì´ì œ ëª©ë¡ì— Adminê³¼ Karen ë‘ ëª…ì˜ ì‚¬ìš©ìê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.</p>
<p>ì´ì œ ì–´ë“œë¯¼ ì‚¬ìš©ìë¡œ ì´ë™í•˜ì—¬ "Role mapping" íƒ­ ì•„ë˜ì—ì„œ ì‚¬ìš©ìì—ê²Œ ì—­í• ì„ í• ë‹¹í•´ë³¼ê¹Œìš”?</p>
<p><img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_5.png" alt="ì´ë¯¸ì§€"></p>
<p>ì´ì œ ìš°ë¦¬ ì–´ë“œë¯¼ ì‚¬ìš©ìì—ê²Œ "admin" ì—­í• ì´ í• ë‹¹ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.</p>
<div class="content-ad"></div>
<img src="/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_6.png">
<p>ê·¸ê²ƒë§Œìœ¼ë¡œë„ Keycloakì—ì„œ RBAC ì‘ì—…ì„ ì‹œì‘í•  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤.</p>
<h1>APIì— RBAC êµ¬í˜„í•˜ê¸°</h1>
<p>ë¨¼ì € Keycloak Realm ë° Client IDë¥¼ .env íŒŒì¼ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<pre><code class="hljs language-js">í‚¤í´ë¡œí¬ê°€ ìˆëŠ” ìœ„ì¹˜ì— ë”°ë¼ <span class="hljs-variable constant_">KEYCLOAK_URL</span>ì„ ë³€ê²½í•´ì£¼ì„¸ìš”.

## í‚¤í´ë¡œí¬ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •

keycloak-connectë¥¼ ë¼ìš°íŠ¸ì˜ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•˜ë ¤ë©´, ìƒˆë¡œìš´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
</code></pre>
<div class="content-ad"></div>
<pre><code class="hljs language-js"><span class="hljs-comment">// file: middlewares/keycloak.js</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Keycloak</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"keycloak-connect"</span>);
<span class="hljs-keyword">const</span> dotenv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'dotenv'</span>).<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> config = {
  <span class="hljs-string">"realm"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">KEYCLOAK_REALM</span>,
  <span class="hljs-string">"auth-server-url"</span>: <span class="hljs-string">`<span class="hljs-subst">${process.env.KEYCLOAK_URL}</span>`</span>,
  <span class="hljs-string">"ssl-required"</span>: <span class="hljs-string">"external"</span>,
  <span class="hljs-string">"resource"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">KEYCLOAK_CLIENT</span>,
  <span class="hljs-string">"bearer-only"</span>: <span class="hljs-literal">true</span>
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Keycloak</span>({}, config);
</code></pre>
<p>ê·¸ëŸ° ë‹¤ìŒ ìš°ë¦¬ëŠ” index.jsì— ë°©ê¸ˆ ë§Œë“  ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì•Œë ¤ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// file: index.js</span>

...

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> keycloak = <span class="hljs-built_in">require</span>(<span class="hljs-string">'#middlewares/keycloak'</span>); <span class="hljs-comment">// Keycloak</span>

...

app.<span class="hljs-title function_">use</span>(keycloak.<span class="hljs-title function_">middleware</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

...
</code></pre>
<h2>ë¼ìš°íŠ¸ì— Keycloak ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€í•˜ê¸°</h2>
<div class="content-ad"></div>
<p>ìƒˆë¡œìš´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ê²ƒì´ì—ìš”.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: routes/menuItems.js</span>

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>();

<span class="hljs-comment">// ë¯¸ë“¤ì›¨ì–´</span>
<span class="hljs-keyword">const</span> keycloak = <span class="hljs-built_in">require</span>(<span class="hljs-string">"#middlewares/keycloak"</span>);

<span class="hljs-comment">// ê°€ì§œ ë°ì´í„°</span>
<span class="hljs-keyword">const</span> menuItems = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"í¬ë£¨ì•„ìƒ"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$1"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">true</span>
  },
  {
    <span class="hljs-attr">name</span>:<span class="hljs-string">"ë¼ë–¼"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$5"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">true</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"ë¡œí‹° ì°¨ë‚˜ì´"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$0.50"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">true</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"í•« ì´ˆì½œë¦¿"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$5"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">false</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"ì‚¬í…Œ"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$8"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">false</span>
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"íŒŸ íƒ€ì´"</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-string">"$7"</span>,
    <span class="hljs-attr">onMenu</span>: <span class="hljs-literal">false</span>
  }
];

<span class="hljs-comment">// ì–´ë–¤ ì—­í• ì´ë“  ì—´ë ¤ ìˆëŠ” ë¼ìš°íŠ¸</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/menu-items"</span>,
[keycloak.<span class="hljs-title function_">protect</span>()],
<span class="hljs-keyword">async</span> (req, res, next) => {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> filtered = menuItems.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =></span> {
      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">onMenu</span> === <span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">return</span> item;
      }
    });

    <span class="hljs-comment">// í•„í„°ëœ ë°ì´í„° ë°˜í™˜</span>
    res.<span class="hljs-title function_">json</span>(filtered);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(error);
  }
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>ë¼ìš°íŠ¸ê°€ ë°ì´í„° ì„¸íŠ¸ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì§€ì‹œí•  ê±°ì—ìš”. ì¼ë°˜ì ìœ¼ë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•˜ê² ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ê°€ì§œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ê±°ì—ìš”.</p>
<h2>Keycloak ë¯¸ë“¤ì›¨ì–´ í…ŒìŠ¤íŠ¸í•˜ê¸°</h2>
<div class="content-ad"></div>
<p>ì•Œë¦¼: ì—¬ê¸°ì„œ ì‚¬ìš©ìì˜ ì—‘ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.</p>
<p>Bearer í† í°ì„ ìš”ì²­ì˜ ì¸ì¦ í—¤ë”ë¡œ íŒŒì‹±í•˜ê³  ìˆë‹¤ê³  ê°€ì •í•˜ë©´, ë©”ë‰´ì— ìˆëŠ” í•­ëª©ë§Œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. /menu-items ê²½ë¡œëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì—´ë ¤ ìˆê¸° ë•Œë¬¸ì— ê´€ë¦¬ìì™€ ì¹´ë Œì´ ë™ì¼í•œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.</p>
<p>Postmanì„ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h2>Bearer í† í°ì—ì„œ ë°ì´í„° ë””ì½”ë”© ë° ì¶”ì¶œí•˜ê¸°</h2>
<div class="content-ad"></div>
<p>ì´ì œ "admin" ì—­í• ì„ ê°€ì§„ ì‚¬ìš©ìì—ê²Œë§Œ ì œí•œëœ ë˜ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ì¶”ê°€í•´ ë´…ì‹œë‹¤.</p>
<p>ë¨¼ì € ë‘ ê°œì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
í•˜ë‚˜ëŠ” jsonwebtokenì„ ì‚¬ìš©í•˜ì—¬ Bearer í† í°ì—ì„œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ í•´ë… ë° ì¶”ì¶œí•˜ëŠ” ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” í•´ë‹¹ ì‚¬ìš©ìê°€ í•„ìš”í•œ ì—­í• ì„ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// file: middlewares/extractToken.js</span>

<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsonwebtoken"</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">async</span> (req, res, next) => {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// ì•¡ì„¸ìŠ¤ í† í° ë””ì½”ë”©</span>
    <span class="hljs-keyword">const</span> bearerToken = req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>;
    <span class="hljs-comment">// bearerTokenì€ "Bearer &#x3C;access_token>"ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</span>

    <span class="hljs-keyword">const</span> token = bearerToken.<span class="hljs-title function_">split</span>(<span class="hljs-string">" "</span>);
    <span class="hljs-comment">// tokenì€ ["Bearer", "&#x3C;access_token>"]ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</span>

    <span class="hljs-keyword">const</span> tokenData = jwt.<span class="hljs-title function_">decode</span>(token[<span class="hljs-number">1</span>]);
    <span class="hljs-comment">// tokenDataëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</span>

    <span class="hljs-comment">// í•´ë…ëœ í† í° ë°ì´í„°ë¥¼ ìš”ì²­ì— ì €ì¥</span>
    req.<span class="hljs-property">tokenData</span> = tokenData;

    <span class="hljs-title function_">next</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title function_">next</span>(error);
  }
}
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-comment">// file: middlewares/checkIfAdmin.js</span>

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">async</span> (req, res, next) => {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> tokenData = req.<span class="hljs-property">tokenData</span>;
    <span class="hljs-keyword">const</span> roles = tokenData.<span class="hljs-property">realm_access</span>.<span class="hljs-property">roles</span>;
    <span class="hljs-comment">// rolesëŠ” ë¬¸ìì—´ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</span>

    <span class="hljs-keyword">const</span> isAdmin = roles.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"admin"</span>);

    <span class="hljs-keyword">if</span> (isAdmin) {
      <span class="hljs-comment">// ì‚¬ìš©ìê°€ Admin ì—­í• ì„ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, ì§„í–‰í•©ë‹ˆë‹¤.</span>
      <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// ì‚¬ìš©ìê°€ ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ì˜¤ë¥˜ ë°œìƒ</span>
      <span class="hljs-keyword">const</span> error = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"ì•¡ì„¸ìŠ¤ ê±°ë¶€: ì´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."</span>);
      error.<span class="hljs-property">statusCode</span> = <span class="hljs-number">401</span>;
      <span class="hljs-keyword">throw</span> error;
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title function_">next</span>(error);
  }
}
</code></pre>
<div class="content-ad"></div>
<p>ì‘ì„±ëœ ë¯¸ë“¤ì›¨ì–´ì™€ ìƒˆë¡œìš´ ë¼ìš°íŠ¸ë¥¼ ë©”ë‰´ ì•„ì´í…œ ë¼ìš°íŠ¸ íŒŒì¼ì— ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// íŒŒì¼: routes/menuItems.js</span>

...

<span class="hljs-comment">// ë¯¸ë“¤ì›¨ì–´</span>
<span class="hljs-keyword">const</span> keycloak = <span class="hljs-built_in">require</span>(<span class="hljs-string">"#middlewares/keycloak"</span>);
<span class="hljs-keyword">const</span> extractToken = <span class="hljs-built_in">require</span>(<span class="hljs-string">"#middlewares/extractToken"</span>);
<span class="hljs-keyword">const</span> checkIfAdmin = <span class="hljs-built_in">require</span>(<span class="hljs-string">"#middlewares/checkIfAdmin"</span>);

...

<span class="hljs-comment">// ì–´ë“œë¯¼ ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¼ìš°íŠ¸</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/menu-items/all"</span>, 
[keycloak.<span class="hljs-title function_">protect</span>(), extractToken, checkIfAdmin],
<span class="hljs-keyword">async</span> ( req, res, next) => {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// ëª¨ë“  ë°ì´í„° ë°˜í™˜</span>
    res.<span class="hljs-title function_">json</span>(menuItems);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(error);
  }
});

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;
</code></pre>
<p>ì´ì œ ì´ ìƒˆë¡œìš´ API ë¼ìš°íŠ¸ë¥¼ Postmanì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.</p>
<p>Karenì˜ í† í°ì„ ì‚¬ìš©í•˜ë©´ ì•¡ì„¸ìŠ¤ ê±°ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ë§Œì•½ Adminì˜ í† í°ì„ ì‚¬ìš©í–ˆë‹¤ë©´, ë©”ë‰´ì— ìˆëŠ” ëª¨ë“  í•­ëª©ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<h1>ë§ˆë¬´ë¦¬</h1>
<p>ì—¬ê¸°ì„œëŠ” Node + Express APIì— ê°„ë‹¨í•œ Role-Based Access Control (RBAC)ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í–ˆìŠµë‹ˆë‹¤. Keycloakë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
<p>ì´ ì•ˆë‚´ì„œëŠ” ì—¬ëŸ¬ë¶„ì˜ APIì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì‰½ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê°„ì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì•ˆë‚´ì„œì—ì„œëŠ” GET ìš”ì²­ë§Œ ì‚¬ìš©í–ˆì§€ë§Œ ì‚¬ì‹¤ìƒ ë‹¤ë¥¸ ìš”ì²­ ë°©ë²•ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="content-ad"></div>
<p>ì´ ê°€ì´ë“œì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. ì´ ê¸°ì‚¬ì— ëŒ€í•´ í† ë¡ í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ ì—°ë½í•´ ì£¼ì„¸ìš”.</p>
<p>ì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”! ğŸ‘‹</p>
</body>
</html>
</div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Nodejsì™€ Expressjsë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ëŠ” Keycloak RBAC ë°©ë²•","description":"","date":"2024-06-23 13:24","slug":"2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs","content":"\n\nì•ˆë…•í•˜ì„¸ìš”!\n\nì˜¤ëŠ˜ì€ Node.js ë° Express.js APIì— ëŒ€í•œ ê°„ë‹¨í•œ ì—­í•  ê¸°ë°˜ ì•¡ì„¸ìŠ¤ ì œì–´ (RBAC)ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¼ ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¸ì¦ì„ ìœ„í•´ Keycloakì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\n\nKeycloak ì¸ì¦ì„ í†µí•´ Node + Express APIë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ëŠ” í•´ê²°ì±…ì„ ì°¾ë˜ ì¤‘ Keycloak Node.js ì–´ëŒ‘í„°ì¸ keycloak-connectë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ ì–´ëŒ‘í„°ëŠ” ëª¨ë“  ìš”ì²­ê³¼ í•¨ê»˜ ì œê³µëœ Bearer í† í°ì„ í™•ì¸í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•´ì£¼ì§€ë§Œ, íŠ¹ì • ì—­í• ì´ ìˆëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ê²½ë¡œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì€ ì¡°ê¸ˆ ë” ë³µì¡í•´ì¡ŒìŠµë‹ˆë‹¤.\n\nì¡°ì‚¬í•œ ê²°ê³¼, Keycloakì—ì„œ í° ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•ŠëŠ” í•´ê²°ì±…ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•¨ê»˜ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n## ì¤€ë¹„ ì‚¬í•­\n\nì•ˆë‚´ì„œë¥¼ ë”°ë¼ ê°€ê¸° ì „ì— ì´ë¯¸ ë…ë¦½ì ì¸ Keycloak ì„¤ì •ì´ ì™„ë£Œë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ë¡œì»¬ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì´ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒì„ ê¸°ëŒ€í•©ë‹ˆë‹¤. (ì´ì „ ê¸€ì—ì„œ êµ¬ì„±í•œ í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)\n\n# ìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°\n\në¨¼ì €, ë¡œì»¬ì—ì„œ ìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm init\n```\n\nêµ¬ì„±ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”. ì£¼ë¡œ ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©í•´ìš”.\n\n## npm íŒ¨í‚¤ì§€ ì„¤ì¹˜\n\nì´ í”„ë¡œì íŠ¸ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ë´ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm i cors dotenv express jsonwebtoken keycloak-connect nodemon\n```\n\nê° íŒ¨í‚¤ì§€ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ í•´ë‹¹ ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.\n\njwtë¥¼ ì‚¬ìš©í•˜ì—¬ API ìš”ì²­ì„ í†µí•´ ì „ë‹¬ëœ Bearer í† í°ì„ ì½ê³ , keycloak-connectë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì„ í™•ì¸í•  ê±°ì—ìš”.\n\në¡œì»¬ì—ì„œ API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ package.json íŒŒì¼ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ í•´ìš”. \"scripts\" ì•„ë˜ì— ì´ ì¤„ì„ ê°ì²´ì— ì¶”ê°€í•˜ì„¸ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n// íŒŒì¼: package.json\n\n...\n\n\"start\": \"nodemon index.js\",\n\n...\n```\n\nì‚¬ìš© í¸ì˜ë¥¼ ìœ„í•´ package.json íŒŒì¼ì— ë£¨íŠ¸ ë° ë¯¸ë“¤ì›¨ì–´ ë””ë ‰í† ë¦¬ì˜ ê²½ë¡œ ë³„ì¹­ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\n\n```js\n// íŒŒì¼: package.json\n\n...\n\n\"imports\": {\n  \"#routes/*\": \"./routes/*.js\",\n  \"#middlewares/*\": \"./middlewares/*.js\"\n}\n\n...\n```\n\n## ê¸°ë³¸ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nAPIê°€ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ê°„ë‹¨í•œ ê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. ë£¨íŠ¸ í´ë”ì— index.js íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.\n\n```js\n// íŒŒì¼: index.js\n\nrequire('dotenv').config();\nconst cors = require('cors');\nconst express = require('express');\n\nconst port = process.env.PORT;\n\n// ë¼ìš°í„°\nconst testRoutes = require('#routes/test');\n\nconst errorHandler = (error, req, res, next) =\u003e {\n  const status = error.status || 422;\n  res.status(status).send(error.message);\n}\n\nconst app = express();\n\napp.use(express.json());\napp.use(cors());\n\n// ë¼ìš°íŠ¸ ë“±ë¡\napp.use('/api', testRoutes);\napp.use(errorHandler);\n\napp.listen(port, () =\u003e {\n  console.log(`ì„œë²„ê°€ ${port} í¬íŠ¸ì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n});\n```\n\nì—¬ê¸°ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì£¼ëª©í–ˆë‚˜ìš”?\n\ní”„ë¡œì íŠ¸ìš© .env íŒŒì¼ì„ ë§Œë“¤ê³ , ì´ë¯¸ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤ë©´ APIì— ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ í• ë‹¹í•´ì£¼ì„¸ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nìš°ë¦¬ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ê·¸ê²ƒì„ ìƒì„±í•´ ë´…ì‹œë‹¤.\n\n```js\n// íŒŒì¼: routes/test.js\n\nconst express = require('express');\nconst router = express.Router();\n\n// í…ŒìŠ¤íŠ¸ ë¼ìš°íŠ¸\nrouter.get('/test', (req, res) =\u003e {\n  res.json({\n    message: \"API ì—°ê²°ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\",\n    status: \"ì„±ê³µ\"\n  })\n  .status(200);\n});\n\nmodule.exports = router;\n```\n\n## ê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ê°€ë™í•´ ë´…ì‹œë‹¤\n\në¡œì»¬ì—ì„œ APIë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•˜ì„¸ìš” :\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\nnpm start\n```\n\ní„°ë¯¸ë„ì—ì„œ 'Server Started at `port`'ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë  ê²ƒì…ë‹ˆë‹¤.\n\nëª¨ë“  ê²ƒì´ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:`port`/api/testì„ ì—´ì–´ë³´ì„¸ìš”. ì—¬ê¸°ì—ì„œëŠ” test.js ë¼ìš°íŠ¸ íŒŒì¼ì—ì„œ ë§Œë“  ì‘ë‹µ ê°ì²´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ê¸°ë³¸ í”„ë¡œì íŠ¸ê°€ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘ ì¤‘ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n\n# ì‚¬ìš©ì„ ìœ„í•œ Keycloak êµ¬ì„±í•˜ê¸°\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì„¤ì •í•œ Keycloakìœ¼ë¡œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ Realmì„ ìƒì„±í•´ë³´ì„¸ìš”. ì €ëŠ” ê°„ë‹¨í•˜ê²Œ \"rbacDemo\"ë¼ê³  ì§€ì—ˆìŠµë‹ˆë‹¤.\n\në§Œë“¤ì–´ì§„ Realmìœ¼ë¡œ ì´ë™í•œ í›„, ì¢Œì¸¡ì˜ \"Clients\"ë¥¼ ì„ íƒí•˜ê³  \"Client ëª©ë¡\" íƒ­ì—ì„œ \"Client ë§Œë“¤ê¸°\" ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”. \"Client ë§Œë“¤ê¸°\" ì–‘ì‹ì—ì„œ \"ì¼ë°˜ ì„¤ì •\" ì•„ë˜ì— ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.\n\n\"Realm ì—­í• \"ë¡œ ì´ë™í•˜ì—¬ ì¢Œì¸¡ì— ìˆëŠ” \"ì—­í•  ë§Œë“¤ê¸°\" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”. ìš°ë¦¬ëŠ” ì´ Realmì„ ìœ„í•œ ê´€ë¦¬ì ì—­í• ì„ ë§Œë“¤ ì˜ˆì •ì…ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n![ì´ë¯¸ì§€1](/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_1.png)\n\nì´ì œ \"Realm roles\"ë¡œ ëŒì•„ê°€ë©´ ë°©ê¸ˆ ë§Œë“  ê´€ë¦¬ì ì—­í• ì„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\n\nì´ì œ ìš°ë¦¬ì˜ realm ë° í´ë¼ì´ì–¸íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤. 2ëª…ë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” ê´€ë¦¬ì ì‚¬ìš©ìì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì¼ë°˜ ì‚¬ìš©ìì…ë‹ˆë‹¤. \"ì‚¬ìš©ì\"ë¡œ ì´ë™í•˜ê³  \"ì‚¬ìš©ì ì¶”ê°€\" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.\n\n![ì´ë¯¸ì§€2](/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_2.png)\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nê´€ë¦¬ì ì‚¬ìš©ìê°€ ìƒì„±ë˜ë©´ ì‚¬ìš©ìì˜ \"ì‚¬ìš©ì ì„¸ë¶€ì •ë³´\" í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ \"ìê²© ì¦ëª…\" íƒ­ì—ì„œ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.\n\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_3.png)\n\n\ní•œ ë²ˆ ë” \"ì‚¬ìš©ì\" í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.\n\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_4.png)\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì¹´ë Œì„ ìœ„í•´ë„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§Œë“¤ì§€ ì•Šë„ë¡í•˜ì„¸ìš”.\n\"ì‚¬ìš©ì\"ë¡œ ëŒì•„ê°€ì„œ ì´ì œ ëª©ë¡ì— Adminê³¼ Karen ë‘ ëª…ì˜ ì‚¬ìš©ìê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.\n\nì´ì œ ì–´ë“œë¯¼ ì‚¬ìš©ìë¡œ ì´ë™í•˜ì—¬ \"Role mapping\" íƒ­ ì•„ë˜ì—ì„œ ì‚¬ìš©ìì—ê²Œ ì—­í• ì„ í• ë‹¹í•´ë³¼ê¹Œìš”?\n\n![ì´ë¯¸ì§€](/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_5.png)\n\nì´ì œ ìš°ë¦¬ ì–´ë“œë¯¼ ì‚¬ìš©ìì—ê²Œ \"admin\" ì—­í• ì´ í• ë‹¹ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n\n\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_6.png\" /\u003e\n\nê·¸ê²ƒë§Œìœ¼ë¡œë„ Keycloakì—ì„œ RBAC ì‘ì—…ì„ ì‹œì‘í•  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤.\n\n# APIì— RBAC êµ¬í˜„í•˜ê¸°\n\në¨¼ì € Keycloak Realm ë° Client IDë¥¼ .env íŒŒì¼ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\ní‚¤í´ë¡œí¬ê°€ ìˆëŠ” ìœ„ì¹˜ì— ë”°ë¼ KEYCLOAK_URLì„ ë³€ê²½í•´ì£¼ì„¸ìš”.\n\n## í‚¤í´ë¡œí¬ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •\n\nkeycloak-connectë¥¼ ë¼ìš°íŠ¸ì˜ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•˜ë ¤ë©´, ìƒˆë¡œìš´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.\n```  \n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\n```js\n// file: middlewares/keycloak.js\n\nconst Keycloak = require(\"keycloak-connect\");\nconst dotenv = require('dotenv').config();\n\nconst config = {\n  \"realm\": process.env.KEYCLOAK_REALM,\n  \"auth-server-url\": `${process.env.KEYCLOAK_URL}`,\n  \"ssl-required\": \"external\",\n  \"resource\": process.env.KEYCLOAK_CLIENT,\n  \"bearer-only\": true\n}\n\nmodule.exports = new Keycloak({}, config);\n```\n\nê·¸ëŸ° ë‹¤ìŒ ìš°ë¦¬ëŠ” index.jsì— ë°©ê¸ˆ ë§Œë“  ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì•Œë ¤ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\n\n```js\n// file: index.js\n\n...\n\nconst express = require('express');\nconst keycloak = require('#middlewares/keycloak'); // Keycloak\n\n...\n\napp.use(keycloak.middleware());\napp.use(express.json());\n\n...\n```\n\n## ë¼ìš°íŠ¸ì— Keycloak ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€í•˜ê¸°\n\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nìƒˆë¡œìš´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ê²ƒì´ì—ìš”.\n\n```js\n// íŒŒì¼: routes/menuItems.js\n\nconst express = require(\"express\");\nconst router = express.Router();\n\n// ë¯¸ë“¤ì›¨ì–´\nconst keycloak = require(\"#middlewares/keycloak\");\n\n// ê°€ì§œ ë°ì´í„°\nconst menuItems = [\n  {\n    name: \"í¬ë£¨ì•„ìƒ\",\n    price: \"$1\",\n    onMenu: true\n  },\n  {\n    name:\"ë¼ë–¼\",\n    price: \"$5\",\n    onMenu: true\n  },\n  {\n    name: \"ë¡œí‹° ì°¨ë‚˜ì´\",\n    price: \"$0.50\",\n    onMenu: true\n  },\n  {\n    name: \"í•« ì´ˆì½œë¦¿\",\n    price: \"$5\",\n    onMenu: false\n  },\n  {\n    name: \"ì‚¬í…Œ\",\n    price: \"$8\",\n    onMenu: false\n  },\n  {\n    name: \"íŒŸ íƒ€ì´\",\n    price: \"$7\",\n    onMenu: false\n  }\n];\n\n// ì–´ë–¤ ì—­í• ì´ë“  ì—´ë ¤ ìˆëŠ” ë¼ìš°íŠ¸\nrouter.get(\"/menu-items\",\n[keycloak.protect()],\nasync (req, res, next) =\u003e {\n  try {\n    let filtered = menuItems.filter(item =\u003e {\n      if (item.onMenu === true) {\n        return item;\n      }\n    });\n\n    // í•„í„°ëœ ë°ì´í„° ë°˜í™˜\n    res.json(filtered);\n  } catch (error) {\n    return next(error);\n  }\n});\n\nmodule.exports = router;\n```\n\në¼ìš°íŠ¸ê°€ ë°ì´í„° ì„¸íŠ¸ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì§€ì‹œí•  ê±°ì—ìš”. ì¼ë°˜ì ìœ¼ë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•˜ê² ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ê°€ì§œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ê±°ì—ìš”.\n\n## Keycloak ë¯¸ë“¤ì›¨ì–´ í…ŒìŠ¤íŠ¸í•˜ê¸°\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì•Œë¦¼: ì—¬ê¸°ì„œ ì‚¬ìš©ìì˜ ì—‘ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.\n\nBearer í† í°ì„ ìš”ì²­ì˜ ì¸ì¦ í—¤ë”ë¡œ íŒŒì‹±í•˜ê³  ìˆë‹¤ê³  ê°€ì •í•˜ë©´, ë©”ë‰´ì— ìˆëŠ” í•­ëª©ë§Œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. /menu-items ê²½ë¡œëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì—´ë ¤ ìˆê¸° ë•Œë¬¸ì— ê´€ë¦¬ìì™€ ì¹´ë Œì´ ë™ì¼í•œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.\n\nPostmanì„ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## Bearer í† í°ì—ì„œ ë°ì´í„° ë””ì½”ë”© ë° ì¶”ì¶œí•˜ê¸°\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì´ì œ \"admin\" ì—­í• ì„ ê°€ì§„ ì‚¬ìš©ìì—ê²Œë§Œ ì œí•œëœ ë˜ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ì¶”ê°€í•´ ë´…ì‹œë‹¤.\n\në¨¼ì € ë‘ ê°œì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\ní•˜ë‚˜ëŠ” jsonwebtokenì„ ì‚¬ìš©í•˜ì—¬ Bearer í† í°ì—ì„œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ í•´ë… ë° ì¶”ì¶œí•˜ëŠ” ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” í•´ë‹¹ ì‚¬ìš©ìê°€ í•„ìš”í•œ ì—­í• ì„ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\n```js\n// file: middlewares/extractToken.js\n\nconst jwt = require(\"jsonwebtoken\");\n\nmodule.exports = async (req, res, next) =\u003e {\n  try {\n    // ì•¡ì„¸ìŠ¤ í† í° ë””ì½”ë”©\n    const bearerToken = req.headers.authorization;\n    // bearerTokenì€ \"Bearer \u003caccess_token\u003e\"ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\n\n    const token = bearerToken.split(\" \");\n    // tokenì€ [\"Bearer\", \"\u003caccess_token\u003e\"]ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\n\n    const tokenData = jwt.decode(token[1]);\n    // tokenDataëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.\n\n    // í•´ë…ëœ í† í° ë°ì´í„°ë¥¼ ìš”ì²­ì— ì €ì¥\n    req.tokenData = tokenData;\n\n    next();\n  } catch (error) {\n    next(error);\n  }\n}\n```\n\n```js\n// file: middlewares/checkIfAdmin.js\n\nmodule.exports = async (req, res, next) =\u003e {\n  try {\n    const tokenData = req.tokenData;\n    const roles = tokenData.realm_access.roles;\n    // rolesëŠ” ë¬¸ìì—´ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\n\n    const isAdmin = roles.includes(\"admin\");\n\n    if (isAdmin) {\n      // ì‚¬ìš©ìê°€ Admin ì—­í• ì„ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, ì§„í–‰í•©ë‹ˆë‹¤.\n      next();\n    } else {\n      // ì‚¬ìš©ìê°€ ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ì˜¤ë¥˜ ë°œìƒ\n      const error = new Error(\"ì•¡ì„¸ìŠ¤ ê±°ë¶€: ì´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\");\n      error.statusCode = 401;\n      throw error;\n    }\n  } catch (error) {\n    next(error);\n  }\n}\n```\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì‘ì„±ëœ ë¯¸ë“¤ì›¨ì–´ì™€ ìƒˆë¡œìš´ ë¼ìš°íŠ¸ë¥¼ ë©”ë‰´ ì•„ì´í…œ ë¼ìš°íŠ¸ íŒŒì¼ì— ì¶”ê°€í•´ë³´ì„¸ìš”.\n\n```js\n// íŒŒì¼: routes/menuItems.js\n\n...\n\n// ë¯¸ë“¤ì›¨ì–´\nconst keycloak = require(\"#middlewares/keycloak\");\nconst extractToken = require(\"#middlewares/extractToken\");\nconst checkIfAdmin = require(\"#middlewares/checkIfAdmin\");\n\n...\n\n// ì–´ë“œë¯¼ ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¼ìš°íŠ¸\nrouter.get(\"/menu-items/all\", \n[keycloak.protect(), extractToken, checkIfAdmin],\nasync ( req, res, next) =\u003e {\n  try {\n    // ëª¨ë“  ë°ì´í„° ë°˜í™˜\n    res.json(menuItems);\n  } catch (error) {\n    return next(error);\n  }\n});\n\nmodule.exports = router;\n```\n\nì´ì œ ì´ ìƒˆë¡œìš´ API ë¼ìš°íŠ¸ë¥¼ Postmanì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.\n\nKarenì˜ í† í°ì„ ì‚¬ìš©í•˜ë©´ ì•¡ì„¸ìŠ¤ ê±°ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\në§Œì•½ Adminì˜ í† í°ì„ ì‚¬ìš©í–ˆë‹¤ë©´, ë©”ë‰´ì— ìˆëŠ” ëª¨ë“  í•­ëª©ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n# ë§ˆë¬´ë¦¬\n\nì—¬ê¸°ì„œëŠ” Node + Express APIì— ê°„ë‹¨í•œ Role-Based Access Control (RBAC)ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í–ˆìŠµë‹ˆë‹¤. Keycloakë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\n\nì´ ì•ˆë‚´ì„œëŠ” ì—¬ëŸ¬ë¶„ì˜ APIì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì‰½ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê°„ì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì•ˆë‚´ì„œì—ì„œëŠ” GET ìš”ì²­ë§Œ ì‚¬ìš©í–ˆì§€ë§Œ ì‚¬ì‹¤ìƒ ë‹¤ë¥¸ ìš”ì²­ ë°©ë²•ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\nì´ ê°€ì´ë“œì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. ì´ ê¸°ì‚¬ì— ëŒ€í•´ í† ë¡ í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ ì—°ë½í•´ ì£¼ì„¸ìš”.\n\nì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”! ğŸ‘‹","ogImage":{"url":"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_0.png"},"coverImage":"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_0.png","tag":["Tech"],"readingTime":9},"content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003cmeta content=\"width=device-width, initial-scale=1\" name=\"viewport\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003eì•ˆë…•í•˜ì„¸ìš”!\u003c/p\u003e\n\u003cp\u003eì˜¤ëŠ˜ì€ Node.js ë° Express.js APIì— ëŒ€í•œ ê°„ë‹¨í•œ ì—­í•  ê¸°ë°˜ ì•¡ì„¸ìŠ¤ ì œì–´ (RBAC)ë¥¼ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¼ ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¸ì¦ì„ ìœ„í•´ Keycloakì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eKeycloak ì¸ì¦ì„ í†µí•´ Node + Express APIë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ëŠ” í•´ê²°ì±…ì„ ì°¾ë˜ ì¤‘ Keycloak Node.js ì–´ëŒ‘í„°ì¸ keycloak-connectë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì´ ì–´ëŒ‘í„°ëŠ” ëª¨ë“  ìš”ì²­ê³¼ í•¨ê»˜ ì œê³µëœ Bearer í† í°ì„ í™•ì¸í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•´ì£¼ì§€ë§Œ, íŠ¹ì • ì—­í• ì´ ìˆëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ê²½ë¡œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì€ ì¡°ê¸ˆ ë” ë³µì¡í•´ì¡ŒìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì¡°ì‚¬í•œ ê²°ê³¼, Keycloakì—ì„œ í° ì„¤ì •ì´ í•„ìš”í•˜ì§€ ì•ŠëŠ” í•´ê²°ì±…ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•¨ê»˜ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003ch2\u003eì¤€ë¹„ ì‚¬í•­\u003c/h2\u003e\n\u003cp\u003eì•ˆë‚´ì„œë¥¼ ë”°ë¼ ê°€ê¸° ì „ì— ì´ë¯¸ ë…ë¦½ì ì¸ Keycloak ì„¤ì •ì´ ì™„ë£Œë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° Dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ë¡œì»¬ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì´ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒì„ ê¸°ëŒ€í•©ë‹ˆë‹¤. (ì´ì „ ê¸€ì—ì„œ êµ¬ì„±í•œ í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)\u003c/p\u003e\n\u003ch1\u003eìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°\u003c/h1\u003e\n\u003cp\u003eë¨¼ì €, ë¡œì»¬ì—ì„œ ìƒˆë¡œìš´ Node.js í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm init\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eêµ¬ì„±ì„ ì›í•˜ëŠ” ëŒ€ë¡œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”. ì£¼ë¡œ ê¸°ë³¸ ì„¤ì •ì„ ì‚¬ìš©í•´ìš”.\u003c/p\u003e\n\u003ch2\u003enpm íŒ¨í‚¤ì§€ ì„¤ì¹˜\u003c/h2\u003e\n\u003cp\u003eì´ í”„ë¡œì íŠ¸ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ë´ìš”.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm i cors dotenv express jsonwebtoken keycloak-connect nodemon\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eê° íŒ¨í‚¤ì§€ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ í•´ë‹¹ ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.\u003c/p\u003e\n\u003cp\u003ejwtë¥¼ ì‚¬ìš©í•˜ì—¬ API ìš”ì²­ì„ í†µí•´ ì „ë‹¬ëœ Bearer í† í°ì„ ì½ê³ , keycloak-connectë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì„ í™•ì¸í•  ê±°ì—ìš”.\u003c/p\u003e\n\u003cp\u003eë¡œì»¬ì—ì„œ API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ package.json íŒŒì¼ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ í•´ìš”. \"scripts\" ì•„ë˜ì— ì´ ì¤„ì„ ê°ì²´ì— ì¶”ê°€í•˜ì„¸ìš”.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: package.json\u003c/span\u003e\n\n...\n\n\u003cspan class=\"hljs-string\"\u003e\"start\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"nodemon index.js\"\u003c/span\u003e,\n\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì‚¬ìš© í¸ì˜ë¥¼ ìœ„í•´ package.json íŒŒì¼ì— ë£¨íŠ¸ ë° ë¯¸ë“¤ì›¨ì–´ ë””ë ‰í† ë¦¬ì˜ ê²½ë¡œ ë³„ì¹­ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: package.json\u003c/span\u003e\n\n...\n\n\u003cspan class=\"hljs-string\"\u003e\"imports\"\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\"#routes/*\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./routes/*.js\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"#middlewares/*\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"./middlewares/*.js\"\u003c/span\u003e\n}\n\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eê¸°ë³¸ í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eAPIê°€ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ê°„ë‹¨í•œ ê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. ë£¨íŠ¸ í´ë”ì— index.js íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: index.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'dotenv'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003econfig\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cors = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'cors'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e port = process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ePORT\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// ë¼ìš°í„°\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e testRoutes = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'#routes/test'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eerrorHandler\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003eerror, req, res, next\u003c/span\u003e) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e status = error.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e || \u003cspan class=\"hljs-number\"\u003e422\u003c/span\u003e;\n  res.\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(status).\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e(error.\u003cspan class=\"hljs-property\"\u003emessage\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(express.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e());\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ecors\u003c/span\u003e());\n\n\u003cspan class=\"hljs-comment\"\u003e// ë¼ìš°íŠ¸ ë“±ë¡\u003c/span\u003e\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/api'\u003c/span\u003e, testRoutes);\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(errorHandler);\n\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(port, \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`ì„œë²„ê°€ \u003cspan class=\"hljs-subst\"\u003e${port}\u003c/span\u003e í¬íŠ¸ì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì—¬ê¸°ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì£¼ëª©í–ˆë‚˜ìš”?\u003c/p\u003e\n\u003cp\u003eí”„ë¡œì íŠ¸ìš© .env íŒŒì¼ì„ ë§Œë“¤ê³ , ì´ë¯¸ ë§Œë“¤ì§€ ì•Šì•˜ë‹¤ë©´ APIì— ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ í• ë‹¹í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eìš°ë¦¬ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ê·¸ê²ƒì„ ìƒì„±í•´ ë´…ì‹œë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: routes/test.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = express.\u003cspan class=\"hljs-title class_\"\u003eRouter\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// í…ŒìŠ¤íŠ¸ ë¼ìš°íŠ¸\u003c/span\u003e\nrouter.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'/test'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  res.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"API ì—°ê²°ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003estatus\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ì„±ê³µ\"\u003c/span\u003e\n  })\n  .\u003cspan class=\"hljs-title function_\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e);\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eê¸°ë³¸ í”„ë¡œì íŠ¸ë¥¼ ê°€ë™í•´ ë´…ì‹œë‹¤\u003c/h2\u003e\n\u003cp\u003eë¡œì»¬ì—ì„œ APIë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•˜ì„¸ìš” :\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003enpm start\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eí„°ë¯¸ë„ì—ì„œ 'Server Started at \u003ccode\u003eport\u003c/code\u003e'ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ í‘œì‹œë  ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eëª¨ë“  ê²ƒì´ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë¸Œë¼ìš°ì €ì—ì„œ \u003ca href=\"http://localhost:%60port%60/api/test%EC%9D%84\" rel=\"nofollow\" target=\"_blank\"\u003ehttp://localhost:`port`/api/testì„\u003c/a\u003e ì—´ì–´ë³´ì„¸ìš”. ì—¬ê¸°ì—ì„œëŠ” test.js ë¼ìš°íŠ¸ íŒŒì¼ì—ì„œ ë§Œë“  ì‘ë‹µ ê°ì²´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë¦¬ì˜ ê¸°ë³¸ í”„ë¡œì íŠ¸ê°€ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘ ì¤‘ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003ch1\u003eì‚¬ìš©ì„ ìœ„í•œ Keycloak êµ¬ì„±í•˜ê¸°\u003c/h1\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì„¤ì •í•œ Keycloakìœ¼ë¡œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ Realmì„ ìƒì„±í•´ë³´ì„¸ìš”. ì €ëŠ” ê°„ë‹¨í•˜ê²Œ \"rbacDemo\"ë¼ê³  ì§€ì—ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eë§Œë“¤ì–´ì§„ Realmìœ¼ë¡œ ì´ë™í•œ í›„, ì¢Œì¸¡ì˜ \"Clients\"ë¥¼ ì„ íƒí•˜ê³  \"Client ëª©ë¡\" íƒ­ì—ì„œ \"Client ë§Œë“¤ê¸°\" ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”. \"Client ë§Œë“¤ê¸°\" ì–‘ì‹ì—ì„œ \"ì¼ë°˜ ì„¤ì •\" ì•„ë˜ì— ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\"Realm ì—­í• \"ë¡œ ì´ë™í•˜ì—¬ ì¢Œì¸¡ì— ìˆëŠ” \"ì—­í•  ë§Œë“¤ê¸°\" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”. ìš°ë¦¬ëŠ” ì´ Realmì„ ìœ„í•œ ê´€ë¦¬ì ì—­í• ì„ ë§Œë“¤ ì˜ˆì •ì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_1.png\" alt=\"ì´ë¯¸ì§€1\"\u003e\u003c/p\u003e\n\u003cp\u003eì´ì œ \"Realm roles\"ë¡œ ëŒì•„ê°€ë©´ ë°©ê¸ˆ ë§Œë“  ê´€ë¦¬ì ì—­í• ì„ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì´ì œ ìš°ë¦¬ì˜ realm ë° í´ë¼ì´ì–¸íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìê°€ í•„ìš”í•©ë‹ˆë‹¤. 2ëª…ë§Œ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” ê´€ë¦¬ì ì‚¬ìš©ìì´ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì¼ë°˜ ì‚¬ìš©ìì…ë‹ˆë‹¤. \"ì‚¬ìš©ì\"ë¡œ ì´ë™í•˜ê³  \"ì‚¬ìš©ì ì¶”ê°€\" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_2.png\" alt=\"ì´ë¯¸ì§€2\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eê´€ë¦¬ì ì‚¬ìš©ìê°€ ìƒì„±ë˜ë©´ ì‚¬ìš©ìì˜ \"ì‚¬ìš©ì ì„¸ë¶€ì •ë³´\" í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ \"ìê²© ì¦ëª…\" íƒ­ì—ì„œ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_3.png\" alt=\"ì´ë¯¸ì§€\"\u003e\u003c/p\u003e\n\u003cp\u003eí•œ ë²ˆ ë” \"ì‚¬ìš©ì\" í˜ì´ì§€ë¡œ ëŒì•„ê°€ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_4.png\" alt=\"ì´ë¯¸ì§€\"\u003e\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì¹´ë Œì„ ìœ„í•´ë„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§Œë“¤ì§€ ì•Šë„ë¡í•˜ì„¸ìš”.\n\"ì‚¬ìš©ì\"ë¡œ ëŒì•„ê°€ì„œ ì´ì œ ëª©ë¡ì— Adminê³¼ Karen ë‘ ëª…ì˜ ì‚¬ìš©ìê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.\u003c/p\u003e\n\u003cp\u003eì´ì œ ì–´ë“œë¯¼ ì‚¬ìš©ìë¡œ ì´ë™í•˜ì—¬ \"Role mapping\" íƒ­ ì•„ë˜ì—ì„œ ì‚¬ìš©ìì—ê²Œ ì—­í• ì„ í• ë‹¹í•´ë³¼ê¹Œìš”?\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_5.png\" alt=\"ì´ë¯¸ì§€\"\u003e\u003c/p\u003e\n\u003cp\u003eì´ì œ ìš°ë¦¬ ì–´ë“œë¯¼ ì‚¬ìš©ìì—ê²Œ \"admin\" ì—­í• ì´ í• ë‹¹ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê±°ì—ìš”.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cimg src=\"/assets/img/2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs_6.png\"\u003e\n\u003cp\u003eê·¸ê²ƒë§Œìœ¼ë¡œë„ Keycloakì—ì„œ RBAC ì‘ì—…ì„ ì‹œì‘í•  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003ch1\u003eAPIì— RBAC êµ¬í˜„í•˜ê¸°\u003c/h1\u003e\n\u003cp\u003eë¨¼ì € Keycloak Realm ë° Client IDë¥¼ .env íŒŒì¼ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003eí‚¤í´ë¡œí¬ê°€ ìˆëŠ” ìœ„ì¹˜ì— ë”°ë¼ \u003cspan class=\"hljs-variable constant_\"\u003eKEYCLOAK_URL\u003c/span\u003eì„ ë³€ê²½í•´ì£¼ì„¸ìš”.\n\n## í‚¤í´ë¡œí¬ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •\n\nkeycloak-connectë¥¼ ë¼ìš°íŠ¸ì˜ ë¯¸ë“¤ì›¨ì–´ë¡œ ì‚¬ìš©í•˜ë ¤ë©´, ìƒˆë¡œìš´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// file: middlewares/keycloak.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKeycloak\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"keycloak-connect\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e dotenv = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'dotenv'\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003econfig\u003c/span\u003e();\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e config = {\n  \u003cspan class=\"hljs-string\"\u003e\"realm\"\u003c/span\u003e: process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eKEYCLOAK_REALM\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"auth-server-url\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${process.env.KEYCLOAK_URL}\u003c/span\u003e`\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"ssl-required\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"external\"\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"resource\"\u003c/span\u003e: process.\u003cspan class=\"hljs-property\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eKEYCLOAK_CLIENT\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\"bearer-only\"\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKeycloak\u003c/span\u003e({}, config);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eê·¸ëŸ° ë‹¤ìŒ ìš°ë¦¬ëŠ” index.jsì— ë°©ê¸ˆ ë§Œë“  ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì•Œë ¤ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// file: index.js\u003c/span\u003e\n\n...\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'express'\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e keycloak = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'#middlewares/keycloak'\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Keycloak\u003c/span\u003e\n\n...\n\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(keycloak.\u003cspan class=\"hljs-title function_\"\u003emiddleware\u003c/span\u003e());\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(express.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e());\n\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eë¼ìš°íŠ¸ì— Keycloak ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€í•˜ê¸°\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eìƒˆë¡œìš´ ë¼ìš°íŠ¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ê²ƒì´ì—ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: routes/menuItems.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"express\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = express.\u003cspan class=\"hljs-title class_\"\u003eRouter\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// ë¯¸ë“¤ì›¨ì–´\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e keycloak = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#middlewares/keycloak\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// ê°€ì§œ ë°ì´í„°\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e menuItems = [\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"í¬ë£¨ì•„ìƒ\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$1\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e:\u003cspan class=\"hljs-string\"\u003e\"ë¼ë–¼\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$5\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ë¡œí‹° ì°¨ë‚˜ì´\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$0.50\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"í•« ì´ˆì½œë¦¿\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$5\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"ì‚¬í…Œ\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$8\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  },\n  {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"íŒŸ íƒ€ì´\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eprice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"$7\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eonMenu\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n  }\n];\n\n\u003cspan class=\"hljs-comment\"\u003e// ì–´ë–¤ ì—­í• ì´ë“  ì—´ë ¤ ìˆëŠ” ë¼ìš°íŠ¸\u003c/span\u003e\nrouter.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/menu-items\"\u003c/span\u003e,\n[keycloak.\u003cspan class=\"hljs-title function_\"\u003eprotect\u003c/span\u003e()],\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res, next) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e filtered = menuItems.\u003cspan class=\"hljs-title function_\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eitem\u003c/span\u003e =\u003e\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (item.\u003cspan class=\"hljs-property\"\u003eonMenu\u003c/span\u003e === \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e item;\n      }\n    });\n\n    \u003cspan class=\"hljs-comment\"\u003e// í•„í„°ëœ ë°ì´í„° ë°˜í™˜\u003c/span\u003e\n    res.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e(filtered);\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(error);\n  }\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eë¼ìš°íŠ¸ê°€ ë°ì´í„° ì„¸íŠ¸ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì§€ì‹œí•  ê±°ì—ìš”. ì¼ë°˜ì ìœ¼ë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•˜ê² ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ê°€ì§œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ê±°ì—ìš”.\u003c/p\u003e\n\u003ch2\u003eKeycloak ë¯¸ë“¤ì›¨ì–´ í…ŒìŠ¤íŠ¸í•˜ê¸°\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì•Œë¦¼: ì—¬ê¸°ì„œ ì‚¬ìš©ìì˜ ì—‘ì„¸ìŠ¤ í† í°ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eBearer í† í°ì„ ìš”ì²­ì˜ ì¸ì¦ í—¤ë”ë¡œ íŒŒì‹±í•˜ê³  ìˆë‹¤ê³  ê°€ì •í•˜ë©´, ë©”ë‰´ì— ìˆëŠ” í•­ëª©ë§Œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. /menu-items ê²½ë¡œëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì—´ë ¤ ìˆê¸° ë•Œë¬¸ì— ê´€ë¦¬ìì™€ ì¹´ë Œì´ ë™ì¼í•œ ì‘ë‹µì„ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003ePostmanì„ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003ch2\u003eBearer í† í°ì—ì„œ ë°ì´í„° ë””ì½”ë”© ë° ì¶”ì¶œí•˜ê¸°\u003c/h2\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì´ì œ \"admin\" ì—­í• ì„ ê°€ì§„ ì‚¬ìš©ìì—ê²Œë§Œ ì œí•œëœ ë˜ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ì¶”ê°€í•´ ë´…ì‹œë‹¤.\u003c/p\u003e\n\u003cp\u003eë¨¼ì € ë‘ ê°œì˜ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\ní•˜ë‚˜ëŠ” jsonwebtokenì„ ì‚¬ìš©í•˜ì—¬ Bearer í† í°ì—ì„œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ í•´ë… ë° ì¶”ì¶œí•˜ëŠ” ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” í•´ë‹¹ ì‚¬ìš©ìê°€ í•„ìš”í•œ ì—­í• ì„ ê°€ì¡ŒëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// file: middlewares/extractToken.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e jwt = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"jsonwebtoken\"\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res, next) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// ì•¡ì„¸ìŠ¤ í† í° ë””ì½”ë”©\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e bearerToken = req.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eauthorization\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e// bearerTokenì€ \"Bearer \u0026#x3C;access_token\u003e\"ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e token = bearerToken.\u003cspan class=\"hljs-title function_\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// tokenì€ [\"Bearer\", \"\u0026#x3C;access_token\u003e\"]ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e tokenData = jwt.\u003cspan class=\"hljs-title function_\"\u003edecode\u003c/span\u003e(token[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n    \u003cspan class=\"hljs-comment\"\u003e// tokenDataëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment\"\u003e// í•´ë…ëœ í† í° ë°ì´í„°ë¥¼ ìš”ì²­ì— ì €ì¥\u003c/span\u003e\n    req.\u003cspan class=\"hljs-property\"\u003etokenData\u003c/span\u003e = tokenData;\n\n    \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e();\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(error);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// file: middlewares/checkIfAdmin.js\u003c/span\u003e\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res, next) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e tokenData = req.\u003cspan class=\"hljs-property\"\u003etokenData\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e roles = tokenData.\u003cspan class=\"hljs-property\"\u003erealm_access\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eroles\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e// rolesëŠ” ë¬¸ìì—´ ë°°ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isAdmin = roles.\u003cspan class=\"hljs-title function_\"\u003eincludes\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"admin\"\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isAdmin) {\n      \u003cspan class=\"hljs-comment\"\u003e// ì‚¬ìš©ìê°€ Admin ì—­í• ì„ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, ì§„í–‰í•©ë‹ˆë‹¤.\u003c/span\u003e\n      \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e();\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// ì‚¬ìš©ìê°€ ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ì˜¤ë¥˜ ë°œìƒ\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e error = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"ì•¡ì„¸ìŠ¤ ê±°ë¶€: ì´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.\"\u003c/span\u003e);\n      error.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e;\n      \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e error;\n    }\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(error);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì‘ì„±ëœ ë¯¸ë“¤ì›¨ì–´ì™€ ìƒˆë¡œìš´ ë¼ìš°íŠ¸ë¥¼ ë©”ë‰´ ì•„ì´í…œ ë¼ìš°íŠ¸ íŒŒì¼ì— ì¶”ê°€í•´ë³´ì„¸ìš”.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// íŒŒì¼: routes/menuItems.js\u003c/span\u003e\n\n...\n\n\u003cspan class=\"hljs-comment\"\u003e// ë¯¸ë“¤ì›¨ì–´\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e keycloak = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#middlewares/keycloak\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e extractToken = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#middlewares/extractToken\"\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e checkIfAdmin = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"#middlewares/checkIfAdmin\"\u003c/span\u003e);\n\n...\n\n\u003cspan class=\"hljs-comment\"\u003e// ì–´ë“œë¯¼ ì—­í• ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¼ìš°íŠ¸\u003c/span\u003e\nrouter.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"/menu-items/all\"\u003c/span\u003e, \n[keycloak.\u003cspan class=\"hljs-title function_\"\u003eprotect\u003c/span\u003e(), extractToken, checkIfAdmin],\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e ( req, res, next) =\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// ëª¨ë“  ë°ì´í„° ë°˜í™˜\u003c/span\u003e\n    res.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e(menuItems);\n  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(error);\n  }\n});\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eì´ì œ ì´ ìƒˆë¡œìš´ API ë¼ìš°íŠ¸ë¥¼ Postmanì„ ì‚¬ìš©í•˜ì—¬ ë‘ ì‚¬ìš©ìë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003eKarenì˜ í† í°ì„ ì‚¬ìš©í•˜ë©´ ì•¡ì„¸ìŠ¤ ê±°ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eë§Œì•½ Adminì˜ í† í°ì„ ì‚¬ìš©í–ˆë‹¤ë©´, ë©”ë‰´ì— ìˆëŠ” ëª¨ë“  í•­ëª©ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003ch1\u003eë§ˆë¬´ë¦¬\u003c/h1\u003e\n\u003cp\u003eì—¬ê¸°ì„œëŠ” Node + Express APIì— ê°„ë‹¨í•œ Role-Based Access Control (RBAC)ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í–ˆìŠµë‹ˆë‹¤. Keycloakë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cp\u003eì´ ì•ˆë‚´ì„œëŠ” ì—¬ëŸ¬ë¶„ì˜ APIì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì‰½ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê°„ì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì•ˆë‚´ì„œì—ì„œëŠ” GET ìš”ì²­ë§Œ ì‚¬ìš©í–ˆì§€ë§Œ ì‚¬ì‹¤ìƒ ë‹¤ë¥¸ ìš”ì²­ ë°©ë²•ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\u003c/p\u003e\n\u003cdiv class=\"content-ad\"\u003e\u003c/div\u003e\n\u003cp\u003eì´ ê°€ì´ë“œì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”. ì´ ê¸°ì‚¬ì— ëŒ€í•´ í† ë¡ í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ ì—°ë½í•´ ì£¼ì„¸ìš”.\u003c/p\u003e\n\u003cp\u003eì½ì–´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”! ğŸ‘‹\u003c/p\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2024-06-23-SimpleKeycloakRBACwithNodejsExpressjs"},"buildId":"Y-fCAg8BUV7y2HNFwX9AA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>